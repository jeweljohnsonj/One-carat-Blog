<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Jewel Johnson">
<meta name="dcterms.date" content="2022-09-19">
<meta name="description" content="Level up your regression knowledge using multiple explanatory variables">
<title>one carat blog - Intermediate Regression in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/quarto-contrib/social-share-0.1.0/social-share.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/social-share-0.1.0/all.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EVCS615JQR"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EVCS615JQR', { 'anonymize_ip': true});
</script><style>html{ scroll-behavior: smooth; }</style>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script><link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<link href="../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../site_libs/pagedtable-1.1/js/pagedtable.js"></script><script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script><script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script><script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
<link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="https://cdn.knightlab.com/libs/juxtapose/latest/css/juxtapose.css">
<meta property="og:title" content="one carat blog - Intermediate Regression in R">
<meta property="og:description" content="Level up your regression knowledge using multiple explanatory variables">
<meta property="og:image" content="https://one-carat-blog.netlify.app/tutorials\stat_basic\images\inter_reg.png">
<meta property="og:site-name" content="one carat blog">
<meta property="og:image:height" content="1080">
<meta property="og:image:width" content="1920">
<meta name="twitter:title" content="one carat blog - Intermediate Regression in R">
<meta name="twitter:description" content="Level up your regression knowledge using multiple explanatory variables">
<meta name="twitter:image" content="https://one-carat-blog.netlify.app/tutorials\stat_basic\images\inter_reg.png">
<meta name="twitter:image-height" content="1080">
<meta name="twitter:image-width" content="1920">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../favicon.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">one carat blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../blog.html">Blog</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials.html">Tutorials</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://jeweljohnsonj.github.io/jewel_resume/">About me</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jeweljohnsonj/one-carat-blog"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/jeweljohnsonj"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
</ul>
<div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Intermediate Regression in R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          Level up your regression knowledge using multiple explanatory variables
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">regression</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Jewel Johnson </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 19, 2022</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">1</span>  Introduction</a></li>
  <li><a href="#linear-regression-using-multiple-variables" id="toc-linear-regression-using-multiple-variables" class="nav-link" data-scroll-target="#linear-regression-using-multiple-variables"><span class="toc-section-number">2</span>  Linear regression using multiple variables</a></li>
  <li><a href="#understanding-the-summary-of-a-multivariate-linear-model" id="toc-understanding-the-summary-of-a-multivariate-linear-model" class="nav-link" data-scroll-target="#understanding-the-summary-of-a-multivariate-linear-model"><span class="toc-section-number">3</span>  Understanding the summary of a multivariate linear model</a></li>
  <li><a href="#making-predictions-using-a-multivariate-linear-model" id="toc-making-predictions-using-a-multivariate-linear-model" class="nav-link" data-scroll-target="#making-predictions-using-a-multivariate-linear-model"><span class="toc-section-number">4</span>  Making predictions using a multivariate linear model</a></li>
  <li>
<a href="#assessing-a-multivariate-linear-model-fit" id="toc-assessing-a-multivariate-linear-model-fit" class="nav-link" data-scroll-target="#assessing-a-multivariate-linear-model-fit"><span class="toc-section-number">5</span>  Assessing a multivariate linear model fit</a>
  <ul class="collapse">
<li><a href="#adjusted-r-square-value" id="toc-adjusted-r-square-value" class="nav-link" data-scroll-target="#adjusted-r-square-value"><span class="toc-section-number">5.1</span>  Adjusted R square value</a></li>
  </ul>
</li>
  <li><a href="#linear-regression-with-interacting-terms" id="toc-linear-regression-with-interacting-terms" class="nav-link" data-scroll-target="#linear-regression-with-interacting-terms"><span class="toc-section-number">6</span>  Linear regression with interacting terms</a></li>
  <li><a href="#plotting-linear-model-with-an-interaction-term" id="toc-plotting-linear-model-with-an-interaction-term" class="nav-link" data-scroll-target="#plotting-linear-model-with-an-interaction-term"><span class="toc-section-number">7</span>  Plotting linear model with an interaction term</a></li>
  <li><a href="#simpsons-paradox" id="toc-simpsons-paradox" class="nav-link" data-scroll-target="#simpsons-paradox"><span class="toc-section-number">8</span>  Simpson’s Paradox</a></li>
  <li><a href="#visualizing-linear-models-with-two-numerical-explanatory-variables" id="toc-visualizing-linear-models-with-two-numerical-explanatory-variables" class="nav-link" data-scroll-target="#visualizing-linear-models-with-two-numerical-explanatory-variables"><span class="toc-section-number">9</span>  Visualizing linear models with two numerical explanatory variables</a></li>
  <li><a href="#visualizing-logistic-models-with-two-numerical-explanatory-variables" id="toc-visualizing-logistic-models-with-two-numerical-explanatory-variables" class="nav-link" data-scroll-target="#visualizing-logistic-models-with-two-numerical-explanatory-variables"><span class="toc-section-number">10</span>  Visualizing logistic models with two numerical explanatory variables</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="toc-section-number">11</span>  Conclusion</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jeweljohnsonj/one-carat-blog/edit/main/tutorials/stat_basic/inter_reg.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/jeweljohnsonj/one-carat-blog/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><div class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="27" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 26;"><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="pp">require</span>(<span class="st">"https://cdn.jsdelivr.net/npm/juxtaposejs@1.1.6/build/js/juxtapose.min.js"</span>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">catch</span>(() <span class="kw">=&gt;</span> <span class="kw">null</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-1" data-nodetype="expression">

</div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
TL;DR
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this article you will learn;</p>
<ol type="1">
<li><p>How to build models with two or more explanatory variables</p></li>
<li><p>How to interpret multivariate models</p></li>
<li><p>How to predict values using a multivariate model</p></li>
<li><p>Assessing a multivariate model</p></li>
<li><p>Building models with interaction terms and plotting them</p></li>
<li><p>What is Simpson’s paradox</p></li>
<li><p>Visualising models with two numerical explanatory variables</p></li>
</ol>
</div>
</div>
<section id="introduction" class="level2" data-number="1"><h2 data-number="1" class="anchored" data-anchor-id="introduction">
<span class="header-section-number">1</span> Introduction</h2>
<p>This tutorial is a sequel to the previous tutorial which covered the basics of regression. Here we will extend our knowledge to build models using more than one explanatory variable, how to visualise them and how to interpret the model summaries.</p>
</section><section id="linear-regression-using-multiple-variables" class="level2" data-number="2"><h2 data-number="2" class="anchored" data-anchor-id="linear-regression-using-multiple-variables">
<span class="header-section-number">2</span> Linear regression using multiple variables</h2>
<p>In the previous tutorial, we have seen how to build a linear model with a single exploratory variable. Now we will see how to build linear models using two variables.</p>
<p>We will use the <code>HorsePrices</code> dataset from the <a href="https://github.com/statmanrobin/Stat2Data">Stat2Data</a> package in R. The dataset contains the price and related characteristics of horses listed for sale on the internet. Using the dataset, we will see how the price of a horse (<code>Price</code>) changes according to its age (<code>Age</code>) and also dues to its sex (<code>Sex</code>) using a linear model. Here, we have a numerical and a categorical variable as the explanatory variables. First, let us plot the data.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statmanrobin/Stat2Data">Stat2Data</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'Stat2Data'</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statmanrobin/Stat2Data">Stat2Data</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"HorsePrices"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the data</span></span>
<span><span class="va">HorsePrices</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Age</span>, <span class="va">Price</span>, col <span class="op">=</span> <span class="va">Sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Change in the price of the horse as a function of age and sex?"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Age (years)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Price (dollars)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_reg_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>At a glance, for intermediately aged horses, the price is high compared to the rest of the age range. Also, female horses seem to have to be priced less compared to males. Let us see if that is the case by building a linear model. To predict the response variable using multiple explanatory variables, we will append them using the <code>+</code> sign.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statmanrobin/Stat2Data">Stat2Data</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"HorsePrices"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a linear model</span></span>
<span><span class="va">model_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Price</span> <span class="op">~</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">Sex</span>, data <span class="op">=</span> <span class="va">HorsePrices</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Printing model output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_lm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Price ~ Age + Sex, data = HorsePrices)

Residuals:
   Min     1Q Median     3Q    Max 
-24988 -10296  -1494   8286  27653 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  18199.7     4129.3   4.407 6.03e-05 ***
Age           -220.1      393.8  -0.559    0.579    
Sexm         17008.6     3639.6   4.673 2.52e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 12540 on 47 degrees of freedom
Multiple R-squared:  0.3283,    Adjusted R-squared:  0.2997 
F-statistic: 11.48 on 2 and 47 DF,  p-value: 8.695e-05</code></pre>
</div>
</div>
<p>Unlike the earlier case with one explanatory variable, we now have two coefficient values and an intercept value. We will soon see how to interpret the coefficient values. But for now, we can see that their age does not significantly explain the variance seen in price but sex does.</p>
<p>Now let us try plotting the model. Instead of using the <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> function in the <a href="https://ggplot2.tidyverse.org">ggplot2</a> package in R, we will use the <code><a href="moderndive.github.io/moderndive//reference/geom_parallel_slopes.html">geom_parallel_slopes()</a></code> function from the <a href="https://moderndive.github.io/moderndive/">moderndive</a> package in R. We will later see why we did not use the <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> function.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://moderndive.github.io/moderndive/">moderndive</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'moderndive'</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statmanrobin/Stat2Data">Stat2Data</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"HorsePrices"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the data</span></span>
<span><span class="va">HorsePrices</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Age</span>, <span class="va">Price</span>, col <span class="op">=</span> <span class="va">Sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Change in the price of the horse as a function of age and sex?"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Age (years)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Price (dollars)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="moderndive.github.io/moderndive//reference/geom_parallel_slopes.html">geom_parallel_slopes</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_reg_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There is a difference in price between male and female horses but their prices are not changing across age. This is exactly what we saw in the model summary results. You can also see that the lines are parallel to each other.</p>
</section><section id="understanding-the-summary-of-a-multivariate-linear-model" class="level2" data-number="3"><h2 data-number="3" class="anchored" data-anchor-id="understanding-the-summary-of-a-multivariate-linear-model">
<span class="header-section-number">3</span> Understanding the summary of a multivariate linear model</h2>
<p>Given below is the summary output of the multivariate model we built earlier.</p>
<p><img src="images/lm_summary_multi.png" class="img-fluid"></p>
<ol type="1">
<li><p>In section 1, we have the model formula we used for building the model.</p></li>
<li><p>In section 2, we have the first quartile, median and third quartile of the residuals of the model. This tells us whether the residuals are normally distributed if the median value is close to zero and, the first and third quartile values are approximately the same in magnitude.</p></li>
<li><p>In section 3, we have the coefficient values of the exploratory variables. Please remember that the variable ‘sex’ has two levels; female and male. By default, R calculates the intercept value for the first level in the first categorical response variable in the model formula. Here, in our case, that first level is female. Therefore, the intercept value gives us the average price value for female horses when age is 0. So here, the y-intercept value of 18199 corresponds to the average price of female horses when age is 0. The second value is the slope of Age, which is -220.1, which corresponds to a decrease in the price by a value of 220.1 dollars when the age of the horse increases by 1 year. The third value corresponds to the difference in the y-intercept value for males as compared to the main intercept value, which is for females and is 18199. In short, it tells us that male horses with age 0 are priced 17008 dollars more on average when compared to female horses. If we want to see the individual averages of the levels in the categorical exploratory variables, then we should use <code>-1</code> in the model formula, which is something we saw in the earlier tutorial.</p></li>
<li><p>Section 4 contains metrics which assess model performance. In the earlier tutorial, we saw what residual standard error and R squared values means. Adjusted R square value is a metric similar to R squared value but is calculated for models with multiple explanatory variables. Like R squared, it tells us how much variance seen in the response variable is explained by the explanatory variables and the value lies between 0 and 1. Here we have around 30% variance seen in price explained by both age and sex of the horses.</p></li>
</ol></section><section id="making-predictions-using-a-multivariate-linear-model" class="level2" data-number="4"><h2 data-number="4" class="anchored" data-anchor-id="making-predictions-using-a-multivariate-linear-model">
<span class="header-section-number">4</span> Making predictions using a multivariate linear model</h2>
<p>As seen earlier, we can use the models to predict values outside the dataset. We will use the <code><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid()</a></code> function to make a data frame containing the values for which we want the model to predict.</p>
<p>Let us predict the price of a 20-year-old male horse.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statmanrobin/Stat2Data">Stat2Data</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"HorsePrices"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a linear model</span></span>
<span><span class="va">model_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Price</span> <span class="op">~</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">Sex</span>, data <span class="op">=</span> <span class="va">HorsePrices</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Making a exploratory data frame</span></span>
<span><span class="va">explorartory_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid</a></span><span class="op">(</span>Sex <span class="op">=</span> <span class="st">"m"</span>,</span>
<span>                                   Age <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predicting values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_lm</span>, <span class="va">explorartory_values</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
30806.54 </code></pre>
</div>
</div>
<p>The model predicts that the price of such a horse would be 30806 dollars.</p>
</section><section id="assessing-a-multivariate-linear-model-fit" class="level2" data-number="5"><h2 data-number="5" class="anchored" data-anchor-id="assessing-a-multivariate-linear-model-fit">
<span class="header-section-number">5</span> Assessing a multivariate linear model fit</h2>
<section id="adjusted-r-square-value" class="level3" data-number="5.1"><h3 data-number="5.1" class="anchored" data-anchor-id="adjusted-r-square-value">
<span class="header-section-number">5.1</span> Adjusted R square value</h3>
<p>For a simple linear model, we have seen how to interpret the R-squared value, Residual standard error (RSE) value and the Root mean square error (RMSE) value. For a multivariate linear model, the R squared value will be greater compared to a simple linear model and this is because as you add more variables to explain the response variable, the model tends to best fit the available dataset. And in doing so, the model will no longer be useful to make inferences about the general population. So the adjusted R-square value is a metric that describes the percentage of variance explained by the explanatory variable but is measured by penalising the model with multiple explanatory variables by assigning a small penalty term for each additional explanatory variable. The formula for calculating the adjusted R square value is as follows;</p>
<p><span class="math display">\bar{R^2} = 1-(1-R^2)\frac{n_{obs}-1}{n_{obs}-n_{var}-1} </span></p>
<ul>
<li>
<span class="math inline">\bar{R^2}</span> = Adjusted R squared value</li>
<li>
<span class="math inline">R^2</span> = R squared value</li>
<li>
<span class="math inline">n_{obs}</span> = Number of observations</li>
<li>
<span class="math inline">n_{var}</span> = Number of variables in the model</li>
</ul>
<p>Please note that the adjusted R square value is always lower than the R squared value.</p>
<p>In R, we can extract the adjusted R square value of a model using the <code><a href="https://generics.r-lib.org/reference/glance.html">glance()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/pull.html">pull()</a></code> functions in the <a href="https://broom.tidymodels.org/">broom</a> and <a href="https://dplyr.tidyverse.org">dplyr</a> packages in R. The adjusted R square in the table would be under the <code>adj.r.squared</code> column.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statmanrobin/Stat2Data">Stat2Data</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"HorsePrices"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a linear model</span></span>
<span><span class="va">model_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Price</span> <span class="op">~</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">Sex</span>, data <span class="op">=</span> <span class="va">HorsePrices</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extracting adjusted R square value</span></span>
<span><span class="va">model_lm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://generics.r-lib.org/reference/glance.html">glance</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">adj.r.squared</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2996728</code></pre>
</div>
</div>
</section></section><section id="linear-regression-with-interacting-terms" class="level2" data-number="6"><h2 data-number="6" class="anchored" data-anchor-id="linear-regression-with-interacting-terms">
<span class="header-section-number">6</span> Linear regression with interacting terms</h2>
<p>So far we have built linear models using the <code>HorsePrices</code> dataset where we looked at the association between age and sex on the price of the horses. Now consider another variable, which is the height of the horses (<code>Height</code>). First, let us visualize the heights of the horses of their respective sex.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statmanrobin/Stat2Data">Stat2Data</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"HorsePrices"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the data</span></span>
<span><span class="va">HorsePrices</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Sex</span>, <span class="va">Height</span>, col <span class="op">=</span> <span class="va">Sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Height of horses with respect to their sex"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Sex"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Height (in hands)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_reg_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the graph, it seems like male horses are typically taller when compared to female horses according to the dataset at hand. Now if we are building a linear model, where we are interested to see the association of height and sex of horses on the price of the horses, we will have to take into consideration that female and male horses have different height distribution, as seen with the box plot above.</p>
<p>One way to account for this is to build separate models using a filtered dataset for each the sex.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statmanrobin/Stat2Data">Stat2Data</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"HorsePrices"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filtering horses by their sex</span></span>
<span><span class="va">male_horses</span> <span class="op">&lt;-</span> <span class="va">HorsePrices</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Sex</span> <span class="op">==</span> <span class="st">"m"</span><span class="op">)</span></span>
<span><span class="va">female_horses</span> <span class="op">&lt;-</span> <span class="va">HorsePrices</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Sex</span> <span class="op">==</span> <span class="st">"f"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building linear models</span></span>
<span><span class="va">male_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Price</span> <span class="op">~</span> <span class="va">Height</span>, data <span class="op">=</span> <span class="va">male_horses</span><span class="op">)</span></span>
<span><span class="va">female_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Price</span> <span class="op">~</span> <span class="va">Height</span>, data <span class="op">=</span> <span class="va">female_horses</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Printing model outputs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">male_lm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Price ~ Height, data = male_horses)

Residuals:
     Min       1Q   Median       3Q      Max 
-18671.5  -6325.5     29.9   9001.5  24001.5 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)  -120546      66679  -1.808   0.0818 .
Height          9346       4016   2.327   0.0277 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 11830 on 27 degrees of freedom
  (1 observation deleted due to missingness)
Multiple R-squared:  0.1671,    Adjusted R-squared:  0.1362 
F-statistic: 5.416 on 1 and 27 DF,  p-value: 0.0277</code></pre>
</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">female_lm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Price ~ Height, data = female_horses)

Residuals:
   Min     1Q Median     3Q    Max 
-15366  -6145  -2716   6127  27277 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)    57330      74949   0.765    0.455
Height         -2515       4710  -0.534    0.601

Residual standard error: 11550 on 16 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.01751,   Adjusted R-squared:  -0.0439 
F-statistic: 0.2851 on 1 and 16 DF,  p-value: 0.6007</code></pre>
</div>
</div>
<p>The coefficient values for the two models are very different. For male horses, a unit change in height contributes to a 9346 dollar increase in the price of the horse, but for female horses, the opposite occurs, a unit change in height decreases the price by 2515 dollars (though this difference is not significantly different). Thus we can say that the height of a horse depends on its sex. In other words, the variable height and the variable sex interact with each other. Instead of making separate models like this, R has an easy way to show interacting terms. Instead of using the <code>+</code>, we can use the <code>*</code> sign to indicate an interaction between two variables. The <code>:</code> sign can also be used to explicitly mention which terms interact. The codes given below show how to account for interaction between height and sex for the given dataset.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statmanrobin/Stat2Data">Stat2Data</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"HorsePrices"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building linear model with interaction</span></span>
<span><span class="va">lm_model_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Price</span> <span class="op">~</span> <span class="va">Height</span> <span class="op">*</span> <span class="va">Sex</span>, data <span class="op">=</span> <span class="va">HorsePrices</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Same model as above but explicitly mentioning interaction terms</span></span>
<span><span class="va">lm_model_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Price</span> <span class="op">~</span> <span class="va">Height</span> <span class="op">+</span> <span class="va">Sex</span> <span class="op">+</span> <span class="va">Height</span><span class="op">:</span><span class="va">Sex</span>, data <span class="op">=</span> <span class="va">HorsePrices</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Printing model outputs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">lm_model_1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Price ~ Height * Sex, data = HorsePrices)

Residuals:
     Min       1Q   Median       3Q      Max 
-18671.5  -6410.3   -671.5   6971.0  27276.9 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)    57330      76078   0.754   0.4552  
Height         -2515       4781  -0.526   0.6016  
Sexm         -177876     100786  -1.765   0.0847 .
Height:Sexm    11861       6222   1.906   0.0633 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 11730 on 43 degrees of freedom
  (3 observations deleted due to missingness)
Multiple R-squared:  0.4086,    Adjusted R-squared:  0.3673 
F-statistic: 9.901 on 3 and 43 DF,  p-value: 4.377e-05</code></pre>
</div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">lm_model_2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Price ~ Height + Sex + Height:Sex, data = HorsePrices)

Residuals:
     Min       1Q   Median       3Q      Max 
-18671.5  -6410.3   -671.5   6971.0  27276.9 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)    57330      76078   0.754   0.4552  
Height         -2515       4781  -0.526   0.6016  
Sexm         -177876     100786  -1.765   0.0847 .
Height:Sexm    11861       6222   1.906   0.0633 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 11730 on 43 degrees of freedom
  (3 observations deleted due to missingness)
Multiple R-squared:  0.4086,    Adjusted R-squared:  0.3673 
F-statistic: 9.901 on 3 and 43 DF,  p-value: 4.377e-05</code></pre>
</div>
</div>
<p>Since the female is the first level in the variable <code>Sex</code>, the intercept is estimated for female horses. This is the same value that we got from the <code>female_lm</code> model we made earlier. We also got the slope value for height, which is calculated for female horses (the same value as that from the <code>female_lm</code> model). The value for male horses is given as <code>Sexm</code> as is -177876, this value is relative to female horses and is given as the difference between the y-intercepts. We can find the actual y-intercept value for males by adding the <code>Sexm</code> value and the <code>(Intercept)</code> value which is -120546 ( = 57330 + -177876). This is the intercept value for male horses which we got from the <code>male_lm</code> model earlier. Now let us look at the <code>Height:Sexm</code> value, which is given as 11861. This is the slope value showing how the price change when height change for male horses, but it is calculated relative to female horses. To get the actual slope for male horses, we have to add the slope of <code>Height</code> and <code>Height:Sexm</code> values. In doing so we get a value of 9346 ( = -2515 + 11861) which is the slope of <code>Height</code>, which we got from the <code>male_lm</code> model earlier.</p>
</section><section id="plotting-linear-model-with-an-interaction-term" class="level2" data-number="7"><h2 data-number="7" class="anchored" data-anchor-id="plotting-linear-model-with-an-interaction-term">
<span class="header-section-number">7</span> Plotting linear model with an interaction term</h2>
<p>When we were using the <code><a href="moderndive.github.io/moderndive//reference/geom_parallel_slopes.html">geom_parallel_slopes()</a></code> function from the <a href="https://moderndive.github.io/moderndive/">moderndive</a> package, I mentioned that we will not use <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> function from the <a href="https://ggplot2.tidyverse.org">ggplot2</a> package. This is because when we specify the <code>col</code> variable, the <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> function automatically plots the trend line by considering the x-axis variable and the colour variable to be interacting.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statmanrobin/Stat2Data">Stat2Data</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"HorsePrices"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting linear model with interaction terms</span></span>
<span><span class="va">HorsePrices</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Height</span>, <span class="va">Price</span>, col <span class="op">=</span> <span class="va">Sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Price of horses with respect to their height and sex"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Height (in hands)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Price (in dollars)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_reg_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The slope for male horses is steeper than for female horses. This indicates that male horses have their price increased significantly as their height increased. Whereas female horses have their price change non significantly when their height change. This is exactly what we see in the <code>male_lm</code> and <code>female_lm</code> model coefficients.</p>
</section><section id="simpsons-paradox" class="level2" data-number="8"><h2 data-number="8" class="anchored" data-anchor-id="simpsons-paradox">
<span class="header-section-number">8</span> Simpson’s Paradox</h2>
<p>Simpson’s paradox occurs when a result conveyed using the whole dataset is different from the results conveyed using the different groups within the same dataset. In simple words, the results of the model change drastically due to the inclusion of a variable which was previously not included in the model. Let’s see what this means.</p>
<p>We will use the <code>penguins</code> dataset from the <a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a> package in R. The dataset contains body measurements taken from three different species of penguins from Antarctica. Let us build a model where the body mass (<code>body_mass_g</code>) is predicted by bill depth (<code>bill_depth_mm</code>) alone. Let us also build another build with the same model formula as before but this time, we will include an interaction term between bill depth and species (<code>species</code>).</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'palmerpenguins'</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building linear model</span></span>
<span><span class="va">model_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">body_mass_g</span>  <span class="op">~</span> <span class="va">bill_depth_mm</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building linear model with interaction term</span></span>
<span><span class="va">model_lm_interaction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">body_mass_g</span>  <span class="op">~</span> <span class="va">bill_depth_mm</span> <span class="op">*</span> <span class="va">species</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Printing model outputs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_lm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = body_mass_g ~ bill_depth_mm, data = penguins)

Residuals:
     Min       1Q   Median       3Q      Max 
-1607.38  -510.10   -66.96   462.43  1819.28 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    7488.65     335.22   22.34   &lt;2e-16 ***
bill_depth_mm  -191.64      19.42   -9.87   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 708.1 on 340 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.2227,    Adjusted R-squared:  0.2204 
F-statistic: 97.41 on 1 and 340 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_lm_interaction</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = body_mass_g ~ bill_depth_mm * species, data = penguins)

Residuals:
    Min      1Q  Median      3Q     Max 
-845.89 -254.74  -28.46  228.01 1161.41 

Coefficients:
                               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                     -283.28     437.94  -0.647   0.5182    
bill_depth_mm                    217.15      23.82   9.117   &lt;2e-16 ***
speciesChinstrap                 247.06     829.77   0.298   0.7661    
speciesGentoo                   -175.71     658.43  -0.267   0.7897    
bill_depth_mm:speciesChinstrap   -12.53      45.01  -0.278   0.7809    
bill_depth_mm:speciesGentoo      152.29      40.49   3.761   0.0002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 354.9 on 336 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.807, Adjusted R-squared:  0.8041 
F-statistic:   281 on 5 and 336 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>We get a rather interesting and contradicting set of results when we compare the summary outputs for both models. In the model without the species variable, greater bill depth predicts lower body mass in penguins. But, when we add the species variable, the trend reverses, increasing bill depth is associated with an increase in body mass.</p>
<p>It is easier to plot the models and see. Use the slider to see the difference between the plots.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the model wihtout interaction term</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">penguins</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">bill_depth_mm</span>, <span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Body mass predcited by bill depth in three different species of penguins"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"body_mass_g  ~ bill_depth_mm + species"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Bill depth (mm)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Body mass (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the model with interaction term</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">penguins</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">bill_depth_mm</span>, <span class="va">body_mass_g</span>, col <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Body mass predcited by bill depth in three different species of penguins"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"body_mass_g  ~ bill_depth_mm * species"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Bill depth (mm)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Body mass (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="juxtapose" data-startingposition="50%">
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the model wihtout interaction term</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">penguins</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">bill_depth_mm</span>, <span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Body mass predcited by bill depth in three different species of penguins"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"body_mass_g  ~ bill_depth_mm + species"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Bill depth (mm)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Body mass (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_reg_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Plotting the model with interaction term</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">penguins</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">bill_depth_mm</span>, <span class="va">body_mass_g</span>, col <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Body mass predcited by bill depth in three different species of penguins"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"body_mass_g  ~ bill_depth_mm * species"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Bill depth (mm)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Body mass (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_reg_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<p>So it is always better to visualize the dataset and build models according to the question at hand.</p>
</section><section id="visualizing-linear-models-with-two-numerical-explanatory-variables" class="level2" data-number="9"><h2 data-number="9" class="anchored" data-anchor-id="visualizing-linear-models-with-two-numerical-explanatory-variables">
<span class="header-section-number">9</span> Visualizing linear models with two numerical explanatory variables</h2>
<p>Often you will be building models with two or more two explanatory variables. If some of those explanatory variables are categorical then it is easier to plot them as we can assign different colour or shape variables and we can also use faceting. But if they are all numerical variables then it is kind of difficult to plot them. We can either rely on three-dimensional plots or use a continuous colour scale gradient in a two-dimensional plot. Let us see how to plot the graphs.</p>
<p>We will again use the <code>penguins</code> dataset from the <a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a> package in R. We will build a model to predict body mass (<code>body_mass_g</code>) using bill length (<code>bill_length_mm</code>) and bill depth (<code>bill_depth_mm</code>). Let us first try to plot a 3D plot using the <code><a href="https://rdrr.io/pkg/plot3D/man/scatter.html">scatter3D()</a></code> function from the <code>{plot3D}</code> package in R.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">plot3D</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'plot3D'</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">plot3D</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting a 3D plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plot3D/man/scatter.html">scatter3D</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">$</span><span class="va">body_mass_g</span>, <span class="va">penguins</span><span class="op">$</span><span class="va">bill_depth_mm</span>, <span class="va">penguins</span><span class="op">$</span><span class="va">bill_length_mm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_reg_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Well, 3D plotting is a mess, as you can see from the above plot. It is very hard to make out any useful findings using the graph above. So instead of this, we can return to our conventional 2D plot where we can use a continuous colour gradient to visualize the third numerical variable.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"penguins"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the graph</span></span>
<span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">bill_depth_mm</span>, <span class="va">body_mass_g</span>, col <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Body mass predcited by bill depth and bill length in three different species of penguins"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"body_mass_g  ~ bill_depth_mm * species"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Bill depth (mm)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Body mass (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"inferno"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_reg_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the graph, it roughly seems like penguins with greater body mass have a longer and narrower bill. We can further subdivide this plot by the species category using faceting.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"penguins"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Making a function to make line breaks in text</span></span>
<span><span class="va">addline_format</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">','</span>,<span class="st">'\n'</span>,<span class="va">x</span><span class="op">)</span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Plotting the graph</span></span>
<span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">bill_depth_mm</span>, <span class="va">body_mass_g</span>, col <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu">addline_format</span><span class="op">(</span><span class="st">"Body mass predcited by bill depth and bill length,in three different species of penguins"</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Bill depth (mm)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Body mass (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"inferno"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">species</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_reg_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>When we group the data according to different species, we get the opposite result as compared before. Here, we can see that penguins with heavier body mass have broader and longer bills.</p>
<p>Now let us plot the predicted values from the linear models to see the general trend of the data.</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"penguins"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Making prediction</span></span>
<span><span class="va">model_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">body_mass_g</span> <span class="op">~</span> <span class="va">bill_depth_mm</span> <span class="op">*</span> <span class="va">bill_length_mm</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="va">explorartory_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid</a></span><span class="op">(</span></span>
<span>  bill_depth_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">15</span>,<span class="fl">25</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>  bill_length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">30</span>,<span class="fl">60</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">predicted_values</span> <span class="op">&lt;-</span> <span class="va">explorartory_values</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>  body_mass_g <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_lm</span>, <span class="va">explorartory_values</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the graph with predicted values</span></span>
<span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">bill_depth_mm</span>, <span class="va">body_mass_g</span>, col <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Body mass predcited by bill depth and bill length </span></span>
<span><span class="st">in three different species of penguins"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Bill depth (mm)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Body mass (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"inferno"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">species</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predicted_values</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">body_mass_g</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span>, shape <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_reg_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We got a nice gradient-coloured graph. From the predicted values we got from the model we can understand how body mass changes with bill depth and bill length. We can see two clear patterns. For penguins with lower bill length values, the body mass increases as bill depth increases. The opposite is true for penguins with larger values for bill length. For these penguins, body mass decreases as bill depth increases.</p>
</section><section id="visualizing-logistic-models-with-two-numerical-explanatory-variables" class="level2" data-number="10"><h2 data-number="10" class="anchored" data-anchor-id="visualizing-logistic-models-with-two-numerical-explanatory-variables">
<span class="header-section-number">10</span> Visualizing logistic models with two numerical explanatory variables</h2>
<p>We have seen how to include two or more variables in a linear model. The same procedure applies to logistic models. Now we will see how to visualize a logistic model with two or more numerical variables.</p>
<p>We will use the <code>CreditCard</code> dataset in the <code>{AER}</code> package in R. The dataset contains the credit history of a sample of applicants for a type of credit card. We will predict to see the success of the acceptance of the credit card application (<code>card</code>) using the yearly income (<code>income</code>) and age (<code>age</code>) of the applicant. The code for making the plot is very similar to that we have seen earlier.</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">AER</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'AER'</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">AER</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"CreditCard"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Making prediction</span></span>
<span><span class="va">model_logistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">card</span> <span class="op">~</span> <span class="va">income</span> <span class="op">*</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">CreditCard</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">explorartory_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid</a></span><span class="op">(</span></span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">18</span>,<span class="fl">90</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">predicted_values</span> <span class="op">&lt;-</span> <span class="va">explorartory_values</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>  card <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_logistic</span>, <span class="va">explorartory_values</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the graph with predicted values</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">CreditCard</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">income</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">card</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>, col <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Does income and age affect the success in accepting a credit card application?"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Yearly income (in USD 10,000)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Probability of success in accepting a credit card application"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_color_gradient2</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predicted_values</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">card</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span>, shape <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_reg_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We get some interesting results. People with higher yearly incomes have a higher chance of getting a credit card. But for age, younger people with lower yearly income have more chance of getting a credit card as compared to older people with the same level of yearly income. But this trend reverses when yearly income crosses 50,000 dollars.</p>
</section><section id="conclusion" class="level2" data-number="11"><h2 data-number="11" class="anchored" data-anchor-id="conclusion">
<span class="header-section-number">11</span> Conclusion</h2>
<p>It is time to wrap up! In this tutorial we have learned the following things;</p>
<ol type="1">
<li><p>How to build models with two or more explanatory variables</p></li>
<li><p>How to interpret multivariate models</p></li>
<li><p>How to predict values using a multivariate model</p></li>
<li><p>Assessing a multivariate model</p></li>
<li><p>Building models with interaction terms and plotting them</p></li>
<li><p>What is Simpson’s paradox</p></li>
<li><p>Visualising models with two numerical explanatory variables</p></li>
</ol>
</section><div id="quarto-appendix" class="default"><section id="last-updated-on" class="level4 unnumbered unlisted appendix"><h2 class="quarto-appendix-heading">Last updated on</h2><div class="quarto-appendix-contents">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-09-19 14:49:47 IST"</code></pre>
</div>
</div>
<!-- Do not forget to put flag counter -->
<p><a hidden="" href="https://info.flagcounter.com/ynrK"><img src="https://s11.flagcounter.com/count2/ynrK/bg_000000/txt_FFFFFF/border_F0F0F0/columns_5/maxflags_25/viewers_0/labels_1/pageviews_1/flags_0/percent_0/" alt="Flag Counter" border="0"></a></p>


<!-- -->

</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{johnson2022,
  author = {Jewel Johnson},
  editor = {},
  title = {Intermediate {Regression} in {R}},
  date = {2022-09-19},
  url = {https://one-carat-blog.netlify.app//tutorials/stat_basic/inter_reg.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-johnson2022" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Jewel Johnson. 2022. <span>“Intermediate Regression in R.”</span>
September 19, 2022. <a href="https://one-carat-blog.netlify.app//tutorials/stat_basic/inter_reg.html">https://one-carat-blog.netlify.app//tutorials/stat_basic/inter_reg.html</a>.
</div></div></section></div></main><!-- /main --><script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"require(\"https://cdn.jsdelivr.net/npm/juxtaposejs@1.1.6/build/js/juxtapose.min.js\")\n  .catch(() => null)\n"}]}
</script><script type="module">
window._ojs.paths.runtimeToDoc = "../../tutorials/stat_basic";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><script src="https://giscus.app/client.js" data-repo="jeweljohnsonj/one-carat-blog" data-repo-id="R_kgDOHW124A" data-category="General" data-category-id="DIC_kwDOHW124M4CPNVL" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb33" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Intermediate Regression in R"</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Level up your regression knowledge using multiple explanatory variables"</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "09/19/2022"</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">    css:</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co">      - https://cdn.knightlab.com/libs/juxtapose/latest/css/juxtapose.css</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> images/inter_reg.png</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [regression]</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co">   - social-share</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="an">share:</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">  permalink: "https://one-carat-blog.netlify.app/tutorials/stat_model/inter_reg.html"</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co">  description: "Intermediate Regression in R"</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co">  twitter: true</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co">  facebook: true</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co">  reddit: true</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co">  stumble: true</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="co">  tumblr: true</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="co">  linkedin: true</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="co">  email: true</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a><span class="co">//| output: false</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a><span class="pp">require</span>(<span class="st">"https://cdn.jsdelivr.net/npm/juxtaposejs@1.1.6/build/js/juxtapose.min.js"</span>)</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">catch</span>(() <span class="kw">=&gt;</span> <span class="kw">null</span>)</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a><span class="vs">:::{.callout-note}</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a><span class="vs">## TL;DR</span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a><span class="vs">In this article you will learn;</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a><span class="vs">1.    How to build models with two or more explanatory variables</span></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a><span class="vs">2.    How to interpret multivariate models</span></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a><span class="vs">3.    How to predict values using a multivariate model</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a><span class="vs">4.    Assessing a multivariate model</span></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a><span class="vs">5.    Building models with interaction terms and plotting them</span></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a><span class="vs">6.    What is Simpson's paradox</span></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a><span class="vs">7.    Visualising models with two numerical explanatory variables</span></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a><span class="vs">:::</span></span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a><span class="vs">## Introduction</span></span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a><span class="vs">This tutorial is a sequel to the previous tutorial which covered the basics of regression. Here we will extend our knowledge to build models using more than one explanatory variable, how to visualise them and how to interpret the model summaries.</span></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a><span class="vs">## Linear regression using multiple variables</span></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a><span class="vs">In the previous tutorial, we have seen how to build a linear model with a single exploratory variable. Now we will see how to build linear models using two variables. </span></span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a><span class="vs">We will use the `</span><span class="fu">HorsePrices</span><span class="vs">` dataset from the `</span>{Stat2Data}<span class="vs">` package in R. The dataset contains the price and related characteristics of horses listed for sale on the internet. Using the dataset, we will see how the price of a horse (`</span><span class="fu">Price</span><span class="vs">`) changes according to its age (`</span><span class="fu">Age</span><span class="vs">`) and also dues to its sex (`</span><span class="fu">Sex</span><span class="vs">`) using a linear model. Here, we have a numerical and a categorical variable as the explanatory variables. First, let us plot the data.</span></span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="pp">require</span>(Stat2Data)) install<span class="op">.</span><span class="fu">packages</span>(<span class="st">'Stat2Data'</span>)</span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a># Plotting the data</span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true" tabindex="-1"></a>HorsePrices <span class="op">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(Age<span class="op">,</span> Price<span class="op">,</span> col <span class="op">=</span> Sex)) <span class="op">+</span> <span class="fu">geom_point</span>() <span class="op">+</span></span>
<span id="cb33-77"><a href="#cb33-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"Change in the price of the horse as a function of age and sex?"</span><span class="op">,</span></span>
<span id="cb33-78"><a href="#cb33-78" aria-hidden="true" tabindex="-1"></a>       x <span class="op">=</span> <span class="st">"Age (years)"</span><span class="op">,</span></span>
<span id="cb33-79"><a href="#cb33-79" aria-hidden="true" tabindex="-1"></a>       y <span class="op">=</span> <span class="st">"Price (dollars)"</span>) <span class="op">+</span></span>
<span id="cb33-80"><a href="#cb33-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb33-81"><a href="#cb33-81" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-82"><a href="#cb33-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-83"><a href="#cb33-83" aria-hidden="true" tabindex="-1"></a><span class="vs">At a glance, for intermediately aged horses, the price is high compared to the rest of the age range. Also, female horses seem to have to be priced less compared to males. Let us see if that is the case by building a linear model. To predict the response variable using multiple explanatory variables, we will append them using the `</span><span class="op">+</span><span class="vs">` sign.</span></span>
<span id="cb33-84"><a href="#cb33-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-87"><a href="#cb33-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-88"><a href="#cb33-88" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb33-89"><a href="#cb33-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-90"><a href="#cb33-90" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb33-91"><a href="#cb33-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-92"><a href="#cb33-92" aria-hidden="true" tabindex="-1"></a># Building a linear model</span>
<span id="cb33-93"><a href="#cb33-93" aria-hidden="true" tabindex="-1"></a>model_lm <span class="op">&lt;-</span> <span class="fu">lm</span>(Price <span class="op">~</span> Age <span class="op">+</span> Sex<span class="op">,</span> data <span class="op">=</span> HorsePrices)</span>
<span id="cb33-94"><a href="#cb33-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-95"><a href="#cb33-95" aria-hidden="true" tabindex="-1"></a># Printing model output</span>
<span id="cb33-96"><a href="#cb33-96" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_lm)</span>
<span id="cb33-97"><a href="#cb33-97" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-98"><a href="#cb33-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-99"><a href="#cb33-99" aria-hidden="true" tabindex="-1"></a><span class="vs">Unlike the earlier case with one explanatory variable, we now have two coefficient values and an intercept value. We will soon see how to interpret the coefficient values. But for now, we can see that their age does not significantly explain the variance seen in price but sex does.</span></span>
<span id="cb33-100"><a href="#cb33-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-101"><a href="#cb33-101" aria-hidden="true" tabindex="-1"></a><span class="vs">Now let us try plotting the model. Instead of using the `</span><span class="fu">geom_smooth</span>()<span class="vs">` function in the `</span>{ggplot2}<span class="vs">` package in R, we will use the `</span><span class="fu">geom_parallel_slopes</span>()<span class="vs">` function from the `</span>{moderndive}<span class="vs">` package in R. We will later see why we did not use the `</span><span class="fu">geom_smooth</span>()<span class="vs">` function.</span></span>
<span id="cb33-102"><a href="#cb33-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-105"><a href="#cb33-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-106"><a href="#cb33-106" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="pp">require</span>(moderndive)) install<span class="op">.</span><span class="fu">packages</span>(<span class="st">'moderndive'</span>)</span>
<span id="cb33-107"><a href="#cb33-107" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb33-108"><a href="#cb33-108" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-109"><a href="#cb33-109" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb33-110"><a href="#cb33-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-111"><a href="#cb33-111" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb33-112"><a href="#cb33-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-113"><a href="#cb33-113" aria-hidden="true" tabindex="-1"></a># Plotting the data</span>
<span id="cb33-114"><a href="#cb33-114" aria-hidden="true" tabindex="-1"></a>HorsePrices <span class="op">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(Age<span class="op">,</span> Price<span class="op">,</span> col <span class="op">=</span> Sex)) <span class="op">+</span> <span class="fu">geom_point</span>() <span class="op">+</span></span>
<span id="cb33-115"><a href="#cb33-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"Change in the price of the horse as a function of age and sex?"</span><span class="op">,</span></span>
<span id="cb33-116"><a href="#cb33-116" aria-hidden="true" tabindex="-1"></a>       x <span class="op">=</span> <span class="st">"Age (years)"</span><span class="op">,</span></span>
<span id="cb33-117"><a href="#cb33-117" aria-hidden="true" tabindex="-1"></a>       y <span class="op">=</span> <span class="st">"Price (dollars)"</span>) <span class="op">+</span></span>
<span id="cb33-118"><a href="#cb33-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_parallel_slopes</span>() <span class="op">+</span></span>
<span id="cb33-119"><a href="#cb33-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb33-120"><a href="#cb33-120" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-121"><a href="#cb33-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-122"><a href="#cb33-122" aria-hidden="true" tabindex="-1"></a><span class="vs">There is a difference in price between male and female horses but their prices are not changing across age. This is exactly what we saw in the model summary results. You can also see that the lines are parallel to each other.</span></span>
<span id="cb33-123"><a href="#cb33-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-124"><a href="#cb33-124" aria-hidden="true" tabindex="-1"></a><span class="vs">## Understanding the summary of a multivariate linear model</span></span>
<span id="cb33-125"><a href="#cb33-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-126"><a href="#cb33-126" aria-hidden="true" tabindex="-1"></a><span class="vs">Given below is the summary output of the multivariate model we built earlier.</span></span>
<span id="cb33-127"><a href="#cb33-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-128"><a href="#cb33-128" aria-hidden="true" tabindex="-1"></a><span class="vs">![](images/lm_summary_multi.png)</span></span>
<span id="cb33-129"><a href="#cb33-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-130"><a href="#cb33-130" aria-hidden="true" tabindex="-1"></a><span class="vs">1.    In section 1, we have the model formula we used for building the model.</span></span>
<span id="cb33-131"><a href="#cb33-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-132"><a href="#cb33-132" aria-hidden="true" tabindex="-1"></a><span class="vs">2.    In section 2, we have the first quartile, median and third quartile of the residuals of the model. This tells us whether the residuals are normally distributed if the median value is close to zero and, the first and third quartile values are approximately the same in magnitude.</span></span>
<span id="cb33-133"><a href="#cb33-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-134"><a href="#cb33-134" aria-hidden="true" tabindex="-1"></a><span class="vs">3.    In section 3, we have the coefficient values of the exploratory variables. Please remember that the variable 'sex' has two levels; female and male. By default, R calculates the intercept value for the first level in the first categorical response variable in the model formula. Here, in our case, that first level is female. Therefore, the intercept value gives us the average price value for female horses when age is 0. So here, the y-intercept value of 18199 corresponds to the average price of female horses when age is 0.  The second value is the slope of Age, which is -220.1, which corresponds to a decrease in the price by a value of 220.1 dollars when the age of the horse increases by 1 year. The third value corresponds to the difference in the y-intercept value for males as compared to the main intercept value, which is for females and is 18199. In short, it tells us that male horses with age 0 are priced 17008 dollars more on average when compared to female horses. If we want to see the individual averages of the levels in the categorical exploratory variables, then we should use `</span><span class="op">-</span><span class="dv">1</span><span class="vs">` in the model formula, which is something we saw in the earlier tutorial.</span></span>
<span id="cb33-135"><a href="#cb33-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-136"><a href="#cb33-136" aria-hidden="true" tabindex="-1"></a><span class="vs">4.    Section 4 contains metrics which assess model performance. In the earlier tutorial, we saw what residual standard error and R squared values means. Adjusted R square value is a metric similar to R squared value but is calculated for models with multiple explanatory variables. Like R squared, it tells us how much variance seen in the response variable is explained by the explanatory variables and the value lies between 0 and 1. Here we have around 30% variance seen in price explained by both age and sex of the horses.</span></span>
<span id="cb33-137"><a href="#cb33-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-138"><a href="#cb33-138" aria-hidden="true" tabindex="-1"></a><span class="vs">## Making predictions using a multivariate linear model</span></span>
<span id="cb33-139"><a href="#cb33-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-140"><a href="#cb33-140" aria-hidden="true" tabindex="-1"></a><span class="vs">As seen earlier, we can use the models to predict values outside the dataset. We will use the `</span><span class="fu">expand_grid</span>()<span class="vs">` function to make a data frame containing the values for which we want the model to predict.</span></span>
<span id="cb33-141"><a href="#cb33-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-142"><a href="#cb33-142" aria-hidden="true" tabindex="-1"></a><span class="vs">Let us predict the price of a 20-year-old male horse.</span></span>
<span id="cb33-143"><a href="#cb33-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-146"><a href="#cb33-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-147"><a href="#cb33-147" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb33-148"><a href="#cb33-148" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb33-149"><a href="#cb33-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-150"><a href="#cb33-150" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb33-151"><a href="#cb33-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-152"><a href="#cb33-152" aria-hidden="true" tabindex="-1"></a># Building a linear model</span>
<span id="cb33-153"><a href="#cb33-153" aria-hidden="true" tabindex="-1"></a>model_lm <span class="op">&lt;-</span> <span class="fu">lm</span>(Price <span class="op">~</span> Age <span class="op">+</span> Sex<span class="op">,</span> data <span class="op">=</span> HorsePrices)</span>
<span id="cb33-154"><a href="#cb33-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-155"><a href="#cb33-155" aria-hidden="true" tabindex="-1"></a># Making a exploratory data frame</span>
<span id="cb33-156"><a href="#cb33-156" aria-hidden="true" tabindex="-1"></a>explorartory_values <span class="op">&lt;-</span> <span class="fu">expand_grid</span>(Sex <span class="op">=</span> <span class="st">"m"</span><span class="op">,</span></span>
<span id="cb33-157"><a href="#cb33-157" aria-hidden="true" tabindex="-1"></a>                                   Age <span class="op">=</span> <span class="dv">20</span>)</span>
<span id="cb33-158"><a href="#cb33-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-159"><a href="#cb33-159" aria-hidden="true" tabindex="-1"></a># Predicting values</span>
<span id="cb33-160"><a href="#cb33-160" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model_lm<span class="op">,</span> explorartory_values)</span>
<span id="cb33-161"><a href="#cb33-161" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-162"><a href="#cb33-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-163"><a href="#cb33-163" aria-hidden="true" tabindex="-1"></a><span class="vs">The model predicts that the price of such a horse would be 30806 dollars.</span></span>
<span id="cb33-164"><a href="#cb33-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-165"><a href="#cb33-165" aria-hidden="true" tabindex="-1"></a><span class="vs">## Assessing a multivariate linear model fit</span></span>
<span id="cb33-166"><a href="#cb33-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-167"><a href="#cb33-167" aria-hidden="true" tabindex="-1"></a><span class="vs">### Adjusted R square value</span></span>
<span id="cb33-168"><a href="#cb33-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-169"><a href="#cb33-169" aria-hidden="true" tabindex="-1"></a><span class="vs">For a simple linear model, we have seen how to interpret the R-squared value, Residual standard error (RSE) value and the Root mean square error (RMSE) value. For a multivariate linear model, the R squared value will be greater compared to a simple linear model and this is because as you add more variables to explain the response variable, the model tends to best fit the available dataset. And in doing so, the model will no longer be useful to make inferences about the general population. So the adjusted R-square value is a metric that describes the percentage of variance explained by the explanatory variable but is measured by penalising the model with multiple explanatory variables by assigning a small penalty term for each additional explanatory variable. The formula for calculating the adjusted R square value is as follows;</span></span>
<span id="cb33-170"><a href="#cb33-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-171"><a href="#cb33-171" aria-hidden="true" tabindex="-1"></a><span class="vs">$$</span><span class="sc">\b</span><span class="vs">ar{R^2} = 1-(1-R^2)</span><span class="sc">\f</span><span class="vs">rac{n_{obs}-1}{n_{obs}-n_{var}-1} $$</span></span>
<span id="cb33-172"><a href="#cb33-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-173"><a href="#cb33-173" aria-hidden="true" tabindex="-1"></a><span class="vs">*   $</span><span class="sc">\b</span><span class="vs">ar{R^2}$ = Adjusted R squared value</span></span>
<span id="cb33-174"><a href="#cb33-174" aria-hidden="true" tabindex="-1"></a><span class="vs">*   $R^2$ = R squared value</span></span>
<span id="cb33-175"><a href="#cb33-175" aria-hidden="true" tabindex="-1"></a><span class="vs">*   $n_{obs}$ = Number of observations</span></span>
<span id="cb33-176"><a href="#cb33-176" aria-hidden="true" tabindex="-1"></a><span class="vs">*   $n_{var}$ = Number of variables in the model</span></span>
<span id="cb33-177"><a href="#cb33-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-178"><a href="#cb33-178" aria-hidden="true" tabindex="-1"></a><span class="vs">Please note that the adjusted R square value is always lower than the R squared value.</span></span>
<span id="cb33-179"><a href="#cb33-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-180"><a href="#cb33-180" aria-hidden="true" tabindex="-1"></a><span class="vs">In R, we can extract the adjusted R square value of a model using the `</span><span class="fu">glance</span>()<span class="vs">` and `</span><span class="fu">pull</span>()<span class="vs">` functions in the `</span>{broom}<span class="vs">` and `</span>{dplyr}<span class="vs">` packages in R. The adjusted R square in the table would be under the `</span>adj<span class="op">.</span><span class="at">r</span><span class="op">.</span><span class="fu">squared</span><span class="vs">` column.</span></span>
<span id="cb33-181"><a href="#cb33-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-184"><a href="#cb33-184" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-185"><a href="#cb33-185" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb33-186"><a href="#cb33-186" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-187"><a href="#cb33-187" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb33-188"><a href="#cb33-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-189"><a href="#cb33-189" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb33-190"><a href="#cb33-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-191"><a href="#cb33-191" aria-hidden="true" tabindex="-1"></a># Building a linear model</span>
<span id="cb33-192"><a href="#cb33-192" aria-hidden="true" tabindex="-1"></a>model_lm <span class="op">&lt;-</span> <span class="fu">lm</span>(Price <span class="op">~</span> Age <span class="op">+</span> Sex<span class="op">,</span> data <span class="op">=</span> HorsePrices)</span>
<span id="cb33-193"><a href="#cb33-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-194"><a href="#cb33-194" aria-hidden="true" tabindex="-1"></a># Extracting adjusted R square value</span>
<span id="cb33-195"><a href="#cb33-195" aria-hidden="true" tabindex="-1"></a>model_lm <span class="op">%&gt;%</span> <span class="fu">glance</span>() <span class="op">%&gt;%</span></span>
<span id="cb33-196"><a href="#cb33-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(adj<span class="op">.</span><span class="at">r</span><span class="op">.</span><span class="at">squared</span>)</span>
<span id="cb33-197"><a href="#cb33-197" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-198"><a href="#cb33-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-199"><a href="#cb33-199" aria-hidden="true" tabindex="-1"></a><span class="vs">## Linear regression with interacting terms</span></span>
<span id="cb33-200"><a href="#cb33-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-201"><a href="#cb33-201" aria-hidden="true" tabindex="-1"></a><span class="vs">So far we have built linear models using the `</span><span class="fu">HorsePrices</span><span class="vs">` dataset where we looked at the association between age and sex on the price of the horses. Now consider another variable, which is the height of the horses (`</span><span class="fu">Height</span><span class="vs">`). First, let us visualize the heights of the horses of their respective sex.</span></span>
<span id="cb33-202"><a href="#cb33-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-205"><a href="#cb33-205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-206"><a href="#cb33-206" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb33-207"><a href="#cb33-207" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-208"><a href="#cb33-208" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb33-209"><a href="#cb33-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-210"><a href="#cb33-210" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb33-211"><a href="#cb33-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-212"><a href="#cb33-212" aria-hidden="true" tabindex="-1"></a># Plotting the data</span>
<span id="cb33-213"><a href="#cb33-213" aria-hidden="true" tabindex="-1"></a>HorsePrices <span class="op">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(Sex<span class="op">,</span> Height<span class="op">,</span> col <span class="op">=</span> Sex)) <span class="op">+</span> <span class="fu">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb33-214"><a href="#cb33-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"Height of horses with respect to their sex"</span><span class="op">,</span></span>
<span id="cb33-215"><a href="#cb33-215" aria-hidden="true" tabindex="-1"></a>       x <span class="op">=</span> <span class="st">"Sex"</span><span class="op">,</span></span>
<span id="cb33-216"><a href="#cb33-216" aria-hidden="true" tabindex="-1"></a>       y <span class="op">=</span> <span class="st">"Height (in hands)"</span>) <span class="op">+</span></span>
<span id="cb33-217"><a href="#cb33-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb33-218"><a href="#cb33-218" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-219"><a href="#cb33-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-220"><a href="#cb33-220" aria-hidden="true" tabindex="-1"></a><span class="vs">From the graph, it seems like male horses are typically taller when compared to female horses according to the dataset at hand. Now if we are building a linear model, where we are interested to see the association of height and sex of horses on the price of the horses, we will have to take into consideration that female and male horses have different height distribution, as seen with the box plot above.</span></span>
<span id="cb33-221"><a href="#cb33-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-222"><a href="#cb33-222" aria-hidden="true" tabindex="-1"></a><span class="vs">One way to account for this is to build separate models using a filtered dataset for each the sex.</span></span>
<span id="cb33-223"><a href="#cb33-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-226"><a href="#cb33-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-227"><a href="#cb33-227" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb33-228"><a href="#cb33-228" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-229"><a href="#cb33-229" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb33-230"><a href="#cb33-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-231"><a href="#cb33-231" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb33-232"><a href="#cb33-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-233"><a href="#cb33-233" aria-hidden="true" tabindex="-1"></a># Filtering horses by their sex</span>
<span id="cb33-234"><a href="#cb33-234" aria-hidden="true" tabindex="-1"></a>male_horses <span class="op">&lt;-</span> HorsePrices <span class="op">%&gt;%</span> <span class="fu">filter</span>(Sex <span class="op">==</span> <span class="st">"m"</span>)</span>
<span id="cb33-235"><a href="#cb33-235" aria-hidden="true" tabindex="-1"></a>female_horses <span class="op">&lt;-</span> HorsePrices <span class="op">%&gt;%</span> <span class="fu">filter</span>(Sex <span class="op">==</span> <span class="st">"f"</span>)</span>
<span id="cb33-236"><a href="#cb33-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-237"><a href="#cb33-237" aria-hidden="true" tabindex="-1"></a># Building linear models</span>
<span id="cb33-238"><a href="#cb33-238" aria-hidden="true" tabindex="-1"></a>male_lm <span class="op">&lt;-</span> <span class="fu">lm</span>(Price <span class="op">~</span> Height<span class="op">,</span> data <span class="op">=</span> male_horses)</span>
<span id="cb33-239"><a href="#cb33-239" aria-hidden="true" tabindex="-1"></a>female_lm <span class="op">&lt;-</span> <span class="fu">lm</span>(Price <span class="op">~</span> Height<span class="op">,</span> data <span class="op">=</span> female_horses)</span>
<span id="cb33-240"><a href="#cb33-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-241"><a href="#cb33-241" aria-hidden="true" tabindex="-1"></a># Printing model outputs</span>
<span id="cb33-242"><a href="#cb33-242" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(male_lm)</span>
<span id="cb33-243"><a href="#cb33-243" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(female_lm)</span>
<span id="cb33-244"><a href="#cb33-244" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-245"><a href="#cb33-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-246"><a href="#cb33-246" aria-hidden="true" tabindex="-1"></a><span class="vs">The coefficient values for the two models are very different. For male horses, a unit change in height contributes to a 9346 dollar increase in the price of the horse, but for female horses, the opposite occurs, a unit change in height decreases the price by 2515 dollars (though this difference is not significantly different). Thus we can say that the height of a horse depends on its sex. In other words, the variable height and the variable sex interact with each other. Instead of making separate models like this, R has an easy way to show interacting terms. Instead of using the `</span><span class="op">+</span><span class="vs">`, we can use the `</span><span class="op">*</span><span class="vs">` sign to indicate an interaction between two variables. The `</span><span class="op">:</span><span class="vs">` sign can also be used to explicitly mention which terms interact. The codes given below show how to account for interaction between height and sex for the given dataset.</span></span>
<span id="cb33-247"><a href="#cb33-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-250"><a href="#cb33-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-251"><a href="#cb33-251" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb33-252"><a href="#cb33-252" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-253"><a href="#cb33-253" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb33-254"><a href="#cb33-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-255"><a href="#cb33-255" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb33-256"><a href="#cb33-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-257"><a href="#cb33-257" aria-hidden="true" tabindex="-1"></a># Building linear model <span class="cf">with</span> interaction</span>
<span id="cb33-258"><a href="#cb33-258" aria-hidden="true" tabindex="-1"></a>lm_model_1 <span class="op">&lt;-</span> <span class="fu">lm</span>(Price <span class="op">~</span> Height <span class="op">*</span> Sex<span class="op">,</span> data <span class="op">=</span> HorsePrices)</span>
<span id="cb33-259"><a href="#cb33-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-260"><a href="#cb33-260" aria-hidden="true" tabindex="-1"></a># Same model <span class="im">as</span> above but explicitly mentioning interaction terms</span>
<span id="cb33-261"><a href="#cb33-261" aria-hidden="true" tabindex="-1"></a>lm_model_2 <span class="op">&lt;-</span> <span class="fu">lm</span>(Price <span class="op">~</span> Height <span class="op">+</span> Sex <span class="op">+</span> Height<span class="op">:</span>Sex<span class="op">,</span> data <span class="op">=</span> HorsePrices)</span>
<span id="cb33-262"><a href="#cb33-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-263"><a href="#cb33-263" aria-hidden="true" tabindex="-1"></a># Printing model outputs</span>
<span id="cb33-264"><a href="#cb33-264" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_model_1)</span>
<span id="cb33-265"><a href="#cb33-265" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_model_2)</span>
<span id="cb33-266"><a href="#cb33-266" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-267"><a href="#cb33-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-268"><a href="#cb33-268" aria-hidden="true" tabindex="-1"></a><span class="vs">Since the female is the first level in the variable `</span><span class="fu">Sex</span><span class="vs">`, the intercept is estimated for female horses. This is the same value that we got from the `</span><span class="fu">female_lm</span><span class="vs">` model we made earlier. We also got the slope value for height, which is calculated for female horses (the same value as that from the `</span><span class="fu">female_lm</span><span class="vs">` model). The value for male horses is given as `</span><span class="fu">Sexm</span><span class="vs">` as is -177876, this value is relative to female horses and is given as the difference between the y-intercepts. We can find the actual y-intercept value for males by adding the `</span><span class="fu">Sexm</span><span class="vs">` value and the `</span>(Intercept)<span class="vs">` value which is -120546 ( = 57330 + -177876). This is the intercept value for male horses which we got from the `</span><span class="fu">male_lm</span><span class="vs">` model earlier. Now let us look at the `</span>Height<span class="op">:</span><span class="fu">Sexm</span><span class="vs">` value, which is given as 11861. This is the slope value showing how the price change when height change for male horses, but it is calculated relative to female horses. To get the actual slope for male horses, we have to add the slope of `</span><span class="fu">Height</span><span class="vs">` and `</span>Height<span class="op">:</span><span class="fu">Sexm</span><span class="vs">` values. In doing so we get a value of 9346 ( = -2515 + 11861) which is the slope of `</span><span class="fu">Height</span><span class="vs">`, which we got from the `</span><span class="fu">male_lm</span><span class="vs">` model earlier.</span></span>
<span id="cb33-269"><a href="#cb33-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-270"><a href="#cb33-270" aria-hidden="true" tabindex="-1"></a><span class="vs">## Plotting linear model with an interaction term</span></span>
<span id="cb33-271"><a href="#cb33-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-272"><a href="#cb33-272" aria-hidden="true" tabindex="-1"></a><span class="vs">When we were using the `</span><span class="fu">geom_parallel_slopes</span>()<span class="vs">` function from the `</span>{moderndive}<span class="vs">` package, I mentioned that we will not use `</span><span class="fu">geom_smooth</span>()<span class="vs">` function from the `</span>{ggplot2}<span class="vs">` package. This is because when we specify the `</span><span class="fu">col</span><span class="vs">` variable, the `</span><span class="fu">geom_smooth</span>()<span class="vs">` function automatically plots the trend line by considering the x-axis variable and the colour variable to be interacting.</span></span>
<span id="cb33-273"><a href="#cb33-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-276"><a href="#cb33-276" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-277"><a href="#cb33-277" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb33-278"><a href="#cb33-278" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-279"><a href="#cb33-279" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb33-280"><a href="#cb33-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-281"><a href="#cb33-281" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb33-282"><a href="#cb33-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-283"><a href="#cb33-283" aria-hidden="true" tabindex="-1"></a># Plotting linear model <span class="cf">with</span> interaction terms</span>
<span id="cb33-284"><a href="#cb33-284" aria-hidden="true" tabindex="-1"></a>HorsePrices <span class="op">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(Height<span class="op">,</span> Price<span class="op">,</span> col <span class="op">=</span> Sex)) <span class="op">+</span> <span class="fu">geom_point</span>() <span class="op">+</span></span>
<span id="cb33-285"><a href="#cb33-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"Price of horses with respect to their height and sex"</span><span class="op">,</span></span>
<span id="cb33-286"><a href="#cb33-286" aria-hidden="true" tabindex="-1"></a>       x <span class="op">=</span> <span class="st">"Height (in hands)"</span><span class="op">,</span></span>
<span id="cb33-287"><a href="#cb33-287" aria-hidden="true" tabindex="-1"></a>       y <span class="op">=</span> <span class="st">"Price (in dollars)"</span>) <span class="op">+</span></span>
<span id="cb33-288"><a href="#cb33-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(method <span class="op">=</span> <span class="st">"lm"</span>) <span class="op">+</span></span>
<span id="cb33-289"><a href="#cb33-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb33-290"><a href="#cb33-290" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-291"><a href="#cb33-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-292"><a href="#cb33-292" aria-hidden="true" tabindex="-1"></a><span class="vs">The slope for male horses is steeper than for female horses. This indicates that male horses have their price increased significantly as their height increased. Whereas female horses have their price change non significantly when their height change. This is exactly what we see in the `</span><span class="fu">male_lm</span><span class="vs">` and `</span><span class="fu">female_lm</span><span class="vs">` model coefficients.</span></span>
<span id="cb33-293"><a href="#cb33-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-294"><a href="#cb33-294" aria-hidden="true" tabindex="-1"></a><span class="vs">## Simpson's Paradox</span></span>
<span id="cb33-295"><a href="#cb33-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-296"><a href="#cb33-296" aria-hidden="true" tabindex="-1"></a><span class="vs">Simpson's paradox occurs when a result conveyed using the whole dataset is different from the results conveyed using the different groups within the same dataset. In simple words, the results of the model change drastically due to the inclusion of a variable which was previously not included in the model. Let's see what this means.</span></span>
<span id="cb33-297"><a href="#cb33-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-298"><a href="#cb33-298" aria-hidden="true" tabindex="-1"></a><span class="vs">We will use the `</span><span class="fu">penguins</span><span class="vs">` dataset from the `</span>{palmerpenguins}<span class="vs">` package in R. The dataset contains body measurements taken from three different species of penguins from Antarctica. Let us build a model where the body mass (`</span><span class="fu">body_mass_g</span><span class="vs">`) is predicted by bill depth (`</span><span class="fu">bill_depth_mm</span><span class="vs">`) alone. Let us also build another build with the same model formula as before but this time, we will include an interaction term between bill depth and species (`</span><span class="fu">species</span><span class="vs">`).</span></span>
<span id="cb33-299"><a href="#cb33-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-302"><a href="#cb33-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-303"><a href="#cb33-303" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="pp">require</span>(palmerpenguins)) install<span class="op">.</span><span class="fu">packages</span>(<span class="st">'palmerpenguins'</span>)</span>
<span id="cb33-304"><a href="#cb33-304" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb33-305"><a href="#cb33-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-306"><a href="#cb33-306" aria-hidden="true" tabindex="-1"></a># Building linear model</span>
<span id="cb33-307"><a href="#cb33-307" aria-hidden="true" tabindex="-1"></a>model_lm <span class="op">&lt;-</span> <span class="fu">lm</span>(body_mass_g  <span class="op">~</span> bill_depth_mm<span class="op">,</span> data <span class="op">=</span> penguins)</span>
<span id="cb33-308"><a href="#cb33-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-309"><a href="#cb33-309" aria-hidden="true" tabindex="-1"></a># Building linear model <span class="cf">with</span> interaction term</span>
<span id="cb33-310"><a href="#cb33-310" aria-hidden="true" tabindex="-1"></a>model_lm_interaction <span class="op">&lt;-</span> <span class="fu">lm</span>(body_mass_g  <span class="op">~</span> bill_depth_mm <span class="op">*</span> species<span class="op">,</span> data <span class="op">=</span> penguins)</span>
<span id="cb33-311"><a href="#cb33-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-312"><a href="#cb33-312" aria-hidden="true" tabindex="-1"></a># Printing model outputs</span>
<span id="cb33-313"><a href="#cb33-313" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_lm)</span>
<span id="cb33-314"><a href="#cb33-314" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_lm_interaction)</span>
<span id="cb33-315"><a href="#cb33-315" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-316"><a href="#cb33-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-317"><a href="#cb33-317" aria-hidden="true" tabindex="-1"></a><span class="vs">We get a rather interesting and contradicting set of results when we compare the summary outputs for both models. In the model without the species variable, greater bill depth predicts lower body mass in penguins. But, when we add the species variable, the trend reverses, increasing bill depth is associated with an increase in body mass. </span></span>
<span id="cb33-318"><a href="#cb33-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-319"><a href="#cb33-319" aria-hidden="true" tabindex="-1"></a><span class="vs">It is easier to plot the models and see. Use the slider to see the difference between the plots.</span></span>
<span id="cb33-320"><a href="#cb33-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-323"><a href="#cb33-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-324"><a href="#cb33-324" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> eval<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb33-325"><a href="#cb33-325" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb33-326"><a href="#cb33-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-327"><a href="#cb33-327" aria-hidden="true" tabindex="-1"></a># Plotting the model wihtout interaction term</span>
<span id="cb33-328"><a href="#cb33-328" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins<span class="op">,</span> <span class="fu">aes</span>(bill_depth_mm<span class="op">,</span> body_mass_g)) <span class="op">+</span></span>
<span id="cb33-329"><a href="#cb33-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="op">+</span></span>
<span id="cb33-330"><a href="#cb33-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"Body mass predcited by bill depth in three different species of penguins"</span><span class="op">,</span></span>
<span id="cb33-331"><a href="#cb33-331" aria-hidden="true" tabindex="-1"></a>       subtitle <span class="op">=</span> <span class="st">"body_mass_g  ~ bill_depth_mm + species"</span><span class="op">,</span></span>
<span id="cb33-332"><a href="#cb33-332" aria-hidden="true" tabindex="-1"></a>       x <span class="op">=</span> <span class="st">"Bill depth (mm)"</span><span class="op">,</span></span>
<span id="cb33-333"><a href="#cb33-333" aria-hidden="true" tabindex="-1"></a>       y <span class="op">=</span> <span class="st">"Body mass (g)"</span>) <span class="op">+</span></span>
<span id="cb33-334"><a href="#cb33-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(method <span class="op">=</span> <span class="st">"lm"</span>) <span class="op">+</span></span>
<span id="cb33-335"><a href="#cb33-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb33-336"><a href="#cb33-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-337"><a href="#cb33-337" aria-hidden="true" tabindex="-1"></a># Plotting the model <span class="cf">with</span> interaction term</span>
<span id="cb33-338"><a href="#cb33-338" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins<span class="op">,</span> <span class="fu">aes</span>(bill_depth_mm<span class="op">,</span> body_mass_g<span class="op">,</span> col <span class="op">=</span> species)) <span class="op">+</span></span>
<span id="cb33-339"><a href="#cb33-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="op">+</span></span>
<span id="cb33-340"><a href="#cb33-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"Body mass predcited by bill depth in three different species of penguins"</span><span class="op">,</span></span>
<span id="cb33-341"><a href="#cb33-341" aria-hidden="true" tabindex="-1"></a>       subtitle <span class="op">=</span> <span class="st">"body_mass_g  ~ bill_depth_mm * species"</span><span class="op">,</span></span>
<span id="cb33-342"><a href="#cb33-342" aria-hidden="true" tabindex="-1"></a>       x <span class="op">=</span> <span class="st">"Bill depth (mm)"</span><span class="op">,</span></span>
<span id="cb33-343"><a href="#cb33-343" aria-hidden="true" tabindex="-1"></a>       y <span class="op">=</span> <span class="st">"Body mass (g)"</span>) <span class="op">+</span></span>
<span id="cb33-344"><a href="#cb33-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(method <span class="op">=</span> <span class="st">"lm"</span>) <span class="op">+</span></span>
<span id="cb33-345"><a href="#cb33-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb33-346"><a href="#cb33-346" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-347"><a href="#cb33-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-348"><a href="#cb33-348" aria-hidden="true" tabindex="-1"></a><span class="vs">::: {.juxtapose data-startingposition="50%"}</span></span>
<span id="cb33-349"><a href="#cb33-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-352"><a href="#cb33-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-353"><a href="#cb33-353" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb33-354"><a href="#cb33-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-355"><a href="#cb33-355" aria-hidden="true" tabindex="-1"></a># Plotting the model wihtout interaction term</span>
<span id="cb33-356"><a href="#cb33-356" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins<span class="op">,</span> <span class="fu">aes</span>(bill_depth_mm<span class="op">,</span> body_mass_g)) <span class="op">+</span></span>
<span id="cb33-357"><a href="#cb33-357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="op">+</span></span>
<span id="cb33-358"><a href="#cb33-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"Body mass predcited by bill depth in three different species of penguins"</span><span class="op">,</span></span>
<span id="cb33-359"><a href="#cb33-359" aria-hidden="true" tabindex="-1"></a>       subtitle <span class="op">=</span> <span class="st">"body_mass_g  ~ bill_depth_mm + species"</span><span class="op">,</span></span>
<span id="cb33-360"><a href="#cb33-360" aria-hidden="true" tabindex="-1"></a>       x <span class="op">=</span> <span class="st">"Bill depth (mm)"</span><span class="op">,</span></span>
<span id="cb33-361"><a href="#cb33-361" aria-hidden="true" tabindex="-1"></a>       y <span class="op">=</span> <span class="st">"Body mass (g)"</span>) <span class="op">+</span></span>
<span id="cb33-362"><a href="#cb33-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(method <span class="op">=</span> <span class="st">"lm"</span>) <span class="op">+</span></span>
<span id="cb33-363"><a href="#cb33-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb33-364"><a href="#cb33-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-365"><a href="#cb33-365" aria-hidden="true" tabindex="-1"></a># Plotting the model <span class="cf">with</span> interaction term</span>
<span id="cb33-366"><a href="#cb33-366" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(penguins<span class="op">,</span> <span class="fu">aes</span>(bill_depth_mm<span class="op">,</span> body_mass_g<span class="op">,</span> col <span class="op">=</span> species)) <span class="op">+</span></span>
<span id="cb33-367"><a href="#cb33-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="op">+</span></span>
<span id="cb33-368"><a href="#cb33-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"Body mass predcited by bill depth in three different species of penguins"</span><span class="op">,</span></span>
<span id="cb33-369"><a href="#cb33-369" aria-hidden="true" tabindex="-1"></a>       subtitle <span class="op">=</span> <span class="st">"body_mass_g  ~ bill_depth_mm * species"</span><span class="op">,</span></span>
<span id="cb33-370"><a href="#cb33-370" aria-hidden="true" tabindex="-1"></a>       x <span class="op">=</span> <span class="st">"Bill depth (mm)"</span><span class="op">,</span></span>
<span id="cb33-371"><a href="#cb33-371" aria-hidden="true" tabindex="-1"></a>       y <span class="op">=</span> <span class="st">"Body mass (g)"</span>) <span class="op">+</span></span>
<span id="cb33-372"><a href="#cb33-372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(method <span class="op">=</span> <span class="st">"lm"</span>) <span class="op">+</span></span>
<span id="cb33-373"><a href="#cb33-373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb33-374"><a href="#cb33-374" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-375"><a href="#cb33-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-376"><a href="#cb33-376" aria-hidden="true" tabindex="-1"></a><span class="vs">:::</span></span>
<span id="cb33-377"><a href="#cb33-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-378"><a href="#cb33-378" aria-hidden="true" tabindex="-1"></a><span class="vs">So it is always better to visualize the dataset and build models according to the question at hand.</span></span>
<span id="cb33-379"><a href="#cb33-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-380"><a href="#cb33-380" aria-hidden="true" tabindex="-1"></a><span class="vs">## Visualizing linear models with two numerical explanatory variables</span></span>
<span id="cb33-381"><a href="#cb33-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-382"><a href="#cb33-382" aria-hidden="true" tabindex="-1"></a><span class="vs">Often you will be building models with two or more two explanatory variables. If some of those explanatory variables are categorical then it is easier to plot them as we can assign different colour or shape variables and we can also use faceting. But if they are all numerical variables then it is kind of difficult to plot them. We can either rely on three-dimensional plots or use a continuous colour scale gradient in a two-dimensional plot. Let us see how to plot the graphs.</span></span>
<span id="cb33-383"><a href="#cb33-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-384"><a href="#cb33-384" aria-hidden="true" tabindex="-1"></a><span class="vs">We will again use the `</span><span class="fu">penguins</span><span class="vs">` dataset from the `</span>{palmerpenguins}<span class="vs">` package in R. We will build a model to predict body mass (`</span><span class="fu">body_mass_g</span><span class="vs">`) using bill length (`</span><span class="fu">bill_length_mm</span><span class="vs">`) and bill depth (`</span><span class="fu">bill_depth_mm</span><span class="vs">`). Let us first try to plot a 3D plot using the `</span><span class="fu">scatter3D</span>()<span class="vs">` function from the `</span>{plot3D}<span class="vs">` package in R. </span></span>
<span id="cb33-385"><a href="#cb33-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-388"><a href="#cb33-388" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-389"><a href="#cb33-389" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="pp">require</span>(plot3D)) install<span class="op">.</span><span class="fu">packages</span>(<span class="st">'plot3D'</span>)</span>
<span id="cb33-390"><a href="#cb33-390" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plot3D)</span>
<span id="cb33-391"><a href="#cb33-391" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb33-392"><a href="#cb33-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-393"><a href="#cb33-393" aria-hidden="true" tabindex="-1"></a># Plotting a <span class="dv">3</span><span class="er">D</span> plot</span>
<span id="cb33-394"><a href="#cb33-394" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter3D</span>(penguins$body_mass_g<span class="op">,</span> penguins$bill_depth_mm<span class="op">,</span> penguins$bill_length_mm)</span>
<span id="cb33-395"><a href="#cb33-395" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-396"><a href="#cb33-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-397"><a href="#cb33-397" aria-hidden="true" tabindex="-1"></a><span class="vs">Well, 3D plotting is a mess, as you can see from the above plot. It is very hard to make out any useful findings using the graph above. So instead of this, we can return to our conventional 2D plot where we can use a continuous colour gradient to visualize the third numerical variable.</span></span>
<span id="cb33-398"><a href="#cb33-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-401"><a href="#cb33-401" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-402"><a href="#cb33-402" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb33-403"><a href="#cb33-403" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb33-404"><a href="#cb33-404" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-405"><a href="#cb33-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-406"><a href="#cb33-406" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"penguins"</span>)</span>
<span id="cb33-407"><a href="#cb33-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-408"><a href="#cb33-408" aria-hidden="true" tabindex="-1"></a># Plotting the graph</span>
<span id="cb33-409"><a href="#cb33-409" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(bill_depth_mm<span class="op">,</span> body_mass_g<span class="op">,</span> col <span class="op">=</span> bill_length_mm)) <span class="op">+</span></span>
<span id="cb33-410"><a href="#cb33-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="op">+</span></span>
<span id="cb33-411"><a href="#cb33-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"Body mass predcited by bill depth and bill length in three different species of penguins"</span><span class="op">,</span></span>
<span id="cb33-412"><a href="#cb33-412" aria-hidden="true" tabindex="-1"></a>       subtitle <span class="op">=</span> <span class="st">"body_mass_g  ~ bill_depth_mm * species"</span><span class="op">,</span></span>
<span id="cb33-413"><a href="#cb33-413" aria-hidden="true" tabindex="-1"></a>       x <span class="op">=</span> <span class="st">"Bill depth (mm)"</span><span class="op">,</span></span>
<span id="cb33-414"><a href="#cb33-414" aria-hidden="true" tabindex="-1"></a>       y <span class="op">=</span> <span class="st">"Body mass (g)"</span>) <span class="op">+</span></span>
<span id="cb33-415"><a href="#cb33-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(option <span class="op">=</span> <span class="st">"inferno"</span>) <span class="op">+</span></span>
<span id="cb33-416"><a href="#cb33-416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb33-417"><a href="#cb33-417" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-418"><a href="#cb33-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-419"><a href="#cb33-419" aria-hidden="true" tabindex="-1"></a><span class="vs">From the graph, it roughly seems like penguins with greater body mass have a longer and narrower bill. We can further subdivide this plot by the species category using faceting.</span></span>
<span id="cb33-420"><a href="#cb33-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-423"><a href="#cb33-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-424"><a href="#cb33-424" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb33-425"><a href="#cb33-425" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb33-426"><a href="#cb33-426" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-427"><a href="#cb33-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-428"><a href="#cb33-428" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"penguins"</span>)</span>
<span id="cb33-429"><a href="#cb33-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-430"><a href="#cb33-430" aria-hidden="true" tabindex="-1"></a># Making a <span class="kw">function</span> to make line breaks <span class="kw">in</span> text</span>
<span id="cb33-431"><a href="#cb33-431" aria-hidden="true" tabindex="-1"></a>addline_format <span class="op">&lt;-</span> <span class="kw">function</span>(x<span class="op">,...</span>){</span>
<span id="cb33-432"><a href="#cb33-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gsub</span>(<span class="st">','</span><span class="op">,</span><span class="st">'</span><span class="sc">\n</span><span class="st">'</span><span class="op">,</span>x)}</span>
<span id="cb33-433"><a href="#cb33-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-434"><a href="#cb33-434" aria-hidden="true" tabindex="-1"></a># Plotting the graph</span>
<span id="cb33-435"><a href="#cb33-435" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(bill_depth_mm<span class="op">,</span> body_mass_g<span class="op">,</span> col <span class="op">=</span> bill_length_mm)) <span class="op">+</span></span>
<span id="cb33-436"><a href="#cb33-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="op">+</span></span>
<span id="cb33-437"><a href="#cb33-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="fu">addline_format</span>(<span class="st">"Body mass predcited by bill depth and bill length,in three different species of penguins"</span>)<span class="op">,</span></span>
<span id="cb33-438"><a href="#cb33-438" aria-hidden="true" tabindex="-1"></a>       x <span class="op">=</span> <span class="st">"Bill depth (mm)"</span><span class="op">,</span></span>
<span id="cb33-439"><a href="#cb33-439" aria-hidden="true" tabindex="-1"></a>       y <span class="op">=</span> <span class="st">"Body mass (g)"</span>) <span class="op">+</span></span>
<span id="cb33-440"><a href="#cb33-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(option <span class="op">=</span> <span class="st">"inferno"</span>) <span class="op">+</span></span>
<span id="cb33-441"><a href="#cb33-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="op">~</span> species) <span class="op">+</span></span>
<span id="cb33-442"><a href="#cb33-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb33-443"><a href="#cb33-443" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-444"><a href="#cb33-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-445"><a href="#cb33-445" aria-hidden="true" tabindex="-1"></a><span class="vs">When we group the data according to different species, we get the opposite result as compared before. Here, we can see that penguins with heavier body mass have broader and longer bills.</span></span>
<span id="cb33-446"><a href="#cb33-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-447"><a href="#cb33-447" aria-hidden="true" tabindex="-1"></a><span class="vs">Now let us plot the predicted values from the linear models to see the general trend of the data.</span></span>
<span id="cb33-448"><a href="#cb33-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-451"><a href="#cb33-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-452"><a href="#cb33-452" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb33-453"><a href="#cb33-453" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb33-454"><a href="#cb33-454" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-455"><a href="#cb33-455" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb33-456"><a href="#cb33-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-457"><a href="#cb33-457" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"penguins"</span>)</span>
<span id="cb33-458"><a href="#cb33-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-459"><a href="#cb33-459" aria-hidden="true" tabindex="-1"></a># Making prediction</span>
<span id="cb33-460"><a href="#cb33-460" aria-hidden="true" tabindex="-1"></a>model_lm <span class="op">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="op">~</span> bill_depth_mm <span class="op">*</span> bill_length_mm<span class="op">,</span> data <span class="op">=</span> penguins)</span>
<span id="cb33-461"><a href="#cb33-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-462"><a href="#cb33-462" aria-hidden="true" tabindex="-1"></a>explorartory_values <span class="op">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb33-463"><a href="#cb33-463" aria-hidden="true" tabindex="-1"></a>  bill_depth_mm <span class="op">=</span> <span class="fu">seq</span>(<span class="dv">15</span><span class="op">,</span><span class="dv">25</span><span class="op">,</span><span class="dv">1</span>)<span class="op">,</span></span>
<span id="cb33-464"><a href="#cb33-464" aria-hidden="true" tabindex="-1"></a>  bill_length_mm <span class="op">=</span> <span class="fu">seq</span>(<span class="dv">30</span><span class="op">,</span><span class="dv">60</span><span class="op">,</span><span class="dv">1</span>)<span class="op">,</span></span>
<span id="cb33-465"><a href="#cb33-465" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-466"><a href="#cb33-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-467"><a href="#cb33-467" aria-hidden="true" tabindex="-1"></a>predicted_values <span class="op">&lt;-</span> explorartory_values <span class="op">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb33-468"><a href="#cb33-468" aria-hidden="true" tabindex="-1"></a>  body_mass_g <span class="op">=</span> <span class="fu">predict</span>(model_lm<span class="op">,</span> explorartory_values)</span>
<span id="cb33-469"><a href="#cb33-469" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-470"><a href="#cb33-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-471"><a href="#cb33-471" aria-hidden="true" tabindex="-1"></a># Plotting the graph <span class="cf">with</span> predicted values</span>
<span id="cb33-472"><a href="#cb33-472" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(bill_depth_mm<span class="op">,</span> body_mass_g<span class="op">,</span> col <span class="op">=</span> bill_length_mm)) <span class="op">+</span></span>
<span id="cb33-473"><a href="#cb33-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="op">+</span></span>
<span id="cb33-474"><a href="#cb33-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"Body mass predcited by bill depth and bill length </span></span>
<span id="cb33-475"><a href="#cb33-475" aria-hidden="true" tabindex="-1"></a><span class="kw">in</span> three different species <span class="kw">of</span> penguins<span class="st">",</span></span>
<span id="cb33-476"><a href="#cb33-476" aria-hidden="true" tabindex="-1"></a>       x <span class="op">=</span> <span class="st">"Bill depth (mm)"</span><span class="op">,</span></span>
<span id="cb33-477"><a href="#cb33-477" aria-hidden="true" tabindex="-1"></a>       y <span class="op">=</span> <span class="st">"Body mass (g)"</span>) <span class="op">+</span></span>
<span id="cb33-478"><a href="#cb33-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(option <span class="op">=</span> <span class="st">"inferno"</span>) <span class="op">+</span></span>
<span id="cb33-479"><a href="#cb33-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="op">~</span> species) <span class="op">+</span></span>
<span id="cb33-480"><a href="#cb33-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(data <span class="op">=</span> predicted_values<span class="op">,</span> <span class="fu">aes</span>(y <span class="op">=</span> body_mass_g)<span class="op">,</span> size <span class="op">=</span> <span class="dv">3</span><span class="op">,</span> shape <span class="op">=</span> <span class="dv">15</span>) <span class="op">+</span></span>
<span id="cb33-481"><a href="#cb33-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb33-482"><a href="#cb33-482" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-483"><a href="#cb33-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-484"><a href="#cb33-484" aria-hidden="true" tabindex="-1"></a><span class="vs">We got a nice gradient-coloured graph. From the predicted values we got from the model we can understand how body mass changes with bill depth and bill length. We can see two clear patterns. For penguins with lower bill length values, the body mass increases as bill depth increases. The opposite is true for penguins with larger values for bill length. For these penguins, body mass decreases as bill depth increases.</span></span>
<span id="cb33-485"><a href="#cb33-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-486"><a href="#cb33-486" aria-hidden="true" tabindex="-1"></a><span class="vs">## Visualizing logistic models with two numerical explanatory variables</span></span>
<span id="cb33-487"><a href="#cb33-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-488"><a href="#cb33-488" aria-hidden="true" tabindex="-1"></a><span class="vs">We have seen how to include two or more variables in a linear model. The same procedure applies to logistic models. Now we will see how to visualize a logistic model with two or more numerical variables.</span></span>
<span id="cb33-489"><a href="#cb33-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-490"><a href="#cb33-490" aria-hidden="true" tabindex="-1"></a><span class="vs">We will use the `</span><span class="fu">CreditCard</span><span class="vs">` dataset in the `</span>{AER}<span class="vs">` package in R. The dataset contains the credit history of a sample of applicants for a type of credit card. We will predict to see the success of the acceptance of the credit card application (`</span><span class="fu">card</span><span class="vs">`) using the yearly income (`</span><span class="fu">income</span><span class="vs">`) and age (`</span><span class="fu">age</span><span class="vs">`) of the applicant. The code for making the plot is very similar to that we have seen earlier.</span></span>
<span id="cb33-491"><a href="#cb33-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-494"><a href="#cb33-494" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-495"><a href="#cb33-495" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="pp">require</span>(AER)) install<span class="op">.</span><span class="fu">packages</span>(<span class="st">'AER'</span>)</span>
<span id="cb33-496"><a href="#cb33-496" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AER)</span>
<span id="cb33-497"><a href="#cb33-497" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb33-498"><a href="#cb33-498" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-499"><a href="#cb33-499" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb33-500"><a href="#cb33-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-501"><a href="#cb33-501" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"CreditCard"</span>)</span>
<span id="cb33-502"><a href="#cb33-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-503"><a href="#cb33-503" aria-hidden="true" tabindex="-1"></a># Making prediction</span>
<span id="cb33-504"><a href="#cb33-504" aria-hidden="true" tabindex="-1"></a>model_logistic <span class="op">&lt;-</span> <span class="fu">glm</span>(card <span class="op">~</span> income <span class="op">*</span> age<span class="op">,</span> data <span class="op">=</span> CreditCard<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb33-505"><a href="#cb33-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-506"><a href="#cb33-506" aria-hidden="true" tabindex="-1"></a>explorartory_values <span class="op">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb33-507"><a href="#cb33-507" aria-hidden="true" tabindex="-1"></a>  income <span class="op">=</span> <span class="fu">seq</span>(<span class="dv">0</span><span class="op">,</span><span class="dv">20</span><span class="op">,</span><span class="dv">1</span>)<span class="op">,</span></span>
<span id="cb33-508"><a href="#cb33-508" aria-hidden="true" tabindex="-1"></a>  age <span class="op">=</span> <span class="fu">seq</span>(<span class="dv">18</span><span class="op">,</span><span class="dv">90</span><span class="op">,</span><span class="dv">1</span>)<span class="op">,</span></span>
<span id="cb33-509"><a href="#cb33-509" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-510"><a href="#cb33-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-511"><a href="#cb33-511" aria-hidden="true" tabindex="-1"></a>predicted_values <span class="op">&lt;-</span> explorartory_values <span class="op">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb33-512"><a href="#cb33-512" aria-hidden="true" tabindex="-1"></a>  card <span class="op">=</span> <span class="fu">predict</span>(model_logistic<span class="op">,</span> explorartory_values<span class="op">,</span> type <span class="op">=</span> <span class="st">"response"</span>)</span>
<span id="cb33-513"><a href="#cb33-513" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-514"><a href="#cb33-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-515"><a href="#cb33-515" aria-hidden="true" tabindex="-1"></a># Plotting the graph <span class="cf">with</span> predicted values</span>
<span id="cb33-516"><a href="#cb33-516" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(CreditCard<span class="op">,</span> <span class="fu">aes</span>(income<span class="op">,</span> <span class="im">as</span><span class="op">.</span><span class="fu">integer</span>(card)<span class="op">-</span><span class="dv">1</span><span class="op">,</span> col <span class="op">=</span> age)) <span class="op">+</span></span>
<span id="cb33-517"><a href="#cb33-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(alpha <span class="op">=</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb33-518"><a href="#cb33-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"Does income and age affect the success in accepting a credit card application?"</span><span class="op">,</span></span>
<span id="cb33-519"><a href="#cb33-519" aria-hidden="true" tabindex="-1"></a>       x <span class="op">=</span> <span class="st">"Yearly income (in USD 10,000)"</span><span class="op">,</span></span>
<span id="cb33-520"><a href="#cb33-520" aria-hidden="true" tabindex="-1"></a>       y <span class="op">=</span> <span class="st">"Probability of success in accepting a credit card application"</span>) <span class="op">+</span></span>
<span id="cb33-521"><a href="#cb33-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>() <span class="op">+</span></span>
<span id="cb33-522"><a href="#cb33-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(data <span class="op">=</span> predicted_values<span class="op">,</span> <span class="fu">aes</span>(y <span class="op">=</span> card)<span class="op">,</span> size <span class="op">=</span> <span class="dv">3</span><span class="op">,</span> shape <span class="op">=</span> <span class="dv">15</span>) <span class="op">+</span></span>
<span id="cb33-523"><a href="#cb33-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb33-524"><a href="#cb33-524" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-525"><a href="#cb33-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-526"><a href="#cb33-526" aria-hidden="true" tabindex="-1"></a><span class="vs">We get some interesting results. People with higher yearly incomes have a higher chance of getting a credit card. But for age, younger people with lower yearly income have more chance of getting a credit card as compared to older people with the same level of yearly income. But this trend reverses when yearly income crosses 50,000 dollars.</span></span>
<span id="cb33-527"><a href="#cb33-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-528"><a href="#cb33-528" aria-hidden="true" tabindex="-1"></a><span class="vs">## Conclusion</span></span>
<span id="cb33-529"><a href="#cb33-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-530"><a href="#cb33-530" aria-hidden="true" tabindex="-1"></a><span class="vs">It is time to wrap up! In this tutorial we have learned the following things;</span></span>
<span id="cb33-531"><a href="#cb33-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-532"><a href="#cb33-532" aria-hidden="true" tabindex="-1"></a><span class="vs">1.    How to build models with two or more explanatory variables</span></span>
<span id="cb33-533"><a href="#cb33-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-534"><a href="#cb33-534" aria-hidden="true" tabindex="-1"></a><span class="vs">2.    How to interpret multivariate models</span></span>
<span id="cb33-535"><a href="#cb33-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-536"><a href="#cb33-536" aria-hidden="true" tabindex="-1"></a><span class="vs">3.    How to predict values using a multivariate model</span></span>
<span id="cb33-537"><a href="#cb33-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-538"><a href="#cb33-538" aria-hidden="true" tabindex="-1"></a><span class="vs">4.    Assessing a multivariate model</span></span>
<span id="cb33-539"><a href="#cb33-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-540"><a href="#cb33-540" aria-hidden="true" tabindex="-1"></a><span class="vs">5.    Building models with interaction terms and plotting them</span></span>
<span id="cb33-541"><a href="#cb33-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-542"><a href="#cb33-542" aria-hidden="true" tabindex="-1"></a><span class="vs">6.    What is Simpson's paradox</span></span>
<span id="cb33-543"><a href="#cb33-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-544"><a href="#cb33-544" aria-hidden="true" tabindex="-1"></a><span class="vs">7.    Visualising models with two numerical explanatory variables</span></span>
<span id="cb33-545"><a href="#cb33-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-546"><a href="#cb33-546" aria-hidden="true" tabindex="-1"></a><span class="vs">#### Last updated on {.unnumbered .unlisted .appendix}</span></span>
<span id="cb33-547"><a href="#cb33-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-550"><a href="#cb33-550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb33-551"><a href="#cb33-551" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> echo<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb33-552"><a href="#cb33-552" aria-hidden="true" tabindex="-1"></a>Sys<span class="op">.</span><span class="fu">time</span>()</span>
<span id="cb33-553"><a href="#cb33-553" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb33-554"><a href="#cb33-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-555"><a href="#cb33-555" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;!-- Do not forget to put flag counter --&gt;</span></span>
<span id="cb33-556"><a href="#cb33-556" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;a hidden href="https://info.flagcounter.com/ynrK"&gt;&lt;img src="https://s11.flagcounter.com/count2/ynrK/bg_000000/txt_FFFFFF/border_F0F0F0/columns_5/maxflags_25/viewers_0/labels_1/pageviews_1/flags_0/percent_0/" alt="Flag Counter" border="0"/&gt;&lt;/a&gt;</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Blog made using <a href="https://quarto.org/">Quarto®</a> with ❤️, by Jewel Johnson.</div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jeweljohnsonj">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/jeweljohnsonj">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:jewel15@alumni.iisertvm.ac.in">
      <i class="bi bi-briefcase" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:jeweljohnsonj@gmail.com">
      <i class="bi bi-house" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer><div class="page-columns page-rows-contents page-layout-article"><div class="social-share">
<a href="https://twitter.com/share?url=https://one-carat-blog.netlify.app/tutorials/stat_model/inter_reg.html&amp;text=Intermediate%20Regression%20in%20R" target="_blank" class="twitter"><i class="fab fa-twitter fa-fw fa-lg"></i></a><a href="https://www.linkedin.com/shareArticle?url=https://one-carat-blog.netlify.app/tutorials/stat_model/inter_reg.html&amp;title=Intermediate%20Regression%20in%20R" target="_blank" class="linkedin"><i class="fa-brands fa-linkedin-in fa-fw fa-lg"></i></a>  <a href="mailto:?subject=Intermediate%20Regression%20in%20R&amp;body=Check%20out%20this%20link:https://one-carat-blog.netlify.app/tutorials/stat_model/inter_reg.html" target="_blank" class="email"><i class="fa-solid fa-envelope fa-fw fa-lg"></i></a><a href="https://www.facebook.com/sharer.php?u=https://one-carat-blog.netlify.app/tutorials/stat_model/inter_reg.html" target="_blank" class="facebook"><i class="fab fa-facebook-f fa-fw fa-lg"></i></a><a href="https://reddit.com/submit?url=https://one-carat-blog.netlify.app/tutorials/stat_model/inter_reg.html&amp;title=Intermediate%20Regression%20in%20R" target="_blank" class="reddit">   <i class="fa-brands fa-reddit-alien fa-fw fa-lg"></i></a><a href="https://www.stumbleupon.com/submit?url=https://one-carat-blog.netlify.app/tutorials/stat_model/inter_reg.html&amp;title=Intermediate%20Regression%20in%20R" target="_blank" class="stumbleupon"><i class="fa-brands fa-stumbleupon fa-fw fa-lg"></i></a><a href="https://www.tumblr.com/share/link?url=https://one-carat-blog.netlify.app/tutorials/stat_model/inter_reg.html&amp;name=Intermediate%20Regression%20in%20R" target="_blank" class="tumblr"><i class="fa-brands fa-tumblr fa-fw fa-lg"></i></a>
</div></div>



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>