<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jewel Johnson">
<meta name="dcterms.date" content="2022-08-04">
<meta name="description" content="Learn how to build a model, predict values using it, evaluating it and plotting the model output in R">

<title>SciQuest - Introduction to statistical modelling in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/social-share-0.1.0/social-share.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/social-share-0.1.0/all.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EVCS615JQR"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EVCS615JQR', { 'anonymize_ip': true});
</script>
<style>html{ scroll-behavior: smooth; }</style>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

<link href="../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="https://cdn.knightlab.com/libs/juxtapose/latest/css/juxtapose.css">
<meta property="og:title" content="SciQuest - Introduction to statistical modelling in R">
<meta property="og:description" content="Learn how to build a model, predict values using it, evaluating it and plotting the model output in R">
<meta property="og:image" content="https://sciquest.netlify.app/tutorials/stat_model/images/stat_model.png">
<meta property="og:site-name" content="SciQuest">
<meta property="og:image:height" content="1080">
<meta property="og:image:width" content="1920">
<meta name="twitter:title" content="SciQuest - Introduction to statistical modelling in R">
<meta name="twitter:description" content="Learn how to build a model, predict values using it, evaluating it and plotting the model output in R">
<meta name="twitter:image" content="https://sciquest.netlify.app/tutorials/stat_model/images/stat_model.png">
<meta name="twitter:image-height" content="1080">
<meta name="twitter:image-width" content="1920">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../favicon.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">SciQuest</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials.html" rel="" target="">
 <span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://jeweljohnsonj.github.io/jewel_resume/" rel="" target="">
 <span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jeweljohnsonj/SciQuest" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/jeweljohnsonj" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Introduction to statistical modelling in R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          Learn how to build a model, predict values using it, evaluating it and plotting the model output in R
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">statistical modelling</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://sciquest.netlify.app/">Jewel Johnson</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 4, 2022</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">April 15, 2023</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#definition-of-statistical-model" id="toc-definition-of-statistical-model" class="nav-link active" data-scroll-target="#definition-of-statistical-model"><span class="header-section-number">1</span> Definition of statistical model</a></li>
  <li><a href="#making-life-easier" id="toc-making-life-easier" class="nav-link" data-scroll-target="#making-life-easier"><span class="header-section-number">2</span> Making life easier</a></li>
  <li><a href="#building-a-model" id="toc-building-a-model" class="nav-link" data-scroll-target="#building-a-model"><span class="header-section-number">3</span> Building a model</a>
  <ul class="collapse">
  <li><a href="#linear-model" id="toc-linear-model" class="nav-link" data-scroll-target="#linear-model"><span class="header-section-number">3.1</span> Linear model</a></li>
  <li><a href="#logistic-model" id="toc-logistic-model" class="nav-link" data-scroll-target="#logistic-model"><span class="header-section-number">3.2</span> Logistic model</a></li>
  </ul></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation"><span class="header-section-number">4</span> Model evaluation</a>
  <ul class="collapse">
  <li><a href="#prediciting-values" id="toc-prediciting-values" class="nav-link" data-scroll-target="#prediciting-values"><span class="header-section-number">4.1</span> Prediciting values</a></li>
  <li><a href="#evaluating-a-model" id="toc-evaluating-a-model" class="nav-link" data-scroll-target="#evaluating-a-model"><span class="header-section-number">4.2</span> Evaluating a model</a></li>
  <li><a href="#choosing-the-explanatory-variables" id="toc-choosing-the-explanatory-variables" class="nav-link" data-scroll-target="#choosing-the-explanatory-variables"><span class="header-section-number">4.3</span> Choosing the explanatory variables</a></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation"><span class="header-section-number">4.4</span> Cross validation</a></li>
  <li><a href="#prediction-error-for-categorical-response-variable" id="toc-prediction-error-for-categorical-response-variable" class="nav-link" data-scroll-target="#prediction-error-for-categorical-response-variable"><span class="header-section-number">4.5</span> Prediction error for categorical response variable</a></li>
  <li><a href="#creating-a-null-model" id="toc-creating-a-null-model" class="nav-link" data-scroll-target="#creating-a-null-model"><span class="header-section-number">4.6</span> Creating a null model</a></li>
  </ul></li>
  <li><a href="#exploratory-modelling" id="toc-exploratory-modelling" class="nav-link" data-scroll-target="#exploratory-modelling"><span class="header-section-number">5</span> Exploratory modelling</a>
  <ul class="collapse">
  <li><a href="#evaluating-a-recursive-partitioning-model" id="toc-evaluating-a-recursive-partitioning-model" class="nav-link" data-scroll-target="#evaluating-a-recursive-partitioning-model"><span class="header-section-number">5.1</span> Evaluating a recursive partitioning model</a></li>
  </ul></li>
  <li><a href="#covariate" id="toc-covariate" class="nav-link" data-scroll-target="#covariate"><span class="header-section-number">6</span> Covariate</a></li>
  <li><a href="#effect-sizes" id="toc-effect-sizes" class="nav-link" data-scroll-target="#effect-sizes"><span class="header-section-number">7</span> Effect sizes</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">8</span> Conclusion</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jeweljohnsonj/SciQuest/edit/main/tutorials/stat_model/intro_stat_model.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/jeweljohnsonj/SciQuest/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="30" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 29;"><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="pp">require</span>(<span class="st">"https://cdn.jsdelivr.net/npm/juxtaposejs@1.1.6/build/js/juxtapose.min.js"</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">catch</span>(() <span class="kw">=&gt;</span> <span class="kw">null</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-1" data-nodetype="expression">

</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
TL;DR
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this article you will learn;</p>
<ol type="1">
<li><p>What is the meaning of a statistical model</p>
<ul>
<li>Model functions: <code>lm()</code>, <code>glm()</code> and <code>rpart()</code></li>
<li>Model formula: <code>response ~ formula</code></li>
<li>Model architectures: linear, logistic, recursive partitioning</li>
</ul></li>
<li><p>How to build a model</p>
<ul>
<li>Building models using functions, formulas and model architectures</li>
<li>Plotting the model output</li>
</ul></li>
<li><p>How to evaluate a model</p>
<ul>
<li>Using the model to predict values outside the data</li>
<li>Calculating the mean of the square of the prediction errors</li>
<li>Using error to compare models to aid explanatory variable selection</li>
<li>Cross-validation technique and model iteration by <code>cv_pred_error()</code> function</li>
<li>Prediction error for a categorical response variable</li>
</ul></li>
<li><p>How to build a null model</p></li>
<li><p>How to do exploratory modelling</p>
<ul>
<li>Evaluation of a recursive partitioning model and plotting it</li>
</ul></li>
<li><p>What is a covariate</p></li>
<li><p>How to calculate effect size</p>
<ul>
<li>For numerical explanatory variables</li>
<li>For categorical explanatory variables</li>
</ul></li>
</ol>
</div>
</div>
<section id="definition-of-statistical-model" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="definition-of-statistical-model"><span class="header-section-number">1</span> Definition of statistical model</h2>
<p>Before we get to know the definition of what a <strong>statistical model</strong> is, let us first try to understand what a <strong>model</strong> means. All of us have an intuitive idea of what a ‘model’ is. A model can be a fashion model posing in pretty clothes and makeup or it can be a blueprint which represents the overall layout of a building. In all these understandings of a model, we can summarise that it is representing a relationship.</p>
<p>A statistical model also belongs to the same suite but is made using data. It is also representing ‘relationships’, but between variables within the data. Understanding a statistical model can lead us to understand how the variables within a dataset are related to each other.</p>
<p>Let us consider the graph given below;</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="intro_stat_model_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The x-axis shows speed and the y-axis shows stopping distance. From the graph, you can see that, as speed increases, the stopping distance also increases. Therefore we can say that the stopping distance linearly increases with speed. To showcase this linear relationship, we can plot a regression line (green line) as shown below.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="intro_stat_model_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The regression line can be extended to values outside the dataset and doing so would enable us to predict values outside our dataset, like predicting what the stopping distance will be if the speed was 35 mph. You can also see that many points are away from the regression line and do not lie on it, therefore the linear relationship we predicted for the variables is not a perfect one. Suppose instead of a linear relationship, we fit a polynomial regression line.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="intro_stat_model_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this graph, especially at the extreme ends, most of the points are closer to the regression line than in the earlier case. Therefore, the residual distance, which is the distance between the actual data points and the fitted values by regression lines would be smaller indicating a better fit for the polynomial regression. Therefore a good fit can more accurately represent the relationship between the variables and therefore would have better predictive power. But how do we exactly compare the linear regression and the polynomial regression ‘models’? Is there a metric which would allow this comparison easier? We will learn all about this later in this article.</p>
<p>Going back to the linear regression plot, suppose, instead of speed, we use the colour of the car and see if it affects the stopping distance at a constant speed. For obvious reasons, there should be no effect of colour on the stopping distances (duh!). Nevertheless, now we also know that some variables form relationships and some don’t.</p>
<p>In short, what we essentially were doing was linear modelling, a type of statistical modelling. And this exercise helped us realise that a model can inform us about;</p>
<ol type="1">
<li>The relationship between the variables in the data</li>
<li>Which variables form relationships</li>
<li>Predict values outside our dataset</li>
<li>Model comparisons (linear vs polynomial)</li>
</ol>
<p>The textbook definition for statistical modelling is;</p>
<blockquote class="blockquote">
<p><strong>A statistical model is a set of probability distributions <span class="math inline">P(S)</span> on a sample space (<span class="math inline">S</span>)</strong> <span class="citation" data-cites="mccullagh_what_2002">(<a href="#ref-mccullagh_what_2002" role="doc-biblioref">1</a>)</span>.</p>
</blockquote>
<p>In our previous modelling exercise, we saw how speed affects stopping distance. Here the variable ‘speed’ is called the <strong>parameter</strong> or otherwise, better called the <strong>explanatory variable</strong>, which tries to explain the variations seen in the <strong>response variable</strong>, which is the stopping distance. The model we created was not perfect as there were many data points which did not lie on the regression line. One potential source of this error can arrive from the selection of the explanatory variables. The dataset had stopping distances of a particular vehicle at different speeds. The stopping distance can also be affected by the road terrain (friction) and the efficiency of the brakes, all of which were missing from the dataset. Therefore these parameters that we have not accounted for can also potentially affect our model. So why weren’t those included in the dataset? Often it is time-consuming to keep note of every parameter that can affect the variable we are interested in and therefore, they are often excluded from data collection. Thus, the model created using this data would only be a close approximation of what is happening in the real world. This particular drawback is emphasised in the following aphorism;</p>
<blockquote class="blockquote">
<p>“All models are wrong, but some are useful” - George Box <span class="citation" data-cites="box_science_1976">(<a href="#ref-box_science_1976" role="doc-biblioref">2</a>)</span></p>
</blockquote>
<p>Thus even though our model is not the perfect one<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, if it reliably predicts values then the model is considered useful. Thus a statistical model is stochastic.</p>
<p>From a mathematical point of view, an ideal model would contain all the parameters that affect the response variable. Thus the sample space (<span class="math inline">S</span>) will contain all possible combinations of <strong>[explanatory variables, stopping distance]</strong> values. Therefore, the set of probability distributions corresponding to all these combinations will be <span class="math inline">P(S)</span>. But in real life, we cannot afford to measure all the parameters concerning the response variable and are only interested in a small set of variables. Thus we often have a subset of the total possible combinations of <strong>[explanatory variables, stopping distance]</strong> values (<span class="math inline">\theta</span>), and the corresponding probability distribution for these combinations will be <span class="math inline">P(\theta)</span>. The model thus created with a small set of parameters is called a parametrised statistical model.</p>
<p>For all such models; <span class="math inline">P(\theta) \subset P(S)</span>.</p>
<p>This definition is not exactly needed to do modelling but it’s good to know the actual mathematical definition of what a statistical model is.</p>
<p>Now that we have a rough idea of what a model is, let us know learn how to build models in R.</p>
</section>
<section id="making-life-easier" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="making-life-easier"><span class="header-section-number">2</span> Making life easier</h2>
<p>Please install and load the necessary packages and datasets which are listed below for a seamless tutorial session. (Not required but can be very helpful if you are following this tutorial code by code)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries used in this tutorial</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'cherryblossom'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'rpart'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'datasets'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'NHANES'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'rpart.plot'</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'mosaicModel'</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'devtools'</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"dtkaplan/statisticalModeling"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading the libraries</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>tutorial_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"cherryblossom"</span>, <span class="st">"rpart"</span>, <span class="st">"datasets"</span>, <span class="st">"NHANES"</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"rpart.plot"</span>, <span class="st">"mosaicModel"</span>, <span class="st">"statisticalModeling"</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(tutorial_packages, library, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Datasets used in this tutorial</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"run17"</span>) <span class="co"># From cherryblossom</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"ToothGrowth"</span>) <span class="co"># From datasets</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"chickwts"</span>) <span class="co"># From datasets</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"NHANES"</span>) <span class="co"># From NHANES</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Tadpoles"</span>) <span class="co"># From mosaicModel</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Used_Fords"</span>) <span class="co"># From mosaicModel</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="building-a-model" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="building-a-model"><span class="header-section-number">3</span> Building a model</h2>
<p>The pipeline for building a model is as follows;</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">graph LR
subgraph Pipeline for making a statistical model
A(Collect data) --&gt; B(Select explanatory&lt;br&gt; and response variables) --&gt; C(Select model architecture) --&gt; D(Build the model)
end
</pre>
</div>
</div>
</div>
</div>
<p>The first step in building a model is by acquiring data. Then we need to select the appropriate response variable (dependent variable) and the explanatory variables (independent variable). In a cancer drug trial experiment data, tumour size can be the response variable and the drug type and patient age can be the explanatory variables. After selecting the variables, the model architecture is chosen. In our earlier example, we used a linear model to explain the changes seen in stopping distances with speed. Choosing a model architecture depends on the nature of the data. For now, we will mostly be using the linear model <code>lm()</code>. But throughout the tutorial, we will also see other model architectures. The final step is to build the model, which is done by the computer.</p>
<p>The syntax for building a model in R is as follows;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(response <span class="sc">~</span> explanaotry1 <span class="sc">+</span> explanatory2, <span class="at">data =</span> dataset_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="linear-model" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="linear-model"><span class="header-section-number">3.1</span> Linear model</h3>
<p>Let us try to plot some models using the linear model architecture using the <code>lm()</code>function in R. We will be using the <code>run17</code> dataset from the <code>{cherryblossom}</code> package in R. The <code>run17</code> dataset contains details for all 19,961 runners in the 2017 Cherry Blossom Run, which is an annual road race that takes place in Washington, DC, USA. Also, the Cherry Blossom Run has two events; a 10 Mile marathon and a 5 Km run. For now, we will be concerned with participants that participated in the 10 Mile marathon only.</p>
<p>In the dataset, we are interested to check whether the net time to complete the 10 Mile marathon (<code>net_sec</code>) is affected by the <code>age</code> and <code>sex</code> of the participant. So for making the model, we use <code>net_sec</code> as the response variable and, <code>age</code> and <code>sex</code> as the explanatory variables.</p>
<p>We can use the <code>summary()</code> function to summarise the model. For now, we will not worry about the summary details. Then, using the <code>{ggplot2}</code> package, we will plot the model using the <code>stat_smooth()</code> function. Please not that there is another function <code>geom_smooth()</code> which is an alias of <code>stat_smooth()</code>. Both do the same thing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(cherryblossom)) <span class="fu">install.packages</span>(<span class="st">'cherryblossom'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking headers in the data</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(run17)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["bib"],"name":[1],"type":["int"],"align":["right"]},{"label":["name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["sex"],"name":[3],"type":["chr"],"align":["left"]},{"label":["age"],"name":[4],"type":["int"],"align":["right"]},{"label":["city"],"name":[5],"type":["chr"],"align":["left"]},{"label":["net_sec"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["clock_sec"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["pace_sec"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["event"],"name":[9],"type":["chr"],"align":["left"]}],"data":[{"1":"6","2":"Hiwot G.","3":"F","4":"21","5":"Ethiopia","6":"3217","7":"3217","8":"321","9":"10 Mile"},{"1":"22","2":"Buze D.","3":"F","4":"22","5":"Ethiopia","6":"3232","7":"3232","8":"323","9":"10 Mile"},{"1":"16","2":"Gladys K.","3":"F","4":"31","5":"Kenya","6":"3276","7":"3276","8":"327","9":"10 Mile"},{"1":"4","2":"Mamitu D.","3":"F","4":"33","5":"Ethiopia","6":"3285","7":"3285","8":"328","9":"10 Mile"},{"1":"20","2":"Karolina N.","3":"F","4":"35","5":"Poland","6":"3288","7":"3288","8":"328","9":"10 Mile"},{"1":"8","2":"Firehiwot D.","3":"F","4":"33","5":"Ethiopia","6":"3316","7":"3316","8":"331","9":"10 Mile"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>model_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(net_sec <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> run17_marathon)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the summary of the model</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># For now don't worry about the details</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = net_sec ~ age + sex, data = run17_marathon)

Residuals:
     Min       1Q   Median       3Q      Max 
-2814.89  -672.65   -41.43   625.34  3112.81 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 5475.8377    25.8841  211.55   &lt;2e-16 ***
age           17.9157     0.6789   26.39   &lt;2e-16 ***
sexM        -674.3765    14.8290  -45.48   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 947.5 on 17439 degrees of freedom
Multiple R-squared:  0.1229,    Adjusted R-squared:  0.1228 
F-statistic:  1222 on 2 and 17439 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model using ggplot2</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Use stat_smooth() function and specify "lm"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, net_sec, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Time to complete 10 Mile marathon (sec)"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Net time ~ Age + Sex"</span>) <span class="sc">+</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="intro_stat_model_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the graph, it seems that female participants take more time to complete the run compared to their male counterparts.</p>
</section>
<section id="logistic-model" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="logistic-model"><span class="header-section-number">3.2</span> Logistic model</h3>
<p>Now let us try to see whether the participant’s choice in choosing between the events is affected by their age and sex. We can hypothesize that older participants of both sexes would prefer the 5 km run over 10 Mile marathon. Thus, we use the variable <code>event</code> as the response variable and, <code>age</code> and <code>sex</code> as the explanatory variables. We are more interested to see the effect of age as compared to sex, therefore the variable <code>sex</code> is considered a covariate. We will learn later what covariate mean</p>
<p>We will use the <code>lm()</code> function to make a linear model. Here we will convert the event variable to boolean values for it to work with the formula. The corresponding values are; 1 = 10 Mile event and 0 = 5 Km event.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting event variable values into boolean </span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="ot">&lt;-</span> run17</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>run17_boolean<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">recode</span>(run17_boolean<span class="sc">$</span>event, <span class="st">"10 Mile"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"5K"</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>model_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(event <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> run17_boolean)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model using ggplot2</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, event, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Event choice"</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Event ~ Age + Sex (linear model)"</span>) <span class="sc">+</span> </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="intro_stat_model_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the graph, it seems like, for male participants, age doesn’t affect their event choice selection. But for females, compared to males, age does seem to affect it. Therefore older female participants prefer 5 km runs as compared to older male participants.</p>
<p>Let us look at the dataset more closely, especially the response variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking the data type of the response variable</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(run17<span class="sc">$</span>event)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the unique strings from the response variable</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(run17<span class="sc">$</span>event)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "10 Mile" "5K"     </code></pre>
</div>
</div>
<p>Our response variable is dichotomous and thus not continuous. The <code>lm()</code> function we used works best for continuous numerical data. So the model architecture we used was not an appropriate one here. So in these situations, we can use the logistic modelling architecture. Both logistic modelling and linear modelling are part of generalised linear modelling. We can use the <code>glm()</code> function in R and specify <code>family = binomial</code> to have a logistic model.</p>
<p>The syntax for a logistic model in R is;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(response_variable <span class="sc">~</span> explanatory_variable, <span class="at">data =</span> dataset_name, <span class="at">family =</span> <span class="st">"binomial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let us try the <code>glm()</code> function and make a logistic model for the earlier case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting event variable values into boolean </span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="ot">&lt;-</span> run17</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>run17_boolean<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">recode</span>(run17_boolean<span class="sc">$</span>event, <span class="st">"10 Mile"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"5K"</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the logistic model</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>model_3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(event <span class="sc">~</span> sex <span class="sc">+</span> age, <span class="at">data =</span> run17_boolean, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model using ggplot2</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Use stat_smooth() function and specify "glm"</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, event, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>)) <span class="sc">+</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Event choice"</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Event ~ Age + Sex (logistic model)"</span>) <span class="sc">+</span> </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="intro_stat_model_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The graph looks very similar to the earlier one. For easy comparison, both the graphs are shown next to each other below. Please use the slider to compare between the graphs.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="ot">&lt;-</span> run17</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>run17_boolean<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">recode</span>(run17_boolean<span class="sc">$</span>event, <span class="st">"10 Mile"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"5K"</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear model</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, event, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Event choice"</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Event ~ Age + Sex (linear model)"</span>) <span class="sc">+</span> </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic model</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, event, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>)) <span class="sc">+</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Event choice"</span>,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Event ~ Age + Sex (logistic model)"</span>) <span class="sc">+</span> </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="juxtapose" data-startingposition="35%">
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="ot">&lt;-</span> run17</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>run17_boolean<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">recode</span>(run17_boolean<span class="sc">$</span>event, <span class="st">"10 Mile"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"5K"</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear model</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, event, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Event choice"</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Event ~ Age + Sex (linear model)"</span>) <span class="sc">+</span> </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="intro_stat_model_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic model</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, event, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>)) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Event choice"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Event ~ Age + Sex (logistic model)"</span>) <span class="sc">+</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="intro_stat_model_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</section>
</section>
<section id="model-evaluation" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="model-evaluation"><span class="header-section-number">4</span> Model evaluation</h2>
<p>After building the model, we can evaluate it by providing new inputs to the model to get corresponding predicted output values. The predicted output values can then be cross-checked against the original output values and see how far off they are in terms of prediction (i.e.&nbsp;the prediction error). Using the <code>predict()</code> function, we can predict for values outside the dataset or evaluate the model using the prediction error.</p>
<section id="prediciting-values" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="prediciting-values"><span class="header-section-number">4.1</span> Prediciting values</h3>
<p>We will go back to the first example where we checked if the net time to complete the 10 Mile marathon (<code>net_sec</code>) is affected by the age and sex of the participants. We will create dummy data of participants with random age and sex values and use the model to predict their net time to complete the race.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating dummy data of different ages</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>male <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"age"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">2</span>)),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"sex"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">replicate</span>(<span class="dv">50</span>, <span class="st">"M"</span>)))</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>female <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"age"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">2</span>)),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"sex"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">replicate</span>(<span class="dv">50</span>, <span class="st">"F"</span>)))</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>dummy_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(male, female)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(net_sec <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> run17_marathon)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting values</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>dummy_data<span class="sc">$</span>net_sec <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_lm, <span class="at">newdata =</span> dummy_data)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the predicted values</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>dummy_data <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, net_sec, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Time to complete the marathon (sec)"</span>,</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Predicted values"</span>) <span class="sc">+</span> </span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="intro_stat_model_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In the plot, we can see that we have babies as young as 1 year old, who have been predicted to have completed the 10 Mile marathon faster that their older participants. So what on earth did we do to get these results?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://c.tenor.com/QSFMj0VddAQAAAAC/hold-on-wait-a-minute.gif" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">My reaction after the model predictions</figcaption>
</figure>
</div>
<p>Let us look the linear model plot that we had earlier.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="intro_stat_model_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>You can see that there is a general trend of increasing ‘net time to complete the race’ as the ‘age’ value increases and decreasing net time as age decreases. Therefore our linear model favours reduced net times for lesser values of age, which is what we see as predicted values.</p>
<p>So our model has its limitations in predicting values for a certain range of age😅.</p>
<p>The moral of the story here is that models trained on data can be a bit wild when evaluated outside the range of the data. So we have to be mindful of its prediction abilities, otherwise, we can end up with superhuman babies who can run marathons faster than anyone.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/age_time.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Ideal relationship between age and the time to complete the marathon</figcaption>
</figure>
</div>
</section>
<section id="evaluating-a-model" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="evaluating-a-model"><span class="header-section-number">4.2</span> Evaluating a model</h3>
<p>Instead of predicting new values outside the dataset, we can use the same dataset used for model training to predict values. Utilizing these predicted values, we can compare them back to the original values and calculate the prediction error. This is one way to compare different models and see which models predict values closer to the original values in the dataset.</p>
<p>We will use our earlier made linear model, where we looked at whether the total time to complete the race is affected by age and sex. We will also make a new model using the ‘recursive partitioning model architecture’ using the same dataset so that we can have a model to compare with. Using the <code>rpart()</code> function in the <code>{rpart}</code> package in R, we can build a recursive partitioning model. The <code>rpart()</code> model works for both numerical (dichotomous and discontinuous) and categorical data. We will learn more about rpart models later in this article.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(rpart)) <span class="fu">install.packages</span>(<span class="st">'rpart'</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking headers in the data</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(run17)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["bib"],"name":[1],"type":["int"],"align":["right"]},{"label":["name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["sex"],"name":[3],"type":["chr"],"align":["left"]},{"label":["age"],"name":[4],"type":["int"],"align":["right"]},{"label":["city"],"name":[5],"type":["chr"],"align":["left"]},{"label":["net_sec"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["clock_sec"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["pace_sec"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["event"],"name":[9],"type":["chr"],"align":["left"]}],"data":[{"1":"6","2":"Hiwot G.","3":"F","4":"21","5":"Ethiopia","6":"3217","7":"3217","8":"321","9":"10 Mile"},{"1":"22","2":"Buze D.","3":"F","4":"22","5":"Ethiopia","6":"3232","7":"3232","8":"323","9":"10 Mile"},{"1":"16","2":"Gladys K.","3":"F","4":"31","5":"Kenya","6":"3276","7":"3276","8":"327","9":"10 Mile"},{"1":"4","2":"Mamitu D.","3":"F","4":"33","5":"Ethiopia","6":"3285","7":"3285","8":"328","9":"10 Mile"},{"1":"20","2":"Karolina N.","3":"F","4":"35","5":"Poland","6":"3288","7":"3288","8":"328","9":"10 Mile"},{"1":"8","2":"Firehiwot D.","3":"F","4":"33","5":"Ethiopia","6":"3316","7":"3316","8":"331","9":"10 Mile"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(net_sec <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> run17_marathon)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a recursive partitioning model</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>model_rpart <span class="ot">&lt;-</span> <span class="fu">rpart</span>(net_sec <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> run17_marathon)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting values</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>lm_predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_lm, <span class="at">newdata =</span> run17_marathon)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>rpart_predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_rpart, <span class="at">newdata =</span> run17_marathon)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating error values</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>lm_error <span class="ot">&lt;-</span> <span class="fu">with</span>(run17_marathon, net_sec <span class="sc">-</span> lm_predict)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>rpart_error <span class="ot">&lt;-</span> <span class="fu">with</span>(run17_marathon, net_sec <span class="sc">-</span> rpart_predict)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing few error values</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.data.frame</span>(lm_error))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["lm_error"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"-2635.068","_rn_":"1"},{"1":"-2637.984","_rn_":"2"},{"1":"-2755.226","_rn_":"3"},{"1":"-2782.057","_rn_":"4"},{"1":"-2814.889","_rn_":"5"},{"1":"-2751.057","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.data.frame</span>(rpart_error))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["rpart_error"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"-2761.985","_rn_":"1"},{"1":"-2746.985","_rn_":"2"},{"1":"-2702.985","_rn_":"3"},{"1":"-2693.985","_rn_":"4"},{"1":"-2690.985","_rn_":"5"},{"1":"-2662.985","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Now we have data frames containing error values calculated between each of the original values in the dataset to the predicted values from the model. You can see that it’s tedious to compare the error values of the linear model to the logistic model, also some of these error values are negative, which makes the comparison even harder. So how can we know which model is better? Calculating the mean of the square of the prediction errors (m.s.e) would be a great way to start. The m.s.e will reflect the magnitude and not the sign of the errors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean of the square of the prediction errors (m.s.e)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(lm_error <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 897630</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(rpart_error <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 905886.9</code></pre>
</div>
</div>
<p>The linear model has a lower error value compared to the recursive partitioning model. Therefore the fitted values in the linear model are closer to the actual value in the dataset compare to the other model.</p>
<p>We can also plot the predicted values and see how they look. Please use the slider to compare the graphs.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the linear model</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, net_sec, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Time to complete 10 Mile marathon (sec)"</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Net time ~ Age + Sex (linear model)"</span>) <span class="sc">+</span> </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding rpart predicted values to the dataset</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>rpart_predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_rpart, <span class="at">newdata =</span> run17_marathon)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>run17_marathon<span class="sc">$</span>rpart_fitted_values <span class="ot">&lt;-</span> rpart_predict</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the recursive partitioning model</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, rpart_predict, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Time to complete 10 Mile marathon (sec)"</span>,</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Net time ~ Age + Sex (recursive partitioning model)"</span>) <span class="sc">+</span> </span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="juxtapose" data-startingposition="50%">
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the linear model</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, net_sec, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Time to complete 10 Mile marathon (sec)"</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Net time ~ Age + Sex (linear model)"</span>) <span class="sc">+</span> </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="intro_stat_model_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding rpart predicted values to the dataset</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>rpart_predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_rpart, <span class="at">newdata =</span> run17_marathon)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>run17_marathon<span class="sc">$</span>rpart_fitted_values <span class="ot">&lt;-</span> rpart_predict</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the recursive partitioning model</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, rpart_predict, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Time to complete 10 Mile marathon (sec)"</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Net time ~ Age + Sex (recursive partitioning model)"</span>) <span class="sc">+</span> </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="intro_stat_model_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</section>
<section id="choosing-the-explanatory-variables" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="choosing-the-explanatory-variables"><span class="header-section-number">4.3</span> Choosing the explanatory variables</h3>
<p>In this exercise, we will use the <code>ToothGrowth</code> dataset from the <code>{datasets}</code> package in R. The dataset is from an experiment that looked at the effect of vitamin C on tooth growth in guinea pigs. In the experiment, three different doses of vitamin C were administered to 60 guinea pigs. Vitamin C was administered either through orange juice or ascorbic acid. The length of odontoblasts (cells responsible for tooth growth) was measured to check for tooth growth.</p>
<p>We will be creating a linear model to check if tooth growth is affected by vitamin C dosages. At the same time, there is also a chance that tooth growth is affected by the method of vitamin C administration. Therefore, we have the choice of choosing between ‘vitamin C dosage’ and the ‘method of vitamin C administration’ as the explanatory variables. So how do we know which of these variables is better at predicting tooth growth values? To find the best predictor, we can first build a model using ‘vitamin C dosage’ as the only explanatory variable. Then later, we can build yet another model using both ‘vitamin C dosage’ and the ‘method of vitamin C administration’ as the explanatory variables. Then similiar to the ealrier case, we can use the mean of the square of the prediction errors can see which model is better.</p>
<p>In the <code>ToothGrowth</code> dataset, the variable <code>len</code> contains the length of the odontoblasts, <code>supp</code> contains the method of vitamin C administration (VC - ascorbic acid, OJ - Orange juice) and <code>dose</code> contains the dosage of vitamin C administered in mg/day units.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(datasets)) <span class="fu">install.packages</span>(<span class="st">'datasets'</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"ToothGrowth"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with only dose</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>model_dose <span class="ot">&lt;-</span> <span class="fu">lm</span>(len <span class="sc">~</span> dose, <span class="at">data =</span> ToothGrowth)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with dose + supp</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>model_dose_supp <span class="ot">&lt;-</span> <span class="fu">lm</span>(len <span class="sc">~</span> dose <span class="sc">+</span> supp, <span class="at">data =</span> ToothGrowth)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting values using the trained dataset</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>predict_dose <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_dose, <span class="at">newdata =</span> ToothGrowth)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>predict_dose_supp <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_dose_supp, <span class="at">newdata =</span> ToothGrowth)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating error values</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>error_dose <span class="ot">&lt;-</span> <span class="fu">with</span>(ToothGrowth, dose <span class="sc">-</span> predict_dose)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>error_dose_supp <span class="ot">&lt;-</span> <span class="fu">with</span>(ToothGrowth, dose <span class="sc">-</span> predict_dose_supp)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean of the square of the prediction errors</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(error_dose <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 341.2716</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(error_dose_supp <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 344.6941</code></pre>
</div>
</div>
<p>You can see that the model with both vitamin C dosage and method of vitamin C administration as the explanatory variables has a greater error value compared to the model with only vitamin C dosage. Therefore adding the method of vitamin C administration as the explanatory variable did not improve the model and therefore can be excluded from the analysis.</p>
</section>
<section id="cross-validation" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="cross-validation"><span class="header-section-number">4.4</span> Cross validation</h3>
<p>So far we have been using the training dataset for predicting values. But there is a problem in using it for our analysis as it allows models with the additional explanatory variable to have smaller prediction errors than the base model. Let’s see what this means in the following code.</p>
<p>Here we use the <code>chickwts</code> dataset from the <code>{datasets}</code> package in R. In this dataset, there are two variables, <code>weight</code> which tells the weight (g) of the chick measured after 6 weeks and the <code>feed</code> variable, which tells the type of feed that was given to the chicks for those 6 weeks. There were 6 different types of feed used. The experiment was done to check whether the feed type has any effect on the weights of the chick.</p>
<p>Here we will build a linear model with weight as the response variable and feed type as the explanatory variable. Then we will make a random variable within the dataset which contains values which have no explanatory power. It will be filled with random numbers which have no relationship with the original data. We will build yet another linear model like earlier but this time we shall use both the feed type and the random variable as the explanatory variable. Adding a random variable to the model should cause the model to perform poorly and therefore should lead to an increased m.s.e value when compared to the model with just the feed type variable as the explanatory variable. Let us see if that’s the case here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"chickwts"</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a random variable</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The variable contains random numbers</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">231</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>chickwts<span class="sc">$</span>random <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(chickwts))</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with only feed</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>model_feed <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> feed, <span class="at">data =</span> chickwts)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with dose + random</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>model_feed_random <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> feed <span class="sc">+</span> random, <span class="at">data =</span> chickwts)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting values using the trained dataset</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>predict_feed <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_feed, <span class="at">newdata =</span> chickwts)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>predict_feed_random <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_feed_random, <span class="at">newdata =</span> chickwts)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating error values</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>error_feed <span class="ot">&lt;-</span> <span class="fu">with</span>(chickwts, weight <span class="sc">-</span> predict_feed)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>error_feed_random <span class="ot">&lt;-</span> <span class="fu">with</span>(chickwts, weight <span class="sc">-</span> predict_feed_random)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean of the square of the prediction errors (m.s.e)</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(error_feed <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2754.31</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(error_feed_random <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2725.115</code></pre>
</div>
</div>
<p>Well, quite a surprise, right? The model with the random variable is having a lower error value as compared to the model with the correct explanatory variable. We will see later (not in this article though) why the error value was lower. But for now, keep in mind that when you use the same dataset to do both training and prediction in a model, the model with the additional explanatory variable will have smaller prediction errors than the base model, as seen here. Therefore this mistake can throw off our analysis and gives us a false positive that some of the explanatory variables form a relationship with the response variable when in reality there is no effect.</p>
<p>To mitigate this problem, we use a technique called ‘cross-validation’. In this technique, we split the original data into two parts; a training set and a testing set. Both sets will have data points that are chosen at random from the original dataset. We train our model using the training set and then test our model using the testing set and then calculate the m.s.e. value. Thus the explanatory variable values in the testing set will be novel to the model. Let us see how we can do this.</p>
<p>We will be reusing our earlier example of chick weight and feed type.</p>
<p>In the code given below, the <code>rnorm(nrow(chickwts)) &gt; 0</code> function will assign TRUE and FALSE values at random to the row values. Looking at this function more closely, the <code>rnorm()</code> function will choose random numbers up to the number of rows in the dataset, and since there is an inequality (greater than zero), it will assign TRUE if the random number is greater than zero and vice versa. The row values with TRUE will go to the training set and rows with FALSE will form the testing set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"chickwts"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating training set</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">231</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>chickwts<span class="sc">$</span>training_set <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(chickwts)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>chickwts<span class="sc">$</span>random <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(chickwts)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model using the training set</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>model_feed <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> feed, <span class="at">data =</span> <span class="fu">subset</span>(chickwts, training_set))</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model using the training set but with random variable</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>model_feed_random <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> feed <span class="sc">+</span> random, <span class="at">data =</span> <span class="fu">subset</span>(chickwts, training_set))</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting values using the testing set</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="co"># !training_set means row values with FALSE value</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>predict_feed <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_feed, <span class="at">newdata =</span> <span class="fu">subset</span>(chickwts, <span class="sc">!</span>training_set))</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>predict_feed_random <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_feed_random, <span class="at">newdata =</span> <span class="fu">subset</span>(chickwts, <span class="sc">!</span>training_set))</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating error values using the testing data</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>error_feed <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="fu">subset</span>(chickwts, <span class="sc">!</span>training_set), weight <span class="sc">-</span> predict_feed)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>error_feed_random <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="fu">subset</span>(chickwts, <span class="sc">!</span>training_set), weight <span class="sc">-</span> predict_feed_random)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean of the square of the prediction errors (m.s.e)</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(error_feed <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2830.79</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(error_feed_random <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2732.715</code></pre>
</div>
</div>
<p>For the seed I have set, using the cross-validation method, we seem to not solve the problem we had earlier. The model with the random variable as the explanatory variable still has a lower error value as compared to the model without the random variable. But this was just an opportunistic case, as the training and testing sets are chosen at random. You might not get the same result as mine if you run this code (provided that the <code>set.seed()</code> is changed). We can deal with this randomness by rerunning the calculation many times to get a more consistent measure of the error value.</p>
<p>We will use the <code>cv_pred_error()</code> function from the <code>statisticalModeling</code> package to rerun the calculations many times. The function automatically makes the training and testing sets using the original dataset and also calculates the m.s.e for each trial. In the code given below, we store the results from the <code>cv_pred_error()</code> function into a variable called ‘trials’. The variable ‘trials’ will have two columns in it; <code>mse</code> which denotes the mean of the square of the prediction errors (m.s.e) and <code>model</code> which denotes the name of the model given as input. Then in the final step, we compare the m.s.e values between the model using a simple t-test.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(devtools)) <span class="fu">install.packages</span>(<span class="st">'devtools'</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(statisticalModeling)) devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"dtkaplan/statisticalModeling"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"chickwts"</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a random variable</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># The variable contains random numbers</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">231</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>chickwts<span class="sc">$</span>random <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(chickwts)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with only feed</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>model_feed <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> feed, <span class="at">data =</span> chickwts)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with dose + random</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>model_feed_random <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> feed <span class="sc">+</span> random, <span class="at">data =</span> chickwts)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Rerunning the models (100 times for each model)</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="fu">cv_pred_error</span>(model_feed, model_feed_random, <span class="at">ntrials =</span> <span class="dv">100</span>)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the two sets of cross-validated errors</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(mse <span class="sc">~</span> model, <span class="at">data =</span> trials)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  mse by model
t = -5.9019, df = 197.95, p-value = 1.537e-08
alternative hypothesis: true difference in means between group model_feed and group model_feed_random is not equal to 0
95 percent confidence interval:
 -118.53296  -59.16003
sample estimates:
       mean in group model_feed mean in group model_feed_random 
                       3309.232                        3398.079 </code></pre>
</div>
</div>
<p>For <span class="math inline">\alpha = 0.05</span> level of significance, we have a p-value &lt; 0.05, which means that the mean error values between the models are not the same and are different from each other. From the t-test summary, we can see that the mean error value of the model without the random variable is lower than the model with the random variable (3309.232 &lt; 3398.079). Therefore we can conclude that the addition of the random variable does not improve the model.</p>
<p>Therefore through the cross-validation technique iterated over many times, in conjunction with the m.s.e values, we can identify which of the variables in our data should be considered as the explanatory variables.</p>
</section>
<section id="prediction-error-for-categorical-response-variable" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="prediction-error-for-categorical-response-variable"><span class="header-section-number">4.5</span> Prediction error for categorical response variable</h3>
<p>So far when we were calculating the predictive error values, the response variable we had was numerical. But what if our response variable was a categorical value, then how will we compare models using the predictive error values?</p>
<p>Let us go back to the <code>run17</code> dataset from the <code>{cherryblossom}</code> package in R. In this dataset, we looked at whether the participants’ choice of event was influenced by their age and sex. We hypothesised that the older participants of both sexes will prefer the 5 Km run as compared to the 10 Mile marathon. In the earlier example, we have used the logistic model, but here let us use the recursive partitioning model made using the <code>rpart()</code> function in the <code>{rpart}</code> package in R. We had learned briefly that the recursive partitioning model is appropriate when the response variable is categorical, which is the case here.</p>
<p>Like earlier, we will use <code>event</code> as the response variable and <code>sex</code> and <code>age</code> as the explanatory variable. The hypothesis remains the same, irrespective of sex, older participants will prefer the 5 Km run as compared to the 10 Mile marathon. We will build two models, one with only <code>age</code> as the explanatory variable and the other with both <code>age</code> and <code>sex</code> as the explanatory variables.</p>
<p>While predicting for values, we use <code>type = "class"</code> so that the model gives prediction values, which are either “10 Mile” or “5 Km” (gives prediction values as categorical values).</p>
<p>Then we will evaluate these two models by comparing the m.s.e values. This will tell us whether adding the variable <code>sex</code> improves the model or not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating training set</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>run17<span class="sc">$</span>training_set <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(run17)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Training the model with the training set</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the recursive partitioning model with just age</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>model_rpart_age <span class="ot">&lt;-</span> <span class="fu">rpart</span>(event <span class="sc">~</span> age, <span class="at">data =</span> <span class="fu">subset</span>(run17, training_set))</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the recursive partitioning model with age + sex</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>model_rpart_age_sex <span class="ot">&lt;-</span> <span class="fu">rpart</span>(event <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> <span class="fu">subset</span>(run17, training_set))</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting values using the testing set</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>predict_age <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_rpart_age,</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>predict_age_sex <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_rpart_age_sex,</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">newdata =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing a few row values</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predict_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      1       2       3       4       5       6 
10 Mile 10 Mile 10 Mile 10 Mile 10 Mile 10 Mile 
Levels: 10 Mile 5K</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predict_age_sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      1       2       3       4       5       6 
10 Mile 10 Mile 10 Mile 10 Mile 10 Mile 10 Mile 
Levels: 10 Mile 5K</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(run17<span class="sc">$</span>event)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "10 Mile" "10 Mile" "10 Mile" "10 Mile" "10 Mile" "10 Mile"</code></pre>
</div>
</div>
<p>In the first 6 row values of the output, both models seem to agree with the values from the original dataset. But our dataset has 199961 rows of data. It would be crazy to even think that one can compare each of the row values between the models instead, we will try to quantify the error. In earlier cases, we could subtract the predicted values from the response variable values in the dataset to get the error value. But that is not possible here as the response variable is categorical.</p>
<p>One way to calculate the error values of these models is to see how many mistakes the model made. This can be calculated by checking how many times the predicted value by the model was not equal to the value in the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the sum of errors using the testing data</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), <span class="fu">sum</span>(predict_age <span class="sc">!=</span> event))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1254</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), <span class="fu">sum</span>(predict_age_sex <span class="sc">!=</span> event))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1254</code></pre>
</div>
</div>
<p>The number of errors each model made is the same. Before we conclude anything let us try to see some more ways to quantify the error.</p>
<p>Instead of sum, we can calculate the mean rate of errors also.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the mean of errors using the testing data</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), <span class="fu">mean</span>(predict_age <span class="sc">!=</span> event))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1243061</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), <span class="fu">mean</span>(predict_age_sex <span class="sc">!=</span> event))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1243061</code></pre>
</div>
</div>
<p>Mean error values are the same (no surprises here).</p>
<p>Let us go one step further. Till now our model predicted a deterministic value to the response variable. It can either be 10 Mile marathon or a 5 km run. Instead of this, we can use the model to predict the probability values to the categorical values present in the response variable. This means, our model will predict how likely a certain participant of a particular age and sex will choose between a 10 Mile marathon and a 5 Km run. To predict probability values, instead of <code>type = "class"</code>, we will use <code>type = "prob"</code> within the <code>predict()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting probability values using the testing set</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>predict_age_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_rpart_age,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>predict_age_sex_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_rpart_age_sex,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">newdata =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparing the predicted value to the actual value in the dataset</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>testing_data <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">select</span>(training_set, event) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(training_set <span class="sc">==</span> F)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>compare_values <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(testing_data, predict_age_prob, predict_age_sex_prob)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Changing the column names for making sense of the column values</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(compare_values)[<span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Ten_Mile_age"</span>, <span class="st">"Five_km_age"</span>, <span class="st">"Ten_Mile_age_sex"</span>, <span class="st">"Five_km_age_sex"</span>)</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing a few row values</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(compare_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["training_set"],"name":[1],"type":["lgl"],"align":["right"]},{"label":["event"],"name":[2],"type":["chr"],"align":["left"]},{"label":["Ten_Mile_age"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Five_km_age"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Ten_Mile_age_sex"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Five_km_age_sex"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"FALSE","2":"10 Mile","3":"0.8772644","4":"0.1227356","5":"0.8772644","6":"0.1227356","_rn_":"1"},{"1":"FALSE","2":"10 Mile","3":"0.8772644","4":"0.1227356","5":"0.8772644","6":"0.1227356","_rn_":"2"},{"1":"FALSE","2":"10 Mile","3":"0.8772644","4":"0.1227356","5":"0.8772644","6":"0.1227356","_rn_":"3"},{"1":"FALSE","2":"10 Mile","3":"0.8772644","4":"0.1227356","5":"0.8772644","6":"0.1227356","_rn_":"4"},{"1":"FALSE","2":"10 Mile","3":"0.8772644","4":"0.1227356","5":"0.8772644","6":"0.1227356","_rn_":"5"},{"1":"FALSE","2":"10 Mile","3":"0.8772644","4":"0.1227356","5":"0.8772644","6":"0.1227356","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The columns <code>Ten_Mile_age</code> and <code>Five_km_age</code> corresponds to probability values from the <code>model_rpart_age</code> model with just ‘age’ as the explanatory variable. The last two columns <code>Ten_Mile_age_sex</code> and <code>Five_km_age_sex</code> are from the <code>model_rpart_age_sex</code> model with both ‘age’ and ‘sex’ as the explanatory variables. The first-row value in the <code>10Mile_age</code> column indicates that the model predicts a nearly 88% chance for that particular participant to be choosing the 10 Mile marathon. And with no surprise, you can see that the probability values across the models are the same (because we found that the error values are the same earlier).</p>
<p>We can condense these probability values to a single value which is called the ‘likelihood value’, which can then be used as a figure of merit to compare the models. This is similar to the mean of the square of the prediction errors (m.s.e) we had when the response variable was numerical. The likelihood values are calculated by multiplying the individual probability values. But since the probability values are in decimal values and are less than 1, multiplying them will lead to a very small value which would be difficult to compare. Therefore we first log transform our probability values and add them, which is mathematically equivalent to multiplying them before the log transformation</p>
<p>Since the dataset is not ‘tidy’, some codes are used to tidy it. The “10 Mile” has a space in-between. While doing analysis, R might register “10 Mile” as “10” and “Mile”. So this needs to be reformatted.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data frame into two other data frames</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Newly made data frames have values corresponding to the respective model</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>compare_values_age <span class="ot">&lt;-</span> compare_values[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>compare_values_age_sex <span class="ot">&lt;-</span> compare_values[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>)]</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidying the data</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>compare_values_age<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">recode</span>(compare_values_age<span class="sc">$</span>event,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"10 Mile"</span> <span class="ot">=</span> <span class="st">"Ten_Mile"</span>, <span class="st">"5K"</span> <span class="ot">=</span> <span class="st">"Five_km"</span>)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>compare_values_age_sex<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">recode</span>(compare_values_age_sex<span class="sc">$</span>event,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"10 Mile"</span> <span class="ot">=</span> <span class="st">"Ten_Mile"</span>, <span class="st">"5K"</span> <span class="ot">=</span> <span class="st">"Five_km"</span>)</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the likelihood values</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Ten_Mile_age and Five_km_age are column names</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>likelihood_age <span class="ot">&lt;-</span> <span class="fu">with</span>(compare_values_age,</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(event <span class="sc">==</span> <span class="st">"Ten_Mile"</span>, Ten_Mile_age, Five_km_age))</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>likelihood_age_sex <span class="ot">&lt;-</span> <span class="fu">with</span>(compare_values_age_sex,</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">ifelse</span>(event <span class="sc">==</span> <span class="st">"Ten_Mile"</span>, Ten_Mile_age_sex, Five_km_age_sex))</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Likelihood value of model with age</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">log</span>(likelihood_age)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -3785.999</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Likelihood value of model with age + sex</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">log</span>(likelihood_age_sex)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -3785.999</code></pre>
</div>
</div>
<p>As the likelihood values are one and the same we can conclude that the variable ‘sex’ does not improve the model.</p>
</section>
<section id="creating-a-null-model" class="level3" data-number="4.6">
<h3 data-number="4.6" class="anchored" data-anchor-id="creating-a-null-model"><span class="header-section-number">4.6</span> Creating a null model</h3>
<p>The null model gives the best estimate of our data when there are no explanatory variables modelled to it. The predicted value from the null model will always be a constant, no matter what testing data is provided. Let us see how to make a null model.</p>
<p>We will again use the <code>run17</code> dataset from the <code>{cherryblossom}</code> package in R. To this dataset we add a new column which contains a constant value. We will make a model where <code>net_sec</code> is the response variable and the <code>constant</code> variable is the explanatory variable. We will use the recursive partitioning architecture to model the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a constant variable</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>run17<span class="sc">$</span>constant <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a null model</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>null_model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(net_sec <span class="sc">~</span> constant, <span class="at">data =</span> run17)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting values</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice how all the values are the same</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>predict_null <span class="ot">&lt;-</span> <span class="fu">predict</span>(null_model, <span class="at">newdata =</span> run17)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Prinitng a few predicted values</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice how all the predicted values are the same</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predict_null)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5427.947 5427.947 5427.947 5427.947 5427.947 5427.947</code></pre>
</div>
</div>
<p>We can calculate the mean of the square of the prediction errors of the null model. The null model essentially acts as a base of our model analysis, where we can compare the errors in the null model to the model of our interest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a constant variable</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>run17<span class="sc">$</span>constant <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating training set</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>run17<span class="sc">$</span>training_set <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(run17)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a null model using the training set</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>null_model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(net_sec <span class="sc">~</span> constant, <span class="at">data =</span> <span class="fu">subset</span>(run17, training_set))</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting values using the testing set</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>predict_null <span class="ot">&lt;-</span> <span class="fu">predict</span>(null_model,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set))</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Prinitng a few predicted values</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predict_null)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5436.2 5436.2 5436.2 5436.2 5436.2 5436.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating error values using testing set</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>error_null <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), net_sec <span class="sc">-</span> predict_null)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean of the square of the prediction errors (m.s.e)</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(error_null <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2273954</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating m.s.e by iterating the model 100 times</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="fu">cv_pred_error</span>(null_model)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing m.s.e values for each iteration</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(trials<span class="sc">$</span>mse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2289640 2289445 2289692 2289697 2289802</code></pre>
</div>
</div>
</section>
</section>
<section id="exploratory-modelling" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="exploratory-modelling"><span class="header-section-number">5</span> Exploratory modelling</h2>
<p>Till now, we had a clear idea of the selection of the explanatory variables while making a model. But sometimes, you might just want to explore your dataset and see which variables affect your response variable without prior knowledge of it. Therefore, we can do exploratory modelling where we take a whole bunch of explanatory variables and see if any of them explain the changes seen in the response variable.</p>
<p>For this exercise, we will be using the <code>NHANES</code> dataset from the <code>{NHANES}</code> package in R. The dataset is a survey data collected by the US National Centre for Health Statistics (NCHS). A total of 75 variables concerning health are collected as data from around 7800 individuals in the US.</p>
<section id="evaluating-a-recursive-partitioning-model" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="evaluating-a-recursive-partitioning-model"><span class="header-section-number">5.1</span> Evaluating a recursive partitioning model</h3>
<p>For our exploratory modelling, we will be using the recursive partitioning architecture. Using the dataset we will see what variables are related to depression.</p>
<p>We will use the formula <code>Depressed ~ .</code></p>
<p>The single period on the right side of the Tilda indicates that we want to model using all the possible variables in the dataset. Finally, we will plot the model as a ‘tree’ using the <code>rpart.plot()</code> function from the <code>{rpart.plot}</code> package in R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(NHANES)) <span class="fu">install.packages</span>(<span class="st">'NHANES'</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(rpart.plot)) <span class="fu">install.packages</span>(<span class="st">'rpart.plot'</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the recursive partitioning model</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>model_rpart <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Depressed <span class="sc">~</span> . , <span class="at">data =</span> NHANES)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model with sample sizes</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(model_rpart, <span class="at">extra =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="intro_stat_model_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We got this nice-looking tree plot with lots of information. Let’s see how to interpret them.</p>
<p>The response variable that we used was the <code>Depressed</code> variable in the dataset. This variable has three levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(NHANES<span class="sc">$</span>Depressed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "None"    "Several" "Most"   </code></pre>
</div>
</div>
<p>The meaning of each of these levels is; “None” = No sign of depression, “Several” = Individual was depressed for less than half of the survey period days, “Most” = Individual was depressed more than half of the days.</p>
<p>The colour code in the plot corresponds to the levels of the response variable. In the beginning node of the tree plot, you can see the label “None” with three sets of numbers. The numbers correspond to the respective sample numbers of the levels, i.e.&nbsp;at this node, 5246 individuals belong to “None”, 1009 individuals belong to “Several” and 418 individuals belong to “Most”. Therefore we have data for a total of 6673 individuals (5256 + 1009 + 418 = 6673). Also, in this node, the majority of individuals belong to the level “None”. Therefore the node is coloured by the respective colour code for “None”, which is orange colour here. You can also see that the node colour changes its brightness to correspond to the difference between the majority value and the other values.</p>
<p>Working with numbers can be tricky, so let us represent the sample sizes in percentiles for easy comparisons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model with percentile values</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(model_rpart, <span class="at">extra =</span> <span class="st">"auto"</span>, <span class="at">type =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="intro_stat_model_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now instead of the actual sample sizes, we have percentile values. Now let us look at the plot. The beginning node which contains the whole set of depressed individuals in the dataset is further split into two groups and this split is caused by the variable <code>LittleInterest</code>. The variable <code>LittleInterest</code> in the dataset denotes the self-reported number of days where the participant had little interest in doing things. And like the <code>Depressed</code> variable, we have three levels for the variable <code>LittleInterest</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(NHANES<span class="sc">$</span>LittleInterest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "None"    "Several" "Most"   </code></pre>
</div>
</div>
<p>The meaning of these levels is the same as explained for the <code>Depressed</code> variable.</p>
<p>The first group contains 77% of the total depressed individuals and they recorded zero days where they had reduced interest to do things. The rest of the 23% individuals belong to the second group which showed a severe reduction or most severe reduction in interest in doing things. This second group is further split into two by the variable <code>DaysMentHlthBad</code> which denotes the self-reported number of days the participant’s mental health was not good out of the past 30 days. Here, 13% of people in the second group with 23% of the total set had bad mental days less than 6. The remaining 11% of people (13% + 11% = ~ 23% of the second group) had bad mental days for more than 6 days, which further splits into two by their categories in the <code>LittleInterest</code> variable. There is no splitting of the group after this. This is because the recursive partitioning architecture stops at a point where further subdivisions don’t lead to a big change in predictive ability.</p>
<p>So as a summary, by this exploratory modelling exercise, we were able to determine potential variables that could act as the explanatory variables for a given response variable that we are interested in. Overall this led us to understand the relationships between the variables in the dataset that otherwise would not have been possible with a simple linear model. But also keep in mind that these potential variables are not indicating a cause and effect, but rather a simple relationship.</p>
</section>
</section>
<section id="covariate" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="covariate"><span class="header-section-number">6</span> Covariate</h2>
<p>We briefly learned what are covariates when we were looking at the <code>run17</code> dataset from the <code>{cherryblossom}</code> package in R. In that exercise, we looked at whether the participant’s choice in choosing between the events is affected by their age and sex. We hypothesized that older participants of both sexes would prefer a 5 km run over the 10 Mile marathon. Therefore we considered <code>age</code> as the main explanatory variable and <code>sex</code> as a covariate.</p>
<p>Covariates are those variables which are of no immediate interest to the user but hold the potential to explain changes seen in the response variable. There is no special distinction between a covariate and an explanatory variable in the formula syntax of the function R code. It’s just a mental label given by the user.</p>
<p>Let us use the <code>Tadpoles</code> dataset from the <code>{mosaicModel}</code> package in R. The dataset contains the swimming speed of tadpoles as a function of the water temperature and the water temperature at which the tadpoles had been raised. Since size is a major determinant of speed, the tadpole’s length was measured as well. It was hypothesized that tadpoles would swim faster in the temperature of water close to that in which they had been raised.</p>
<p>As an exercise, let us see if the maximum swimming speed achieved by the tadpole is affected by the temperature at which they were raised. In addition, let also add the size of the tadpole as a covariate, as size could also affect the swimming speeds. The variable <code>vmax</code> denotes the maximum swimming speed (mm/sec) and therefore will be our response variable. The variable <code>group</code> denotes whether the tadpoles were raised in a cold environment (“c”) or warm environment (“w”) and <code>length</code> denotes the length of the tadpole (mm). Here both <code>group</code> and <code>length</code> will be our explanatory variables where <code>length</code> is also our covariate.</p>
<p>While predicting values using the model, we can keep the covariate unchanged or constant, and predict different values for the other variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(mosaicModel)) <span class="fu">install.packages</span>(<span class="st">'mosaicModel'</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicModel)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Tadpoles)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>model_vmax <span class="ot">&lt;-</span> <span class="fu">lm</span>(vmax <span class="sc">~</span> group <span class="sc">+</span> length, <span class="at">data =</span> Tadpoles)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting for vmax</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>predict_vmax <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_vmax, <span class="at">newdata =</span> Tadpoles)</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predict_vmax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1        2        3        4        5        6 
27.08018 27.11388 25.32803 27.31605 27.51822 26.57476 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keeping length constant, predicting for vmax</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model_vmax, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">group =</span> <span class="st">"c"</span> ,<span class="at">length =</span> <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      1 
26.2378 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model_vmax, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">group =</span> <span class="st">"w"</span> ,<span class="at">length =</span> <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
25.25733 </code></pre>
</div>
</div>
<p>So while keeping length constant, our model predicts change in swimming speeds between cold and warm environments the tadpoles were raised in.</p>
</section>
<section id="effect-sizes" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="effect-sizes"><span class="header-section-number">7</span> Effect sizes</h2>
<p>Effect sizes are a great way to estimate the change in the output value, given the change in the input. Thus they are a great tool to analyse covariates in the model.</p>
<p>While calculating the effect size, the units of it depend on both the response variable and the explanatory variable for which the effect size is measured.</p>
<p>If we have a response variable called ‘salary’ (Dollars) and we have a numerical explanatory variable called the ‘years of education’ (years), then the effect size of ‘years of education on the ’salary’ would be in the units of dollars/year. Suppose we get an effect size of 100 dollars/year, this means that for every unit increase in years of education, the salary will increase by 100 dollars.</p>
<p>Here the effect size is calculated as a rate of change and its unit will be;</p>
<span class="math display">\begin{align*}
Unit\,of\,effect\,size = \frac{Unit\,of\,response\,variable}{Unit\,of\,explaratory\,variable}
\end{align*}</span>
<p>But if our explanatory variable is categorical, then the effect size is calculated as a difference. As categorical values have no units, the units of effect sizes here would be the same as that of the response variable.</p>
<p>Suppose we have a response variable called ‘rent’ (Dollars) and we have a categorical explanatory variable called ‘city’. Let us say the variable ‘city’ has two levels; Chicago and New York. The meaning of effect size values in this context would be the numerical difference in the response variable when input is changed from one category to another. If our effect size in moving from Chicago to New York is 500 Dollars, then this means that the rent increases by 500 when we move from Chicago to New York.</p>
<p>Here the calculated effect size is will have the same unit as the response variable</p>
<p>Look at the following exercise, we will use the <code>Used_Fords</code> dataset in the <code>{mosaicModel}</code> package in R. The dataset contains details about used Ford cars. We will see if the price of the cars (Price) has any relationship with both, how old the car is (Age) and the colour of the car (Color). We will build two linear models using <code>Price</code> as the response variable. But one model will have <code>Age</code> and the other will have <code>Color</code> as the explanatory variable. The units are; Price = <span class="math inline">USD</span> and Age = <span class="math inline">years</span></p>
<p>We will calculate the effect sizes using the <code>effect_size()</code> function from the <code>{statisticalModeling }</code> package. The <code>effect_size()</code> function takes in two arguments; the model and a formula indicating which variable to vary when looking at the model output. The effect size to <code>Age</code> will be represented in dollars/year and the effect size to <code>Colour</code> will be represented as a difference in dollars when changing from one colour to another.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicModel)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Used_Fords)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with only age</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>model_car_age <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span>  Age, <span class="at">data =</span> Used_Fords)</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect sizes by varying age</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_car_age, <span class="sc">~</span> Age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["slope"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Age"],"name":[2],"type":["int"],"align":["right"]},{"label":["to:Age"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"-1124.556","2":"3","3":"6.284152","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Effect size to Age is represented in the slope column. The value is -1124, which means for every unit increase in the age of the car (1-year increase), the price of the car depreciates by 1124 dollars.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with only colour</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>model_car_age <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span>  Color, <span class="at">data =</span> Used_Fords)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect sizes by varying colour</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_car_age, <span class="sc">~</span> Color, <span class="at">Color =</span> <span class="st">"blue"</span>, <span class="at">to =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["change"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Color"],"name":[2],"type":["fct"],"align":["left"]},{"label":["to:Color"],"name":[3],"type":["fct"],"align":["left"]}],"data":[{"1":"-3290.81","2":"blue","3":"red","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>For categorical explanatory variables, the <code>effect_size()</code> function automatically takes appropriate levels. However, we can manually change this behaviour. From the given code, the effect size to colour is calculated when the colour of the car changes from blue to red. Here the effect size is represented in the change column. The value is -3290. This means that the price of the car reduces by 3290 dollars when the colour of the car changes from blue to red.</p>
</section>
<section id="conclusion" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">8</span> Conclusion</h2>
<p>I hope this article provided you with a good learning experience. In a nutshell, we learned;</p>
<ol type="1">
<li><p>What is the meaning of a statistical model</p>
<ul>
<li>Model functions: <code>lm()</code>, <code>glm()</code> and <code>rpart()</code></li>
<li>Model formula: <code>response ~ formula</code></li>
<li>Model architectures: linear, logistic, recursive partitioning</li>
</ul></li>
<li><p>How to build a model</p>
<ul>
<li>Building models using functions, formulas and model architectures</li>
<li>Plotting the model output</li>
</ul></li>
<li><p>How to evaluate a model</p>
<ul>
<li>Using the model to predict values outside the data</li>
<li>Calculating the mean of the square of the prediction errors</li>
<li>Using error to compare models to aid explanatory variable selection</li>
<li>Cross-validation technique and model iteration by <code>cv_pred_error()</code> function</li>
<li>Prediction error for a categorical response variable</li>
</ul></li>
<li><p>How to build a null model</p></li>
<li><p>How to do exploratory modelling</p>
<ul>
<li>Evaluation of a recursive partitioning model and plotting it</li>
</ul></li>
<li><p>What is a covariate</p></li>
<li><p>How to calculate effect size</p>
<ul>
<li>For numerical explanatory variables</li>
<li>For categorical explanatory variables</li>
</ul></li>
</ol>
<p>Take a break and practice the concepts learned from this tutorial. I will see you in the next tutorial where we will learn about ‘Intermediate statistical modelling using R’. See you there 👍</p>
<p><a hidden="" href="https://info.flagcounter.com/ynrK"><img src="https://s11.flagcounter.com/count2/ynrK/bg_000000/txt_FFFFFF/border_F0F0F0/columns_5/maxflags_25/viewers_0/labels_1/pageviews_1/flags_0/percent_0/" alt="Flag Counter" border="0"></a></p>


<!-- -->


</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" role="list">
<div id="ref-mccullagh_what_2002" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline"><strong>McCullagh P</strong>. What is a statistical model? <em>The Annals of Statistics</em> 30, 2002. doi: <a href="https://doi.org/10.1214/aos/1035844977">10.1214/aos/1035844977</a>.</div>
</div>
<div id="ref-box_science_1976" class="csl-entry" role="listitem">
<div class="csl-left-margin">2. </div><div class="csl-right-inline"><strong>Box GEP</strong>. Science and <span>Statistics</span>. <em>Journal of the American Statistical Association</em> 71: 791–799, 1976. doi: <a href="https://doi.org/10.1080/01621459.1976.10480949">10.1080/01621459.1976.10480949</a>.</div>
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Which is almost impossible to create under real-life conditions<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{johnson2022,
  author = {Johnson, Jewel},
  title = {Introduction to Statistical Modelling in {R}},
  date = {2022-08-04},
  url = {https://sciquest.netlify.app//tutorials/stat_model/intro_stat_model.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-johnson2022" class="csl-entry quarto-appendix-citeas" role="listitem">
<div class=""><strong>Johnson J</strong>. Introduction to
statistical modelling in R [Online]. 2022. <a href="https://sciquest.netlify.app//tutorials/stat_model/intro_stat_model.html">https://sciquest.netlify.app//tutorials/stat_model/intro_stat_model.html</a>.</div>
</div></div></section></div></main> <!-- /main -->
<script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"require(\"https://cdn.jsdelivr.net/npm/juxtaposejs@1.1.6/build/js/juxtapose.min.js\")\n  .catch(() => null)\n"}]}
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../tutorials/stat_model";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="jeweljohnsonj/SciQuest" data-repo-id="R_kgDOHW124A" data-category="General" data-category-id="DIC_kwDOHW124M4CPNVL" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb84" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Introduction to statistical modelling in R"</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Learn how to build a model, predict values using it, evaluating it and plotting the model output in R"</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "08/04/2022"</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> last-modified</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> images/stat_model.png</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="an">csl:</span><span class="co"> american-physiological-society</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a><span class="co">    css:</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="co">      - https://cdn.knightlab.com/libs/juxtapose/latest/css/juxtapose.css</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [statistical modelling]</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a><span class="co">   - social-share</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a><span class="an">share:</span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a><span class="co">  permalink: "https://sciquest.netlify.app/tutorials/stat_model/intro_stat_model.html"</span></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a><span class="co">  description: "Introduction to statistical modelling in R"</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a><span class="co">  twitter: true</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a><span class="co">  facebook: true</span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a><span class="co">  reddit: true</span></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a><span class="co">  stumble: true</span></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a><span class="co">  tumblr: true</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a><span class="co">  linkedin: true</span></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a><span class="co">  email: true</span></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a><span class="co">//| output: false</span></span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a><span class="pp">require</span>(<span class="st">"https://cdn.jsdelivr.net/npm/juxtaposejs@1.1.6/build/js/juxtapose.min.js"</span>)</span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">catch</span>(() <span class="kw">=&gt;</span> <span class="kw">null</span>)</span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a><span class="fu">## TL;DR</span></span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a>In this article you will learn;</span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>What is the meaning of a statistical model</span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Model functions: <span class="in">`lm()`</span>, <span class="in">`glm()`</span> and <span class="in">`rpart()`</span></span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Model formula: <span class="in">`response ~ formula`</span></span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Model architectures: linear, logistic, recursive partitioning</span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>How to build a model</span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Building models using functions, formulas and model architectures</span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Plotting the model output</span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>How to evaluate a model</span>
<span id="cb84-52"><a href="#cb84-52" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Using the model to predict values outside the data</span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Calculating the mean of the square of the prediction errors</span>
<span id="cb84-54"><a href="#cb84-54" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Using error to compare models to aid explanatory variable selection</span>
<span id="cb84-55"><a href="#cb84-55" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Cross-validation technique and model iteration by <span class="in">`cv_pred_error()`</span> function</span>
<span id="cb84-56"><a href="#cb84-56" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Prediction error for a categorical response variable</span>
<span id="cb84-57"><a href="#cb84-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-58"><a href="#cb84-58" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>How to build a null model</span>
<span id="cb84-59"><a href="#cb84-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-60"><a href="#cb84-60" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>How to do exploratory modelling</span>
<span id="cb84-61"><a href="#cb84-61" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Evaluation of a recursive partitioning model and plotting it</span>
<span id="cb84-62"><a href="#cb84-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-63"><a href="#cb84-63" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>What is a covariate</span>
<span id="cb84-64"><a href="#cb84-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-65"><a href="#cb84-65" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>How to calculate effect size</span>
<span id="cb84-66"><a href="#cb84-66" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>For numerical explanatory variables</span>
<span id="cb84-67"><a href="#cb84-67" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>For categorical explanatory variables</span>
<span id="cb84-68"><a href="#cb84-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-69"><a href="#cb84-69" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb84-70"><a href="#cb84-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-71"><a href="#cb84-71" aria-hidden="true" tabindex="-1"></a><span class="fu">## Definition of statistical model</span></span>
<span id="cb84-72"><a href="#cb84-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-73"><a href="#cb84-73" aria-hidden="true" tabindex="-1"></a>Before we get to know the definition of what a **statistical model** is, let us first try to understand what a **model** means. All of us have an intuitive idea of what a 'model' is. A model can be a fashion model posing in pretty clothes and makeup or it can be a blueprint which represents the overall layout of a building. In all these understandings of a model, we can summarise that it is representing a relationship.</span>
<span id="cb84-74"><a href="#cb84-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-75"><a href="#cb84-75" aria-hidden="true" tabindex="-1"></a>A statistical model also belongs to the same suite but is made using data. It is also representing 'relationships', but between variables within the data. Understanding a statistical model can lead us to understand how the variables within a dataset are related to each other. </span>
<span id="cb84-76"><a href="#cb84-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-77"><a href="#cb84-77" aria-hidden="true" tabindex="-1"></a>Let us consider the graph given below;</span>
<span id="cb84-78"><a href="#cb84-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-81"><a href="#cb84-81" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-82"><a href="#cb84-82" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb84-83"><a href="#cb84-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-84"><a href="#cb84-84" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb84-85"><a href="#cb84-85" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb84-86"><a href="#cb84-86" aria-hidden="true" tabindex="-1"></a>cars <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(speed, dist)) <span class="sc">+</span> </span>
<span id="cb84-87"><a href="#cb84-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb84-88"><a href="#cb84-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Speed (mph)"</span>,</span>
<span id="cb84-89"><a href="#cb84-89" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Stopping Distance (ft)"</span>,</span>
<span id="cb84-90"><a href="#cb84-90" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Speed vs Stopping distances"</span>) <span class="sc">+</span> </span>
<span id="cb84-91"><a href="#cb84-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-92"><a href="#cb84-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-93"><a href="#cb84-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-94"><a href="#cb84-94" aria-hidden="true" tabindex="-1"></a>The x-axis shows speed and the y-axis shows stopping distance. From the graph, you can see that, as speed increases, the stopping distance also increases. Therefore we can say that the stopping distance linearly increases with speed. To showcase this linear relationship, we can plot a regression line (green line) as shown below.</span>
<span id="cb84-95"><a href="#cb84-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-98"><a href="#cb84-98" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-99"><a href="#cb84-99" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb84-100"><a href="#cb84-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-101"><a href="#cb84-101" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb84-102"><a href="#cb84-102" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb84-103"><a href="#cb84-103" aria-hidden="true" tabindex="-1"></a>cars <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(speed, dist)) <span class="sc">+</span> </span>
<span id="cb84-104"><a href="#cb84-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb84-105"><a href="#cb84-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">col =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb84-106"><a href="#cb84-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Speed (mph)"</span>,</span>
<span id="cb84-107"><a href="#cb84-107" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Stopping Distance (ft)"</span>,</span>
<span id="cb84-108"><a href="#cb84-108" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Speed vs Stopping distances"</span>) <span class="sc">+</span> </span>
<span id="cb84-109"><a href="#cb84-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-110"><a href="#cb84-110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-111"><a href="#cb84-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-112"><a href="#cb84-112" aria-hidden="true" tabindex="-1"></a>The regression line can be extended to values outside the dataset and doing so would enable us to predict values outside our dataset, like predicting what the stopping distance will be if the speed was 35 mph. You can also see that many points are away from the regression line and do not lie on it, therefore the linear relationship we predicted for the variables is not a perfect one. Suppose instead of a linear relationship, we fit a polynomial regression line.</span>
<span id="cb84-113"><a href="#cb84-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-116"><a href="#cb84-116" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-117"><a href="#cb84-117" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb84-118"><a href="#cb84-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-119"><a href="#cb84-119" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb84-120"><a href="#cb84-120" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb84-121"><a href="#cb84-121" aria-hidden="true" tabindex="-1"></a>cars <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(speed, dist)) <span class="sc">+</span> </span>
<span id="cb84-122"><a href="#cb84-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb84-123"><a href="#cb84-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula=</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">3</span>), <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb84-124"><a href="#cb84-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Speed (mph)"</span>,</span>
<span id="cb84-125"><a href="#cb84-125" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Stopping Distance (ft)"</span>,</span>
<span id="cb84-126"><a href="#cb84-126" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Speed vs Stopping distances"</span>) <span class="sc">+</span> </span>
<span id="cb84-127"><a href="#cb84-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-128"><a href="#cb84-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-129"><a href="#cb84-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-130"><a href="#cb84-130" aria-hidden="true" tabindex="-1"></a>In this graph, especially at the extreme ends, most of the points are closer to the regression line than in the earlier case. Therefore, the residual distance, which is the distance between the actual data points and the fitted values by regression lines would be smaller indicating a better fit for the polynomial regression. Therefore a good fit can more accurately represent the relationship between the variables and therefore would have better predictive power. But how do we exactly compare the linear regression and the polynomial regression 'models'? Is there a metric which would allow this comparison easier? We will learn all about this later in this article.</span>
<span id="cb84-131"><a href="#cb84-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-132"><a href="#cb84-132" aria-hidden="true" tabindex="-1"></a>Going back to the linear regression plot, suppose, instead of speed, we use the colour of the car and see if it affects the stopping distance at a constant speed. For obvious reasons, there should be no effect of colour on the stopping distances (duh!). Nevertheless, now we also know that some variables form relationships and some don't.</span>
<span id="cb84-133"><a href="#cb84-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-134"><a href="#cb84-134" aria-hidden="true" tabindex="-1"></a>In short, what we essentially were doing was linear modelling, a type of statistical modelling. And this exercise helped us realise that a model can inform us about;</span>
<span id="cb84-135"><a href="#cb84-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-136"><a href="#cb84-136" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>The relationship between the variables in the data</span>
<span id="cb84-137"><a href="#cb84-137" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Which variables form relationships</span>
<span id="cb84-138"><a href="#cb84-138" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Predict values outside our dataset</span>
<span id="cb84-139"><a href="#cb84-139" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Model comparisons (linear vs polynomial)</span>
<span id="cb84-140"><a href="#cb84-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-141"><a href="#cb84-141" aria-hidden="true" tabindex="-1"></a>The textbook definition for statistical modelling is;</span>
<span id="cb84-142"><a href="#cb84-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-143"><a href="#cb84-143" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;**A statistical model is a set of probability distributions $P(S)$ on a sample space ($S$)** </span><span class="co">[</span><span class="ot">@mccullagh_what_2002</span><span class="co">]</span><span class="at">. </span></span>
<span id="cb84-144"><a href="#cb84-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-145"><a href="#cb84-145" aria-hidden="true" tabindex="-1"></a>In our previous modelling exercise, we saw how speed affects stopping distance. Here the variable 'speed' is called the **parameter** or otherwise, better called the **explanatory variable**, which tries to explain the variations seen in the **response variable**, which is the stopping distance. The model we created was not perfect as there were many data points which did not lie on the regression line. One potential source of this error can arrive from the selection of the explanatory variables. The dataset had stopping distances of a particular vehicle at different speeds. The stopping distance can also be affected by the road terrain (friction) and the efficiency of the brakes, all of which were missing from the dataset. Therefore these parameters that we have not accounted for can also potentially affect our model. So why weren't those included in the dataset? Often it is time-consuming to keep note of every parameter that can affect the variable we are interested in and therefore, they are often excluded from data collection. Thus, the model created using this data would only be a close approximation of what is happening in the real world. This particular drawback is emphasised in the following aphorism;</span>
<span id="cb84-146"><a href="#cb84-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-147"><a href="#cb84-147" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;"All models are wrong, but some are useful" - George Box </span><span class="co">[</span><span class="ot">@box_science_1976</span><span class="co">]</span></span>
<span id="cb84-148"><a href="#cb84-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-149"><a href="#cb84-149" aria-hidden="true" tabindex="-1"></a>Thus even though our model is not the perfect one^<span class="co">[</span><span class="ot">Which is almost impossible to create under real-life conditions</span><span class="co">]</span>, if it reliably predicts values then the model is considered useful. Thus a statistical model is stochastic.</span>
<span id="cb84-150"><a href="#cb84-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-151"><a href="#cb84-151" aria-hidden="true" tabindex="-1"></a>From a mathematical point of view, an ideal model would contain all the parameters that affect the response variable. Thus the sample space ($S$) will contain all possible combinations of **[explanatory variables, stopping distance]** values. Therefore, the set of probability distributions corresponding to all these combinations will be $P(S)$. But in real life, we cannot afford to measure all the parameters concerning the response variable and are only interested in a small set of variables. Thus we often have a subset of the total possible combinations of **[explanatory variables, stopping distance]** values ($\theta$), and the corresponding probability distribution for these combinations will be $P(\theta)$. The model thus created with a small set of parameters is called a parametrised statistical model. </span>
<span id="cb84-152"><a href="#cb84-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-153"><a href="#cb84-153" aria-hidden="true" tabindex="-1"></a>For all such models; $P(\theta) \subset P(S)$.</span>
<span id="cb84-154"><a href="#cb84-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-155"><a href="#cb84-155" aria-hidden="true" tabindex="-1"></a>This definition is not exactly needed to do modelling but it's good to know the actual mathematical definition of what a statistical model is.</span>
<span id="cb84-156"><a href="#cb84-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-157"><a href="#cb84-157" aria-hidden="true" tabindex="-1"></a>Now that we have a rough idea of what a model is, let us know learn how to build models in R.</span>
<span id="cb84-158"><a href="#cb84-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-159"><a href="#cb84-159" aria-hidden="true" tabindex="-1"></a><span class="fu">## Making life easier</span></span>
<span id="cb84-160"><a href="#cb84-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-161"><a href="#cb84-161" aria-hidden="true" tabindex="-1"></a>Please install and load the necessary packages and datasets which are listed below for a seamless tutorial session. (Not required but can be very helpful if you are following this tutorial code by code)</span>
<span id="cb84-162"><a href="#cb84-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-165"><a href="#cb84-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-166"><a href="#cb84-166" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb84-167"><a href="#cb84-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-168"><a href="#cb84-168" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries used in this tutorial</span></span>
<span id="cb84-169"><a href="#cb84-169" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'cherryblossom'</span>)</span>
<span id="cb84-170"><a href="#cb84-170" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'rpart'</span>)</span>
<span id="cb84-171"><a href="#cb84-171" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'datasets'</span>)</span>
<span id="cb84-172"><a href="#cb84-172" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'NHANES'</span>)</span>
<span id="cb84-173"><a href="#cb84-173" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'rpart.plot'</span>)</span>
<span id="cb84-174"><a href="#cb84-174" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'mosaicModel'</span>)</span>
<span id="cb84-175"><a href="#cb84-175" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'devtools'</span>)</span>
<span id="cb84-176"><a href="#cb84-176" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"dtkaplan/statisticalModeling"</span>)</span>
<span id="cb84-177"><a href="#cb84-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-178"><a href="#cb84-178" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading the libraries</span></span>
<span id="cb84-179"><a href="#cb84-179" aria-hidden="true" tabindex="-1"></a>tutorial_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"cherryblossom"</span>, <span class="st">"rpart"</span>, <span class="st">"datasets"</span>, <span class="st">"NHANES"</span>,</span>
<span id="cb84-180"><a href="#cb84-180" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"rpart.plot"</span>, <span class="st">"mosaicModel"</span>, <span class="st">"statisticalModeling"</span>)</span>
<span id="cb84-181"><a href="#cb84-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-182"><a href="#cb84-182" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(tutorial_packages, library, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb84-183"><a href="#cb84-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-184"><a href="#cb84-184" aria-hidden="true" tabindex="-1"></a><span class="co"># Datasets used in this tutorial</span></span>
<span id="cb84-185"><a href="#cb84-185" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"run17"</span>) <span class="co"># From cherryblossom</span></span>
<span id="cb84-186"><a href="#cb84-186" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"ToothGrowth"</span>) <span class="co"># From datasets</span></span>
<span id="cb84-187"><a href="#cb84-187" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"chickwts"</span>) <span class="co"># From datasets</span></span>
<span id="cb84-188"><a href="#cb84-188" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"NHANES"</span>) <span class="co"># From NHANES</span></span>
<span id="cb84-189"><a href="#cb84-189" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Tadpoles"</span>) <span class="co"># From mosaicModel</span></span>
<span id="cb84-190"><a href="#cb84-190" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Used_Fords"</span>) <span class="co"># From mosaicModel</span></span>
<span id="cb84-191"><a href="#cb84-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-192"><a href="#cb84-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-193"><a href="#cb84-193" aria-hidden="true" tabindex="-1"></a><span class="fu">## Building a model</span></span>
<span id="cb84-194"><a href="#cb84-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-195"><a href="#cb84-195" aria-hidden="true" tabindex="-1"></a>The pipeline for building a model is as follows;</span>
<span id="cb84-196"><a href="#cb84-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-199"><a href="#cb84-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb84-200"><a href="#cb84-200" aria-hidden="true" tabindex="-1"></a>graph LR</span>
<span id="cb84-201"><a href="#cb84-201" aria-hidden="true" tabindex="-1"></a>subgraph Pipeline <span class="kw">for</span> making a statistical model</span>
<span id="cb84-202"><a href="#cb84-202" aria-hidden="true" tabindex="-1"></a>A(Collect data) --&gt; B(Select explanatory&lt;br&gt; <span class="ot">and</span> response variables) --&gt; C(Select model architecture) --&gt; D(Build the model)</span>
<span id="cb84-203"><a href="#cb84-203" aria-hidden="true" tabindex="-1"></a>end</span>
<span id="cb84-204"><a href="#cb84-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-205"><a href="#cb84-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-206"><a href="#cb84-206" aria-hidden="true" tabindex="-1"></a>The first step in building a model is by acquiring data. Then we need to select the appropriate response variable (dependent variable) and the explanatory variables (independent variable). In a cancer drug trial experiment data, tumour size can be the response variable and the drug type and patient age can be the explanatory variables. After selecting the variables, the model architecture is chosen. In our earlier example, we used a linear model to explain the changes seen in stopping distances with speed. Choosing a model architecture depends on the nature of the data. For now, we will mostly be using the linear model <span class="in">`lm()`</span>. But throughout the tutorial, we will also see other model architectures. The final step is to build the model, which is done by the computer.</span>
<span id="cb84-207"><a href="#cb84-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-208"><a href="#cb84-208" aria-hidden="true" tabindex="-1"></a>The syntax for building a model in R is as follows;</span>
<span id="cb84-209"><a href="#cb84-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-212"><a href="#cb84-212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-213"><a href="#cb84-213" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb84-214"><a href="#cb84-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-215"><a href="#cb84-215" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(response <span class="sc">~</span> explanaotry1 <span class="sc">+</span> explanatory2, <span class="at">data =</span> dataset_name)</span>
<span id="cb84-216"><a href="#cb84-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-217"><a href="#cb84-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-218"><a href="#cb84-218" aria-hidden="true" tabindex="-1"></a><span class="fu">### Linear model</span></span>
<span id="cb84-219"><a href="#cb84-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-220"><a href="#cb84-220" aria-hidden="true" tabindex="-1"></a>Let us try to plot some models using the linear model architecture using the <span class="in">`lm()`</span>function in R. We will be using the <span class="in">`run17`</span> dataset from the <span class="in">`{cherryblossom}`</span> package in R. The <span class="in">`run17`</span> dataset contains details for all 19,961 runners in the 2017 Cherry Blossom Run, which is an annual road race that takes place in Washington, DC, USA. Also, the Cherry Blossom Run has two events; a 10 Mile marathon and a 5 Km run. For now, we will be concerned with participants that participated in the 10 Mile marathon only.</span>
<span id="cb84-221"><a href="#cb84-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-222"><a href="#cb84-222" aria-hidden="true" tabindex="-1"></a>In the dataset, we are interested to check whether the net time to complete the 10 Mile marathon (<span class="in">`net_sec`</span>) is affected by the <span class="in">`age`</span> and <span class="in">`sex`</span> of the participant. So for making the model, we use <span class="in">`net_sec`</span> as the response variable and, <span class="in">`age`</span> and <span class="in">`sex`</span> as the explanatory variables.</span>
<span id="cb84-223"><a href="#cb84-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-224"><a href="#cb84-224" aria-hidden="true" tabindex="-1"></a>We can use the <span class="in">`summary()`</span> function to summarise the model. For now, we will not worry about the summary details. Then, using the <span class="in">`{ggplot2}`</span> package, we will plot the model using the <span class="in">`stat_smooth()`</span> function. Please not that there is another function <span class="in">`geom_smooth()`</span> which is an alias of <span class="in">`stat_smooth()`</span>. Both do the same thing.</span>
<span id="cb84-225"><a href="#cb84-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-228"><a href="#cb84-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-229"><a href="#cb84-229" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(cherryblossom)) <span class="fu">install.packages</span>(<span class="st">'cherryblossom'</span>)</span>
<span id="cb84-230"><a href="#cb84-230" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb84-231"><a href="#cb84-231" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb84-232"><a href="#cb84-232" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb84-233"><a href="#cb84-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-234"><a href="#cb84-234" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking headers in the data</span></span>
<span id="cb84-235"><a href="#cb84-235" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(run17)</span>
<span id="cb84-236"><a href="#cb84-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-237"><a href="#cb84-237" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb84-238"><a href="#cb84-238" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb84-239"><a href="#cb84-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-240"><a href="#cb84-240" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb84-241"><a href="#cb84-241" aria-hidden="true" tabindex="-1"></a>model_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(net_sec <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> run17_marathon)</span>
<span id="cb84-242"><a href="#cb84-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-243"><a href="#cb84-243" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the summary of the model</span></span>
<span id="cb84-244"><a href="#cb84-244" aria-hidden="true" tabindex="-1"></a><span class="co"># For now don't worry about the details</span></span>
<span id="cb84-245"><a href="#cb84-245" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_1)</span>
<span id="cb84-246"><a href="#cb84-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-247"><a href="#cb84-247" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model using ggplot2</span></span>
<span id="cb84-248"><a href="#cb84-248" aria-hidden="true" tabindex="-1"></a><span class="co"># Use stat_smooth() function and specify "lm"</span></span>
<span id="cb84-249"><a href="#cb84-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-250"><a href="#cb84-250" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, net_sec, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb84-251"><a href="#cb84-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> </span>
<span id="cb84-252"><a href="#cb84-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb84-253"><a href="#cb84-253" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Time to complete 10 Mile marathon (sec)"</span>,</span>
<span id="cb84-254"><a href="#cb84-254" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Net time ~ Age + Sex"</span>) <span class="sc">+</span> </span>
<span id="cb84-255"><a href="#cb84-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-256"><a href="#cb84-256" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-257"><a href="#cb84-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-258"><a href="#cb84-258" aria-hidden="true" tabindex="-1"></a>From the graph, it seems that female participants take more time to complete the run compared to their male counterparts.</span>
<span id="cb84-259"><a href="#cb84-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-260"><a href="#cb84-260" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic model</span></span>
<span id="cb84-261"><a href="#cb84-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-262"><a href="#cb84-262" aria-hidden="true" tabindex="-1"></a>Now let us try to see whether the participant's choice in choosing between the events is affected by their age and sex. We can hypothesize that older participants of both sexes would prefer the 5 km run over 10 </span>
<span id="cb84-263"><a href="#cb84-263" aria-hidden="true" tabindex="-1"></a>Mile marathon. Thus, we use the variable <span class="in">`event`</span> as the response variable and, <span class="in">`age`</span> and <span class="in">`sex`</span> as the explanatory variables. We are more interested to see the effect of age as compared to sex, therefore the variable <span class="in">`sex`</span> is considered a covariate. We will learn later what covariate mean</span>
<span id="cb84-264"><a href="#cb84-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-265"><a href="#cb84-265" aria-hidden="true" tabindex="-1"></a>We will use the <span class="in">`lm()`</span> function to make a linear model. Here we will convert the event variable to boolean values for it to work with the formula. The corresponding values are; 1 = 10 Mile event and 0 = 5 Km event.</span>
<span id="cb84-266"><a href="#cb84-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-269"><a href="#cb84-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-270"><a href="#cb84-270" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb84-271"><a href="#cb84-271" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb84-272"><a href="#cb84-272" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb84-273"><a href="#cb84-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-274"><a href="#cb84-274" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting event variable values into boolean </span></span>
<span id="cb84-275"><a href="#cb84-275" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="ot">&lt;-</span> run17</span>
<span id="cb84-276"><a href="#cb84-276" aria-hidden="true" tabindex="-1"></a>run17_boolean<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">recode</span>(run17_boolean<span class="sc">$</span>event, <span class="st">"10 Mile"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"5K"</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb84-277"><a href="#cb84-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-278"><a href="#cb84-278" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb84-279"><a href="#cb84-279" aria-hidden="true" tabindex="-1"></a>model_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(event <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> run17_boolean)</span>
<span id="cb84-280"><a href="#cb84-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-281"><a href="#cb84-281" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model using ggplot2</span></span>
<span id="cb84-282"><a href="#cb84-282" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, event, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb84-283"><a href="#cb84-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb84-284"><a href="#cb84-284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb84-285"><a href="#cb84-285" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Event choice"</span>,</span>
<span id="cb84-286"><a href="#cb84-286" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Event ~ Age + Sex (linear model)"</span>) <span class="sc">+</span> </span>
<span id="cb84-287"><a href="#cb84-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-288"><a href="#cb84-288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-289"><a href="#cb84-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-290"><a href="#cb84-290" aria-hidden="true" tabindex="-1"></a>From the graph, it seems like, for male participants, age doesn't affect their event choice selection. But for females, compared to males, age does seem to affect it. Therefore older female participants prefer 5 km runs as compared to older male participants.</span>
<span id="cb84-291"><a href="#cb84-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-292"><a href="#cb84-292" aria-hidden="true" tabindex="-1"></a>Let us look at the dataset more closely, especially the response variable.</span>
<span id="cb84-293"><a href="#cb84-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-296"><a href="#cb84-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-297"><a href="#cb84-297" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking the data type of the response variable</span></span>
<span id="cb84-298"><a href="#cb84-298" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(run17<span class="sc">$</span>event)</span>
<span id="cb84-299"><a href="#cb84-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-300"><a href="#cb84-300" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the unique strings from the response variable</span></span>
<span id="cb84-301"><a href="#cb84-301" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(run17<span class="sc">$</span>event)</span>
<span id="cb84-302"><a href="#cb84-302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-303"><a href="#cb84-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-304"><a href="#cb84-304" aria-hidden="true" tabindex="-1"></a>Our response variable is dichotomous and thus not continuous. The <span class="in">`lm()`</span> function we used works best for continuous numerical data. So the model architecture we used was not an appropriate one here. So in these situations, we can use the logistic modelling architecture. Both logistic modelling and linear modelling are part of generalised linear modelling. We can use the <span class="in">`glm()`</span> function in R and specify <span class="in">`family = binomial`</span> to have a logistic model.</span>
<span id="cb84-305"><a href="#cb84-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-306"><a href="#cb84-306" aria-hidden="true" tabindex="-1"></a>The syntax for a logistic model in R is;</span>
<span id="cb84-307"><a href="#cb84-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-310"><a href="#cb84-310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-311"><a href="#cb84-311" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb84-312"><a href="#cb84-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-313"><a href="#cb84-313" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(response_variable <span class="sc">~</span> explanatory_variable, <span class="at">data =</span> dataset_name, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb84-314"><a href="#cb84-314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-315"><a href="#cb84-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-316"><a href="#cb84-316" aria-hidden="true" tabindex="-1"></a>Now let us try the <span class="in">`glm()`</span> function and make a logistic model for the earlier case. </span>
<span id="cb84-317"><a href="#cb84-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-320"><a href="#cb84-320" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-321"><a href="#cb84-321" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb84-322"><a href="#cb84-322" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb84-323"><a href="#cb84-323" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb84-324"><a href="#cb84-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-325"><a href="#cb84-325" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting event variable values into boolean </span></span>
<span id="cb84-326"><a href="#cb84-326" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="ot">&lt;-</span> run17</span>
<span id="cb84-327"><a href="#cb84-327" aria-hidden="true" tabindex="-1"></a>run17_boolean<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">recode</span>(run17_boolean<span class="sc">$</span>event, <span class="st">"10 Mile"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"5K"</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb84-328"><a href="#cb84-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-329"><a href="#cb84-329" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the logistic model</span></span>
<span id="cb84-330"><a href="#cb84-330" aria-hidden="true" tabindex="-1"></a>model_3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(event <span class="sc">~</span> sex <span class="sc">+</span> age, <span class="at">data =</span> run17_boolean, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb84-331"><a href="#cb84-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-332"><a href="#cb84-332" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model using ggplot2</span></span>
<span id="cb84-333"><a href="#cb84-333" aria-hidden="true" tabindex="-1"></a><span class="co"># Use stat_smooth() function and specify "glm"</span></span>
<span id="cb84-334"><a href="#cb84-334" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, event, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb84-335"><a href="#cb84-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>)) <span class="sc">+</span></span>
<span id="cb84-336"><a href="#cb84-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb84-337"><a href="#cb84-337" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Event choice"</span>,</span>
<span id="cb84-338"><a href="#cb84-338" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Event ~ Age + Sex (logistic model)"</span>) <span class="sc">+</span> </span>
<span id="cb84-339"><a href="#cb84-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-340"><a href="#cb84-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-341"><a href="#cb84-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-342"><a href="#cb84-342" aria-hidden="true" tabindex="-1"></a>The graph looks very similar to the earlier one. For easy comparison, both the graphs are shown next to each other below. Please use the slider to compare between the graphs.</span>
<span id="cb84-343"><a href="#cb84-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-346"><a href="#cb84-346" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-347"><a href="#cb84-347" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb84-348"><a href="#cb84-348" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb84-349"><a href="#cb84-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-350"><a href="#cb84-350" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb84-351"><a href="#cb84-351" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb84-352"><a href="#cb84-352" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb84-353"><a href="#cb84-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-354"><a href="#cb84-354" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="ot">&lt;-</span> run17</span>
<span id="cb84-355"><a href="#cb84-355" aria-hidden="true" tabindex="-1"></a>run17_boolean<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">recode</span>(run17_boolean<span class="sc">$</span>event, <span class="st">"10 Mile"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"5K"</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb84-356"><a href="#cb84-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-357"><a href="#cb84-357" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear model</span></span>
<span id="cb84-358"><a href="#cb84-358" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, event, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb84-359"><a href="#cb84-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb84-360"><a href="#cb84-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb84-361"><a href="#cb84-361" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Event choice"</span>,</span>
<span id="cb84-362"><a href="#cb84-362" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Event ~ Age + Sex (linear model)"</span>) <span class="sc">+</span> </span>
<span id="cb84-363"><a href="#cb84-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-364"><a href="#cb84-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-365"><a href="#cb84-365" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic model</span></span>
<span id="cb84-366"><a href="#cb84-366" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, event, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb84-367"><a href="#cb84-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>)) <span class="sc">+</span></span>
<span id="cb84-368"><a href="#cb84-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb84-369"><a href="#cb84-369" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Event choice"</span>,</span>
<span id="cb84-370"><a href="#cb84-370" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Event ~ Age + Sex (logistic model)"</span>) <span class="sc">+</span> </span>
<span id="cb84-371"><a href="#cb84-371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-372"><a href="#cb84-372" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-373"><a href="#cb84-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-374"><a href="#cb84-374" aria-hidden="true" tabindex="-1"></a>::: {.juxtapose data-startingposition="35%"}</span>
<span id="cb84-375"><a href="#cb84-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-378"><a href="#cb84-378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-379"><a href="#cb84-379" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb84-380"><a href="#cb84-380" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb84-381"><a href="#cb84-381" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb84-382"><a href="#cb84-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-383"><a href="#cb84-383" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="ot">&lt;-</span> run17</span>
<span id="cb84-384"><a href="#cb84-384" aria-hidden="true" tabindex="-1"></a>run17_boolean<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">recode</span>(run17_boolean<span class="sc">$</span>event, <span class="st">"10 Mile"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"5K"</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb84-385"><a href="#cb84-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-386"><a href="#cb84-386" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear model</span></span>
<span id="cb84-387"><a href="#cb84-387" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, event, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb84-388"><a href="#cb84-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb84-389"><a href="#cb84-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb84-390"><a href="#cb84-390" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Event choice"</span>,</span>
<span id="cb84-391"><a href="#cb84-391" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Event ~ Age + Sex (linear model)"</span>) <span class="sc">+</span> </span>
<span id="cb84-392"><a href="#cb84-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-393"><a href="#cb84-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-394"><a href="#cb84-394" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic model</span></span>
<span id="cb84-395"><a href="#cb84-395" aria-hidden="true" tabindex="-1"></a>run17_boolean <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, event, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb84-396"><a href="#cb84-396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>)) <span class="sc">+</span></span>
<span id="cb84-397"><a href="#cb84-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb84-398"><a href="#cb84-398" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Event choice"</span>,</span>
<span id="cb84-399"><a href="#cb84-399" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Event ~ Age + Sex (logistic model)"</span>) <span class="sc">+</span> </span>
<span id="cb84-400"><a href="#cb84-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-401"><a href="#cb84-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-402"><a href="#cb84-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-403"><a href="#cb84-403" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb84-404"><a href="#cb84-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-405"><a href="#cb84-405" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model evaluation</span></span>
<span id="cb84-406"><a href="#cb84-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-407"><a href="#cb84-407" aria-hidden="true" tabindex="-1"></a>After building the model, we can evaluate it by providing new inputs to the model to get corresponding predicted output values. The predicted output values can then be cross-checked against the original output values and see how far off they are in terms of prediction (i.e. the prediction error). Using the <span class="in">`predict()`</span> function, we can predict for values outside the dataset or evaluate the model using the prediction error.</span>
<span id="cb84-408"><a href="#cb84-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-409"><a href="#cb84-409" aria-hidden="true" tabindex="-1"></a><span class="fu">### Prediciting values</span></span>
<span id="cb84-410"><a href="#cb84-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-411"><a href="#cb84-411" aria-hidden="true" tabindex="-1"></a>We will go back to the first example where we checked if the net time to complete the 10 Mile marathon (<span class="in">`net_sec`</span>) is affected by the age and sex of the participants. We will create dummy data of participants with random age and sex values and use the model to predict their net time to complete the race.</span>
<span id="cb84-412"><a href="#cb84-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-415"><a href="#cb84-415" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-416"><a href="#cb84-416" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb84-417"><a href="#cb84-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-418"><a href="#cb84-418" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating dummy data of different ages</span></span>
<span id="cb84-419"><a href="#cb84-419" aria-hidden="true" tabindex="-1"></a>male <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"age"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">2</span>)),</span>
<span id="cb84-420"><a href="#cb84-420" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"sex"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">replicate</span>(<span class="dv">50</span>, <span class="st">"M"</span>)))</span>
<span id="cb84-421"><a href="#cb84-421" aria-hidden="true" tabindex="-1"></a>female <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"age"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">2</span>)),</span>
<span id="cb84-422"><a href="#cb84-422" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"sex"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">replicate</span>(<span class="dv">50</span>, <span class="st">"F"</span>)))</span>
<span id="cb84-423"><a href="#cb84-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-424"><a href="#cb84-424" aria-hidden="true" tabindex="-1"></a>dummy_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(male, female)</span>
<span id="cb84-425"><a href="#cb84-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-426"><a href="#cb84-426" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb84-427"><a href="#cb84-427" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb84-428"><a href="#cb84-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-429"><a href="#cb84-429" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb84-430"><a href="#cb84-430" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(net_sec <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> run17_marathon)</span>
<span id="cb84-431"><a href="#cb84-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-432"><a href="#cb84-432" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting values</span></span>
<span id="cb84-433"><a href="#cb84-433" aria-hidden="true" tabindex="-1"></a>dummy_data<span class="sc">$</span>net_sec <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_lm, <span class="at">newdata =</span> dummy_data)</span>
<span id="cb84-434"><a href="#cb84-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-435"><a href="#cb84-435" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the predicted values</span></span>
<span id="cb84-436"><a href="#cb84-436" aria-hidden="true" tabindex="-1"></a>dummy_data <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, net_sec, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb84-437"><a href="#cb84-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb84-438"><a href="#cb84-438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb84-439"><a href="#cb84-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb84-440"><a href="#cb84-440" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Time to complete the marathon (sec)"</span>,</span>
<span id="cb84-441"><a href="#cb84-441" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Predicted values"</span>) <span class="sc">+</span> </span>
<span id="cb84-442"><a href="#cb84-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-443"><a href="#cb84-443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-444"><a href="#cb84-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-445"><a href="#cb84-445" aria-hidden="true" tabindex="-1"></a>In the plot, we can see that we have babies as young as 1 year old, who have been predicted to have completed the 10 Mile marathon faster that their older participants. So what on earth did we do to get these results?</span>
<span id="cb84-446"><a href="#cb84-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-447"><a href="#cb84-447" aria-hidden="true" tabindex="-1"></a><span class="al">![My reaction after the model predictions](https://c.tenor.com/QSFMj0VddAQAAAAC/hold-on-wait-a-minute.gif)</span></span>
<span id="cb84-448"><a href="#cb84-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-449"><a href="#cb84-449" aria-hidden="true" tabindex="-1"></a>Let us look the linear model plot that we had earlier.</span>
<span id="cb84-450"><a href="#cb84-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-453"><a href="#cb84-453" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-454"><a href="#cb84-454" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb84-455"><a href="#cb84-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-456"><a href="#cb84-456" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb84-457"><a href="#cb84-457" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb84-458"><a href="#cb84-458" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb84-459"><a href="#cb84-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-460"><a href="#cb84-460" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb84-461"><a href="#cb84-461" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb84-462"><a href="#cb84-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-463"><a href="#cb84-463" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb84-464"><a href="#cb84-464" aria-hidden="true" tabindex="-1"></a>model_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(net_sec <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> run17_marathon)</span>
<span id="cb84-465"><a href="#cb84-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-466"><a href="#cb84-466" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model using ggplot2</span></span>
<span id="cb84-467"><a href="#cb84-467" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, net_sec, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb84-468"><a href="#cb84-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> </span>
<span id="cb84-469"><a href="#cb84-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb84-470"><a href="#cb84-470" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Time to complete 10 Mile marathon (sec)"</span>,</span>
<span id="cb84-471"><a href="#cb84-471" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Net time ~ Age + Sex"</span>) <span class="sc">+</span> </span>
<span id="cb84-472"><a href="#cb84-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-473"><a href="#cb84-473" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-474"><a href="#cb84-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-475"><a href="#cb84-475" aria-hidden="true" tabindex="-1"></a>You can see that there is a general trend of increasing 'net time to complete the race' as the 'age' value increases and decreasing net time as age decreases. Therefore our linear model favours reduced net times for lesser values of age, which is what we see as predicted values. </span>
<span id="cb84-476"><a href="#cb84-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-477"><a href="#cb84-477" aria-hidden="true" tabindex="-1"></a>So our model has its limitations in predicting values for a certain range of age😅. </span>
<span id="cb84-478"><a href="#cb84-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-479"><a href="#cb84-479" aria-hidden="true" tabindex="-1"></a>The moral of the story here is that models trained on data can be a bit wild when evaluated outside the range of the data. So we have to be mindful of its prediction abilities, otherwise, we can end up with superhuman babies who can run marathons faster than anyone.</span>
<span id="cb84-480"><a href="#cb84-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-481"><a href="#cb84-481" aria-hidden="true" tabindex="-1"></a><span class="al">![Ideal relationship between age and the time to complete the marathon](images/age_time.png)</span></span>
<span id="cb84-482"><a href="#cb84-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-483"><a href="#cb84-483" aria-hidden="true" tabindex="-1"></a><span class="fu">### Evaluating a model</span></span>
<span id="cb84-484"><a href="#cb84-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-485"><a href="#cb84-485" aria-hidden="true" tabindex="-1"></a>Instead of predicting new values outside the dataset, we can use the same dataset used for model training to predict values. Utilizing these predicted values, we can compare them back to the original values and calculate the prediction error. This is one way to compare different models and see which models predict values closer to the original values in the dataset.</span>
<span id="cb84-486"><a href="#cb84-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-487"><a href="#cb84-487" aria-hidden="true" tabindex="-1"></a>We will use our earlier made linear model, where we looked at whether the total time to complete the race is affected by age and sex. We will also make a new model using the 'recursive partitioning model architecture' using the same dataset so that we can have a model to compare with. Using the <span class="in">`rpart()`</span> function in the <span class="in">`{rpart}`</span> package in R, we can build a recursive partitioning model. The <span class="in">`rpart()`</span> model works for both numerical (dichotomous and discontinuous) and categorical data. We will learn more about rpart models later in this article. </span>
<span id="cb84-488"><a href="#cb84-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-491"><a href="#cb84-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-492"><a href="#cb84-492" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb84-493"><a href="#cb84-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-494"><a href="#cb84-494" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(rpart)) <span class="fu">install.packages</span>(<span class="st">'rpart'</span>)</span>
<span id="cb84-495"><a href="#cb84-495" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb84-496"><a href="#cb84-496" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb84-497"><a href="#cb84-497" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb84-498"><a href="#cb84-498" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb84-499"><a href="#cb84-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-500"><a href="#cb84-500" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking headers in the data</span></span>
<span id="cb84-501"><a href="#cb84-501" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(run17)</span>
<span id="cb84-502"><a href="#cb84-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-503"><a href="#cb84-503" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb84-504"><a href="#cb84-504" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb84-505"><a href="#cb84-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-506"><a href="#cb84-506" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb84-507"><a href="#cb84-507" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(net_sec <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> run17_marathon)</span>
<span id="cb84-508"><a href="#cb84-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-509"><a href="#cb84-509" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a recursive partitioning model</span></span>
<span id="cb84-510"><a href="#cb84-510" aria-hidden="true" tabindex="-1"></a>model_rpart <span class="ot">&lt;-</span> <span class="fu">rpart</span>(net_sec <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> run17_marathon)</span>
<span id="cb84-511"><a href="#cb84-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-512"><a href="#cb84-512" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting values</span></span>
<span id="cb84-513"><a href="#cb84-513" aria-hidden="true" tabindex="-1"></a>lm_predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_lm, <span class="at">newdata =</span> run17_marathon)</span>
<span id="cb84-514"><a href="#cb84-514" aria-hidden="true" tabindex="-1"></a>rpart_predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_rpart, <span class="at">newdata =</span> run17_marathon)</span>
<span id="cb84-515"><a href="#cb84-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-516"><a href="#cb84-516" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating error values</span></span>
<span id="cb84-517"><a href="#cb84-517" aria-hidden="true" tabindex="-1"></a>lm_error <span class="ot">&lt;-</span> <span class="fu">with</span>(run17_marathon, net_sec <span class="sc">-</span> lm_predict)</span>
<span id="cb84-518"><a href="#cb84-518" aria-hidden="true" tabindex="-1"></a>rpart_error <span class="ot">&lt;-</span> <span class="fu">with</span>(run17_marathon, net_sec <span class="sc">-</span> rpart_predict)</span>
<span id="cb84-519"><a href="#cb84-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-520"><a href="#cb84-520" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing few error values</span></span>
<span id="cb84-521"><a href="#cb84-521" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.data.frame</span>(lm_error))</span>
<span id="cb84-522"><a href="#cb84-522" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.data.frame</span>(rpart_error))</span>
<span id="cb84-523"><a href="#cb84-523" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-524"><a href="#cb84-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-525"><a href="#cb84-525" aria-hidden="true" tabindex="-1"></a>Now we have data frames containing error values calculated between each of the original values in the dataset to the predicted values from the model. You can see that it's tedious to compare the error values of the linear model to the logistic model, also some of these error values are negative, which makes the comparison even harder. So how can we know which model is better? Calculating the mean of the square of the prediction errors (m.s.e) would be a great way to start. The m.s.e will reflect the magnitude and not the sign of the errors.</span>
<span id="cb84-526"><a href="#cb84-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-529"><a href="#cb84-529" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-530"><a href="#cb84-530" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean of the square of the prediction errors (m.s.e)</span></span>
<span id="cb84-531"><a href="#cb84-531" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(lm_error <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb84-532"><a href="#cb84-532" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(rpart_error <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb84-533"><a href="#cb84-533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-534"><a href="#cb84-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-535"><a href="#cb84-535" aria-hidden="true" tabindex="-1"></a>The linear model has a lower error value compared to the recursive partitioning model. Therefore the fitted values in the linear model are closer to the actual value in the dataset compare to the other model.</span>
<span id="cb84-536"><a href="#cb84-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-537"><a href="#cb84-537" aria-hidden="true" tabindex="-1"></a>We can also plot the predicted values and see how they look. Please use the slider to compare the graphs.</span>
<span id="cb84-538"><a href="#cb84-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-541"><a href="#cb84-541" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-542"><a href="#cb84-542" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb84-543"><a href="#cb84-543" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb84-544"><a href="#cb84-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-545"><a href="#cb84-545" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb84-546"><a href="#cb84-546" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb84-547"><a href="#cb84-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-548"><a href="#cb84-548" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb84-549"><a href="#cb84-549" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb84-550"><a href="#cb84-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-551"><a href="#cb84-551" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the linear model</span></span>
<span id="cb84-552"><a href="#cb84-552" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, net_sec, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb84-553"><a href="#cb84-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> </span>
<span id="cb84-554"><a href="#cb84-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb84-555"><a href="#cb84-555" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Time to complete 10 Mile marathon (sec)"</span>,</span>
<span id="cb84-556"><a href="#cb84-556" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Net time ~ Age + Sex (linear model)"</span>) <span class="sc">+</span> </span>
<span id="cb84-557"><a href="#cb84-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-558"><a href="#cb84-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-559"><a href="#cb84-559" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding rpart predicted values to the dataset</span></span>
<span id="cb84-560"><a href="#cb84-560" aria-hidden="true" tabindex="-1"></a>rpart_predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_rpart, <span class="at">newdata =</span> run17_marathon)</span>
<span id="cb84-561"><a href="#cb84-561" aria-hidden="true" tabindex="-1"></a>run17_marathon<span class="sc">$</span>rpart_fitted_values <span class="ot">&lt;-</span> rpart_predict</span>
<span id="cb84-562"><a href="#cb84-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-563"><a href="#cb84-563" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the recursive partitioning model</span></span>
<span id="cb84-564"><a href="#cb84-564" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, rpart_predict, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb84-565"><a href="#cb84-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb84-566"><a href="#cb84-566" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb84-567"><a href="#cb84-567" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Time to complete 10 Mile marathon (sec)"</span>,</span>
<span id="cb84-568"><a href="#cb84-568" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Net time ~ Age + Sex (recursive partitioning model)"</span>) <span class="sc">+</span> </span>
<span id="cb84-569"><a href="#cb84-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-570"><a href="#cb84-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-571"><a href="#cb84-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-572"><a href="#cb84-572" aria-hidden="true" tabindex="-1"></a>::: {.juxtapose data-startingposition="50%"}</span>
<span id="cb84-573"><a href="#cb84-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-576"><a href="#cb84-576" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-577"><a href="#cb84-577" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb84-578"><a href="#cb84-578" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb84-579"><a href="#cb84-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-580"><a href="#cb84-580" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb84-581"><a href="#cb84-581" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb84-582"><a href="#cb84-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-583"><a href="#cb84-583" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the linear model</span></span>
<span id="cb84-584"><a href="#cb84-584" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, net_sec, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb84-585"><a href="#cb84-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> </span>
<span id="cb84-586"><a href="#cb84-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb84-587"><a href="#cb84-587" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Time to complete 10 Mile marathon (sec)"</span>,</span>
<span id="cb84-588"><a href="#cb84-588" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Net time ~ Age + Sex (linear model)"</span>) <span class="sc">+</span> </span>
<span id="cb84-589"><a href="#cb84-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-590"><a href="#cb84-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-591"><a href="#cb84-591" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding rpart predicted values to the dataset</span></span>
<span id="cb84-592"><a href="#cb84-592" aria-hidden="true" tabindex="-1"></a>rpart_predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_rpart, <span class="at">newdata =</span> run17_marathon)</span>
<span id="cb84-593"><a href="#cb84-593" aria-hidden="true" tabindex="-1"></a>run17_marathon<span class="sc">$</span>rpart_fitted_values <span class="ot">&lt;-</span> rpart_predict</span>
<span id="cb84-594"><a href="#cb84-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-595"><a href="#cb84-595" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the recursive partitioning model</span></span>
<span id="cb84-596"><a href="#cb84-596" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, rpart_predict, <span class="at">col =</span> sex)) <span class="sc">+</span></span>
<span id="cb84-597"><a href="#cb84-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb84-598"><a href="#cb84-598" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb84-599"><a href="#cb84-599" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Time to complete 10 Mile marathon (sec)"</span>,</span>
<span id="cb84-600"><a href="#cb84-600" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Net time ~ Age + Sex (recursive partitioning model)"</span>) <span class="sc">+</span> </span>
<span id="cb84-601"><a href="#cb84-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-602"><a href="#cb84-602" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-603"><a href="#cb84-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-604"><a href="#cb84-604" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb84-605"><a href="#cb84-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-606"><a href="#cb84-606" aria-hidden="true" tabindex="-1"></a><span class="fu">### Choosing the explanatory variables</span></span>
<span id="cb84-607"><a href="#cb84-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-608"><a href="#cb84-608" aria-hidden="true" tabindex="-1"></a>In this exercise, we will use the <span class="in">`ToothGrowth`</span> dataset from the <span class="in">`{datasets}`</span> package in R. The dataset is from an experiment that looked at the effect of vitamin C on tooth growth in guinea pigs. In the experiment, three different doses of vitamin C were administered to 60 guinea pigs. Vitamin C was administered either through orange juice or ascorbic acid. The length of odontoblasts (cells responsible for tooth growth) was measured to check for tooth growth. </span>
<span id="cb84-609"><a href="#cb84-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-610"><a href="#cb84-610" aria-hidden="true" tabindex="-1"></a>We will be creating a linear model to check if tooth growth is affected by vitamin C dosages. At the same time, there is also a chance that tooth growth is affected by the method of vitamin C administration. Therefore, we have the choice of choosing between 'vitamin C dosage' and the 'method of vitamin C administration' as the explanatory variables. So how do we know which of these variables is better at predicting tooth growth values? To find the best predictor, we can first build a model using 'vitamin C dosage' as the only explanatory variable. Then later, we can build yet another model using both 'vitamin C dosage' and the 'method of vitamin C administration' as the explanatory variables. Then similiar to the ealrier case, we can use the mean of the square of the prediction errors can see which model is better.</span>
<span id="cb84-611"><a href="#cb84-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-612"><a href="#cb84-612" aria-hidden="true" tabindex="-1"></a>In the <span class="in">`ToothGrowth`</span> dataset, the variable <span class="in">`len`</span> contains the length of the odontoblasts, <span class="in">`supp`</span> contains the method of vitamin C administration (VC - ascorbic acid, OJ - Orange juice) and <span class="in">`dose`</span> contains the dosage of vitamin C administered in mg/day units.</span>
<span id="cb84-613"><a href="#cb84-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-616"><a href="#cb84-616" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-617"><a href="#cb84-617" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(datasets)) <span class="fu">install.packages</span>(<span class="st">'datasets'</span>)</span>
<span id="cb84-618"><a href="#cb84-618" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb84-619"><a href="#cb84-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-620"><a href="#cb84-620" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"ToothGrowth"</span>)</span>
<span id="cb84-621"><a href="#cb84-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-622"><a href="#cb84-622" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with only dose</span></span>
<span id="cb84-623"><a href="#cb84-623" aria-hidden="true" tabindex="-1"></a>model_dose <span class="ot">&lt;-</span> <span class="fu">lm</span>(len <span class="sc">~</span> dose, <span class="at">data =</span> ToothGrowth)</span>
<span id="cb84-624"><a href="#cb84-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-625"><a href="#cb84-625" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with dose + supp</span></span>
<span id="cb84-626"><a href="#cb84-626" aria-hidden="true" tabindex="-1"></a>model_dose_supp <span class="ot">&lt;-</span> <span class="fu">lm</span>(len <span class="sc">~</span> dose <span class="sc">+</span> supp, <span class="at">data =</span> ToothGrowth)</span>
<span id="cb84-627"><a href="#cb84-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-628"><a href="#cb84-628" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting values using the trained dataset</span></span>
<span id="cb84-629"><a href="#cb84-629" aria-hidden="true" tabindex="-1"></a>predict_dose <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_dose, <span class="at">newdata =</span> ToothGrowth)</span>
<span id="cb84-630"><a href="#cb84-630" aria-hidden="true" tabindex="-1"></a>predict_dose_supp <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_dose_supp, <span class="at">newdata =</span> ToothGrowth)</span>
<span id="cb84-631"><a href="#cb84-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-632"><a href="#cb84-632" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating error values</span></span>
<span id="cb84-633"><a href="#cb84-633" aria-hidden="true" tabindex="-1"></a>error_dose <span class="ot">&lt;-</span> <span class="fu">with</span>(ToothGrowth, dose <span class="sc">-</span> predict_dose)</span>
<span id="cb84-634"><a href="#cb84-634" aria-hidden="true" tabindex="-1"></a>error_dose_supp <span class="ot">&lt;-</span> <span class="fu">with</span>(ToothGrowth, dose <span class="sc">-</span> predict_dose_supp)</span>
<span id="cb84-635"><a href="#cb84-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-636"><a href="#cb84-636" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean of the square of the prediction errors</span></span>
<span id="cb84-637"><a href="#cb84-637" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(error_dose <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb84-638"><a href="#cb84-638" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(error_dose_supp <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb84-639"><a href="#cb84-639" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-640"><a href="#cb84-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-641"><a href="#cb84-641" aria-hidden="true" tabindex="-1"></a>You can see that the model with both vitamin C dosage and method of vitamin C administration as the explanatory variables has a greater error value compared to the model with only vitamin C dosage. Therefore adding the method of vitamin C administration as the explanatory variable did not improve the model and therefore can be excluded from the analysis.</span>
<span id="cb84-642"><a href="#cb84-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-643"><a href="#cb84-643" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cross validation</span></span>
<span id="cb84-644"><a href="#cb84-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-645"><a href="#cb84-645" aria-hidden="true" tabindex="-1"></a>So far we have been using the training dataset for predicting values. But there is a problem in using it for our analysis as it allows models with the additional explanatory variable to have smaller prediction errors than the base model. Let's see what this means in the following code.</span>
<span id="cb84-646"><a href="#cb84-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-647"><a href="#cb84-647" aria-hidden="true" tabindex="-1"></a>Here we use the <span class="in">`chickwts`</span> dataset from the <span class="in">`{datasets}`</span> package in R. In this dataset, there are two variables,  <span class="in">`weight`</span> which tells the weight (g) of the chick measured after 6 weeks and the <span class="in">`feed`</span> variable, which tells the type of feed that was given to the chicks for those 6 weeks. There were 6 different types of feed used. The experiment was done to check whether the feed type has any effect on the weights of the chick. </span>
<span id="cb84-648"><a href="#cb84-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-649"><a href="#cb84-649" aria-hidden="true" tabindex="-1"></a>Here we will build a linear model with weight as the response variable and feed type as the explanatory variable. Then we will make a random variable within the dataset which contains values which have no explanatory power. It will be filled with random numbers which have no relationship with the original data. We will build yet another linear model like earlier but this time we shall use both the feed type and the random variable as the explanatory variable. Adding a random variable to the model should cause the model to perform poorly and therefore should lead to an increased m.s.e value when compared to the model with just the feed type variable as the explanatory variable. Let us see if that's the case here. </span>
<span id="cb84-650"><a href="#cb84-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-653"><a href="#cb84-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-654"><a href="#cb84-654" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb84-655"><a href="#cb84-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-656"><a href="#cb84-656" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"chickwts"</span>)</span>
<span id="cb84-657"><a href="#cb84-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-658"><a href="#cb84-658" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a random variable</span></span>
<span id="cb84-659"><a href="#cb84-659" aria-hidden="true" tabindex="-1"></a><span class="co"># The variable contains random numbers</span></span>
<span id="cb84-660"><a href="#cb84-660" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">231</span>)</span>
<span id="cb84-661"><a href="#cb84-661" aria-hidden="true" tabindex="-1"></a>chickwts<span class="sc">$</span>random <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(chickwts))</span>
<span id="cb84-662"><a href="#cb84-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-663"><a href="#cb84-663" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with only feed</span></span>
<span id="cb84-664"><a href="#cb84-664" aria-hidden="true" tabindex="-1"></a>model_feed <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> feed, <span class="at">data =</span> chickwts)</span>
<span id="cb84-665"><a href="#cb84-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-666"><a href="#cb84-666" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with dose + random</span></span>
<span id="cb84-667"><a href="#cb84-667" aria-hidden="true" tabindex="-1"></a>model_feed_random <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> feed <span class="sc">+</span> random, <span class="at">data =</span> chickwts)</span>
<span id="cb84-668"><a href="#cb84-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-669"><a href="#cb84-669" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting values using the trained dataset</span></span>
<span id="cb84-670"><a href="#cb84-670" aria-hidden="true" tabindex="-1"></a>predict_feed <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_feed, <span class="at">newdata =</span> chickwts)</span>
<span id="cb84-671"><a href="#cb84-671" aria-hidden="true" tabindex="-1"></a>predict_feed_random <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_feed_random, <span class="at">newdata =</span> chickwts)</span>
<span id="cb84-672"><a href="#cb84-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-673"><a href="#cb84-673" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating error values</span></span>
<span id="cb84-674"><a href="#cb84-674" aria-hidden="true" tabindex="-1"></a>error_feed <span class="ot">&lt;-</span> <span class="fu">with</span>(chickwts, weight <span class="sc">-</span> predict_feed)</span>
<span id="cb84-675"><a href="#cb84-675" aria-hidden="true" tabindex="-1"></a>error_feed_random <span class="ot">&lt;-</span> <span class="fu">with</span>(chickwts, weight <span class="sc">-</span> predict_feed_random)</span>
<span id="cb84-676"><a href="#cb84-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-677"><a href="#cb84-677" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean of the square of the prediction errors (m.s.e)</span></span>
<span id="cb84-678"><a href="#cb84-678" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(error_feed <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb84-679"><a href="#cb84-679" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(error_feed_random <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb84-680"><a href="#cb84-680" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-681"><a href="#cb84-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-682"><a href="#cb84-682" aria-hidden="true" tabindex="-1"></a>Well, quite a surprise, right? The model with the random variable is having a lower error value as compared to the model with the correct explanatory variable. We will see later (not in this article though) why the error value was lower. But for now, keep in mind that when you use the same dataset to do both training and prediction in a model, the model with the additional explanatory variable will have smaller prediction errors than the base model, as seen here. Therefore this mistake can throw off our analysis and gives us a false positive that some of the explanatory variables form a relationship with the response variable when in reality there is no effect.</span>
<span id="cb84-683"><a href="#cb84-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-684"><a href="#cb84-684" aria-hidden="true" tabindex="-1"></a>To mitigate this problem, we use a technique called 'cross-validation'. In this technique, we split the original data into two parts; a training set and a testing set. Both sets will have data points that are chosen at random from the original dataset. We train our model using the training set and then test our model using the testing set and then calculate the m.s.e. value. Thus the explanatory variable values in the testing set will be novel to the model. Let us see how we can do this.</span>
<span id="cb84-685"><a href="#cb84-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-686"><a href="#cb84-686" aria-hidden="true" tabindex="-1"></a>We will be reusing our earlier example of chick weight and feed type. </span>
<span id="cb84-687"><a href="#cb84-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-688"><a href="#cb84-688" aria-hidden="true" tabindex="-1"></a>In the code given below, the <span class="in">`rnorm(nrow(chickwts)) &gt; 0`</span> function will assign TRUE and FALSE values at random to the row values. Looking at this function more closely, the <span class="in">`rnorm()`</span> function will choose random numbers up to the number of rows in the dataset, and since there is an inequality (greater than zero), it will assign TRUE if the random number is greater than zero and vice versa. The row values with TRUE will go to the training set and rows with FALSE will form the testing set.</span>
<span id="cb84-689"><a href="#cb84-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-692"><a href="#cb84-692" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-693"><a href="#cb84-693" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb84-694"><a href="#cb84-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-695"><a href="#cb84-695" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"chickwts"</span>)</span>
<span id="cb84-696"><a href="#cb84-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-697"><a href="#cb84-697" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating training set</span></span>
<span id="cb84-698"><a href="#cb84-698" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">231</span>)</span>
<span id="cb84-699"><a href="#cb84-699" aria-hidden="true" tabindex="-1"></a>chickwts<span class="sc">$</span>training_set <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(chickwts)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb84-700"><a href="#cb84-700" aria-hidden="true" tabindex="-1"></a>chickwts<span class="sc">$</span>random <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(chickwts)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb84-701"><a href="#cb84-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-702"><a href="#cb84-702" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model using the training set</span></span>
<span id="cb84-703"><a href="#cb84-703" aria-hidden="true" tabindex="-1"></a>model_feed <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> feed, <span class="at">data =</span> <span class="fu">subset</span>(chickwts, training_set))</span>
<span id="cb84-704"><a href="#cb84-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-705"><a href="#cb84-705" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model using the training set but with random variable</span></span>
<span id="cb84-706"><a href="#cb84-706" aria-hidden="true" tabindex="-1"></a>model_feed_random <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> feed <span class="sc">+</span> random, <span class="at">data =</span> <span class="fu">subset</span>(chickwts, training_set))</span>
<span id="cb84-707"><a href="#cb84-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-708"><a href="#cb84-708" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting values using the testing set</span></span>
<span id="cb84-709"><a href="#cb84-709" aria-hidden="true" tabindex="-1"></a><span class="co"># !training_set means row values with FALSE value</span></span>
<span id="cb84-710"><a href="#cb84-710" aria-hidden="true" tabindex="-1"></a>predict_feed <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_feed, <span class="at">newdata =</span> <span class="fu">subset</span>(chickwts, <span class="sc">!</span>training_set))</span>
<span id="cb84-711"><a href="#cb84-711" aria-hidden="true" tabindex="-1"></a>predict_feed_random <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_feed_random, <span class="at">newdata =</span> <span class="fu">subset</span>(chickwts, <span class="sc">!</span>training_set))</span>
<span id="cb84-712"><a href="#cb84-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-713"><a href="#cb84-713" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating error values using the testing data</span></span>
<span id="cb84-714"><a href="#cb84-714" aria-hidden="true" tabindex="-1"></a>error_feed <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="fu">subset</span>(chickwts, <span class="sc">!</span>training_set), weight <span class="sc">-</span> predict_feed)</span>
<span id="cb84-715"><a href="#cb84-715" aria-hidden="true" tabindex="-1"></a>error_feed_random <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="fu">subset</span>(chickwts, <span class="sc">!</span>training_set), weight <span class="sc">-</span> predict_feed_random)</span>
<span id="cb84-716"><a href="#cb84-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-717"><a href="#cb84-717" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean of the square of the prediction errors (m.s.e)</span></span>
<span id="cb84-718"><a href="#cb84-718" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(error_feed <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb84-719"><a href="#cb84-719" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(error_feed_random <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb84-720"><a href="#cb84-720" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-721"><a href="#cb84-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-722"><a href="#cb84-722" aria-hidden="true" tabindex="-1"></a>For the seed I have set, using the cross-validation method, we seem to not solve the problem we had earlier. The model with the random variable as the explanatory variable still has a lower error value as compared to the model without the random variable. But this was just an opportunistic case, as the training and testing sets are chosen at random. You might not get the same result as mine if you run this code (provided that the <span class="in">`set.seed()`</span> is changed). We can deal with this randomness by rerunning the calculation many times to get a more consistent measure of the error value.</span>
<span id="cb84-723"><a href="#cb84-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-724"><a href="#cb84-724" aria-hidden="true" tabindex="-1"></a>We will use the <span class="in">`cv_pred_error()`</span> function from the <span class="in">`statisticalModeling`</span> package to rerun the calculations many times. The function automatically makes the training and testing sets using the original dataset and also calculates the m.s.e for each trial. In the code given below, we store the results from the <span class="in">`cv_pred_error()`</span> function into a variable called 'trials'. The variable 'trials' will have two columns in it; <span class="in">`mse`</span> which denotes the mean of the square of the prediction errors (m.s.e) and <span class="in">`model`</span> which denotes the name of the model given as input. Then in the final step, we compare the m.s.e values between the model using a simple t-test.</span>
<span id="cb84-725"><a href="#cb84-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-728"><a href="#cb84-728" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-729"><a href="#cb84-729" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(devtools)) <span class="fu">install.packages</span>(<span class="st">'devtools'</span>)</span>
<span id="cb84-730"><a href="#cb84-730" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(statisticalModeling)) devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"dtkaplan/statisticalModeling"</span>)</span>
<span id="cb84-731"><a href="#cb84-731" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb84-732"><a href="#cb84-732" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb84-733"><a href="#cb84-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-734"><a href="#cb84-734" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"chickwts"</span>)</span>
<span id="cb84-735"><a href="#cb84-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-736"><a href="#cb84-736" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a random variable</span></span>
<span id="cb84-737"><a href="#cb84-737" aria-hidden="true" tabindex="-1"></a><span class="co"># The variable contains random numbers</span></span>
<span id="cb84-738"><a href="#cb84-738" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">231</span>)</span>
<span id="cb84-739"><a href="#cb84-739" aria-hidden="true" tabindex="-1"></a>chickwts<span class="sc">$</span>random <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(chickwts)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb84-740"><a href="#cb84-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-741"><a href="#cb84-741" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with only feed</span></span>
<span id="cb84-742"><a href="#cb84-742" aria-hidden="true" tabindex="-1"></a>model_feed <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> feed, <span class="at">data =</span> chickwts)</span>
<span id="cb84-743"><a href="#cb84-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-744"><a href="#cb84-744" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with dose + random</span></span>
<span id="cb84-745"><a href="#cb84-745" aria-hidden="true" tabindex="-1"></a>model_feed_random <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> feed <span class="sc">+</span> random, <span class="at">data =</span> chickwts)</span>
<span id="cb84-746"><a href="#cb84-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-747"><a href="#cb84-747" aria-hidden="true" tabindex="-1"></a><span class="co"># Rerunning the models (100 times for each model)</span></span>
<span id="cb84-748"><a href="#cb84-748" aria-hidden="true" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="fu">cv_pred_error</span>(model_feed, model_feed_random, <span class="at">ntrials =</span> <span class="dv">100</span>)</span>
<span id="cb84-749"><a href="#cb84-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-750"><a href="#cb84-750" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the two sets of cross-validated errors</span></span>
<span id="cb84-751"><a href="#cb84-751" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(mse <span class="sc">~</span> model, <span class="at">data =</span> trials)</span>
<span id="cb84-752"><a href="#cb84-752" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-753"><a href="#cb84-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-754"><a href="#cb84-754" aria-hidden="true" tabindex="-1"></a>For $\alpha = 0.05$ level of significance, we have a p-value &lt; 0.05, which means that the mean error values between the models are not the same and are different from each other. From the t-test summary, we can see that the mean error value of the model without the random variable is lower than the model with the random variable (3309.232 &lt; 3398.079). Therefore we can conclude that the addition of the random variable does not improve the model.</span>
<span id="cb84-755"><a href="#cb84-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-756"><a href="#cb84-756" aria-hidden="true" tabindex="-1"></a>Therefore through the cross-validation technique iterated over many times, in conjunction with the m.s.e values, we can identify which of the variables in our data should be considered as the explanatory variables.</span>
<span id="cb84-757"><a href="#cb84-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-758"><a href="#cb84-758" aria-hidden="true" tabindex="-1"></a><span class="fu">### Prediction error for categorical response variable</span></span>
<span id="cb84-759"><a href="#cb84-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-760"><a href="#cb84-760" aria-hidden="true" tabindex="-1"></a>So far when we were calculating the predictive error values, the response variable we had was numerical. But what if our response variable was a categorical value, then how will we compare models using the predictive error values?</span>
<span id="cb84-761"><a href="#cb84-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-762"><a href="#cb84-762" aria-hidden="true" tabindex="-1"></a>Let us go back to the <span class="in">`run17`</span> dataset from the <span class="in">`{cherryblossom}`</span> package in R. In this dataset, we looked at whether the participants' choice of event was influenced by their age and sex. We hypothesised that the older participants of both sexes will prefer the 5 Km run as compared to the 10 Mile marathon. In the earlier example, we have used the logistic model, but here let us use the recursive partitioning model made using the <span class="in">`rpart()`</span> function in the <span class="in">`{rpart}`</span> package in R. We had learned briefly that the recursive partitioning model is appropriate when the response variable is categorical, which is the case here.</span>
<span id="cb84-763"><a href="#cb84-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-764"><a href="#cb84-764" aria-hidden="true" tabindex="-1"></a>Like earlier, we will use <span class="in">`event`</span> as the response variable and <span class="in">`sex`</span> and <span class="in">`age`</span> as the explanatory variable. The hypothesis remains the same, irrespective of sex, older participants will prefer the 5 Km run as compared to the 10 Mile marathon. We will build two models, one with only <span class="in">`age`</span> as the explanatory variable and the other with both <span class="in">`age`</span> and <span class="in">`sex`</span> as the explanatory variables. </span>
<span id="cb84-765"><a href="#cb84-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-766"><a href="#cb84-766" aria-hidden="true" tabindex="-1"></a>While predicting for values, we use <span class="in">`type = "class"`</span> so that the model gives prediction values, which are either "10 Mile" or "5 Km" (gives prediction values as categorical values).</span>
<span id="cb84-767"><a href="#cb84-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-768"><a href="#cb84-768" aria-hidden="true" tabindex="-1"></a>Then we will evaluate these two models by comparing the m.s.e values. This will tell us whether adding the variable <span class="in">`sex`</span> improves the model or not.</span>
<span id="cb84-769"><a href="#cb84-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-772"><a href="#cb84-772" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-773"><a href="#cb84-773" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb84-774"><a href="#cb84-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-775"><a href="#cb84-775" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb84-776"><a href="#cb84-776" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb84-777"><a href="#cb84-777" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb84-778"><a href="#cb84-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-779"><a href="#cb84-779" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating training set</span></span>
<span id="cb84-780"><a href="#cb84-780" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb84-781"><a href="#cb84-781" aria-hidden="true" tabindex="-1"></a>run17<span class="sc">$</span>training_set <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(run17)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb84-782"><a href="#cb84-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-783"><a href="#cb84-783" aria-hidden="true" tabindex="-1"></a><span class="co"># Training the model with the training set</span></span>
<span id="cb84-784"><a href="#cb84-784" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the recursive partitioning model with just age</span></span>
<span id="cb84-785"><a href="#cb84-785" aria-hidden="true" tabindex="-1"></a>model_rpart_age <span class="ot">&lt;-</span> <span class="fu">rpart</span>(event <span class="sc">~</span> age, <span class="at">data =</span> <span class="fu">subset</span>(run17, training_set))</span>
<span id="cb84-786"><a href="#cb84-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-787"><a href="#cb84-787" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the recursive partitioning model with age + sex</span></span>
<span id="cb84-788"><a href="#cb84-788" aria-hidden="true" tabindex="-1"></a>model_rpart_age_sex <span class="ot">&lt;-</span> <span class="fu">rpart</span>(event <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> <span class="fu">subset</span>(run17, training_set))</span>
<span id="cb84-789"><a href="#cb84-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-790"><a href="#cb84-790" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting values using the testing set</span></span>
<span id="cb84-791"><a href="#cb84-791" aria-hidden="true" tabindex="-1"></a>predict_age <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_rpart_age,</span>
<span id="cb84-792"><a href="#cb84-792" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb84-793"><a href="#cb84-793" aria-hidden="true" tabindex="-1"></a>predict_age_sex <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_rpart_age_sex,</span>
<span id="cb84-794"><a href="#cb84-794" aria-hidden="true" tabindex="-1"></a>                           <span class="at">newdata =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb84-795"><a href="#cb84-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-796"><a href="#cb84-796" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing a few row values</span></span>
<span id="cb84-797"><a href="#cb84-797" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predict_age)</span>
<span id="cb84-798"><a href="#cb84-798" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predict_age_sex)</span>
<span id="cb84-799"><a href="#cb84-799" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(run17<span class="sc">$</span>event)</span>
<span id="cb84-800"><a href="#cb84-800" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-801"><a href="#cb84-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-802"><a href="#cb84-802" aria-hidden="true" tabindex="-1"></a>In the first 6 row values of the output, both models seem to agree with the values from the original dataset. But our dataset has 199961 rows of data. It would be crazy to even think that one can compare each of the row values between the models instead, we will try to quantify the error. In earlier cases, we could subtract the predicted values from the response variable values in the dataset to get the error value. But that is not possible here as the response variable is categorical. </span>
<span id="cb84-803"><a href="#cb84-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-804"><a href="#cb84-804" aria-hidden="true" tabindex="-1"></a>One way to calculate the error values of these models is to see how many mistakes the model made. This can be calculated by checking how many times the predicted value by the model was not equal to the value in the dataset.</span>
<span id="cb84-805"><a href="#cb84-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-808"><a href="#cb84-808" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-809"><a href="#cb84-809" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the sum of errors using the testing data</span></span>
<span id="cb84-810"><a href="#cb84-810" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), <span class="fu">sum</span>(predict_age <span class="sc">!=</span> event))</span>
<span id="cb84-811"><a href="#cb84-811" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), <span class="fu">sum</span>(predict_age_sex <span class="sc">!=</span> event))</span>
<span id="cb84-812"><a href="#cb84-812" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-813"><a href="#cb84-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-814"><a href="#cb84-814" aria-hidden="true" tabindex="-1"></a>The number of errors each model made is the same. Before we conclude anything let us try to see some more ways to quantify the error.</span>
<span id="cb84-815"><a href="#cb84-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-816"><a href="#cb84-816" aria-hidden="true" tabindex="-1"></a>Instead of sum, we can calculate the mean rate of errors also.</span>
<span id="cb84-817"><a href="#cb84-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-820"><a href="#cb84-820" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-821"><a href="#cb84-821" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the mean of errors using the testing data</span></span>
<span id="cb84-822"><a href="#cb84-822" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), <span class="fu">mean</span>(predict_age <span class="sc">!=</span> event))</span>
<span id="cb84-823"><a href="#cb84-823" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), <span class="fu">mean</span>(predict_age_sex <span class="sc">!=</span> event))</span>
<span id="cb84-824"><a href="#cb84-824" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-825"><a href="#cb84-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-826"><a href="#cb84-826" aria-hidden="true" tabindex="-1"></a>Mean error values are the same (no surprises here).</span>
<span id="cb84-827"><a href="#cb84-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-828"><a href="#cb84-828" aria-hidden="true" tabindex="-1"></a>Let us go one step further. Till now our model predicted a deterministic value to the response variable. It can either be 10 Mile marathon or a 5 km run. Instead of this, we can use the model to predict the probability values to the categorical values present in the response variable. This means, our model will predict how likely a certain participant of a particular age and sex will choose between a 10 Mile marathon and a 5 Km run. To predict probability values, instead of <span class="in">`type = "class"`</span>, we will use <span class="in">`type = "prob"`</span> within the <span class="in">`predict()`</span> function.</span>
<span id="cb84-829"><a href="#cb84-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-832"><a href="#cb84-832" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-833"><a href="#cb84-833" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb84-834"><a href="#cb84-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-835"><a href="#cb84-835" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting probability values using the testing set</span></span>
<span id="cb84-836"><a href="#cb84-836" aria-hidden="true" tabindex="-1"></a>predict_age_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_rpart_age,</span>
<span id="cb84-837"><a href="#cb84-837" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb84-838"><a href="#cb84-838" aria-hidden="true" tabindex="-1"></a>predict_age_sex_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_rpart_age_sex,</span>
<span id="cb84-839"><a href="#cb84-839" aria-hidden="true" tabindex="-1"></a>                           <span class="at">newdata =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb84-840"><a href="#cb84-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-841"><a href="#cb84-841" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparing the predicted value to the actual value in the dataset</span></span>
<span id="cb84-842"><a href="#cb84-842" aria-hidden="true" tabindex="-1"></a>testing_data <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">select</span>(training_set, event) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(training_set <span class="sc">==</span> F)</span>
<span id="cb84-843"><a href="#cb84-843" aria-hidden="true" tabindex="-1"></a>compare_values <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(testing_data, predict_age_prob, predict_age_sex_prob)</span>
<span id="cb84-844"><a href="#cb84-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-845"><a href="#cb84-845" aria-hidden="true" tabindex="-1"></a><span class="co"># Changing the column names for making sense of the column values</span></span>
<span id="cb84-846"><a href="#cb84-846" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(compare_values)[<span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Ten_Mile_age"</span>, <span class="st">"Five_km_age"</span>, <span class="st">"Ten_Mile_age_sex"</span>, <span class="st">"Five_km_age_sex"</span>)</span>
<span id="cb84-847"><a href="#cb84-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-848"><a href="#cb84-848" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing a few row values</span></span>
<span id="cb84-849"><a href="#cb84-849" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(compare_values)</span>
<span id="cb84-850"><a href="#cb84-850" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-851"><a href="#cb84-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-852"><a href="#cb84-852" aria-hidden="true" tabindex="-1"></a>The columns <span class="in">`Ten_Mile_age`</span> and <span class="in">`Five_km_age`</span> corresponds to probability values from the <span class="in">`model_rpart_age`</span> model with just 'age' as the explanatory variable. The last two columns <span class="in">`Ten_Mile_age_sex`</span> and <span class="in">`Five_km_age_sex`</span> are from the <span class="in">`model_rpart_age_sex`</span> model with both 'age' and 'sex' as the explanatory variables. The first-row value in the <span class="in">`10Mile_age`</span> column indicates that the model predicts a nearly 88% chance for that particular participant to be choosing the 10 Mile marathon. And with no surprise, you can see that the probability values across the models are the same (because we found that the error values are the same earlier). </span>
<span id="cb84-853"><a href="#cb84-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-854"><a href="#cb84-854" aria-hidden="true" tabindex="-1"></a>We can condense these probability values to a single value which is called the 'likelihood value', which can then be used as a figure of merit to compare the models. This is similar to the mean of the square of the prediction errors (m.s.e) we had when the response variable was numerical. The likelihood values are calculated by multiplying the individual probability values. But since the probability values are in decimal values and are less than 1, multiplying them will lead to a very small value which would be difficult to compare. Therefore we first log transform our probability values and add them, which is mathematically equivalent to multiplying them before the log transformation</span>
<span id="cb84-855"><a href="#cb84-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-856"><a href="#cb84-856" aria-hidden="true" tabindex="-1"></a>Since the dataset is not 'tidy', some codes are used to tidy it. The "10 Mile" has a space in-between. While doing analysis, R might register "10 Mile" as "10" and "Mile". So this needs to be reformatted.</span>
<span id="cb84-857"><a href="#cb84-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-860"><a href="#cb84-860" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-861"><a href="#cb84-861" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data frame into two other data frames</span></span>
<span id="cb84-862"><a href="#cb84-862" aria-hidden="true" tabindex="-1"></a><span class="co"># Newly made data frames have values corresponding to the respective model</span></span>
<span id="cb84-863"><a href="#cb84-863" aria-hidden="true" tabindex="-1"></a>compare_values_age <span class="ot">&lt;-</span> compare_values[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb84-864"><a href="#cb84-864" aria-hidden="true" tabindex="-1"></a>compare_values_age_sex <span class="ot">&lt;-</span> compare_values[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>)]</span>
<span id="cb84-865"><a href="#cb84-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-866"><a href="#cb84-866" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidying the data</span></span>
<span id="cb84-867"><a href="#cb84-867" aria-hidden="true" tabindex="-1"></a>compare_values_age<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">recode</span>(compare_values_age<span class="sc">$</span>event,</span>
<span id="cb84-868"><a href="#cb84-868" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"10 Mile"</span> <span class="ot">=</span> <span class="st">"Ten_Mile"</span>, <span class="st">"5K"</span> <span class="ot">=</span> <span class="st">"Five_km"</span>)</span>
<span id="cb84-869"><a href="#cb84-869" aria-hidden="true" tabindex="-1"></a>compare_values_age_sex<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">recode</span>(compare_values_age_sex<span class="sc">$</span>event,</span>
<span id="cb84-870"><a href="#cb84-870" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"10 Mile"</span> <span class="ot">=</span> <span class="st">"Ten_Mile"</span>, <span class="st">"5K"</span> <span class="ot">=</span> <span class="st">"Five_km"</span>)</span>
<span id="cb84-871"><a href="#cb84-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-872"><a href="#cb84-872" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the likelihood values</span></span>
<span id="cb84-873"><a href="#cb84-873" aria-hidden="true" tabindex="-1"></a><span class="co"># Ten_Mile_age and Five_km_age are column names</span></span>
<span id="cb84-874"><a href="#cb84-874" aria-hidden="true" tabindex="-1"></a>likelihood_age <span class="ot">&lt;-</span> <span class="fu">with</span>(compare_values_age,</span>
<span id="cb84-875"><a href="#cb84-875" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(event <span class="sc">==</span> <span class="st">"Ten_Mile"</span>, Ten_Mile_age, Five_km_age))</span>
<span id="cb84-876"><a href="#cb84-876" aria-hidden="true" tabindex="-1"></a>likelihood_age_sex <span class="ot">&lt;-</span> <span class="fu">with</span>(compare_values_age_sex,</span>
<span id="cb84-877"><a href="#cb84-877" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">ifelse</span>(event <span class="sc">==</span> <span class="st">"Ten_Mile"</span>, Ten_Mile_age_sex, Five_km_age_sex))</span>
<span id="cb84-878"><a href="#cb84-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-879"><a href="#cb84-879" aria-hidden="true" tabindex="-1"></a><span class="co"># Likelihood value of model with age</span></span>
<span id="cb84-880"><a href="#cb84-880" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">log</span>(likelihood_age)) </span>
<span id="cb84-881"><a href="#cb84-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-882"><a href="#cb84-882" aria-hidden="true" tabindex="-1"></a><span class="co"># Likelihood value of model with age + sex</span></span>
<span id="cb84-883"><a href="#cb84-883" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">log</span>(likelihood_age_sex)) </span>
<span id="cb84-884"><a href="#cb84-884" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-885"><a href="#cb84-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-886"><a href="#cb84-886" aria-hidden="true" tabindex="-1"></a>As the likelihood values are one and the same we can conclude that the variable 'sex' does not improve the model.</span>
<span id="cb84-887"><a href="#cb84-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-888"><a href="#cb84-888" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating a null model</span></span>
<span id="cb84-889"><a href="#cb84-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-890"><a href="#cb84-890" aria-hidden="true" tabindex="-1"></a>The null model gives the best estimate of our data when there are no explanatory variables modelled to it. The predicted value from the null model will always be a constant, no matter what testing data is provided. Let us see how to make a null model.</span>
<span id="cb84-891"><a href="#cb84-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-892"><a href="#cb84-892" aria-hidden="true" tabindex="-1"></a>We will again use the <span class="in">`run17`</span> dataset from the <span class="in">`{cherryblossom}`</span> package in R. To this dataset we add a new column which contains a constant value. We will make a model where <span class="in">`net_sec`</span> is the response variable and the <span class="in">`constant`</span> variable is the explanatory variable. We will use the recursive partitioning architecture to model the data.</span>
<span id="cb84-893"><a href="#cb84-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-896"><a href="#cb84-896" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-897"><a href="#cb84-897" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb84-898"><a href="#cb84-898" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb84-899"><a href="#cb84-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-900"><a href="#cb84-900" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a constant variable</span></span>
<span id="cb84-901"><a href="#cb84-901" aria-hidden="true" tabindex="-1"></a>run17<span class="sc">$</span>constant <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb84-902"><a href="#cb84-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-903"><a href="#cb84-903" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a null model</span></span>
<span id="cb84-904"><a href="#cb84-904" aria-hidden="true" tabindex="-1"></a>null_model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(net_sec <span class="sc">~</span> constant, <span class="at">data =</span> run17)</span>
<span id="cb84-905"><a href="#cb84-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-906"><a href="#cb84-906" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting values</span></span>
<span id="cb84-907"><a href="#cb84-907" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice how all the values are the same</span></span>
<span id="cb84-908"><a href="#cb84-908" aria-hidden="true" tabindex="-1"></a>predict_null <span class="ot">&lt;-</span> <span class="fu">predict</span>(null_model, <span class="at">newdata =</span> run17)</span>
<span id="cb84-909"><a href="#cb84-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-910"><a href="#cb84-910" aria-hidden="true" tabindex="-1"></a><span class="co"># Prinitng a few predicted values</span></span>
<span id="cb84-911"><a href="#cb84-911" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice how all the predicted values are the same</span></span>
<span id="cb84-912"><a href="#cb84-912" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predict_null)</span>
<span id="cb84-913"><a href="#cb84-913" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-914"><a href="#cb84-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-915"><a href="#cb84-915" aria-hidden="true" tabindex="-1"></a>We can calculate the mean of the square of the prediction errors of the null model. The null model essentially acts as a base of our model analysis, where we can compare the errors in the null model to the model of our interest.</span>
<span id="cb84-916"><a href="#cb84-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-919"><a href="#cb84-919" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-920"><a href="#cb84-920" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb84-921"><a href="#cb84-921" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb84-922"><a href="#cb84-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-923"><a href="#cb84-923" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a constant variable</span></span>
<span id="cb84-924"><a href="#cb84-924" aria-hidden="true" tabindex="-1"></a>run17<span class="sc">$</span>constant <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb84-925"><a href="#cb84-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-926"><a href="#cb84-926" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating training set</span></span>
<span id="cb84-927"><a href="#cb84-927" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb84-928"><a href="#cb84-928" aria-hidden="true" tabindex="-1"></a>run17<span class="sc">$</span>training_set <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(run17)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb84-929"><a href="#cb84-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-930"><a href="#cb84-930" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a null model using the training set</span></span>
<span id="cb84-931"><a href="#cb84-931" aria-hidden="true" tabindex="-1"></a>null_model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(net_sec <span class="sc">~</span> constant, <span class="at">data =</span> <span class="fu">subset</span>(run17, training_set))</span>
<span id="cb84-932"><a href="#cb84-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-933"><a href="#cb84-933" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting values using the testing set</span></span>
<span id="cb84-934"><a href="#cb84-934" aria-hidden="true" tabindex="-1"></a>predict_null <span class="ot">&lt;-</span> <span class="fu">predict</span>(null_model,</span>
<span id="cb84-935"><a href="#cb84-935" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> <span class="fu">subset</span>(run17, <span class="sc">!</span>training_set))</span>
<span id="cb84-936"><a href="#cb84-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-937"><a href="#cb84-937" aria-hidden="true" tabindex="-1"></a><span class="co"># Prinitng a few predicted values</span></span>
<span id="cb84-938"><a href="#cb84-938" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predict_null)</span>
<span id="cb84-939"><a href="#cb84-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-940"><a href="#cb84-940" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating error values using testing set</span></span>
<span id="cb84-941"><a href="#cb84-941" aria-hidden="true" tabindex="-1"></a>error_null <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="fu">subset</span>(run17, <span class="sc">!</span>training_set), net_sec <span class="sc">-</span> predict_null)</span>
<span id="cb84-942"><a href="#cb84-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-943"><a href="#cb84-943" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean of the square of the prediction errors (m.s.e)</span></span>
<span id="cb84-944"><a href="#cb84-944" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(error_null <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb84-945"><a href="#cb84-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-946"><a href="#cb84-946" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating m.s.e by iterating the model 100 times</span></span>
<span id="cb84-947"><a href="#cb84-947" aria-hidden="true" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="fu">cv_pred_error</span>(null_model)</span>
<span id="cb84-948"><a href="#cb84-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-949"><a href="#cb84-949" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing m.s.e values for each iteration</span></span>
<span id="cb84-950"><a href="#cb84-950" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(trials<span class="sc">$</span>mse)</span>
<span id="cb84-951"><a href="#cb84-951" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-952"><a href="#cb84-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-953"><a href="#cb84-953" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exploratory modelling</span></span>
<span id="cb84-954"><a href="#cb84-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-955"><a href="#cb84-955" aria-hidden="true" tabindex="-1"></a>Till now, we had a clear idea of the selection of the explanatory variables while making a model. But sometimes, you might just want to explore your dataset and see which variables affect your response variable without prior knowledge of it. Therefore, we can do exploratory modelling where we take a whole bunch of explanatory variables and see if any of them explain the changes seen in the response variable.</span>
<span id="cb84-956"><a href="#cb84-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-957"><a href="#cb84-957" aria-hidden="true" tabindex="-1"></a>For this exercise, we will be using the <span class="in">`NHANES`</span> dataset from the <span class="in">`{NHANES}`</span> package in R. The dataset is a survey data collected by the US National Centre for Health Statistics (NCHS).  A total of 75 variables concerning health are collected as data from around 7800 individuals in the US.</span>
<span id="cb84-958"><a href="#cb84-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-959"><a href="#cb84-959" aria-hidden="true" tabindex="-1"></a><span class="fu">### Evaluating a recursive partitioning model</span></span>
<span id="cb84-960"><a href="#cb84-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-961"><a href="#cb84-961" aria-hidden="true" tabindex="-1"></a>For our exploratory modelling, we will be using the recursive partitioning architecture. Using the dataset we will see what variables are related to depression. </span>
<span id="cb84-962"><a href="#cb84-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-963"><a href="#cb84-963" aria-hidden="true" tabindex="-1"></a>We will use the formula <span class="in">`Depressed ~ .`</span> </span>
<span id="cb84-964"><a href="#cb84-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-965"><a href="#cb84-965" aria-hidden="true" tabindex="-1"></a>The single period on the right side of the Tilda indicates that we want to model using all the possible variables in the dataset. Finally, we will plot the model as a 'tree' using the <span class="in">`rpart.plot()`</span> function from the <span class="in">`{rpart.plot}`</span> package in R.</span>
<span id="cb84-966"><a href="#cb84-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-969"><a href="#cb84-969" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-970"><a href="#cb84-970" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb84-971"><a href="#cb84-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-972"><a href="#cb84-972" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(NHANES)) <span class="fu">install.packages</span>(<span class="st">'NHANES'</span>)</span>
<span id="cb84-973"><a href="#cb84-973" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(rpart.plot)) <span class="fu">install.packages</span>(<span class="st">'rpart.plot'</span>)</span>
<span id="cb84-974"><a href="#cb84-974" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb84-975"><a href="#cb84-975" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb84-976"><a href="#cb84-976" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb84-977"><a href="#cb84-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-978"><a href="#cb84-978" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the recursive partitioning model</span></span>
<span id="cb84-979"><a href="#cb84-979" aria-hidden="true" tabindex="-1"></a>model_rpart <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Depressed <span class="sc">~</span> . , <span class="at">data =</span> NHANES)</span>
<span id="cb84-980"><a href="#cb84-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-981"><a href="#cb84-981" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model with sample sizes</span></span>
<span id="cb84-982"><a href="#cb84-982" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(model_rpart, <span class="at">extra =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="dv">4</span>)</span>
<span id="cb84-983"><a href="#cb84-983" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-984"><a href="#cb84-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-985"><a href="#cb84-985" aria-hidden="true" tabindex="-1"></a>We got this nice-looking tree plot with lots of information. Let's see how to interpret them.</span>
<span id="cb84-986"><a href="#cb84-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-987"><a href="#cb84-987" aria-hidden="true" tabindex="-1"></a>The response variable that we used was the <span class="in">`Depressed`</span> variable in the dataset. This variable has three levels.</span>
<span id="cb84-988"><a href="#cb84-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-991"><a href="#cb84-991" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-992"><a href="#cb84-992" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(NHANES<span class="sc">$</span>Depressed)</span>
<span id="cb84-993"><a href="#cb84-993" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-994"><a href="#cb84-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-995"><a href="#cb84-995" aria-hidden="true" tabindex="-1"></a>The meaning of each of these levels is; "None" = No sign of depression, "Several" = Individual was depressed for less than half of the survey period days, "Most" = Individual was depressed more than half of the days.</span>
<span id="cb84-996"><a href="#cb84-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-997"><a href="#cb84-997" aria-hidden="true" tabindex="-1"></a>The colour code in the plot corresponds to the levels of the response variable. In the beginning node of the tree plot, you can see the label "None" with three sets of numbers. The numbers correspond to the respective sample numbers of the levels, i.e. at this node, 5246 individuals belong to "None", 1009 individuals belong to "Several" and 418 individuals belong to "Most". Therefore we have data for a total of 6673  individuals (5256 + 1009 + 418 = 6673). Also, in this node, the majority of individuals belong to the level "None". Therefore the node is coloured by the respective colour code for "None", which is orange colour here. You can also see that the node colour changes its brightness to correspond to the difference between the majority value and the other values.</span>
<span id="cb84-998"><a href="#cb84-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-999"><a href="#cb84-999" aria-hidden="true" tabindex="-1"></a>Working with numbers can be tricky, so let us represent the sample sizes in percentiles for easy comparisons.</span>
<span id="cb84-1000"><a href="#cb84-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1003"><a href="#cb84-1003" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-1004"><a href="#cb84-1004" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model with percentile values</span></span>
<span id="cb84-1005"><a href="#cb84-1005" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(model_rpart, <span class="at">extra =</span> <span class="st">"auto"</span>, <span class="at">type =</span> <span class="dv">4</span>)</span>
<span id="cb84-1006"><a href="#cb84-1006" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-1007"><a href="#cb84-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1008"><a href="#cb84-1008" aria-hidden="true" tabindex="-1"></a>Now instead of the actual sample sizes, we have percentile values. Now let us look at the plot. The beginning node which contains the whole set of depressed individuals in the dataset is further split into two groups and this split is caused by the variable <span class="in">`LittleInterest`</span>. The variable <span class="in">`LittleInterest`</span> in the dataset denotes the self-reported number of days where the participant had little interest in doing things. And like the <span class="in">`Depressed`</span> variable, we have three levels for the variable <span class="in">`LittleInterest`</span>.</span>
<span id="cb84-1009"><a href="#cb84-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1012"><a href="#cb84-1012" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-1013"><a href="#cb84-1013" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(NHANES<span class="sc">$</span>LittleInterest)</span>
<span id="cb84-1014"><a href="#cb84-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-1015"><a href="#cb84-1015" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb84-1016"><a href="#cb84-1016" aria-hidden="true" tabindex="-1"></a>The meaning of these levels is the same as explained for the <span class="in">`Depressed`</span> variable.</span>
<span id="cb84-1017"><a href="#cb84-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1018"><a href="#cb84-1018" aria-hidden="true" tabindex="-1"></a>The first group contains 77% of the total depressed individuals and they recorded zero days where they had reduced interest to do things. The rest of the 23% individuals belong to the second group which showed a severe reduction or most severe reduction in interest in doing things. This second group is further split into two by the variable <span class="in">`DaysMentHlthBad`</span> which denotes the self-reported number of days the participant’s mental health was not good out of the past 30 days. Here, 13% of people in the second group with 23% of the total set had bad mental days less than 6. The remaining 11% of people (13% + 11% = ~ 23% of the second group) had bad mental days for more than 6 days, which further splits into two by their categories in the <span class="in">`LittleInterest`</span> variable. There is no splitting of the group after this. This is because the recursive partitioning architecture stops at a point where further subdivisions don't lead to a big change in predictive ability.</span>
<span id="cb84-1019"><a href="#cb84-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1020"><a href="#cb84-1020" aria-hidden="true" tabindex="-1"></a>So as a summary, by this exploratory modelling exercise, we were able to determine potential variables that could act as the explanatory variables for a given response variable that we are interested in. Overall this led us to understand the relationships between the variables in the dataset that otherwise would not have been possible with a simple linear model. But also keep in mind that these potential variables are not indicating a cause and effect, but rather a simple relationship.</span>
<span id="cb84-1021"><a href="#cb84-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1022"><a href="#cb84-1022" aria-hidden="true" tabindex="-1"></a><span class="fu">## Covariate</span></span>
<span id="cb84-1023"><a href="#cb84-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1024"><a href="#cb84-1024" aria-hidden="true" tabindex="-1"></a>We briefly learned what are covariates when we were looking at the <span class="in">`run17`</span> dataset from the <span class="in">`{cherryblossom}`</span> package in R. In that exercise, we looked at whether the participant’s choice in choosing between the events is affected by their age and sex. We hypothesized that older participants of both sexes would prefer a 5 km run over the 10 Mile marathon. Therefore we considered <span class="in">`age`</span> as the main explanatory variable and <span class="in">`sex`</span> as a covariate.</span>
<span id="cb84-1025"><a href="#cb84-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1026"><a href="#cb84-1026" aria-hidden="true" tabindex="-1"></a>Covariates are those variables which are of no immediate interest to the user but hold the potential to explain changes seen in the response variable. There is no special distinction between a covariate and an explanatory variable in the formula syntax of the function R code. It's just a mental label given by the user.</span>
<span id="cb84-1027"><a href="#cb84-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1028"><a href="#cb84-1028" aria-hidden="true" tabindex="-1"></a>Let us use the <span class="in">`Tadpoles`</span> dataset from the <span class="in">`{mosaicModel}`</span> package in R. The dataset contains the swimming speed of tadpoles as a function of the water temperature and the water temperature at which the tadpoles had been raised. Since size is a major determinant of speed, the tadpole’s length was measured as well. It was hypothesized that tadpoles would swim faster in the temperature of water close to that in which they had been raised.</span>
<span id="cb84-1029"><a href="#cb84-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1030"><a href="#cb84-1030" aria-hidden="true" tabindex="-1"></a>As an exercise, let us see if the maximum swimming speed achieved by the tadpole is affected by the temperature at which they were raised. In addition, let also add the size of the tadpole as a covariate, as size could also affect the swimming speeds. The variable <span class="in">`vmax`</span> denotes the maximum swimming speed (mm/sec) and therefore will be our response variable. The variable <span class="in">`group`</span> denotes whether the tadpoles were raised in a cold environment ("c") or warm environment ("w") and <span class="in">`length`</span> denotes the length of the tadpole (mm). Here both <span class="in">`group`</span> and <span class="in">`length`</span> will be our explanatory variables where <span class="in">`length`</span> is also our covariate.</span>
<span id="cb84-1031"><a href="#cb84-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1032"><a href="#cb84-1032" aria-hidden="true" tabindex="-1"></a>While predicting values using the model, we can keep the covariate unchanged or constant, and predict different values for the other variable.</span>
<span id="cb84-1033"><a href="#cb84-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1036"><a href="#cb84-1036" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-1037"><a href="#cb84-1037" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(mosaicModel)) <span class="fu">install.packages</span>(<span class="st">'mosaicModel'</span>)</span>
<span id="cb84-1038"><a href="#cb84-1038" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicModel)</span>
<span id="cb84-1039"><a href="#cb84-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1040"><a href="#cb84-1040" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Tadpoles)</span>
<span id="cb84-1041"><a href="#cb84-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1042"><a href="#cb84-1042" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb84-1043"><a href="#cb84-1043" aria-hidden="true" tabindex="-1"></a>model_vmax <span class="ot">&lt;-</span> <span class="fu">lm</span>(vmax <span class="sc">~</span> group <span class="sc">+</span> length, <span class="at">data =</span> Tadpoles)</span>
<span id="cb84-1044"><a href="#cb84-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1045"><a href="#cb84-1045" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting for vmax</span></span>
<span id="cb84-1046"><a href="#cb84-1046" aria-hidden="true" tabindex="-1"></a>predict_vmax <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_vmax, <span class="at">newdata =</span> Tadpoles)</span>
<span id="cb84-1047"><a href="#cb84-1047" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predict_vmax)</span>
<span id="cb84-1048"><a href="#cb84-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1049"><a href="#cb84-1049" aria-hidden="true" tabindex="-1"></a><span class="co"># Keeping length constant, predicting for vmax</span></span>
<span id="cb84-1050"><a href="#cb84-1050" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model_vmax, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">group =</span> <span class="st">"c"</span> ,<span class="at">length =</span> <span class="dv">5</span>))</span>
<span id="cb84-1051"><a href="#cb84-1051" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model_vmax, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">group =</span> <span class="st">"w"</span> ,<span class="at">length =</span> <span class="dv">5</span>))</span>
<span id="cb84-1052"><a href="#cb84-1052" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-1053"><a href="#cb84-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1054"><a href="#cb84-1054" aria-hidden="true" tabindex="-1"></a>So while keeping length constant, our model predicts change in swimming speeds between cold and warm environments the tadpoles were raised in.</span>
<span id="cb84-1055"><a href="#cb84-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1056"><a href="#cb84-1056" aria-hidden="true" tabindex="-1"></a><span class="fu">## Effect sizes</span></span>
<span id="cb84-1057"><a href="#cb84-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1058"><a href="#cb84-1058" aria-hidden="true" tabindex="-1"></a>Effect sizes are a great way to estimate the change in the output value, given the change in the input. Thus they are a great tool to analyse covariates in the model.</span>
<span id="cb84-1059"><a href="#cb84-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1060"><a href="#cb84-1060" aria-hidden="true" tabindex="-1"></a>While calculating the effect size, the units of it depend on both the response variable and the explanatory variable for which the effect size is measured.</span>
<span id="cb84-1061"><a href="#cb84-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1062"><a href="#cb84-1062" aria-hidden="true" tabindex="-1"></a>If we have a response variable called 'salary' (Dollars) and we have a numerical explanatory variable called the 'years of education' (years), then the effect size of 'years of education on the 'salary' would be in the units of dollars/year. Suppose we get an effect size of 100 dollars/year, this means that for every unit increase in years of education, the salary will increase by 100 dollars. </span>
<span id="cb84-1063"><a href="#cb84-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1064"><a href="#cb84-1064" aria-hidden="true" tabindex="-1"></a>Here the effect size is calculated as a rate of change and its unit will be;</span>
<span id="cb84-1065"><a href="#cb84-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1066"><a href="#cb84-1066" aria-hidden="true" tabindex="-1"></a><span class="in">```{=tex}</span></span>
<span id="cb84-1067"><a href="#cb84-1067" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align*}</span></span>
<span id="cb84-1068"><a href="#cb84-1068" aria-hidden="true" tabindex="-1"></a><span class="in">Unit\,of\,effect\,size = \frac{Unit\,of\,response\,variable}{Unit\,of\,explaratory\,variable}</span></span>
<span id="cb84-1069"><a href="#cb84-1069" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align*}</span></span>
<span id="cb84-1070"><a href="#cb84-1070" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-1071"><a href="#cb84-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1072"><a href="#cb84-1072" aria-hidden="true" tabindex="-1"></a>But if our explanatory variable is categorical, then the effect size is calculated as a difference. As categorical values have no units, the units of effect sizes here would be the same as that of the response variable. </span>
<span id="cb84-1073"><a href="#cb84-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1074"><a href="#cb84-1074" aria-hidden="true" tabindex="-1"></a>Suppose we have a response variable called 'rent' (Dollars) and we have a categorical explanatory variable called 'city'. Let us say the variable 'city' has two levels; Chicago and New York. The meaning of effect size values in this context would be the numerical difference in the response variable when input is changed from one category to another. If our effect size in moving from Chicago to New York is 500 Dollars, then this means that the rent increases by 500 when we move from Chicago to New York.</span>
<span id="cb84-1075"><a href="#cb84-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1076"><a href="#cb84-1076" aria-hidden="true" tabindex="-1"></a>Here the calculated effect size is will have the same unit as the response variable</span>
<span id="cb84-1077"><a href="#cb84-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1078"><a href="#cb84-1078" aria-hidden="true" tabindex="-1"></a>Look at the following exercise, we will use the <span class="in">`Used_Fords`</span> dataset in the <span class="in">`{mosaicModel}`</span> package in R. The dataset contains details about used Ford cars. We will see if the price of the cars (Price) has any relationship with both, how old the car is (Age) and the colour of the car (Color). We will build two linear models using <span class="in">`Price`</span> as the response variable. But one model will have <span class="in">`Age`</span> and the other will have <span class="in">`Color`</span> as the explanatory variable. The units are; Price = $USD$ and Age = $years$</span>
<span id="cb84-1079"><a href="#cb84-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1080"><a href="#cb84-1080" aria-hidden="true" tabindex="-1"></a>We will calculate the effect sizes using the <span class="in">`effect_size()`</span> function from the <span class="in">`{statisticalModeling }`</span> package. The <span class="in">`effect_size()`</span> function takes in two arguments; the model and a formula indicating which variable to vary when looking at the model output. The effect size to <span class="in">`Age`</span> will be represented in dollars/year and the effect size to <span class="in">`Colour`</span> will be represented as a difference in dollars when changing from one colour to another.</span>
<span id="cb84-1081"><a href="#cb84-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1084"><a href="#cb84-1084" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-1085"><a href="#cb84-1085" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb84-1086"><a href="#cb84-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1087"><a href="#cb84-1087" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicModel)</span>
<span id="cb84-1088"><a href="#cb84-1088" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb84-1089"><a href="#cb84-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1090"><a href="#cb84-1090" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Used_Fords)</span>
<span id="cb84-1091"><a href="#cb84-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1092"><a href="#cb84-1092" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with only age</span></span>
<span id="cb84-1093"><a href="#cb84-1093" aria-hidden="true" tabindex="-1"></a>model_car_age <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span>  Age, <span class="at">data =</span> Used_Fords)</span>
<span id="cb84-1094"><a href="#cb84-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1095"><a href="#cb84-1095" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect sizes by varying age</span></span>
<span id="cb84-1096"><a href="#cb84-1096" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_car_age, <span class="sc">~</span> Age)</span>
<span id="cb84-1097"><a href="#cb84-1097" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-1098"><a href="#cb84-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1099"><a href="#cb84-1099" aria-hidden="true" tabindex="-1"></a>Effect size to Age is represented in the slope column. The value is -1124, which means for every unit increase in the age of the car (1-year increase), the price of the car depreciates by 1124 dollars.</span>
<span id="cb84-1100"><a href="#cb84-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1103"><a href="#cb84-1103" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-1104"><a href="#cb84-1104" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with only colour</span></span>
<span id="cb84-1105"><a href="#cb84-1105" aria-hidden="true" tabindex="-1"></a>model_car_age <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span>  Color, <span class="at">data =</span> Used_Fords)</span>
<span id="cb84-1106"><a href="#cb84-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1107"><a href="#cb84-1107" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect sizes by varying colour</span></span>
<span id="cb84-1108"><a href="#cb84-1108" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_car_age, <span class="sc">~</span> Color, <span class="at">Color =</span> <span class="st">"blue"</span>, <span class="at">to =</span> <span class="st">"red"</span>)</span>
<span id="cb84-1109"><a href="#cb84-1109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-1110"><a href="#cb84-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1111"><a href="#cb84-1111" aria-hidden="true" tabindex="-1"></a>For categorical explanatory variables, the <span class="in">`effect_size()`</span> function automatically takes appropriate levels. However, we can manually change this behaviour. From the given code, the effect size to colour is calculated when the colour of the car changes from blue to red. Here the effect size is represented in the change column. The value is -3290. This means that the price of the car reduces by 3290 dollars when the colour of the car changes from blue to red.</span>
<span id="cb84-1112"><a href="#cb84-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1113"><a href="#cb84-1113" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion</span></span>
<span id="cb84-1114"><a href="#cb84-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1115"><a href="#cb84-1115" aria-hidden="true" tabindex="-1"></a>I hope this article provided you with a good learning experience. In a nutshell, we learned;</span>
<span id="cb84-1116"><a href="#cb84-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1117"><a href="#cb84-1117" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>What is the meaning of a statistical model</span>
<span id="cb84-1118"><a href="#cb84-1118" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Model functions: <span class="in">`lm()`</span>, <span class="in">`glm()`</span> and <span class="in">`rpart()`</span></span>
<span id="cb84-1119"><a href="#cb84-1119" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Model formula: <span class="in">`response ~ formula`</span></span>
<span id="cb84-1120"><a href="#cb84-1120" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Model architectures: linear, logistic, recursive partitioning</span>
<span id="cb84-1121"><a href="#cb84-1121" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-1122"><a href="#cb84-1122" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>How to build a model</span>
<span id="cb84-1123"><a href="#cb84-1123" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Building models using functions, formulas and model architectures</span>
<span id="cb84-1124"><a href="#cb84-1124" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Plotting the model output</span>
<span id="cb84-1125"><a href="#cb84-1125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-1126"><a href="#cb84-1126" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>How to evaluate a model</span>
<span id="cb84-1127"><a href="#cb84-1127" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Using the model to predict values outside the data</span>
<span id="cb84-1128"><a href="#cb84-1128" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Calculating the mean of the square of the prediction errors</span>
<span id="cb84-1129"><a href="#cb84-1129" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Using error to compare models to aid explanatory variable selection</span>
<span id="cb84-1130"><a href="#cb84-1130" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Cross-validation technique and model iteration by <span class="in">`cv_pred_error()`</span> function</span>
<span id="cb84-1131"><a href="#cb84-1131" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Prediction error for a categorical response variable</span>
<span id="cb84-1132"><a href="#cb84-1132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-1133"><a href="#cb84-1133" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>How to build a null model</span>
<span id="cb84-1134"><a href="#cb84-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1135"><a href="#cb84-1135" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>How to do exploratory modelling</span>
<span id="cb84-1136"><a href="#cb84-1136" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Evaluation of a recursive partitioning model and plotting it</span>
<span id="cb84-1137"><a href="#cb84-1137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-1138"><a href="#cb84-1138" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>What is a covariate</span>
<span id="cb84-1139"><a href="#cb84-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1140"><a href="#cb84-1140" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>How to calculate effect size</span>
<span id="cb84-1141"><a href="#cb84-1141" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>For numerical explanatory variables</span>
<span id="cb84-1142"><a href="#cb84-1142" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>For categorical explanatory variables</span>
<span id="cb84-1143"><a href="#cb84-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1144"><a href="#cb84-1144" aria-hidden="true" tabindex="-1"></a>Take a break and practice the concepts learned from this tutorial. I will see you in the next tutorial where we will learn about 'Intermediate statistical modelling using R'. See you there 👍</span>
<span id="cb84-1145"><a href="#cb84-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-1146"><a href="#cb84-1146" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;a</span> <span class="er">hidden</span> <span class="er">href</span><span class="ot">=</span><span class="st">"https://info.flagcounter.com/ynrK"</span><span class="kw">&gt;&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://s11.flagcounter.com/count2/ynrK/bg_000000/txt_FFFFFF/border_F0F0F0/columns_5/maxflags_25/viewers_0/labels_1/pageviews_1/flags_0/percent_0/"</span> <span class="er">alt</span><span class="ot">=</span><span class="st">"Flag Counter"</span> <span class="er">border</span><span class="ot">=</span><span class="st">"0"</span><span class="kw">/&gt;&lt;/a&gt;</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Blog made using <a href="https://quarto.org/">Quarto®</a> with ❤️, by Jewel Johnson.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jeweljohnsonj">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/jeweljohnsonj">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:jewel.johnson@bsu.edu">
      <i class="bi bi-briefcase" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:jeweljohnsonj@gmail.com">
      <i class="bi bi-house" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<div class="page-columns page-rows-contents page-layout-article"><div class="social-share"><a href="https://twitter.com/share?url=https://sciquest.netlify.app/tutorials/stat_model/intro_stat_model.html&amp;text=Introduction to statistical modelling in R" target="_blank" class="twitter"><i class="fab fa-twitter fa-fw fa-lg"></i></a><a href="https://www.linkedin.com/shareArticle?url=https://sciquest.netlify.app/tutorials/stat_model/intro_stat_model.html&amp;title=Introduction to statistical modelling in R" target="_blank" class="linkedin"><i class="fa-brands fa-linkedin-in fa-fw fa-lg"></i></a>  <a href="mailto:?subject=Introduction to statistical modelling in R&amp;body=Check out this link:https://sciquest.netlify.app/tutorials/stat_model/intro_stat_model.html" target="_blank" class="email"><i class="fa-solid fa-envelope fa-fw fa-lg"></i></a><a href="https://www.facebook.com/sharer.php?u=https://sciquest.netlify.app/tutorials/stat_model/intro_stat_model.html" target="_blank" class="facebook"><i class="fab fa-facebook-f fa-fw fa-lg"></i></a><a href="https://reddit.com/submit?url=https://sciquest.netlify.app/tutorials/stat_model/intro_stat_model.html&amp;title=Introduction to statistical modelling in R" target="_blank" class="reddit">   <i class="fa-brands fa-reddit-alien fa-fw fa-lg"></i></a><a href="https://www.stumbleupon.com/submit?url=https://sciquest.netlify.app/tutorials/stat_model/intro_stat_model.html&amp;title=Introduction to statistical modelling in R" target="_blank" class="stumbleupon"><i class="fa-brands fa-stumbleupon fa-fw fa-lg"></i></a><a href="https://www.tumblr.com/share/link?url=https://sciquest.netlify.app/tutorials/stat_model/intro_stat_model.html&amp;name=Introduction to statistical modelling in R" target="_blank" class="tumblr"><i class="fa-brands fa-tumblr fa-fw fa-lg"></i></a></div></div>



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>