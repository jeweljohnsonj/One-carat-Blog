<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jewel Johnson">
<meta name="dcterms.date" content="2022-08-11">
<meta name="description" content="Learn about interaction terms, total and partial change, R-squared values, bootstrapping and collinearity">

<title>SciQuest - Intermediate statistical modelling in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/social-share-0.1.0/social-share.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/social-share-0.1.0/all.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EVCS615JQR"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EVCS615JQR', { 'anonymize_ip': true});
</script>
<style>html{ scroll-behavior: smooth; }</style>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

<link href="../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="https://cdn.knightlab.com/libs/juxtapose/latest/css/juxtapose.css">
<meta property="og:title" content="SciQuest - Intermediate statistical modelling in R">
<meta property="og:description" content="Learn about interaction terms, total and partial change, R-squared values, bootstrapping and collinearity">
<meta property="og:image" content="https://sciquest.netlify.app/tutorials/stat_model/images/stat_model_2.png">
<meta property="og:site-name" content="SciQuest">
<meta property="og:image:height" content="1080">
<meta property="og:image:width" content="1920">
<meta name="twitter:title" content="SciQuest - Intermediate statistical modelling in R">
<meta name="twitter:description" content="Learn about interaction terms, total and partial change, R-squared values, bootstrapping and collinearity">
<meta name="twitter:image" content="https://sciquest.netlify.app/tutorials/stat_model/images/stat_model_2.png">
<meta name="twitter:image-height" content="1080">
<meta name="twitter:image-width" content="1920">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../favicon.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">SciQuest</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials.html" rel="" target="">
 <span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://jeweljohnsonj.github.io/jewel_resume/" rel="" target="">
 <span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jeweljohnsonj/SciQuest" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/jeweljohnsonj" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Intermediate statistical modelling in R</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                  <div>
        <div class="description">
          Learn about interaction terms, total and partial change, R-squared values, bootstrapping and collinearity
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">statistical modelling</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://sciquest.netlify.app/">Jewel Johnson</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 11, 2022</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">April 15, 2023</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#prologue" id="toc-prologue" class="nav-link active" data-scroll-target="#prologue"><span class="header-section-number">1</span> Prologue</a></li>
  <li><a href="#making-life-easier" id="toc-making-life-easier" class="nav-link" data-scroll-target="#making-life-easier"><span class="header-section-number">2</span> Making life easier</a></li>
  <li><a href="#effect-size-when-response-variable-is-categorical" id="toc-effect-size-when-response-variable-is-categorical" class="nav-link" data-scroll-target="#effect-size-when-response-variable-is-categorical"><span class="header-section-number">3</span> Effect size when response variable is categorical</a></li>
  <li><a href="#plotting-the-model-output" id="toc-plotting-the-model-output" class="nav-link" data-scroll-target="#plotting-the-model-output"><span class="header-section-number">4</span> Plotting the model output</a></li>
  <li><a href="#interactions-among-explanatory-variables" id="toc-interactions-among-explanatory-variables" class="nav-link" data-scroll-target="#interactions-among-explanatory-variables"><span class="header-section-number">5</span> Interactions among explanatory variables</a></li>
  <li><a href="#polynomial-regression" id="toc-polynomial-regression" class="nav-link" data-scroll-target="#polynomial-regression"><span class="header-section-number">6</span> Polynomial regression</a></li>
  <li><a href="#total-and-partial-change" id="toc-total-and-partial-change" class="nav-link" data-scroll-target="#total-and-partial-change"><span class="header-section-number">7</span> Total and partial change</a></li>
  <li><a href="#r-squared-in-terms-of-model-output" id="toc-r-squared-in-terms-of-model-output" class="nav-link" data-scroll-target="#r-squared-in-terms-of-model-output"><span class="header-section-number">8</span> R-squared in terms of model output</a></li>
  <li><a href="#r-squared-in-terms-of-residuals" id="toc-r-squared-in-terms-of-residuals" class="nav-link" data-scroll-target="#r-squared-in-terms-of-residuals"><span class="header-section-number">9</span> R-squared in terms of residuals</a></li>
  <li><a href="#bootstrapping-and-precision" id="toc-bootstrapping-and-precision" class="nav-link" data-scroll-target="#bootstrapping-and-precision"><span class="header-section-number">10</span> Bootstrapping and precision</a></li>
  <li><a href="#scales-and-transformations" id="toc-scales-and-transformations" class="nav-link" data-scroll-target="#scales-and-transformations"><span class="header-section-number">11</span> Scales and transformations</a>
  <ul class="collapse">
  <li><a href="#logarithmic-transformation" id="toc-logarithmic-transformation" class="nav-link" data-scroll-target="#logarithmic-transformation"><span class="header-section-number">11.1</span> Logarithmic transformation</a></li>
  <li><a href="#rank-transformation" id="toc-rank-transformation" class="nav-link" data-scroll-target="#rank-transformation"><span class="header-section-number">11.2</span> Rank transformation</a></li>
  </ul></li>
  <li><a href="#collinearity-also-called-multicollinearity" id="toc-collinearity-also-called-multicollinearity" class="nav-link" data-scroll-target="#collinearity-also-called-multicollinearity"><span class="header-section-number">12</span> Collinearity (also called Multicollinearity)</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">13</span> Conclusion</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jeweljohnsonj/SciQuest/edit/main/tutorials/stat_model/inter_stat_model.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/jeweljohnsonj/SciQuest/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="28" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 27;"><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="pp">require</span>(<span class="st">"https://cdn.jsdelivr.net/npm/juxtaposejs@1.1.6/build/js/juxtapose.min.js"</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">catch</span>(() <span class="kw">=&gt;</span> <span class="kw">null</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-1" data-nodetype="expression">

</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
TL;DR
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this article you will learn;</p>
<ol type="1">
<li><p>Interpreting effect size when the response variable is categorical</p></li>
<li><p>Plotting model output using the <code>fmodel()</code> function from the <code>{statisticalModeling}</code> package</p></li>
<li><p>Interaction terms</p></li>
<li><p>Polynomial regression</p></li>
<li><p>Total change and partial change</p></li>
<li><p>Interpreting the R-squared value in terms of model output and residuals</p></li>
<li><p>Bootstrapping technique to measure the precision of model statistics</p></li>
<li><p>Scales and transformation</p>
<ul>
<li>Log transformation</li>
<li>Rank transformation</li>
</ul></li>
<li><p>Collinearity</p></li>
</ol>
</div>
</div>
<section id="prologue" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="prologue"><span class="header-section-number">1</span> Prologue</h2>
<p>This tutorial serves as a sequel to the tutorial post: <a href="https://one-carat-blog.netlify.app/tutorials/stat_model/intro_stat_model.html">Introduction to statistical modelling in R</a>. In this tutorial, you will gain knowledge in intermediate statistical modelling using R. You will learn more about effect sizes, interaction terms, total change and partial change, bootstrapping and collinearity.</p>
</section>
<section id="making-life-easier" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="making-life-easier"><span class="header-section-number">2</span> Making life easier</h2>
<p>Please install and load the necessary packages and datasets which are listed below for a seamless tutorial session. (Not required but can be very helpful if you are following this tutorial code by code)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries used in this tutorial</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'NHANES'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'devtools'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"dtkaplan/statisticalModeling"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'mosaicData'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'mosaicModel'</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'Stat2Data'</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'cherryblossom'</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"mosaic"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading the libraries</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>tutorial_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"cherryblossom"</span>, <span class="st">"mosaicData"</span>, <span class="st">"NHANES"</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Stat2Data"</span>, <span class="st">"tidyverse"</span>, <span class="st">"mosaic"</span>, <span class="st">"mosaicModel"</span>, <span class="st">"statisticalModeling"</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(tutorial_packages, library, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Datasets used in this tutorial</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"NHANES"</span>) <span class="co"># From NHANES</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"SwimRecords"</span>) <span class="co"># From mosaicData</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Tadpoles"</span>) <span class="co"># From mosaicModel</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>) <span class="co"># From Stat2Data</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"run17"</span>) <span class="co"># From cherryblossom</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Oil_history"</span>) <span class="co"># From statisticalModeling</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"SAT"</span>) <span class="co"># From mosaicData</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="effect-size-when-response-variable-is-categorical" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="effect-size-when-response-variable-is-categorical"><span class="header-section-number">3</span> Effect size when response variable is categorical</h2>
<p>In the last tutorial, we learned how to calculate the effect size for an explanatory variable. To recall, we learned that;</p>
<table class="table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Exploratory variable type</th>
<th>Effect size</th>
<th>Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Numerical</td>
<td>Rate of change (slope)</td>
<td>Mean of the square of the prediction error (m.s.e)</td>
</tr>
<tr class="even">
<td>Categorical</td>
<td>Difference (change)</td>
<td>Likelihood value</td>
</tr>
</tbody>
</table>
<p>So depending on the nature of the exploratory variable, the nature of the effect size will also change. For a numerical exploratory variable, the effect size is represented as the slope of the line, which represents the rate of change. For a categorical response variable, the effect size is represented as the difference in model output values, when the variable changes from one category to the other.</p>
<p>We also learned that, for a categorical response variable, it’s helpful to represent the model output as probability values rather than class values. Therefore, for calculating errors, if we have a numerical response variable then the error metric is the mean of the square of the prediction error and for a categorical response variable, the error would be the likelihood value. We saw in detail how to find each of them.</p>
<p>But what we did not calculate back then was the effect size, if we had a categorical response variable. So what intuition would effect size make here for this case? Let us find out.</p>
<p>We will be using the <code>NHANES</code> dataset from the <code>{NHANES}</code> package in R, the same one we saw last time while learning to interpret the recursive partitioning model plots. Back then, our exploratory analysis found that depression is having a strong association with the interest in doing things on a given day. Let us build that model using the <code>rpart()</code> function. Here the model will have <code>Depressed</code> as the response variable and <code>LittleInterest</code> as the explanatory variable. Please note that here both the variables are categorical.</p>
<p>The levels for <code>Depressed</code> are; “None” = No sign of depression, “Several” = Individual was depressed for less than half of the survey period days, and “Most” = Individual was depressed more than half of the days.</p>
<p>The levels for <code>LittleInterest</code> are also similar to that of <code>Depressed</code>; “None”, “Several” and “Most”, and are analogous to levels of <code>Depressed</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(NHANES)) <span class="fu">install.packages</span>(<span class="st">'NHANES'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(rpart)) <span class="fu">install.packages</span>(<span class="st">'rpart'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(devtools)) <span class="fu">install.packages</span>(<span class="st">'devtools'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(statisticalModeling)) devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"dtkaplan/statisticalModeling"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the recursive partitioning model</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>model_rpart <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Depressed <span class="sc">~</span> LittleInterest, <span class="at">data =</span> NHANES)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>effect_size_rpart <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(model_rpart, <span class="sc">~</span> LittleInterest)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the effect size</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>effect_size_rpart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["change.None"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["change.Several"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["change.Most"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LittleInterest"],"name":[4],"type":["fct"],"align":["left"]},{"label":["to:LittleInterest"],"name":[5],"type":["fct"],"align":["left"]}],"data":[{"1":"-0.4466272","2":"0.3628062","3":"0.08382102","4":"None","5":"Several","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>All right, we got the effect size values and they are given in two columns; ‘change.None’ and ‘change.Several’. Since our explanatory variable is categorical, effect size values with a categorical response variable give the change in probability values. Here, notice that the effect size is calculated as the difference when the response variable is changing its category from ‘None’ to ‘Several’. That difference is the probability difference from the base value, which is zero.</p>
<p>To make more sense, imagine we get an effect size value of zero, in both the columns, in the above case. This means that when the level of little interest changes from ‘None’ to ‘Several’, there is no increase or decrease in the probability of depression is ‘None’ or ‘Several’. This means, that if a person is having no depression, changing little interest from ‘None’ to ‘Several’ will not evoke a change in that person’s depressed state. Thus zero is taken as the base value.</p>
<p>Now let us look at the actual effect size values we got. As the level of little interest is changing from ‘None’ to ‘Several’, we get a probability difference of -0.4466272 = ~ 0.45 for depression is ‘None’. This means that there is a reduction of 45% in the base value of probability. In other words, the person is 45% less likely to have depression set to ‘None’. Likewise, in the same notion, the person is 36% more likely to have a depressed state of ‘Several’, when little interest changes from ‘None’ to ‘Several’. I hope this was clear to you.</p>
<p>Now, let us look at the case when, again, our response variable is categorical but this time, our explanatory variable is numerical.</p>
<p>Let us make another recursive partitioning model. We will have <code>SmokeNow</code> as the response variable and our explanatory variable will be <code>BMI</code>, which denotes the body mass index of the participants. The <code>SmokeNow</code> variable denotes smoking habit and has two levels; “Yes” = smoked 100 or more cigarettes in their lifetime., and “No” = did not smoke 100 or more cigarettes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(NHANES)) <span class="fu">install.packages</span>(<span class="st">'NHANES'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(rpart)) <span class="fu">install.packages</span>(<span class="st">'rpart'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(devtools)) <span class="fu">install.packages</span>(<span class="st">'devtools'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(statisticalModeling)) devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"dtkaplan/statisticalModeling"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the recursive partitioning model</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>model_rpart <span class="ot">&lt;-</span> <span class="fu">rpart</span>(SmokeNow <span class="sc">~</span> BMI, <span class="at">data =</span> NHANES)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>effect_size_rpart <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(model_rpart, <span class="sc">~</span> BMI)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the effect size</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>effect_size_rpart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["slope.No"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["slope.Yes"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["BMI"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["to:BMI"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"0","2":"0","3":"25.98","4":"33.35658","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Looks like we got the effect size values as zero. Going by our previous notion, this means that when BMI is changed from 26 to 33, there is no change in smoking habit. Does this mean that BMI has no relationship with the smoking habit?</p>
<p>Before we conclude, let us try a different model architecture. We learned about logistic modelling last time. Let us build a model using it for the same question.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(NHANES)) <span class="fu">install.packages</span>(<span class="st">'NHANES'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(devtools)) <span class="fu">install.packages</span>(<span class="st">'devtools'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(statisticalModeling)) devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"dtkaplan/statisticalModeling"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the logistic model</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>model_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(SmokeNow <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">~</span> BMI, <span class="at">data =</span> NHANES, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>effect_size_logistic <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(model_logistic, <span class="sc">~</span> BMI)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the effect size</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>effect_size_logistic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["slope"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["BMI"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["to:BMI"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.008784786","2":"25.98","3":"33.35658","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We got a very small effect size value but a non-zero value. Let us try plotting both models. We will use the <code>fmodel()</code> function in the <code>{statisticalModeling}</code> package to easily plot the model. Use the slider to view between the plots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting both recursive partitioning model</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_rpart) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SmokeNow ~ Age (recursive partitioning model)"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting both logistic model</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SmokeNow ~ Age (logistic model)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="juxtapose" data-startingposition="50%">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting both recursive partitioning model</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_rpart) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SmokeNow ~ Age (recursive partitioning model)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting both logistic model</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SmokeNow ~ Age (logistic model)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<p>Please note that the <code>fmodel()</code> function, while plotting for the recursive partitioning model takes in the ‘first’ level in the variable. You can easily check which level is represented in the y-axis by checking the level order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking levels</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(NHANES<span class="sc">$</span>SmokeNow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "No"  "Yes"</code></pre>
</div>
</div>
<p>The level “No” will be represented in the y-axis for the recursive partitioning model plot. Therefore for increasing y-axis values, the probability of not smoking will increase.</p>
<p>After comparing both the plots you can quickly notice that the plot for the recursive partitioning model shows step-wise change or sudden change and for the logistic model plot, the increase is gradual. Interestingly the plot shows that in higher BMI groups, i.e.&nbsp;in groups of obese people, a smoking habit is uncommon. Anyway, in the recursive partitioning model plot, there is a sudden increase in y-axis values between 20 and 30 in the axis. Let us calculate the effect size of both models at this range.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size for recursive partitioning model</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>effect_size_rpart <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(model_rpart, <span class="sc">~</span> BMI, <span class="at">BMI =</span> <span class="dv">20</span>, <span class="at">to =</span> <span class="dv">10</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the effect size for recursive partitioning </span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>effect_size_rpart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["slope.No"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["slope.Yes"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["BMI"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["to:BMI"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.01837502","2":"-0.01837502","3":"20","4":"30","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size for logistic model</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>effect_size_logistic <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(model_logistic, <span class="sc">~</span> BMI, <span class="at">BMI =</span> <span class="dv">20</span>, <span class="at">to =</span> <span class="dv">10</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the effect size for logistic</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>effect_size_logistic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["slope"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["BMI"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["to:BMI"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.00887037","2":"20","3":"30","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Note how the effect size for the recursive partitioning model is higher as compared to the logistic model. This is evident from the graph as the slope changes much faster at the given range of x-axis values for the recursive partitioning model as compared to the logistic model. Thus, recursive partitioning works best for sharp, discontinuous changes, whereas logistic regression can capture smooth, gradual changes.</p>
<p>Now coming back to interpreting the values, let’s take the case we just discussed. Let us take the effect sizes in the recursive partitioning model. Here, as BMI changes from 20 to 30, there is a 1.8% increased chance that the smoking habit drops. Also ass the response variable is dichotomous, the opposite happens for the other case; 1.8% reduced chance that smoking habit is seen. With such low chances, BMI might not have any association with smoking habit at that particular range of the x-axis. values.</p>
</section>
<section id="plotting-the-model-output" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="plotting-the-model-output"><span class="header-section-number">4</span> Plotting the model output</h2>
<p>With the help of the <code>fmodel()</code> function in the <code>{statisticalModeling}</code> package, we can easily plot the model outputs as a plot. Let us plot some plots.</p>
<p>We will again use the <code>NHANES</code> dataset from the <code>{NHANES}</code> package in R. We will <code>DiabetesAge</code> as the response variable and see if it has any association with <code>Age</code>. The <code>Diabetes</code> describes the participant’s age at which they were declared diabetic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the logistic model</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>model_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(Diabetes <span class="sc">~</span> Age, <span class="at">data =</span> NHANES, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the graph</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Diabetes ~ Age (logistic model)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We get a rather unsurprising graph. As age increases, the risk of getting diabetes increases. Let us add more variables to the model and plot them one by one. Let us add the following variables; <code>Gender</code>, <code>Depressed</code> and <code>Education</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the logistic model (adding gender)</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>model_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(Diabetes <span class="sc">~</span> Age <span class="sc">+</span> Gender, <span class="at">data =</span> NHANES, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the graph</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"DiabetesAge ~ Age + Gender (logistic model)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The addition of the third variable introduced the colour aesthetic to the plot. Let us add another variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the logistic model (adding depressed state)</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>model_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(Diabetes <span class="sc">~</span> Age <span class="sc">+</span> Gender <span class="sc">+</span> Depressed, <span class="at">data =</span> NHANES, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the graph</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"DiabetesAge ~ Age + Gender + Depressed (logistic model)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Adding a fourth variable faceted the plot into the levels of the fourth variable. Let us add one last variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the logistic model (adding Education)</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>model_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(Diabetes <span class="sc">~</span> Age <span class="sc">+</span> Gender <span class="sc">+</span> Depressed <span class="sc">+</span> Education,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> NHANES, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the graph</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"DiabetesAge ~ Age + Gender + Depressed + Education (logistic model)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The plot undergoes another layer of faceting. Now we get a rather complex plot as compared to the plot with just one explanatory variable. The plot shows some interesting info. Males are more prone to become diabetic as compared to females in all the groups. For college graduates who have no depression, both sexes have a reduced chance of having diabetes at younger ages as compared to all other groups. People with high school level of education and college level education have the most chance of becoming diabetic out of all groups. I leave the rest of the interpretations to the readers.</p>
<p>In summary, the <code>fmodel()</code> function syntax with four explanatory variables would be;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(response <span class="sc">~</span> var1 <span class="sc">+</span> var2 <span class="sc">+</span> var3 <span class="sc">+</span> var4, <span class="at">data =</span> dataset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, the response variable will always be plotted on the y-axis. The var1 will be plotted on the x-axis and will be the main exploratory variable that we are interested in. The var2 will assume the colour aesthetic. The var3 and var4 will invoke faceting. Therefore we have;</p>
<table class="table">
<caption>fmodel() variables as plot components</caption>
<thead>
<tr class="header">
<th>Variable</th>
<th>Plot component</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>var1</td>
<td>y-axis</td>
</tr>
<tr class="even">
<td>var2</td>
<td>colour</td>
</tr>
<tr class="odd">
<td>var3</td>
<td>facet</td>
</tr>
<tr class="even">
<td>var4</td>
<td>facet</td>
</tr>
</tbody>
</table>
</section>
<section id="interactions-among-explanatory-variables" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="interactions-among-explanatory-variables"><span class="header-section-number">5</span> Interactions among explanatory variables</h2>
<p>Till now, when making models, we assumed that our explanatory variables are independent of each other, i.e.&nbsp;their effect sizes are independent of each other. But often this is not the case in real life, we can have instances where the effect size of one variable changes with the other explanatory variables. When this happens, we say that both of those variables are interacting with each other.</p>
<p>To denote interacting terms in the formula, instead of a <code>+</code> sign, we use a <code>*</code>.</p>
<p>Let us see it with an example. We will use the <code>SwimRecords</code> dataset from the <code>mosaicData</code> package in R. The dataset contains world records for 100m swimming for men and women over time from 1905 through 2004. We will build a linear model, using <code>time</code> as the response variable and, <code>year</code> and <code>sex</code> as the explanatory variable. Here <code>time</code> denotes the time of the world record.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(mosaicData)) <span class="fu">install.packages</span>(<span class="st">'mosaicData'</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(time <span class="sc">~</span> year <span class="sc">+</span> sex, <span class="at">data =</span> SwimRecords)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"time ~ year + sex (linear model)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the graph, you can see that the slopes for both the lines are decreasing. This means that as years progressed, the world record times for both the sexes reduced. Also, men’s record time is faster compared to women’s. What happens to this plot if we introduce an interaction between <code>year</code> and <code>sex</code>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(mosaicData)) <span class="fu">install.packages</span>(<span class="st">'mosaicData'</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>model_lm_int <span class="ot">&lt;-</span> <span class="fu">lm</span>(time <span class="sc">~</span> year <span class="sc">*</span> sex, <span class="at">data =</span> SwimRecords)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm_int) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"time ~ year * sex (linear model)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The introduction of interacting terms seems to converge the two lines. For better comparison, use the slider to compare the plots as given below.</p>
<div class="juxtapose" data-startingposition="50%">
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(mosaicData)) <span class="fu">install.packages</span>(<span class="st">'mosaicData'</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(time <span class="sc">~</span> year <span class="sc">+</span> sex, <span class="at">data =</span> SwimRecords)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"time ~ year + sex (linear model without interaction)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model with interaction term</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>model_lm_int <span class="ot">&lt;-</span> <span class="fu">lm</span>(time <span class="sc">~</span> year <span class="sc">*</span> sex, <span class="at">data =</span> SwimRecords)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm_int) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"time ~ year * sex (linear model with interaction)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<p>We get some interesting results. First of all, compared to the plot without the interaction term, the slope changes for both the sexes, in the plot with interaction terms. Also, the lines are not parallel when interaction terms are introduced, this is direct evidence showing that both <code>year</code> and <code>sex</code> variables are truly interacting with each other. This is why with increasing years, the gap between the lines decreased, indicating a reduced effect size of sex with increasing years.</p>
<p>To see if this interaction term makes the model better, we can calculate the mean of the square of prediction errors (m.s.e) for each model and do a t.test using them (something we learned in the previous tutorial).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(mosaicData)) <span class="fu">install.packages</span>(<span class="st">'mosaicData'</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(time <span class="sc">~</span> year <span class="sc">+</span> sex, <span class="at">data =</span> SwimRecords)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model with interaction term</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>model_lm_int <span class="ot">&lt;-</span> <span class="fu">lm</span>(time <span class="sc">~</span> year <span class="sc">*</span> sex, <span class="at">data =</span> SwimRecords)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the m.s.e</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(mse <span class="sc">~</span> model, <span class="at">data =</span> <span class="fu">cv_pred_error</span>(model_lm, model_lm_int))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  mse by model
t = 13.854, df = 7.9205, p-value = 7.829e-07
alternative hypothesis: true difference in means between group model_lm and group model_lm_int is not equal to 0
95 percent confidence interval:
 3.992455 5.590253
sample estimates:
    mean in group model_lm mean in group model_lm_int 
                  17.04400                   12.25265 </code></pre>
</div>
</div>
<p>For <span class="math inline">\alpha = 0.05</span> level of significance, we have a p-value &lt; 0.05. Thus we conclude that the m.s.e values between the two models are significantly different from each other. Also, from the t.test summary, we can see that the m.s.e value is lowest for the model with the interaction term as compared to the model without the interaction term. This means interaction made the model better.</p>
<p>Some takeaway points about effect sizes, from analysing the plots are;</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Point 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Point 2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Point 3</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Point 4</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">Point 5</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p><img src="images/tab_1.png" class="img-fluid"> The slope of the line is the effect size of the x-axis exploratory variable on the y-axis response variable.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p><img src="images/tab_2.png" class="img-fluid"> The difference in y-intercepts of both the lines for a given x-axis exploratory variable value gives the effect size of the colour aesthetic on the y-axis response variable.</p>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p><img src="images/tab_3.png" class="img-fluid"> If lines are parallel, then there is no interaction between the x-axis variable and the colour aesthetic variable.</p>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<p><img src="images/tab_4.png" class="img-fluid"></p>
<p>The difference between the values of the slopes tells how the colour aesthetic variable is affecting the effect size of the x-axis variable.</p>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<p><img src="images/tab_5.png" class="img-fluid"></p>
<p>The rate of change of the y-intercepts tells how the x-axis variable is affecting the effect size of the colour aesthetic variable.</p>
</div>
</div>
</div>
<p>Now we are equipped with a strong intuition of how the interaction between variables affects the effect size of those variables and how they can be visualized from the plot.</p>
</section>
<section id="polynomial-regression" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="polynomial-regression"><span class="header-section-number">6</span> Polynomial regression</h2>
<p>Let us look at the <code>Tadpoles</code> dataset from the <code>{mosaicModel}</code> package in R. We saw this dataset while we learned about covariates in the previous tutorial. The dataset contains the swimming speed of tadpoles as a function of the water temperature and the water temperature at which the tadpoles had been raised. Let us plot the temperature at which the tadpoles were allowed to swim versus the maximum swimming speed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(mosaicModel)) <span class="fu">install.packages</span>(<span class="st">'mosaicModel'</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicModel)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Tadpoles)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a plot</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>Tadpoles <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(rtemp, vmax)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now let us try building a linear model using <code>vmax</code> as the response variable and <code>rtemp</code> as the exploratory variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicModel)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Tadpoles)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(vmax <span class="sc">~</span> rtemp, <span class="at">data =</span> Tadpoles)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> Tadpoles) <span class="sc">+</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see that the model out shows a weak relationship between the temperature at which the tadpoles were allowed to swim and the maximum swimming speed. But our intuition tells us that most of the maximum values for <code>vmax</code> peaked at temperatures of 15°C and 25°C hence, the line should curve upwards at these temperature regions. Essentially, instead of a straight line relationship, a parabolic relationship would be better for defining the relationship between <code>rtemp</code> and <code>vmax</code>. To tell the model to consider <code>rtemp</code> as a second-order variable, we use the <code>I()</code> function. So here, including <code>I(rtemp^2)</code> in the formula will inform the model to regress <code>vmax</code> against <code>rtemp^2</code>. You might be tempted to ask, why not just use <code>rtemp^2</code> in the model formula? If we use <code>vmax ~ rtemp^2</code> as the model formula, then notation wise it is equivalent to using <code>vmax ~ rtemp * rtemp</code>. If we run the model using this formula, the model will omit one of the <code>rtemp</code> variables as it is redundant to regress against a variable interacting with itself.</p>
<p>On a more technical note, in R, the symbols <code>"+", "-", "*" and "^"</code> are interpreted as formula operators. Therefore if <code>rtemp^2</code> is used inside the formula, it will consider it as <code>rtemp * rtemp</code>. Thus to make things right, we use the <code>I()</code> function, so that R will interpret <code>rtemp^2</code> as a new predictor with squared values.</p>
<p>Let us plot a polynomial model for the same question as above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicModel)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Tadpoles)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model with rtemp in second order using I()</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>model_lm_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vmax <span class="sc">~</span> rtemp <span class="sc">+</span> <span class="fu">I</span>(rtemp<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> Tadpoles)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm_2) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> Tadpoles) <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Much better plot than the earlier one. The same can also be achieved by using the <code>poly()</code> function. The syntax for it is; <code>poly(variable, the order)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicModel)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Tadpoles)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model with rtemp in second order using poly()</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>model_lm_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vmax <span class="sc">~</span> <span class="fu">poly</span>(rtemp, <span class="dv">2</span>), <span class="at">data =</span> Tadpoles)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm_2) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> Tadpoles) <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="total-and-partial-change" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="total-and-partial-change"><span class="header-section-number">7</span> Total and partial change</h2>
<p>From the previous tutorial and current tutorial, we built our notion of effect size bit by bit. In a gist, the flowchart below shows our efforts till now;</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">%%{init: {'securityLevel': 'loose', 'theme':'base'}}%%
graph TB
  A[Understanding effect sizes] --o B(In the context of numerical explanatory variable)
  B --&gt; C(In the context of categorical explanatory variable)
  C --&gt; D(Magnitude and the sign of effect size value)
  D --&gt; E(Units of effect size)
  E --&gt; F(In the context of categorical response variable)
  F --&gt; G(How interaction terms affect effect sizes:&lt;br&gt;Understanding it from graphs)
  G -.-&gt; H(How interaction terms affect effect sizes:&lt;br&gt;Understanding it from calculations)
  style H fill:#f96
  subgraph Flowchart on current understanding of effect size
  A
  B
  C
  D
  E
  F
  G
  H
  end
</pre>
</div>
</div>
</div>
</div>
<p>From the flowchart, we can appreciate the growing complexity in the understanding of effect size. We have already begun to understand effect sizes in the context of interaction terms as seen from previous graphs. Now let us try to calculate effect sizes with interaction terms.</p>
<p>We will use the <code>HorsePrices</code> dataset from the <code>{Stat2Data}</code> package in R. The dataset contains the price and related characteristics of horses listed for sale on the internet. The variables in the dataset include; <code>Price</code> = Price of the horse ($), <code>HorseID</code> = ID of the horse, <code>Age</code> = Age of the horse, <code>Height</code> = Height of the horse and <code>Sex</code> = Sex of the horse.</p>
<p>Suppose we are interested in the following questions</p>
<ol type="1">
<li>How does the price of the horse change between sexes?</li>
<li>How does the price of the horse change between sexes for the same height and age?</li>
</ol>
<p>In the first question, we are checking for the price difference between the sexes. Here, when sex changes, the covariate variables; height and age of the horse will also change with sex. Therefore, here we are measuring the change in price by allowing all other variables in the model to change along with the exploratory variable sex. This is termed the ‘total change in price as sex changes’.</p>
<p>In the second question, unlike the first, we want to specifically see what is the price difference between sexes. To see this change, we keep height and age constant. Therefore, the only change seen in this case would be coming from the sex change. This is termed the ‘partial change of price as sex changes’.</p>
<p>For the first question, we will calculate the effect size of sex on price using the following lines of code. Since our question focuses on the total change in price with sex, we make a model by excluding all the other covariates that we want to change as sex changes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(Stat2Data)) <span class="fu">install.packages</span>(<span class="st">'Stat2Data'</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Sex, <span class="at">data =</span> HorsePrices)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_lm, <span class="sc">~</span> Sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["change"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Sex"],"name":[2],"type":["fct"],"align":["left"]},{"label":["to:Sex"],"name":[3],"type":["fct"],"align":["left"]}],"data":[{"1":"-17225","2":"m","3":"f","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The effect size value tells us that, changing from a male horse to a female, the price depreciates by 17225 dollars. Now to answer the second question, to calculate the partial change in price because of a change in sex, we build a model by including all the other covariates that we want to keep constant when we change sex.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(Stat2Data)) <span class="fu">install.packages</span>(<span class="st">'Stat2Data'</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>model_lm_partial <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Sex <span class="sc">+</span> Height <span class="sc">+</span> Age, <span class="at">data =</span> HorsePrices)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_lm_partial, <span class="sc">~</span> Sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["change"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Sex"],"name":[2],"type":["fct"],"align":["left"]},{"label":["to:Sex"],"name":[3],"type":["fct"],"align":["left"]},{"label":["Height"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Age"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"-9928.29","2":"m","3":"f","4":"16.5","5":"6","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The effect size value, in this case, tells us that, a male horse of age 6 and 16.5m in height will be 9928 dollars more costly than a female horse of the same physical attributes. Here it’s clear that for the given height and age, there is a price difference between male and female horses, something which we were trying to answer.</p>
</section>
<section id="r-squared-in-terms-of-model-output" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="r-squared-in-terms-of-model-output"><span class="header-section-number">8</span> R-squared in terms of model output</h2>
<p>So far we have seen metrics like the mean of the square of prediction error and likelihood values to evaluate a model’s predictive abilities. In terms of variables used in the model formula, we know how to interpret them using effect sizes. There is also another metric called R-squared (<span class="math inline">R^2</span>).</p>
<p>One of the implications of a model is to account for variations seen within the response variable to the model output values. The R-squared value tells us how well this has been done. By definition;</p>
<p><span class="math display">R^2 = \frac{variance\,of\,model\,output\,values}{variance\,of\,response\,variable\,values}</span> The R-squared value is always positive and is between 0 and 1. R-squared value of 1 means that the model accounted for all the variance seen within the actual dataset values of the response variable. R-squared value of 0 means that the model does not account for any variance seen in the response variable.</p>
<p>But the R-squared value has its flaws which we will see soon.</p>
<p>Let us calculate the R-squared value for some models. We will again use the <code>HorsePrices</code> dataset from the <code>{Stat2Data}</code> package in R. Let us build the earlier model again and calculate the R-squared value for the model. We will use the <code>evaluate_model()</code> function from the <code>statisticalModeling</code> package to get the predicted values. For now, we will use the training dataset itself as the testing dataset. We will use the <code>var()</code> formula to calculate the variance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Sex, <span class="at">data =</span> HorsePrices)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the predicted values</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>model_lm_output <span class="ot">&lt;-</span> <span class="fu">evaluate_model</span>(model_lm, <span class="at">data =</span> HorsePrices)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the R-squared value</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="at">data =</span> model_lm_output, <span class="fu">var</span>(model_output)<span class="sc">/</span><span class="fu">var</span>(Price))</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing R-squared value</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>r_squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3237929</code></pre>
</div>
</div>
<p>We get an R-squared value of 0.32. What this means is that 32% of the variability seen in the price of the horses is explained by the sex of the horses.</p>
<p>Now let us add in more explanatory variables and calculate the R-squared value. We will also remove any <code>NA</code> values in the model variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing NA values</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>HorsePrices_new <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(HorsePrices)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Sex <span class="sc">+</span> Height <span class="sc">+</span> Age, <span class="at">data =</span> HorsePrices_new)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the predicted values</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>model_lm_output <span class="ot">&lt;-</span> <span class="fu">evaluate_model</span>(model_lm, <span class="at">data =</span> HorsePrices_new)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the R-squared value</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="at">data =</span> model_lm_output, <span class="fu">var</span>(model_output)<span class="sc">/</span><span class="fu">var</span>(Price))</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing R-squared value</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>r_squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4328061</code></pre>
</div>
</div>
<p>We got a higher R-squared value than before. Instead of 32%, we now can account for 43% of variability seen in price by all the other variables.</p>
<p>Does this mean that this model is better than the previous one? Before we jump in, let us do a fun little experiment. Let us see what happens if we add in random variables with no predicted power whatsoever to the model and run a model using them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing NA values</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>HorsePrices_new <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(HorsePrices)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding random variable</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">56</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>HorsePrices_new<span class="sc">$</span>Random <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(HorsePrices_new)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>model_lm_random <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Sex <span class="sc">+</span> Height <span class="sc">+</span> Age <span class="sc">+</span> Random, <span class="at">data =</span> HorsePrices_new)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the predicted values</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>model_lm_random_output <span class="ot">&lt;-</span> <span class="fu">evaluate_model</span>(model_lm_random, <span class="at">data =</span> HorsePrices_new)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the R-squared value</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="at">data =</span> model_lm_random_output, <span class="fu">var</span>(model_output)<span class="sc">/</span><span class="fu">var</span>(Price))</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing R-squared value</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>r_squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4437072</code></pre>
</div>
</div>
<p>We got an R-squared value of 0.44. The random variable should throw off the model output, then why did we get a higher R-squared value?</p>
<p>The R-squared value of a model will increase with increasing explanatory variables. To remind you again, the R-squared value comes partly from the model output and our model output comes from the design of the model. The model design includes selecting the appropriate explanatory variables which are up to the user. Therefore, stupidly adding variables which have no relationship whatsoever with the response variable can lead us to the wrong conclusion. Let us calculate the mean square of the prediction error for our last two models and compare them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing NA values</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>HorsePrices_new <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(HorsePrices)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding random variable</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">56</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>HorsePrices_new<span class="sc">$</span>Random <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(HorsePrices_new)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Sex, <span class="at">data =</span> HorsePrices_new)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model with random variable</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>model_lm_random <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Sex <span class="sc">+</span> Random, <span class="at">data =</span> HorsePrices_new)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the mean of square of prediction errors for trials</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>model_errors <span class="ot">&lt;-</span> <span class="fu">cv_pred_error</span>(model_lm, model_lm_random)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the mean of square of prediction errors</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(mse <span class="sc">~</span> model, model_errors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conducting t-test</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(mse <span class="sc">~</span> model, model_errors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  mse by model
t = -2.9348, df = 6.9143, p-value = 0.02218
alternative hypothesis: true difference in means between group model_lm and group model_lm_random is not equal to 0
95 percent confidence interval:
 -11481425  -1221092
sample estimates:
       mean in group model_lm mean in group model_lm_random 
                    153536030                     159887288 </code></pre>
</div>
</div>
<p>The plot and the t.test results can be used to check if the model with the random variable is indeed a poor one compared to the model without any random variable, something the R-squared value failed to report. Therefore R-squared value has its flaw, but it is widely used by people. Therefore, we should be very careful in interpreting the R-squared values of different models. Different models made from the same data can have different R-squared values.</p>
</section>
<section id="r-squared-in-terms-of-residuals" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="r-squared-in-terms-of-residuals"><span class="header-section-number">9</span> R-squared in terms of residuals</h2>
<p>From the above example, I mentioned that the R-squared value tells us how much percentage of the variability seen within the response variable is captured by the predicted model output values. Another way of seeing the same thing is through residuals. The residual is the distance between the regression line and the response variable value, or in other words, the difference between the fitted value and the corresponding response variable value. We can find R-squared using the following formula also;</p>
<p><span class="math display">R^2 = \frac{variance\,of\,response\,variable\,values - variance\,of\,residuals}{variance\,of\,response\,variable\,values}</span></p>
<p>We can use the following code to calculate the R-squared value via the above formula.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing NA values</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>HorsePrices_new <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(HorsePrices)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Sex <span class="sc">+</span> Height <span class="sc">+</span> Age, <span class="at">data =</span> HorsePrices_new)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the predicted values</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>model_lm_output <span class="ot">&lt;-</span> <span class="fu">evaluate_model</span>(model_lm, <span class="at">data =</span> HorsePrices_new)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the R-squared value using model output values</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>r_squared_mo <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="at">data =</span> model_lm_output, <span class="fu">var</span>(model_output)<span class="sc">/</span><span class="fu">var</span>(Price))</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the R-squared value using residuals</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>r_squared_res <span class="ot">&lt;-</span> (<span class="fu">var</span>(HorsePrices_new<span class="sc">$</span>Price) <span class="sc">-</span> <span class="fu">var</span>(model_lm<span class="sc">$</span>residuals)) <span class="sc">/</span> <span class="fu">var</span>(HorsePrices_new<span class="sc">$</span>Price)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking if both R-squared values are the same</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>r_squared_mo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4328061</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>r_squared_res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4328061</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(r_squared_mo) <span class="sc">==</span> <span class="fu">round</span>(r_squared_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>As you can see, they are both the same. Therefore, the R-squared value of 1 means that the model has zero residuals, which means that the model is a perfect fit; all data points lie on the regression line. R-squared value of 0 means that the variance of residuals is the same as that of the variance of the response variable. This means the explanatory variables we chose do not account for the variation seen within the response variable.</p>
</section>
<section id="bootstrapping-and-precision" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="bootstrapping-and-precision"><span class="header-section-number">10</span> Bootstrapping and precision</h2>
<p>All the datasets that we have worked on till now have been collected from a large population. Therefore, from these samples, we calculated different test statistics like the mean prediction error and effect sizes. Suppose we sample data again from the same population and calculate these test statistics, if they are close to earlier calculated values, then we can say that our test statistics are precise. But re-sampling the data is often costly and tedious to do. Then how can we check for precision? We can do that using a technique called bootstrapping. Similar to resampling, instead of collecting new samples from the population, we resample the data from the already collected data itself. Essentially, we are treating our existing dataset as a population dataset from which resampling occurs. Needless to say, this would only work effectively with large datasets.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">%%{init: {'securityLevel': 'loose', 'theme':'base'}}%%
graph LR
  A[Population] --&gt; B(Random sample)
  B --&gt; C(Calculating sample statistics)
  A --&gt; D(Random sample)
  D --&gt; E(Calculating sample statistics)
  A --&gt; F("---")
  F --&gt; G("---")
  A --&gt; H(Random sample)
  H --&gt; I(Calculating sample statistics)
  J[Population] --&gt; K(Random sample)
  J --&gt; L(Random sample)
  J --&gt; M(Collected random sample)
  M --&gt; N(Resample 1)
  M --&gt; O(Resample 2)
  M --&gt; P(Resample 3)
  J --&gt; Q(Random sample)
  subgraph Bootstrapping
  J
  K
  L
  M
  N
  O
  P
  Q
  end
  subgraph Resampling from the population
  A
  B
  C
  D
  E
  F
  G
  H
  I
  end
</pre>
</div>
</div>
</div>
</div>
<p>Let us perform a bootstrap trial code by code. We will be using the <code>run17</code> dataset from the <code>{cherryblossom}</code> package in R. It’s a relatively large dataset that we can use to study how to do a bootstrap.</p>
<p>We will first build a model and then calculate a sample statistic, which in this case would be the effect size.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(cherryblossom)) <span class="fu">install.packages</span>(<span class="st">'cherryblossom'</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(net_sec <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> run17_marathon)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_lm, <span class="sc">~</span> age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["slope"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["age"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["to:age"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["sex"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"17.91574","2":"35","3":"45.70635","4":"F","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Using the <code>sample()</code> function in R, we will sample the row indices in the original dataset. Then using these row indices, we build a resampled dataset. Then using this resampled dataset, we will build a new model and then calculate the effect size.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Collecting the row indices </span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>row_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(run17_marathon), <span class="at">replace =</span> T)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Resampling data using the rwo indices</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>resample_data <span class="ot">&lt;-</span> run17_marathon[row_indices, ]</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>model_lm_resample <span class="ot">&lt;-</span> <span class="fu">lm</span>(net_sec <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> resample_data)</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_lm_resample, <span class="sc">~</span> age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["slope"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["age"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["to:age"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["sex"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"18.08821","2":"35","3":"45.74382","4":"F","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We get a slightly different effect size value in each case. If we repeat this process, we can get multiple effect size values that we can plot to get the sampling distribution of the effect size. doing this code by code is tedious and therefore we will automate this process using the <code>ensemble()</code> function in the <code>statisticalModeling</code> package in R. Using <code>nreps</code> inside the <code>ensemble()</code> function, we can specify how many times we want to resample the data. Normally, 100 resampling trials are performed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(net_sec <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> run17_marathon)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Resampling 100 times</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>model_trials <span class="ot">&lt;-</span> <span class="fu">ensemble</span>(model_lm, <span class="at">nreps =</span> <span class="dv">100</span>)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size for each resampled data</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>resampled_effect_sizes <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(model_trials, <span class="sc">~</span> age)</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing effect sizes</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>resampled_effect_sizes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["slope"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["age"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["to:age"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["sex"],"name":[4],"type":["chr"],"align":["left"]},{"label":["bootstrap_rep"],"name":[5],"type":["int"],"align":["right"]}],"data":[{"1":"18.52807","2":"35","3":"45.70635","4":"F","5":"1","_rn_":"1"},{"1":"18.62894","2":"35","3":"45.70635","4":"F","5":"2","_rn_":"11"},{"1":"16.96007","2":"35","3":"45.70635","4":"F","5":"3","_rn_":"12"},{"1":"17.13521","2":"35","3":"45.70635","4":"F","5":"4","_rn_":"13"},{"1":"17.72699","2":"35","3":"45.70635","4":"F","5":"5","_rn_":"14"},{"1":"17.26502","2":"35","3":"45.70635","4":"F","5":"6","_rn_":"15"},{"1":"17.84770","2":"35","3":"45.70635","4":"F","5":"7","_rn_":"16"},{"1":"18.21044","2":"35","3":"45.70635","4":"F","5":"8","_rn_":"17"},{"1":"17.72617","2":"35","3":"45.70635","4":"F","5":"9","_rn_":"18"},{"1":"19.14271","2":"35","3":"45.70635","4":"F","5":"10","_rn_":"19"},{"1":"18.21329","2":"35","3":"45.70635","4":"F","5":"11","_rn_":"110"},{"1":"17.74558","2":"35","3":"45.70635","4":"F","5":"12","_rn_":"111"},{"1":"16.81683","2":"35","3":"45.70635","4":"F","5":"13","_rn_":"112"},{"1":"18.49238","2":"35","3":"45.70635","4":"F","5":"14","_rn_":"113"},{"1":"18.16016","2":"35","3":"45.70635","4":"F","5":"15","_rn_":"114"},{"1":"18.25199","2":"35","3":"45.70635","4":"F","5":"16","_rn_":"115"},{"1":"18.19143","2":"35","3":"45.70635","4":"F","5":"17","_rn_":"116"},{"1":"16.23985","2":"35","3":"45.70635","4":"F","5":"18","_rn_":"117"},{"1":"17.13319","2":"35","3":"45.70635","4":"F","5":"19","_rn_":"118"},{"1":"18.76587","2":"35","3":"45.70635","4":"F","5":"20","_rn_":"119"},{"1":"17.02959","2":"35","3":"45.70635","4":"F","5":"21","_rn_":"120"},{"1":"17.70577","2":"35","3":"45.70635","4":"F","5":"22","_rn_":"121"},{"1":"17.61485","2":"35","3":"45.70635","4":"F","5":"23","_rn_":"122"},{"1":"18.58561","2":"35","3":"45.70635","4":"F","5":"24","_rn_":"123"},{"1":"18.50629","2":"35","3":"45.70635","4":"F","5":"25","_rn_":"124"},{"1":"18.00859","2":"35","3":"45.70635","4":"F","5":"26","_rn_":"125"},{"1":"17.44250","2":"35","3":"45.70635","4":"F","5":"27","_rn_":"126"},{"1":"17.57814","2":"35","3":"45.70635","4":"F","5":"28","_rn_":"127"},{"1":"17.65674","2":"35","3":"45.70635","4":"F","5":"29","_rn_":"128"},{"1":"17.94273","2":"35","3":"45.70635","4":"F","5":"30","_rn_":"129"},{"1":"18.36642","2":"35","3":"45.70635","4":"F","5":"31","_rn_":"130"},{"1":"17.78833","2":"35","3":"45.70635","4":"F","5":"32","_rn_":"131"},{"1":"18.03960","2":"35","3":"45.70635","4":"F","5":"33","_rn_":"132"},{"1":"18.01160","2":"35","3":"45.70635","4":"F","5":"34","_rn_":"133"},{"1":"17.49672","2":"35","3":"45.70635","4":"F","5":"35","_rn_":"134"},{"1":"18.70492","2":"35","3":"45.70635","4":"F","5":"36","_rn_":"135"},{"1":"18.17493","2":"35","3":"45.70635","4":"F","5":"37","_rn_":"136"},{"1":"17.95394","2":"35","3":"45.70635","4":"F","5":"38","_rn_":"137"},{"1":"16.66961","2":"35","3":"45.70635","4":"F","5":"39","_rn_":"138"},{"1":"18.85841","2":"35","3":"45.70635","4":"F","5":"40","_rn_":"139"},{"1":"18.69594","2":"35","3":"45.70635","4":"F","5":"41","_rn_":"140"},{"1":"18.89479","2":"35","3":"45.70635","4":"F","5":"42","_rn_":"141"},{"1":"18.72304","2":"35","3":"45.70635","4":"F","5":"43","_rn_":"142"},{"1":"17.73050","2":"35","3":"45.70635","4":"F","5":"44","_rn_":"143"},{"1":"18.20891","2":"35","3":"45.70635","4":"F","5":"45","_rn_":"144"},{"1":"17.74706","2":"35","3":"45.70635","4":"F","5":"46","_rn_":"145"},{"1":"17.45297","2":"35","3":"45.70635","4":"F","5":"47","_rn_":"146"},{"1":"17.78011","2":"35","3":"45.70635","4":"F","5":"48","_rn_":"147"},{"1":"17.78550","2":"35","3":"45.70635","4":"F","5":"49","_rn_":"148"},{"1":"16.75681","2":"35","3":"45.70635","4":"F","5":"50","_rn_":"149"},{"1":"18.26516","2":"35","3":"45.70635","4":"F","5":"51","_rn_":"150"},{"1":"18.42345","2":"35","3":"45.70635","4":"F","5":"52","_rn_":"151"},{"1":"17.70255","2":"35","3":"45.70635","4":"F","5":"53","_rn_":"152"},{"1":"17.47794","2":"35","3":"45.70635","4":"F","5":"54","_rn_":"153"},{"1":"18.33432","2":"35","3":"45.70635","4":"F","5":"55","_rn_":"154"},{"1":"17.74489","2":"35","3":"45.70635","4":"F","5":"56","_rn_":"155"},{"1":"17.77921","2":"35","3":"45.70635","4":"F","5":"57","_rn_":"156"},{"1":"18.23165","2":"35","3":"45.70635","4":"F","5":"58","_rn_":"157"},{"1":"17.42809","2":"35","3":"45.70635","4":"F","5":"59","_rn_":"158"},{"1":"17.36443","2":"35","3":"45.70635","4":"F","5":"60","_rn_":"159"},{"1":"18.20237","2":"35","3":"45.70635","4":"F","5":"61","_rn_":"160"},{"1":"19.60116","2":"35","3":"45.70635","4":"F","5":"62","_rn_":"161"},{"1":"18.42000","2":"35","3":"45.70635","4":"F","5":"63","_rn_":"162"},{"1":"18.27962","2":"35","3":"45.70635","4":"F","5":"64","_rn_":"163"},{"1":"17.01492","2":"35","3":"45.70635","4":"F","5":"65","_rn_":"164"},{"1":"18.47336","2":"35","3":"45.70635","4":"F","5":"66","_rn_":"165"},{"1":"19.24642","2":"35","3":"45.70635","4":"F","5":"67","_rn_":"166"},{"1":"18.56850","2":"35","3":"45.70635","4":"F","5":"68","_rn_":"167"},{"1":"18.06588","2":"35","3":"45.70635","4":"F","5":"69","_rn_":"168"},{"1":"17.25082","2":"35","3":"45.70635","4":"F","5":"70","_rn_":"169"},{"1":"18.53319","2":"35","3":"45.70635","4":"F","5":"71","_rn_":"170"},{"1":"18.67266","2":"35","3":"45.70635","4":"F","5":"72","_rn_":"171"},{"1":"18.38777","2":"35","3":"45.70635","4":"F","5":"73","_rn_":"172"},{"1":"17.68760","2":"35","3":"45.70635","4":"F","5":"74","_rn_":"173"},{"1":"17.60244","2":"35","3":"45.70635","4":"F","5":"75","_rn_":"174"},{"1":"18.95387","2":"35","3":"45.70635","4":"F","5":"76","_rn_":"175"},{"1":"18.16775","2":"35","3":"45.70635","4":"F","5":"77","_rn_":"176"},{"1":"18.57344","2":"35","3":"45.70635","4":"F","5":"78","_rn_":"177"},{"1":"16.91922","2":"35","3":"45.70635","4":"F","5":"79","_rn_":"178"},{"1":"18.19612","2":"35","3":"45.70635","4":"F","5":"80","_rn_":"179"},{"1":"17.52922","2":"35","3":"45.70635","4":"F","5":"81","_rn_":"180"},{"1":"19.48984","2":"35","3":"45.70635","4":"F","5":"82","_rn_":"181"},{"1":"18.62649","2":"35","3":"45.70635","4":"F","5":"83","_rn_":"182"},{"1":"18.04497","2":"35","3":"45.70635","4":"F","5":"84","_rn_":"183"},{"1":"17.03443","2":"35","3":"45.70635","4":"F","5":"85","_rn_":"184"},{"1":"17.26326","2":"35","3":"45.70635","4":"F","5":"86","_rn_":"185"},{"1":"16.58411","2":"35","3":"45.70635","4":"F","5":"87","_rn_":"186"},{"1":"17.69762","2":"35","3":"45.70635","4":"F","5":"88","_rn_":"187"},{"1":"17.18250","2":"35","3":"45.70635","4":"F","5":"89","_rn_":"188"},{"1":"17.65801","2":"35","3":"45.70635","4":"F","5":"90","_rn_":"189"},{"1":"17.01308","2":"35","3":"45.70635","4":"F","5":"91","_rn_":"190"},{"1":"18.08049","2":"35","3":"45.70635","4":"F","5":"92","_rn_":"191"},{"1":"17.72445","2":"35","3":"45.70635","4":"F","5":"93","_rn_":"192"},{"1":"18.66508","2":"35","3":"45.70635","4":"F","5":"94","_rn_":"193"},{"1":"17.74312","2":"35","3":"45.70635","4":"F","5":"95","_rn_":"194"},{"1":"17.23929","2":"35","3":"45.70635","4":"F","5":"96","_rn_":"195"},{"1":"17.56232","2":"35","3":"45.70635","4":"F","5":"97","_rn_":"196"},{"1":"17.39767","2":"35","3":"45.70635","4":"F","5":"98","_rn_":"197"},{"1":"18.16926","2":"35","3":"45.70635","4":"F","5":"99","_rn_":"198"},{"1":"18.49813","2":"35","3":"45.70635","4":"F","5":"100","_rn_":"199"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Now to estimate the precision in the effect size, we can calculate its standard deviation. This is the bootstrapped estimate of the standard error of the effect size, a measure of the precision of the quantity calculated on the original model. We can also plot a histogram of the effect size values we got from each of the trails to get the sampling distribution of the effect size.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the standard error of effect size of age</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(resampled_effect_sizes<span class="sc">$</span>slope)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.652797</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting a histogram</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(resampled_effect_sizes<span class="sc">$</span>slope)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="scales-and-transformations" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="scales-and-transformations"><span class="header-section-number">11</span> Scales and transformations</h2>
<p>Depending on the class of the response variables, we can apply relevant transformations to change the scale of the variables to make the model better. We have seen how to use appropriate model architecture depending on the response variable, now we will see how to use relevant transformations.</p>
<section id="logarithmic-transformation" class="level3" data-number="11.1">
<h3 data-number="11.1" class="anchored" data-anchor-id="logarithmic-transformation"><span class="header-section-number">11.1</span> Logarithmic transformation</h3>
<p>In this exercise, we will see log-transformation which is mainly used when the response variable varies in proportion to its current size. For example, variables denoting population growth, exponential growth, prices or other money-related variables.</p>
<p>We will be using the <code>Oil_history</code> dataset from the <code>statisticalModeling</code> package in R. It denotes the historical production of crude oil, worldwide from 1880-2014. Let us first plot the data points and see how they are distributed. Here I am filtering the data till the year 1980 to get a nice looking exponential growth curve for the exercise.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Oil_history"</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the data points</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>Oil_history <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">1980</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, mbbl)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"mbbl (oil production in millions of barrels)"</span>) <span class="sc">+</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>You can see exponential growth in oil barrel production with increasing years. First, we will build a linear model looking at how years influenced change in barrel production. Here, <code>mbbl</code> would be our response variable and <code>year</code> our explanatory variable. Secondly, we will build another linear model but here our response variable; <code>mbbl</code> will be log-transformed. You can compare the plots using the slider.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Oil_history"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering values till 1980</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>Oil_1980 <span class="ot">&lt;-</span> Oil_history <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">1980</span>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the linear model</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> Oil_1980) <span class="sc">+</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"mbbl (oil production in millions of barrels)"</span>,</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">"Oil production in millions of barrels ~ Year"</span>) <span class="sc">+</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Transforming mbbl values to logarithmic scale</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>Oil_1980<span class="sc">$</span>log_mbbl <span class="ot">&lt;-</span> <span class="fu">log</span>(Oil_1980<span class="sc">$</span>mbbl)</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with log transformed response variable</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>model_lm_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the linear model with log transformed response variable</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm_log) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> Oil_1980) <span class="sc">+</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"log(mbbl) [oil production in millions of barrels]"</span>,</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">"log(Oil production in millions of barrels) ~ Year"</span>) <span class="sc">+</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="juxtapose" data-startingposition="50%">
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Oil_history"</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering values till 1980</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>Oil_1980 <span class="ot">&lt;-</span> Oil_history <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">1980</span>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the linear model</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> Oil_1980) <span class="sc">+</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"mbbl (oil production in millions of barrels)"</span>,</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">"Oil production in millions of barrels ~ Year"</span>) <span class="sc">+</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transforming mbbl values to logarithmic scale</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>Oil_1980<span class="sc">$</span>log_mbbl <span class="ot">&lt;-</span> <span class="fu">log</span>(Oil_1980<span class="sc">$</span>mbbl)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with log transformed response variable</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>model_lm_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the linear model with log transformed response variable</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm_log) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> Oil_1980) <span class="sc">+</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"log(mbbl) [oil production in millions of barrels]"</span>,</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">"log(Oil production in millions of barrels) ~ Year"</span>) <span class="sc">+</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-38-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<p>In the first graph, our linear model does not fit the values perfectly as opposed to the model which used the log transformation of the response variable. Why the second model fits better because initially <code>mbbl</code> and <code>Year</code> had an exponential relationship. But after log transformation, the relationship became a linear one and thus the model performs better. We can calculate the mean predictive error between these two models and see which one does a better job at predicting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Oil_history"</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering values till 1980</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>Oil_1980 <span class="ot">&lt;-</span> Oil_history <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">1980</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Transforming mbbl values to logarithmic scale</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>Oil_1980<span class="sc">$</span>log_mbbl <span class="ot">&lt;-</span> <span class="fu">log</span>(Oil_1980<span class="sc">$</span>mbbl)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with log transformed response variable</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>model_lm_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluating the model</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>predict_lm <span class="ot">&lt;-</span> <span class="fu">evaluate_model</span>(model_lm, <span class="at">data =</span> Oil_1980)</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>predict_lm_log <span class="ot">&lt;-</span> <span class="fu">evaluate_model</span>(model_lm_log, <span class="at">data =</span> Oil_1980)</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Transforming the model output values back to normal</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>predict_lm_log<span class="sc">$</span>model_output_nonlog <span class="ot">&lt;-</span> <span class="fu">exp</span>(predict_lm_log<span class="sc">$</span>model_output)</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the mean square errors</span></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((predict_lm<span class="sc">$</span>mbbl <span class="sc">-</span> predict_lm<span class="sc">$</span>model_output)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 17671912</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((predict_lm_log<span class="sc">$</span>mbbl <span class="sc">-</span> predict_lm_log<span class="sc">$</span>model_output_nonlog)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1861877</code></pre>
</div>
</div>
<p>We get a much smaller mean predictive error for the model with log transformation as compared to the model which does not have log transformation.</p>
<p>Let us calculate the effect size for these two models</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Oil_history"</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with log transformed response variable</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>model_lm_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect sizes</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_lm, <span class="sc">~</span> year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["slope"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["year"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["to:year"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"254.1007","2":"1957.5","3":"1987.599","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_lm_log, <span class="sc">~</span> year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["slope"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["year"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["to:year"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.06533616","2":"1957.5","3":"1987.599","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>For the model without a log-transformed response variable, we have slope = 254. This means, that from the year 1958 to 1988, the oil barrels production increased by 254 million barrels per year. What about the effect size of the model with a log-transformed response variable?</p>
<p>The effect size for a log-transformed value is in terms of the change of logarithm per unit of the explanatory variable. It’s generally easier to interpret this as a percentage change per unit of the explanatory variable, which also involves an exponential transformation: <code>100 * (exp(__effect_size__) - 1)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Oil_history"</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with log transformed response variable</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>model_lm_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>effect_lm_log <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(model_lm_log, <span class="sc">~</span> year)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting effect size to percentage change</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span> <span class="sc">*</span> (<span class="fu">exp</span>(effect_lm_log<span class="sc">$</span>slope) <span class="sc">-</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.751782</code></pre>
</div>
</div>
<p>We get a value of 6.75. This means that barrel production increased by 6.75% each year from 1958 to 1988.</p>
<p>We can take this one step further by using the bootstrapping method and thereby calculate the effect size. Then, after converting effect size to percentage change, we can calculate the 95% confidence interval on the percentage change in oil barrel production per year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Oil_history"</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with log transformed response variable</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>model_lm_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Bootstrap replications: 100 trials</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>bootstrap_trials <span class="ot">&lt;-</span> <span class="fu">ensemble</span>(model_lm_log, <span class="at">nreps =</span> <span class="dv">100</span>, <span class="at">data =</span> Oil_1980)</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>bootstrap_effect_sizes <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(bootstrap_trials, <span class="sc">~</span> year)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting effect size to percentage change</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>bootstrap_effect_sizes<span class="sc">$</span>precentage_change <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> (<span class="fu">exp</span>(bootstrap_effect_sizes<span class="sc">$</span>slope) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating 95% confidence interval</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(bootstrap_effect_sizes, <span class="fu">mean</span>(precentage_change) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">sd</span>(precentage_change))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.496748 7.003000</code></pre>
</div>
</div>
<p>Nice! We got a narrow 95% confidence interval of [6.50, 7.00].</p>
</section>
<section id="rank-transformation" class="level3" data-number="11.2">
<h3 data-number="11.2" class="anchored" data-anchor-id="rank-transformation"><span class="header-section-number">11.2</span> Rank transformation</h3>
<p>We found that log transformation worked best for datasets showcasing exponential growth or where depicting percentage change of response variables makes more sense. Likewise, there is another transformation called rank transformation which works best with a dataset that deviates from normality and has outliers.</p>
<p>Consider the dataset <code>HorsePrices</code> from the <code>Stat2Data</code> package in R. We will plot the prices for female horses with their age.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the graph</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>HorsePrices <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex <span class="sc">==</span> <span class="st">"f"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Age, Price)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>You can see that there are two outliers in the plot for y &gt; 30000, let us label them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Making a function to identify outliers</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>is_outlier <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">&gt;</span> <span class="dv">30000</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering female horses and labelling the outliers</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>female_horses <span class="ot">&lt;-</span> HorsePrices <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex <span class="sc">==</span> <span class="st">"f"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outliers =</span> <span class="fu">if_else</span>(<span class="fu">is_outlier</span>(Price), Price, rlang<span class="sc">::</span>na_int))</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the graph</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>female_horses <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex <span class="sc">==</span> <span class="st">"f"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Age, Price)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> outliers), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now let us build a linear model with <code>Price</code> as the response variable and <code>Age</code> as the explanatory variable and then plot the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Making a function to identify outliers</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>is_outlier <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">&gt;</span> <span class="dv">30000</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering female horses and labelling the outliers</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>female_horses <span class="ot">&lt;-</span> HorsePrices <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex <span class="sc">==</span> <span class="st">"f"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outliers =</span> <span class="fu">if_else</span>(<span class="fu">is_outlier</span>(Price), Price, rlang<span class="sc">::</span>na_int))</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Age, <span class="at">data =</span> female_horses)</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> female_horses) <span class="sc">+</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> outliers), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">vjust =</span> <span class="dv">1</span>,</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">data =</span> female_horses) <span class="sc">+</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">50000</span>,<span class="dv">10000</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50000</span>)) <span class="sc">+</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Linear model"</span>) <span class="sc">+</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The outliers might be causing an effect on the slope of the regression line. This is where rank transformation comes into place. Using the <code>rank()</code> in R, we replace the actual value with the rank which that value occupies when arranged from ascending to descending order. Let us see how the plot will be after rank transformation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Making a function to identify outliers via ranks</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>is_outlier <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">&gt;</span> <span class="dv">18</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering female horses</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>female_horses <span class="ot">&lt;-</span> HorsePrices <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex <span class="sc">==</span> <span class="st">"f"</span>)</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Assigning ranks</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>female_horses<span class="sc">$</span>price_rank <span class="ot">&lt;-</span> <span class="fu">rank</span>(female_horses<span class="sc">$</span>Price)</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Labelling outliers via ranks</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>female_horses<span class="ot">&lt;-</span> female_horses <span class="sc">%&gt;%</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outliers =</span> <span class="fu">if_else</span>(<span class="fu">is_outlier</span>(price_rank), Price, rlang<span class="sc">::</span>na_int))</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>model_lm_rank <span class="ot">&lt;-</span> <span class="fu">lm</span>(price_rank <span class="sc">~</span> Age, <span class="at">data =</span> female_horses)</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm_rank) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> female_horses) <span class="sc">+</span></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> outliers), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">vjust =</span> <span class="dv">1</span>,</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">data =</span> female_horses) <span class="sc">+</span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Ranked Price"</span>, <span class="at">title =</span> <span class="st">"Linear model with ranked price"</span>) <span class="sc">+</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A quick comparison of both the graphs shows that the slope of the regression line has changed. For now, let us not worry if this made the model better. We will see in greater detail rank transformation in the coming tutorials. For now, keep in mind that rank transformation works best for data with outliers.</p>
</section>
</section>
<section id="collinearity-also-called-multicollinearity" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="collinearity-also-called-multicollinearity"><span class="header-section-number">12</span> Collinearity (also called Multicollinearity)</h2>
<p>Collinearity is a phenomenon that occurs when two or more explanatory variables used in the model are in a linear relationship with each other. Consider a dataset with ‘poverty’ as a variable, let’s say we are looking at the association between ‘poverty’ and other variables such as ‘education’ and ‘income’. Now common sense tells us that, most often, education and income have a linear relationship with each other. Highly educated people often will have a high income. Therefore, changes seen in poverty status explained by education might often be a result of income rather than education itself and vice versa. In this case, we say that the variables ‘education’ and ‘income’ are colinear.</p>
<p>Let us look at a real-life example. Let us use the <code>SAT</code> dataset from the <code>{mosaicData}</code> package in R. The SAT data looks at the link between SAT scores and measures of educational expenditures.</p>
<p>We will build a linear model using <code>sat</code> as the response variable. The <code>sat</code> variable denotes the average total SAT score. We will also use <code>expend</code> as the explanatory variable. The <code>expend</code> variable denotes expenditure per pupil in average daily attendance in public elementary and secondary schools, 1994-95 (in thousands of US dollars). We will also do bootstrapping and find the 95% confidence interval.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend, <span class="at">data =</span> SAT)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bootstrap replications: 100 trials</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>bootstrap_trials <span class="ot">&lt;-</span> <span class="fu">ensemble</span>(model_lm, <span class="at">nreps =</span> <span class="dv">100</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect sizes of salary from the bootstrap samples</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>bootstrap_effect_sizes <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(bootstrap_trials, <span class="sc">~</span> expend)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the 95% confidence interval</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(bootstrap_effect_sizes, <span class="fu">mean</span>(slope) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">sd</span>(slope))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -33.765958  -8.135405</code></pre>
</div>
</div>
<p>We get a rather surprising plot and a 95% confidence interval value. The plot suggests that with increasing college expenditure, sat scores reduce. The confidence interval is adding evidence to it by showing that the mean of the effect size lies within a negative interval. So what’s happening? Should we believe our model?</p>
<p>Before we decide on anything, let us add a covariate to the model. We will add the variable <code>frac</code> to the model which denotes the percentage of all eligible students taking the SAT. Let us build the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>model_lm_cov <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend <span class="sc">+</span> frac, <span class="at">data =</span> SAT)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm_cov) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="inter_stat_model_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bootstrap replications: 100 trials</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>bootstrap_trials_cov <span class="ot">&lt;-</span> <span class="fu">ensemble</span>(model_lm_cov, <span class="at">nreps =</span> <span class="dv">100</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect sizes of salary from the bootstrap samples</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>bootstrap_effect_sizes_cov <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(bootstrap_trials, <span class="sc">~</span> expend)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the 95% confidence interval</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(bootstrap_effect_sizes_cov, <span class="fu">mean</span>(slope) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">sd</span>(slope))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -33.765958  -8.135405</code></pre>
</div>
</div>
<p>Guess we got quite the opposite result now. Let us calculate the mean prediction error using the cross-validation technique and see which of these models is better.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend, <span class="at">data =</span> SAT)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with covariate</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>model_lm_cov <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend <span class="sc">+</span> frac, <span class="at">data =</span> SAT)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the m.s.e values</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>trials_mse <span class="ot">&lt;-</span> <span class="fu">cv_pred_error</span>(model_lm, model_lm_cov)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing mse</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>trials_mse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mse"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["model"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"5005.516","2":"model_lm"},{"1":"4858.050","2":"model_lm"},{"1":"4906.532","2":"model_lm"},{"1":"4936.597","2":"model_lm"},{"1":"4900.786","2":"model_lm"},{"1":"1165.439","2":"model_lm_cov"},{"1":"1127.709","2":"model_lm_cov"},{"1":"1171.935","2":"model_lm_cov"},{"1":"1161.813","2":"model_lm_cov"},{"1":"1122.860","2":"model_lm_cov"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Doing a t.test</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(mse <span class="sc">~</span> model, trials_mse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  mse by model
t = 142.26, df = 5.3575, p-value = 8.603e-11
alternative hypothesis: true difference in means between group model_lm and group model_lm_cov is not equal to 0
95 percent confidence interval:
 3704.738 3838.352
sample estimates:
    mean in group model_lm mean in group model_lm_cov 
                  4921.496                   1149.951 </code></pre>
</div>
</div>
<p>From the t.test results, the model with the covariate has a lower mean prediction error value as compared to the model without the covariate. Adding <code>frac</code> as the covariate seems to significantly improve our model.</p>
<p>The reason why I emphasized covariates is because collinearity is introduced to the model as a result of our choice of covariates. To check for collinearity, we build a linear model with our group of explanatory variables that we want to check. Then we will find the R-squared value from the model, the greater the R-squared value, the greater the collinearity between these variables. Let us find the collinearity between <code>expend</code> and <code>frac</code>. We can either use the <code>summary()</code> function to get the model summary and then get the R-squared value from the summary or use the <code>rsquared()</code> function from the <code>{mosaic}</code> package in R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(mosaic)) <span class="fu">install.packages</span>(<span class="st">'mosaic'</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaic)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>model_cov <span class="ot">&lt;-</span> <span class="fu">lm</span>(expend <span class="sc">~</span> frac, <span class="at">data =</span> SAT)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the summary of the model to get Rsquared value</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_cov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = expend ~ frac, data = SAT)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.7951 -0.7441 -0.2177  0.5983  2.8197 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  4.84179    0.26101  18.550  &lt; 2e-16 ***
frac         0.03018    0.00592   5.097 5.78e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.109 on 48 degrees of freedom
Multiple R-squared:  0.3512,    Adjusted R-squared:  0.3377 
F-statistic: 25.98 on 1 and 48 DF,  p-value: 5.781e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the Rsquared value</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rsquared</span>(model_cov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3512072</code></pre>
</div>
</div>
<p>From the model summary, the value that we are interested in is given in the ‘Multiple R-squared’ section, which is 0.35, which is the same as the output given by the <code>rsquared()</code> function. The value of 0.35 means that 35% of the variation seen in the <code>expend</code> variable is explained by <code>frac</code>. This suggests that there is some level of redundancy between the <code>expend</code> and <code>frac</code>. Greater the R-squared value, the greater the redundancy between the variables.</p>
<p>R-squared is also represented in a different way called ‘variance inflation factor (VIF)’ which measures the factor by which the correlations amongst the predictor variables inflate the variance of the standard error of the effect size. Okay, that was a handful, let us see what this means. First, let us see the formula for VIF;</p>
<p><span class="math display">VIF = \frac{1}{1-R^2}</span></p>
<p>Here, if we have an R-squared value of 0, which means there is no collinearity between the variables, then VIF would be 1. Let us assume we get a VIF value of 2. In the current context, this means that the variance of the effect sizes calculated from bootstrap trials is increased by a factor of 2. If variance increases, then the standard error associated with the effect sizes increases and thereby it will lead to reduced precision. A result of collinearity is often getting a wider confidence interval thereby giving us an unprecise estimation of; for example effect sizes in this case.</p>
<p>If we take the square root of VIF, then we get the ‘standard error inflation factor’ which tells us by how much factor the standard error of the effect sizes calculated from bootstrap trails inflate.</p>
<p>Let us see all this in action from the codes below;</p>
<p>We will add another covariate to our earlier model; <code>salary</code>. The variable <code>salary</code> denotes the estimated average annual salary of teachers in public elementary and secondary schools.</p>
<p>Let us first check for collinearity between the <code>salary</code> and <code>expend</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaic)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model to check collinearity</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>model_collinear_salary <span class="ot">&lt;-</span> <span class="fu">lm</span>(expend <span class="sc">~</span> salary, <span class="at">data =</span> SAT)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the Rsquared value</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rsquared</span>(model_collinear_salary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7565547</code></pre>
</div>
</div>
<p>Looks like we opened Pandora’s box. Now let us build two models, one without salary and one with salary and, see how the prediction error of the effect sizes changes. The two models will have the SAT scores as the response variable. We will calculate the standard error of effect sizes within the <code>effect_size()</code> formula by assigning <code>bootstrap = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1 without salary</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>model_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend, <span class="at">data =</span> SAT)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2 with salary</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>model_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend <span class="sc">+</span> salary, <span class="at">data =</span> SAT)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating effect sizes and standard error via bootstrapping</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">effect_size</span>(model_1, <span class="sc">~</span> expend, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>), <span class="at">n =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["slope"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["stderr_effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["expend"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["to:expend"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"-20.89217","2":"5","3":"5.7675","4":"7.130307","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">effect_size</span>(model_2, <span class="sc">~</span> expend, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>), <span class="at">n =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["slope"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["stderr_effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["expend"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["to:expend"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["salary"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.4677801","2":"11","3":"5.7675","4":"7.130307","5":"33.2875","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>You can see that the standard error has increased which is due to the effect of collinearity between <code>expend</code> and <code>salary</code>.</p>
<p>The <code>statisticalModeling</code> package comes with the <code>collinearity()</code> function which can be used to calculate how much the effect size might (at a maximum) be influenced by collinearity with the other explanatory variables. Essentially, the <code>collinearity()</code> function calculates the square root of VIF which denotes the inflation of standard errors. Let us check the collinearity between <code>expend</code> and <code>salary</code> variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the collinearity</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="fu">collinearity</span>(<span class="sc">~</span> expend <span class="sc">+</span> salary, <span class="at">data =</span> SAT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["expl_vars"],"name":[1],"type":["chr"],"align":["left"]},{"label":["SeIF"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"expend","2":"2.026746"},{"1":"salary","2":"2.026746"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Interaction between collinear variables can also increase the standard error of effect size.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3 with salary interaction</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>model_3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend <span class="sc">*</span> salary, <span class="at">data =</span> SAT)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating effect sizes and standard error via bootstrapping</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">effect_size</span>(model_3, <span class="sc">~</span> expend, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>), <span class="at">n =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["slope"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["stderr_effect"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["expend"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["to:expend"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["salary"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"-7.792263","2":"14","3":"5.7675","4":"7.130307","5":"33.2875","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>As you can see, we got a higher standard error value as compared to model_1. Let us also calculate the mean prediction error for the three models we created.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the models</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>model_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend, <span class="at">data =</span> SAT)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>model_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend <span class="sc">+</span> salary, <span class="at">data =</span> SAT)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>model_3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend <span class="sc">*</span> salary, <span class="at">data =</span> SAT)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the mean prediction error for 100 trials</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>model_mse <span class="ot">&lt;-</span> <span class="fu">cv_pred_error</span>(model_1, model_2, model_3, <span class="at">ntrials =</span> <span class="dv">100</span>)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the mean and sd of mse</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>model_mse_mean <span class="ot">&lt;-</span> model_mse <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(mse),</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd =</span> <span class="fu">sd</span>(mse))</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the mean and sd of mse</span></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>model_mse_mean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["model"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"model_1","2":"4980.035","3":"91.9569"},{"1":"model_2","2":"4881.252","3":"112.7638"},{"1":"model_3","2":"4855.465","3":"126.5202"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Since I did not set seed, you might not get the same results as I got. But essentially we can use the mean prediction error values to also choose the better model out of the three.</p>
<p>In the end, from these two tutorials, we can sum up our criteria for model comparison. We should check for the following while doing the comparison;</p>
<ul>
<li>Cross-validated prediction error</li>
<li>Inflation due to collinearity</li>
<li>The standard error of effect size</li>
</ul>
</section>
<section id="conclusion" class="level2" data-number="13">
<h2 data-number="13" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">13</span> Conclusion</h2>
<p>First of all, congratulations on completing the intermediate statistical modelling tutorial (bonus points if you completed the introduction tutorial also). In a nutshell, this is what we have learned from this tutorial;</p>
<ol type="1">
<li><p>Interpreting effect size when the response variable is categorical</p></li>
<li><p>Plotting model output using the <code>fmodel()</code> function from the <code>{statisticalModeling}</code> package</p></li>
<li><p>Interaction terms</p></li>
<li><p>Polynomial regression</p></li>
<li><p>Total and partial change</p></li>
<li><p>Interpreting the R-squared value in terms of model output and residuals</p></li>
<li><p>Bootstrapping technique to measure the precision of model statistics</p></li>
<li><p>Scales and transformation</p>
<ul>
<li>Log transformation</li>
<li>Rank transformation</li>
</ul></li>
<li><p>Collinearity</p></li>
</ol>
<p>You have mastered almost everything that is there in linear modelling. Congratulations! But, the journey is not over. The next stop is ’Generalized Linear Models in R`. This is a realm where we deal with complex datasets that cannot be analysed by our trusty linear regression models. Anyway, that’s a problem for tomorrow. Practice the concepts you gained from both the tutorials and come ready for the next tutorial ✌️</p>
<p><a hidden="" href="https://info.flagcounter.com/ynrK"><img src="https://s11.flagcounter.com/count2/ynrK/bg_000000/txt_FFFFFF/border_F0F0F0/columns_5/maxflags_25/viewers_0/labels_1/pageviews_1/flags_0/percent_0/" alt="Flag Counter" border="0"></a></p>


<!-- -->

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{johnson2022,
  author = {Johnson, Jewel},
  title = {Intermediate Statistical Modelling in {R}},
  date = {2022-08-11},
  url = {https://sciquest.netlify.app//tutorials/stat_model/inter_stat_model.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-johnson2022" class="csl-entry quarto-appendix-citeas" role="listitem">
Johnson, Jewel. 2022. <span>“Intermediate Statistical Modelling in
R.”</span> August 11, 2022. <a href="https://sciquest.netlify.app//tutorials/stat_model/inter_stat_model.html">https://sciquest.netlify.app//tutorials/stat_model/inter_stat_model.html</a>.
</div></div></section></div></main> <!-- /main -->
<script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"require(\"https://cdn.jsdelivr.net/npm/juxtaposejs@1.1.6/build/js/juxtapose.min.js\")\n  .catch(() => null)\n"}]}
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../tutorials/stat_model";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="jeweljohnsonj/SciQuest" data-repo-id="R_kgDOHW124A" data-category="General" data-category-id="DIC_kwDOHW124M4CPNVL" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb89" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Intermediate statistical modelling in R"</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Learn about interaction terms, total and partial change, R-squared values, bootstrapping and collinearity"</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "08/11/2022"</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> last-modified</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="co">    css:</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="co">      - https://cdn.knightlab.com/libs/juxtapose/latest/css/juxtapose.css</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> images/stat_model_2.png</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [statistical modelling]</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a><span class="co">   - social-share</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a><span class="an">share:</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a><span class="co">  permalink: "https://sciquest.netlify.app/tutorials/stat_model/inter_stat_model.html"</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a><span class="co">  description: "Intermediate statistical modelling in R"</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a><span class="co">  twitter: true</span></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a><span class="co">  facebook: true</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a><span class="co">  reddit: true</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a><span class="co">  stumble: true</span></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a><span class="co">  tumblr: true</span></span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a><span class="co">  linkedin: true</span></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a><span class="co">  email: true</span></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a><span class="co">//| output: false</span></span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a><span class="pp">require</span>(<span class="st">"https://cdn.jsdelivr.net/npm/juxtaposejs@1.1.6/build/js/juxtapose.min.js"</span>)</span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">catch</span>(() <span class="kw">=&gt;</span> <span class="kw">null</span>)</span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a><span class="fu">## TL;DR</span></span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a>In this article you will learn;</span>
<span id="cb89-39"><a href="#cb89-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-40"><a href="#cb89-40" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Interpreting effect size when the response variable is categorical</span>
<span id="cb89-41"><a href="#cb89-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-42"><a href="#cb89-42" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Plotting model output using the <span class="in">`fmodel()`</span> function from the <span class="in">`{statisticalModeling}`</span> package</span>
<span id="cb89-43"><a href="#cb89-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-44"><a href="#cb89-44" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Interaction terms</span>
<span id="cb89-45"><a href="#cb89-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-46"><a href="#cb89-46" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Polynomial regression</span>
<span id="cb89-47"><a href="#cb89-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-48"><a href="#cb89-48" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Total change and partial change</span>
<span id="cb89-49"><a href="#cb89-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-50"><a href="#cb89-50" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Interpreting the R-squared value in terms of model output and residuals</span>
<span id="cb89-51"><a href="#cb89-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-52"><a href="#cb89-52" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Bootstrapping technique to measure the precision of model statistics</span>
<span id="cb89-53"><a href="#cb89-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-54"><a href="#cb89-54" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>Scales and transformation</span>
<span id="cb89-55"><a href="#cb89-55" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Log transformation</span>
<span id="cb89-56"><a href="#cb89-56" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Rank transformation</span>
<span id="cb89-57"><a href="#cb89-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-58"><a href="#cb89-58" aria-hidden="true" tabindex="-1"></a><span class="ss">9. </span>Collinearity</span>
<span id="cb89-59"><a href="#cb89-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-60"><a href="#cb89-60" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb89-61"><a href="#cb89-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-62"><a href="#cb89-62" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prologue</span></span>
<span id="cb89-63"><a href="#cb89-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-64"><a href="#cb89-64" aria-hidden="true" tabindex="-1"></a>This tutorial serves as a sequel to the tutorial post: <span class="co">[</span><span class="ot">Introduction to statistical modelling in R</span><span class="co">](https://one-carat-blog.netlify.app/tutorials/stat_model/intro_stat_model.html)</span>. In this tutorial, you will gain knowledge in intermediate statistical modelling using R. You will learn more about effect sizes, interaction terms, total change and partial change, bootstrapping and collinearity.</span>
<span id="cb89-65"><a href="#cb89-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-66"><a href="#cb89-66" aria-hidden="true" tabindex="-1"></a><span class="fu">## Making life easier</span></span>
<span id="cb89-67"><a href="#cb89-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-68"><a href="#cb89-68" aria-hidden="true" tabindex="-1"></a>Please install and load the necessary packages and datasets which are listed below for a seamless tutorial session. (Not required but can be very helpful if you are following this tutorial code by code)</span>
<span id="cb89-69"><a href="#cb89-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-72"><a href="#cb89-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-73"><a href="#cb89-73" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb89-74"><a href="#cb89-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-75"><a href="#cb89-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries used in this tutorial</span></span>
<span id="cb89-76"><a href="#cb89-76" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'NHANES'</span>)</span>
<span id="cb89-77"><a href="#cb89-77" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'devtools'</span>)</span>
<span id="cb89-78"><a href="#cb89-78" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"dtkaplan/statisticalModeling"</span>)</span>
<span id="cb89-79"><a href="#cb89-79" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'mosaicData'</span>)</span>
<span id="cb89-80"><a href="#cb89-80" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'mosaicModel'</span>)</span>
<span id="cb89-81"><a href="#cb89-81" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'Stat2Data'</span>)</span>
<span id="cb89-82"><a href="#cb89-82" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'cherryblossom'</span>)</span>
<span id="cb89-83"><a href="#cb89-83" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb89-84"><a href="#cb89-84" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"mosaic"</span>)</span>
<span id="cb89-85"><a href="#cb89-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-86"><a href="#cb89-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading the libraries</span></span>
<span id="cb89-87"><a href="#cb89-87" aria-hidden="true" tabindex="-1"></a>tutorial_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"cherryblossom"</span>, <span class="st">"mosaicData"</span>, <span class="st">"NHANES"</span>,</span>
<span id="cb89-88"><a href="#cb89-88" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Stat2Data"</span>, <span class="st">"tidyverse"</span>, <span class="st">"mosaic"</span>, <span class="st">"mosaicModel"</span>, <span class="st">"statisticalModeling"</span>)</span>
<span id="cb89-89"><a href="#cb89-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-90"><a href="#cb89-90" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(tutorial_packages, library, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb89-91"><a href="#cb89-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-92"><a href="#cb89-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Datasets used in this tutorial</span></span>
<span id="cb89-93"><a href="#cb89-93" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"NHANES"</span>) <span class="co"># From NHANES</span></span>
<span id="cb89-94"><a href="#cb89-94" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"SwimRecords"</span>) <span class="co"># From mosaicData</span></span>
<span id="cb89-95"><a href="#cb89-95" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Tadpoles"</span>) <span class="co"># From mosaicModel</span></span>
<span id="cb89-96"><a href="#cb89-96" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>) <span class="co"># From Stat2Data</span></span>
<span id="cb89-97"><a href="#cb89-97" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"run17"</span>) <span class="co"># From cherryblossom</span></span>
<span id="cb89-98"><a href="#cb89-98" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Oil_history"</span>) <span class="co"># From statisticalModeling</span></span>
<span id="cb89-99"><a href="#cb89-99" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"SAT"</span>) <span class="co"># From mosaicData</span></span>
<span id="cb89-100"><a href="#cb89-100" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-101"><a href="#cb89-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-102"><a href="#cb89-102" aria-hidden="true" tabindex="-1"></a><span class="fu">## Effect size when response variable is categorical</span></span>
<span id="cb89-103"><a href="#cb89-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-104"><a href="#cb89-104" aria-hidden="true" tabindex="-1"></a>In the last tutorial, we learned how to calculate the effect size for an explanatory variable. To recall, we learned that;</span>
<span id="cb89-105"><a href="#cb89-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-106"><a href="#cb89-106" aria-hidden="true" tabindex="-1"></a>| Exploratory variable type | Effect size | Error |</span>
<span id="cb89-107"><a href="#cb89-107" aria-hidden="true" tabindex="-1"></a>|---|---|---|</span>
<span id="cb89-108"><a href="#cb89-108" aria-hidden="true" tabindex="-1"></a>| Numerical | Rate of change (slope) | Mean of the square of the prediction error (m.s.e) |</span>
<span id="cb89-109"><a href="#cb89-109" aria-hidden="true" tabindex="-1"></a>| Categorical | Difference (change) | Likelihood value |</span>
<span id="cb89-110"><a href="#cb89-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-111"><a href="#cb89-111" aria-hidden="true" tabindex="-1"></a>So depending on the nature of the exploratory variable, the nature of the effect size will also change. For a numerical exploratory variable, the effect size is represented as the slope of the line, which represents the rate of change. For a categorical response variable, the effect size is represented as the difference in model output values, when the variable changes from one category to the other.</span>
<span id="cb89-112"><a href="#cb89-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-113"><a href="#cb89-113" aria-hidden="true" tabindex="-1"></a>We also learned that, for a categorical response variable, it's helpful to represent the model output as probability values rather than class values. Therefore, for calculating errors, if we have a numerical response variable then the error metric is the mean of the square of the prediction error and for a categorical response variable, the error would be the likelihood value. We saw in detail how to find each of them.</span>
<span id="cb89-114"><a href="#cb89-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-115"><a href="#cb89-115" aria-hidden="true" tabindex="-1"></a>But what we did not calculate back then was the effect size, if we had a categorical response variable. So what intuition would effect size make here for this case? Let us find out.</span>
<span id="cb89-116"><a href="#cb89-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-117"><a href="#cb89-117" aria-hidden="true" tabindex="-1"></a>We will be using the <span class="in">`NHANES`</span> dataset from the <span class="in">`{NHANES}`</span> package in R, the same one we saw last time while learning to interpret the recursive partitioning model plots. Back then, our exploratory analysis found that depression is having a strong association with the interest in doing things on a given day. Let us build that model using the <span class="in">`rpart()`</span> function. Here the model will have <span class="in">`Depressed`</span> as the response variable and <span class="in">`LittleInterest`</span> as the explanatory variable. Please note that here both the variables are categorical. </span>
<span id="cb89-118"><a href="#cb89-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-119"><a href="#cb89-119" aria-hidden="true" tabindex="-1"></a>The levels for <span class="in">`Depressed`</span> are; “None” = No sign of depression, “Several” = Individual was depressed for less than half of the survey period days, and “Most” = Individual was depressed more than half of the days. </span>
<span id="cb89-120"><a href="#cb89-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-121"><a href="#cb89-121" aria-hidden="true" tabindex="-1"></a>The levels for <span class="in">`LittleInterest`</span> are also similar to that of <span class="in">`Depressed`</span>; "None", "Several" and "Most", and are analogous to levels of <span class="in">`Depressed`</span>.</span>
<span id="cb89-122"><a href="#cb89-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-125"><a href="#cb89-125" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-126"><a href="#cb89-126" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(NHANES)) <span class="fu">install.packages</span>(<span class="st">'NHANES'</span>)</span>
<span id="cb89-127"><a href="#cb89-127" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(rpart)) <span class="fu">install.packages</span>(<span class="st">'rpart'</span>)</span>
<span id="cb89-128"><a href="#cb89-128" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(devtools)) <span class="fu">install.packages</span>(<span class="st">'devtools'</span>)</span>
<span id="cb89-129"><a href="#cb89-129" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(statisticalModeling)) devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"dtkaplan/statisticalModeling"</span>)</span>
<span id="cb89-130"><a href="#cb89-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-131"><a href="#cb89-131" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-132"><a href="#cb89-132" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb89-133"><a href="#cb89-133" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb89-134"><a href="#cb89-134" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-135"><a href="#cb89-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-136"><a href="#cb89-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the recursive partitioning model</span></span>
<span id="cb89-137"><a href="#cb89-137" aria-hidden="true" tabindex="-1"></a>model_rpart <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Depressed <span class="sc">~</span> LittleInterest, <span class="at">data =</span> NHANES)</span>
<span id="cb89-138"><a href="#cb89-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-139"><a href="#cb89-139" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb89-140"><a href="#cb89-140" aria-hidden="true" tabindex="-1"></a>effect_size_rpart <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(model_rpart, <span class="sc">~</span> LittleInterest)</span>
<span id="cb89-141"><a href="#cb89-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-142"><a href="#cb89-142" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the effect size</span></span>
<span id="cb89-143"><a href="#cb89-143" aria-hidden="true" tabindex="-1"></a>effect_size_rpart</span>
<span id="cb89-144"><a href="#cb89-144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-145"><a href="#cb89-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-146"><a href="#cb89-146" aria-hidden="true" tabindex="-1"></a>All right, we got the effect size values and they are given in two columns; 'change.None' and 'change.Several'. Since our explanatory variable is categorical, effect size values with a categorical response variable give the change in probability values. Here, notice that the effect size is calculated as the difference when the response variable is changing its category from 'None' to 'Several'. That difference is the probability difference from the base value, which is zero. </span>
<span id="cb89-147"><a href="#cb89-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-148"><a href="#cb89-148" aria-hidden="true" tabindex="-1"></a>To make more sense, imagine we get an effect size value of zero, in both the columns, in the above case. This means that when the level of little interest changes from 'None' to 'Several', there is no increase or decrease in the probability of depression is 'None' or 'Several'. This means, that if a person is having no depression, changing little interest from 'None' to 'Several' will not evoke a change in that person's depressed state. Thus zero is taken as the base value.</span>
<span id="cb89-149"><a href="#cb89-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-150"><a href="#cb89-150" aria-hidden="true" tabindex="-1"></a>Now let us look at the actual effect size values we got. As the level of little interest is changing from 'None' to 'Several', we get a probability difference of -0.4466272 = ~ 0.45 for depression is 'None'. This means that there is a reduction of 45% in the base value of probability. In other words, the person is 45% less likely to have depression set to 'None'. Likewise, in the same notion, the person is 36% more likely to have a depressed state of 'Several', when little interest changes from 'None' to 'Several'. I hope this was clear to you.</span>
<span id="cb89-151"><a href="#cb89-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-152"><a href="#cb89-152" aria-hidden="true" tabindex="-1"></a>Now, let us look at the case when, again, our response variable is categorical but this time, our explanatory variable is numerical.</span>
<span id="cb89-153"><a href="#cb89-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-154"><a href="#cb89-154" aria-hidden="true" tabindex="-1"></a>Let us make another recursive partitioning model. We will have <span class="in">`SmokeNow`</span> as the response variable and our explanatory variable will be <span class="in">`BMI`</span>, which denotes the body mass index of the participants. The <span class="in">`SmokeNow`</span> variable denotes smoking habit and has two levels; "Yes" = smoked 100 or more cigarettes in their lifetime., and "No" = did not smoke 100 or more cigarettes.</span>
<span id="cb89-155"><a href="#cb89-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-158"><a href="#cb89-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-159"><a href="#cb89-159" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb89-160"><a href="#cb89-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-161"><a href="#cb89-161" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(NHANES)) <span class="fu">install.packages</span>(<span class="st">'NHANES'</span>)</span>
<span id="cb89-162"><a href="#cb89-162" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(rpart)) <span class="fu">install.packages</span>(<span class="st">'rpart'</span>)</span>
<span id="cb89-163"><a href="#cb89-163" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(devtools)) <span class="fu">install.packages</span>(<span class="st">'devtools'</span>)</span>
<span id="cb89-164"><a href="#cb89-164" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(statisticalModeling)) devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"dtkaplan/statisticalModeling"</span>)</span>
<span id="cb89-165"><a href="#cb89-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-166"><a href="#cb89-166" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-167"><a href="#cb89-167" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb89-168"><a href="#cb89-168" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb89-169"><a href="#cb89-169" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-170"><a href="#cb89-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-171"><a href="#cb89-171" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the recursive partitioning model</span></span>
<span id="cb89-172"><a href="#cb89-172" aria-hidden="true" tabindex="-1"></a>model_rpart <span class="ot">&lt;-</span> <span class="fu">rpart</span>(SmokeNow <span class="sc">~</span> BMI, <span class="at">data =</span> NHANES)</span>
<span id="cb89-173"><a href="#cb89-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-174"><a href="#cb89-174" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb89-175"><a href="#cb89-175" aria-hidden="true" tabindex="-1"></a>effect_size_rpart <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(model_rpart, <span class="sc">~</span> BMI)</span>
<span id="cb89-176"><a href="#cb89-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-177"><a href="#cb89-177" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the effect size</span></span>
<span id="cb89-178"><a href="#cb89-178" aria-hidden="true" tabindex="-1"></a>effect_size_rpart</span>
<span id="cb89-179"><a href="#cb89-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-180"><a href="#cb89-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-181"><a href="#cb89-181" aria-hidden="true" tabindex="-1"></a>Looks like we got the effect size values as zero. Going by our previous notion, this means that when BMI is changed from 26 to 33, there is no change in smoking habit. Does this mean that BMI has no relationship with the smoking habit? </span>
<span id="cb89-182"><a href="#cb89-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-183"><a href="#cb89-183" aria-hidden="true" tabindex="-1"></a>Before we conclude, let us try a different model architecture. We learned about logistic modelling last time. Let us build a model using it for the same question. </span>
<span id="cb89-184"><a href="#cb89-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-187"><a href="#cb89-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-188"><a href="#cb89-188" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb89-189"><a href="#cb89-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-190"><a href="#cb89-190" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(NHANES)) <span class="fu">install.packages</span>(<span class="st">'NHANES'</span>)</span>
<span id="cb89-191"><a href="#cb89-191" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(devtools)) <span class="fu">install.packages</span>(<span class="st">'devtools'</span>)</span>
<span id="cb89-192"><a href="#cb89-192" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(statisticalModeling)) devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"dtkaplan/statisticalModeling"</span>)</span>
<span id="cb89-193"><a href="#cb89-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-194"><a href="#cb89-194" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-195"><a href="#cb89-195" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb89-196"><a href="#cb89-196" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-197"><a href="#cb89-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-198"><a href="#cb89-198" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the logistic model</span></span>
<span id="cb89-199"><a href="#cb89-199" aria-hidden="true" tabindex="-1"></a>model_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(SmokeNow <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">~</span> BMI, <span class="at">data =</span> NHANES, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb89-200"><a href="#cb89-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-201"><a href="#cb89-201" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb89-202"><a href="#cb89-202" aria-hidden="true" tabindex="-1"></a>effect_size_logistic <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(model_logistic, <span class="sc">~</span> BMI)</span>
<span id="cb89-203"><a href="#cb89-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-204"><a href="#cb89-204" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the effect size</span></span>
<span id="cb89-205"><a href="#cb89-205" aria-hidden="true" tabindex="-1"></a>effect_size_logistic</span>
<span id="cb89-206"><a href="#cb89-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-207"><a href="#cb89-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-208"><a href="#cb89-208" aria-hidden="true" tabindex="-1"></a>We got a very small effect size value but a non-zero value. Let us try plotting both models. We will use the <span class="in">`fmodel()`</span> function in the <span class="in">`{statisticalModeling}`</span> package to easily plot the model. Use the slider to view between the plots.</span>
<span id="cb89-209"><a href="#cb89-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-212"><a href="#cb89-212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-213"><a href="#cb89-213" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb89-214"><a href="#cb89-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-215"><a href="#cb89-215" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting both recursive partitioning model</span></span>
<span id="cb89-216"><a href="#cb89-216" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_rpart) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb89-217"><a href="#cb89-217" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SmokeNow ~ Age (recursive partitioning model)"</span>)</span>
<span id="cb89-218"><a href="#cb89-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-219"><a href="#cb89-219" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting both logistic model</span></span>
<span id="cb89-220"><a href="#cb89-220" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb89-221"><a href="#cb89-221" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SmokeNow ~ Age (logistic model)"</span>)</span>
<span id="cb89-222"><a href="#cb89-222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-223"><a href="#cb89-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-224"><a href="#cb89-224" aria-hidden="true" tabindex="-1"></a>::: {.juxtapose data-startingposition="50%"}</span>
<span id="cb89-225"><a href="#cb89-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-228"><a href="#cb89-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-229"><a href="#cb89-229" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting both recursive partitioning model</span></span>
<span id="cb89-230"><a href="#cb89-230" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_rpart) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb89-231"><a href="#cb89-231" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SmokeNow ~ Age (recursive partitioning model)"</span>)</span>
<span id="cb89-232"><a href="#cb89-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-233"><a href="#cb89-233" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting both logistic model</span></span>
<span id="cb89-234"><a href="#cb89-234" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb89-235"><a href="#cb89-235" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SmokeNow ~ Age (logistic model)"</span>)</span>
<span id="cb89-236"><a href="#cb89-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-237"><a href="#cb89-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-238"><a href="#cb89-238" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb89-239"><a href="#cb89-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-240"><a href="#cb89-240" aria-hidden="true" tabindex="-1"></a>Please note that the <span class="in">`fmodel()`</span> function, while plotting for the recursive partitioning model takes in the 'first' level in the variable. You can easily check which level is represented in the y-axis by checking the level order.</span>
<span id="cb89-241"><a href="#cb89-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-244"><a href="#cb89-244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-245"><a href="#cb89-245" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb89-246"><a href="#cb89-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-247"><a href="#cb89-247" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking levels</span></span>
<span id="cb89-248"><a href="#cb89-248" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(NHANES<span class="sc">$</span>SmokeNow)</span>
<span id="cb89-249"><a href="#cb89-249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-250"><a href="#cb89-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-251"><a href="#cb89-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-252"><a href="#cb89-252" aria-hidden="true" tabindex="-1"></a>The level "No" will be represented in the y-axis for the recursive partitioning model plot. Therefore for increasing y-axis values, the probability of not smoking will increase.</span>
<span id="cb89-253"><a href="#cb89-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-254"><a href="#cb89-254" aria-hidden="true" tabindex="-1"></a>After comparing both the plots you can quickly notice that the plot for the recursive partitioning model shows step-wise change or sudden change and for the logistic model plot, the increase is gradual. Interestingly the plot shows that in higher BMI groups, i.e. in groups of obese people, a smoking habit is uncommon. Anyway, in the recursive partitioning model plot, there is a sudden increase in y-axis values between 20 and 30 in the axis. Let us calculate the effect size of both models at this range.</span>
<span id="cb89-255"><a href="#cb89-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-258"><a href="#cb89-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-259"><a href="#cb89-259" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size for recursive partitioning model</span></span>
<span id="cb89-260"><a href="#cb89-260" aria-hidden="true" tabindex="-1"></a>effect_size_rpart <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(model_rpart, <span class="sc">~</span> BMI, <span class="at">BMI =</span> <span class="dv">20</span>, <span class="at">to =</span> <span class="dv">10</span>)</span>
<span id="cb89-261"><a href="#cb89-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-262"><a href="#cb89-262" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the effect size for recursive partitioning </span></span>
<span id="cb89-263"><a href="#cb89-263" aria-hidden="true" tabindex="-1"></a>effect_size_rpart</span>
<span id="cb89-264"><a href="#cb89-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-265"><a href="#cb89-265" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size for logistic model</span></span>
<span id="cb89-266"><a href="#cb89-266" aria-hidden="true" tabindex="-1"></a>effect_size_logistic <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(model_logistic, <span class="sc">~</span> BMI, <span class="at">BMI =</span> <span class="dv">20</span>, <span class="at">to =</span> <span class="dv">10</span>)</span>
<span id="cb89-267"><a href="#cb89-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-268"><a href="#cb89-268" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the effect size for logistic</span></span>
<span id="cb89-269"><a href="#cb89-269" aria-hidden="true" tabindex="-1"></a>effect_size_logistic</span>
<span id="cb89-270"><a href="#cb89-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-271"><a href="#cb89-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-272"><a href="#cb89-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-273"><a href="#cb89-273" aria-hidden="true" tabindex="-1"></a>Note how the effect size for the recursive partitioning model is higher as compared to the logistic model. This is evident from the graph as the slope changes much faster at the given range of x-axis values for the recursive partitioning model as compared to the logistic model. Thus, recursive partitioning works best for sharp, discontinuous changes, whereas logistic regression can capture smooth, gradual changes.</span>
<span id="cb89-274"><a href="#cb89-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-275"><a href="#cb89-275" aria-hidden="true" tabindex="-1"></a>Now coming back to interpreting the values, let's take the case we just discussed. Let us take the effect sizes in the recursive partitioning model. Here, as BMI changes from 20 to 30, there is a 1.8% increased chance that the smoking habit drops. Also ass the response variable is dichotomous, the opposite happens for the other case; 1.8% reduced chance that smoking habit is seen. With such low chances, BMI might not have any association with smoking habit at that particular range of the x-axis. values.   </span>
<span id="cb89-276"><a href="#cb89-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-277"><a href="#cb89-277" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plotting the model output</span></span>
<span id="cb89-278"><a href="#cb89-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-279"><a href="#cb89-279" aria-hidden="true" tabindex="-1"></a>With the help of the <span class="in">`fmodel()`</span> function in the <span class="in">`{statisticalModeling}`</span> package, we can easily plot the model outputs as a plot. Let us plot some plots.</span>
<span id="cb89-280"><a href="#cb89-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-281"><a href="#cb89-281" aria-hidden="true" tabindex="-1"></a>We will again use the <span class="in">`NHANES`</span> dataset from the <span class="in">`{NHANES}`</span> package in R. We will <span class="in">`DiabetesAge`</span> as the response variable and see if it has any association with <span class="in">`Age`</span>. The <span class="in">`Diabetes`</span> describes the participant's age at which they were declared diabetic.</span>
<span id="cb89-282"><a href="#cb89-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-285"><a href="#cb89-285" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-286"><a href="#cb89-286" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-287"><a href="#cb89-287" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb89-288"><a href="#cb89-288" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-289"><a href="#cb89-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-290"><a href="#cb89-290" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the logistic model</span></span>
<span id="cb89-291"><a href="#cb89-291" aria-hidden="true" tabindex="-1"></a>model_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(Diabetes <span class="sc">~</span> Age, <span class="at">data =</span> NHANES, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb89-292"><a href="#cb89-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-293"><a href="#cb89-293" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the graph</span></span>
<span id="cb89-294"><a href="#cb89-294" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb89-295"><a href="#cb89-295" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Diabetes ~ Age (logistic model)"</span>)</span>
<span id="cb89-296"><a href="#cb89-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-297"><a href="#cb89-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-298"><a href="#cb89-298" aria-hidden="true" tabindex="-1"></a>We get a rather unsurprising graph. As age increases, the risk of getting diabetes increases. Let us add more variables to the model and plot them one by one. Let us add the following variables; <span class="in">`Gender`</span>, <span class="in">`Depressed`</span> and <span class="in">`Education`</span>.</span>
<span id="cb89-299"><a href="#cb89-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-302"><a href="#cb89-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-303"><a href="#cb89-303" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-304"><a href="#cb89-304" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb89-305"><a href="#cb89-305" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-306"><a href="#cb89-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-307"><a href="#cb89-307" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the logistic model (adding gender)</span></span>
<span id="cb89-308"><a href="#cb89-308" aria-hidden="true" tabindex="-1"></a>model_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(Diabetes <span class="sc">~</span> Age <span class="sc">+</span> Gender, <span class="at">data =</span> NHANES, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb89-309"><a href="#cb89-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-310"><a href="#cb89-310" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the graph</span></span>
<span id="cb89-311"><a href="#cb89-311" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb89-312"><a href="#cb89-312" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"DiabetesAge ~ Age + Gender (logistic model)"</span>)</span>
<span id="cb89-313"><a href="#cb89-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-314"><a href="#cb89-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-315"><a href="#cb89-315" aria-hidden="true" tabindex="-1"></a>The addition of the third variable introduced the colour aesthetic to the plot. Let us add another variable.</span>
<span id="cb89-316"><a href="#cb89-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-319"><a href="#cb89-319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-320"><a href="#cb89-320" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-321"><a href="#cb89-321" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb89-322"><a href="#cb89-322" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-323"><a href="#cb89-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-324"><a href="#cb89-324" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the logistic model (adding depressed state)</span></span>
<span id="cb89-325"><a href="#cb89-325" aria-hidden="true" tabindex="-1"></a>model_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(Diabetes <span class="sc">~</span> Age <span class="sc">+</span> Gender <span class="sc">+</span> Depressed, <span class="at">data =</span> NHANES, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb89-326"><a href="#cb89-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-327"><a href="#cb89-327" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the graph</span></span>
<span id="cb89-328"><a href="#cb89-328" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb89-329"><a href="#cb89-329" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"DiabetesAge ~ Age + Gender + Depressed (logistic model)"</span>)</span>
<span id="cb89-330"><a href="#cb89-330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-331"><a href="#cb89-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-332"><a href="#cb89-332" aria-hidden="true" tabindex="-1"></a>Adding a fourth variable faceted the plot into the levels of the fourth variable. Let us add one last variable.</span>
<span id="cb89-333"><a href="#cb89-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-336"><a href="#cb89-336" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-337"><a href="#cb89-337" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-338"><a href="#cb89-338" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)</span>
<span id="cb89-339"><a href="#cb89-339" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-340"><a href="#cb89-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-341"><a href="#cb89-341" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the logistic model (adding Education)</span></span>
<span id="cb89-342"><a href="#cb89-342" aria-hidden="true" tabindex="-1"></a>model_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(Diabetes <span class="sc">~</span> Age <span class="sc">+</span> Gender <span class="sc">+</span> Depressed <span class="sc">+</span> Education,</span>
<span id="cb89-343"><a href="#cb89-343" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> NHANES, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb89-344"><a href="#cb89-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-345"><a href="#cb89-345" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the graph</span></span>
<span id="cb89-346"><a href="#cb89-346" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb89-347"><a href="#cb89-347" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"DiabetesAge ~ Age + Gender + Depressed + Education (logistic model)"</span>)</span>
<span id="cb89-348"><a href="#cb89-348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-349"><a href="#cb89-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-350"><a href="#cb89-350" aria-hidden="true" tabindex="-1"></a>The plot undergoes another layer of faceting. Now we get a rather complex plot as compared to the plot with just one explanatory variable. The plot shows some interesting info. Males are more prone to become diabetic as compared to females in all the groups. For college graduates who have no depression, both sexes have a reduced chance of having diabetes at younger ages as compared to all other groups. People with high school level of education and college level education have the most chance of becoming diabetic out of all groups. I leave the rest of the interpretations to the readers.</span>
<span id="cb89-351"><a href="#cb89-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-352"><a href="#cb89-352" aria-hidden="true" tabindex="-1"></a>In summary, the <span class="in">`fmodel()`</span> function syntax with four explanatory variables would be;</span>
<span id="cb89-353"><a href="#cb89-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-356"><a href="#cb89-356" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-357"><a href="#cb89-357" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb89-358"><a href="#cb89-358" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(response <span class="sc">~</span> var1 <span class="sc">+</span> var2 <span class="sc">+</span> var3 <span class="sc">+</span> var4, <span class="at">data =</span> dataset)</span>
<span id="cb89-359"><a href="#cb89-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-360"><a href="#cb89-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-361"><a href="#cb89-361" aria-hidden="true" tabindex="-1"></a>Here, the response variable will always be plotted on the y-axis. The var1 will be plotted on the x-axis and will be the main exploratory variable that we are interested in. The var2 will assume the colour aesthetic. The var3 and var4 will invoke faceting. Therefore we have;</span>
<span id="cb89-362"><a href="#cb89-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-363"><a href="#cb89-363" aria-hidden="true" tabindex="-1"></a>| Variable | Plot component |</span>
<span id="cb89-364"><a href="#cb89-364" aria-hidden="true" tabindex="-1"></a>|---|---|</span>
<span id="cb89-365"><a href="#cb89-365" aria-hidden="true" tabindex="-1"></a>| var1 | y-axis |</span>
<span id="cb89-366"><a href="#cb89-366" aria-hidden="true" tabindex="-1"></a>| var2 | colour |</span>
<span id="cb89-367"><a href="#cb89-367" aria-hidden="true" tabindex="-1"></a>| var3 | facet |</span>
<span id="cb89-368"><a href="#cb89-368" aria-hidden="true" tabindex="-1"></a>| var4 | facet |</span>
<span id="cb89-369"><a href="#cb89-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-370"><a href="#cb89-370" aria-hidden="true" tabindex="-1"></a>: fmodel() variables as plot components</span>
<span id="cb89-371"><a href="#cb89-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-372"><a href="#cb89-372" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interactions among explanatory variables</span></span>
<span id="cb89-373"><a href="#cb89-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-374"><a href="#cb89-374" aria-hidden="true" tabindex="-1"></a>Till now, when making models, we assumed that our explanatory variables are independent of each other, i.e. their effect sizes are independent of each other. But often this is not the case in real life, we can have instances where the effect size of one variable changes with the other explanatory variables. When this happens, we say that both of those variables are interacting with each other.</span>
<span id="cb89-375"><a href="#cb89-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-376"><a href="#cb89-376" aria-hidden="true" tabindex="-1"></a>To denote interacting terms in the formula, instead of a <span class="in">`+`</span> sign, we use a <span class="in">`*`</span>.</span>
<span id="cb89-377"><a href="#cb89-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-378"><a href="#cb89-378" aria-hidden="true" tabindex="-1"></a>Let us see it with an example. We will use the <span class="in">`SwimRecords`</span> dataset from the <span class="in">`mosaicData`</span> package in R. The dataset contains world records for 100m swimming for men and women over time from 1905 through 2004. We will build a linear model, using <span class="in">`time`</span> as the response variable and, <span class="in">`year`</span> and <span class="in">`sex`</span> as the explanatory variable. Here <span class="in">`time`</span> denotes the time of the world record.</span>
<span id="cb89-379"><a href="#cb89-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-382"><a href="#cb89-382" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-383"><a href="#cb89-383" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(mosaicData)) <span class="fu">install.packages</span>(<span class="st">'mosaicData'</span>)</span>
<span id="cb89-384"><a href="#cb89-384" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb89-385"><a href="#cb89-385" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-386"><a href="#cb89-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-387"><a href="#cb89-387" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb89-388"><a href="#cb89-388" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(time <span class="sc">~</span> year <span class="sc">+</span> sex, <span class="at">data =</span> SwimRecords)</span>
<span id="cb89-389"><a href="#cb89-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-390"><a href="#cb89-390" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb89-391"><a href="#cb89-391" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb89-392"><a href="#cb89-392" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"time ~ year + sex (linear model)"</span>)</span>
<span id="cb89-393"><a href="#cb89-393" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-394"><a href="#cb89-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-395"><a href="#cb89-395" aria-hidden="true" tabindex="-1"></a>From the graph, you can see that the slopes for both the lines are decreasing. This means that as years progressed, the world record times for both the sexes reduced. Also, men's record time is faster compared to women's. What happens to this plot if we introduce an interaction between <span class="in">`year`</span> and <span class="in">`sex`</span>?</span>
<span id="cb89-396"><a href="#cb89-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-399"><a href="#cb89-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-400"><a href="#cb89-400" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(mosaicData)) <span class="fu">install.packages</span>(<span class="st">'mosaicData'</span>)</span>
<span id="cb89-401"><a href="#cb89-401" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb89-402"><a href="#cb89-402" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-403"><a href="#cb89-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-404"><a href="#cb89-404" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb89-405"><a href="#cb89-405" aria-hidden="true" tabindex="-1"></a>model_lm_int <span class="ot">&lt;-</span> <span class="fu">lm</span>(time <span class="sc">~</span> year <span class="sc">*</span> sex, <span class="at">data =</span> SwimRecords)</span>
<span id="cb89-406"><a href="#cb89-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-407"><a href="#cb89-407" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb89-408"><a href="#cb89-408" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm_int) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb89-409"><a href="#cb89-409" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"time ~ year * sex (linear model)"</span>)</span>
<span id="cb89-410"><a href="#cb89-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-411"><a href="#cb89-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-412"><a href="#cb89-412" aria-hidden="true" tabindex="-1"></a>The introduction of interacting terms seems to converge the two lines. For better comparison, use the slider to compare the plots as given below.</span>
<span id="cb89-413"><a href="#cb89-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-414"><a href="#cb89-414" aria-hidden="true" tabindex="-1"></a>::: {.juxtapose data-startingposition="50%"}</span>
<span id="cb89-415"><a href="#cb89-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-418"><a href="#cb89-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-419"><a href="#cb89-419" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(mosaicData)) <span class="fu">install.packages</span>(<span class="st">'mosaicData'</span>)</span>
<span id="cb89-420"><a href="#cb89-420" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb89-421"><a href="#cb89-421" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-422"><a href="#cb89-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-423"><a href="#cb89-423" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb89-424"><a href="#cb89-424" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(time <span class="sc">~</span> year <span class="sc">+</span> sex, <span class="at">data =</span> SwimRecords)</span>
<span id="cb89-425"><a href="#cb89-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-426"><a href="#cb89-426" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb89-427"><a href="#cb89-427" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb89-428"><a href="#cb89-428" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"time ~ year + sex (linear model without interaction)"</span>)</span>
<span id="cb89-429"><a href="#cb89-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-430"><a href="#cb89-430" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model with interaction term</span></span>
<span id="cb89-431"><a href="#cb89-431" aria-hidden="true" tabindex="-1"></a>model_lm_int <span class="ot">&lt;-</span> <span class="fu">lm</span>(time <span class="sc">~</span> year <span class="sc">*</span> sex, <span class="at">data =</span> SwimRecords)</span>
<span id="cb89-432"><a href="#cb89-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-433"><a href="#cb89-433" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb89-434"><a href="#cb89-434" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm_int) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb89-435"><a href="#cb89-435" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"time ~ year * sex (linear model with interaction)"</span>)</span>
<span id="cb89-436"><a href="#cb89-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-437"><a href="#cb89-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-438"><a href="#cb89-438" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb89-439"><a href="#cb89-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-440"><a href="#cb89-440" aria-hidden="true" tabindex="-1"></a>We get some interesting results. First of all, compared to the plot without the interaction term, the slope changes for both the sexes, in the plot with interaction terms. Also, the lines are not parallel when interaction terms are introduced, this is direct evidence showing that both <span class="in">`year`</span> and <span class="in">`sex`</span>  variables are truly interacting with each other. This is why with increasing years, the gap between the lines decreased, indicating a reduced effect size of sex with increasing years.</span>
<span id="cb89-441"><a href="#cb89-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-442"><a href="#cb89-442" aria-hidden="true" tabindex="-1"></a>To see if this interaction term makes the model better, we can calculate the mean of the square of prediction errors (m.s.e) for each model and do a t.test using them (something we learned in the previous tutorial).</span>
<span id="cb89-443"><a href="#cb89-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-446"><a href="#cb89-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-447"><a href="#cb89-447" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(mosaicData)) <span class="fu">install.packages</span>(<span class="st">'mosaicData'</span>)</span>
<span id="cb89-448"><a href="#cb89-448" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb89-449"><a href="#cb89-449" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-450"><a href="#cb89-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-451"><a href="#cb89-451" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb89-452"><a href="#cb89-452" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(time <span class="sc">~</span> year <span class="sc">+</span> sex, <span class="at">data =</span> SwimRecords)</span>
<span id="cb89-453"><a href="#cb89-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-454"><a href="#cb89-454" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model with interaction term</span></span>
<span id="cb89-455"><a href="#cb89-455" aria-hidden="true" tabindex="-1"></a>model_lm_int <span class="ot">&lt;-</span> <span class="fu">lm</span>(time <span class="sc">~</span> year <span class="sc">*</span> sex, <span class="at">data =</span> SwimRecords)</span>
<span id="cb89-456"><a href="#cb89-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-457"><a href="#cb89-457" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the m.s.e</span></span>
<span id="cb89-458"><a href="#cb89-458" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(mse <span class="sc">~</span> model, <span class="at">data =</span> <span class="fu">cv_pred_error</span>(model_lm, model_lm_int))</span>
<span id="cb89-459"><a href="#cb89-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-460"><a href="#cb89-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-461"><a href="#cb89-461" aria-hidden="true" tabindex="-1"></a>For $\alpha = 0.05$ level of significance, we have a p-value &lt; 0.05. Thus we conclude that the m.s.e values between the two models are significantly different from each other. Also, from the t.test summary, we can see that the m.s.e value is lowest for the model with the interaction term as compared to the model without the interaction term. This means interaction made the model better.</span>
<span id="cb89-462"><a href="#cb89-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-463"><a href="#cb89-463" aria-hidden="true" tabindex="-1"></a>Some takeaway points about effect sizes, from analysing the plots are;</span>
<span id="cb89-464"><a href="#cb89-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-465"><a href="#cb89-465" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb89-466"><a href="#cb89-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-467"><a href="#cb89-467" aria-hidden="true" tabindex="-1"></a><span class="fu">## Point 1</span></span>
<span id="cb89-468"><a href="#cb89-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-469"><a href="#cb89-469" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/tab_1.png)</span></span>
<span id="cb89-470"><a href="#cb89-470" aria-hidden="true" tabindex="-1"></a>The slope of the line is the effect size of the x-axis exploratory variable on the y-axis response variable.</span>
<span id="cb89-471"><a href="#cb89-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-472"><a href="#cb89-472" aria-hidden="true" tabindex="-1"></a><span class="fu">## Point 2</span></span>
<span id="cb89-473"><a href="#cb89-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-474"><a href="#cb89-474" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/tab_2.png)</span></span>
<span id="cb89-475"><a href="#cb89-475" aria-hidden="true" tabindex="-1"></a>The difference in y-intercepts of both the lines for a given x-axis exploratory variable value gives the effect size of the colour aesthetic on the y-axis response variable.</span>
<span id="cb89-476"><a href="#cb89-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-477"><a href="#cb89-477" aria-hidden="true" tabindex="-1"></a><span class="fu">## Point 3</span></span>
<span id="cb89-478"><a href="#cb89-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-479"><a href="#cb89-479" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/tab_3.png)</span></span>
<span id="cb89-480"><a href="#cb89-480" aria-hidden="true" tabindex="-1"></a>If lines are parallel, then there is no interaction between the x-axis variable and the colour aesthetic variable.</span>
<span id="cb89-481"><a href="#cb89-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-482"><a href="#cb89-482" aria-hidden="true" tabindex="-1"></a><span class="fu">## Point 4</span></span>
<span id="cb89-483"><a href="#cb89-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-484"><a href="#cb89-484" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/tab_4.png)</span></span>
<span id="cb89-485"><a href="#cb89-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-486"><a href="#cb89-486" aria-hidden="true" tabindex="-1"></a>The difference between the values of the slopes tells how the colour aesthetic variable is affecting the effect size of the x-axis variable.</span>
<span id="cb89-487"><a href="#cb89-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-488"><a href="#cb89-488" aria-hidden="true" tabindex="-1"></a><span class="fu">## Point 5</span></span>
<span id="cb89-489"><a href="#cb89-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-490"><a href="#cb89-490" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/tab_5.png)</span></span>
<span id="cb89-491"><a href="#cb89-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-492"><a href="#cb89-492" aria-hidden="true" tabindex="-1"></a>The rate of change of the y-intercepts tells how the x-axis variable is affecting the effect size of the colour aesthetic variable. </span>
<span id="cb89-493"><a href="#cb89-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-494"><a href="#cb89-494" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb89-495"><a href="#cb89-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-496"><a href="#cb89-496" aria-hidden="true" tabindex="-1"></a>Now we are equipped with a strong intuition of how the interaction between variables affects the effect size of those variables and how they can be visualized from the plot.</span>
<span id="cb89-497"><a href="#cb89-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-498"><a href="#cb89-498" aria-hidden="true" tabindex="-1"></a><span class="fu">## Polynomial regression</span></span>
<span id="cb89-499"><a href="#cb89-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-500"><a href="#cb89-500" aria-hidden="true" tabindex="-1"></a>Let us look at the <span class="in">`Tadpoles`</span> dataset from the <span class="in">`{mosaicModel}`</span> package in R. We saw this dataset while we learned about covariates in the previous tutorial. The dataset contains the swimming speed of tadpoles as a function of the water temperature and the water temperature at which the tadpoles had been raised. Let us plot the temperature at which the tadpoles were allowed to swim versus the maximum swimming speed.</span>
<span id="cb89-501"><a href="#cb89-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-504"><a href="#cb89-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-505"><a href="#cb89-505" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(mosaicModel)) <span class="fu">install.packages</span>(<span class="st">'mosaicModel'</span>)</span>
<span id="cb89-506"><a href="#cb89-506" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicModel)</span>
<span id="cb89-507"><a href="#cb89-507" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb89-508"><a href="#cb89-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-509"><a href="#cb89-509" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Tadpoles)</span>
<span id="cb89-510"><a href="#cb89-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-511"><a href="#cb89-511" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a plot</span></span>
<span id="cb89-512"><a href="#cb89-512" aria-hidden="true" tabindex="-1"></a>Tadpoles <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(rtemp, vmax)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb89-513"><a href="#cb89-513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-514"><a href="#cb89-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-515"><a href="#cb89-515" aria-hidden="true" tabindex="-1"></a>Now let us try building a linear model using <span class="in">`vmax`</span> as the response variable and <span class="in">`rtemp`</span> as the exploratory variable.</span>
<span id="cb89-516"><a href="#cb89-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-519"><a href="#cb89-519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-520"><a href="#cb89-520" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicModel)</span>
<span id="cb89-521"><a href="#cb89-521" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-522"><a href="#cb89-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-523"><a href="#cb89-523" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Tadpoles)</span>
<span id="cb89-524"><a href="#cb89-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-525"><a href="#cb89-525" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb89-526"><a href="#cb89-526" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(vmax <span class="sc">~</span> rtemp, <span class="at">data =</span> Tadpoles)</span>
<span id="cb89-527"><a href="#cb89-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-528"><a href="#cb89-528" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb89-529"><a href="#cb89-529" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> Tadpoles) <span class="sc">+</span></span>
<span id="cb89-530"><a href="#cb89-530" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span>
<span id="cb89-531"><a href="#cb89-531" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-532"><a href="#cb89-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-533"><a href="#cb89-533" aria-hidden="true" tabindex="-1"></a>We see that the model out shows a weak relationship between the temperature at which the tadpoles were allowed to swim and the maximum swimming speed. But our intuition tells us that most of the maximum values for <span class="in">`vmax`</span> peaked at temperatures of 15°C and 25°C hence, the line should curve upwards at these temperature regions. Essentially, instead of a straight line relationship, a parabolic relationship would be better for defining the relationship between <span class="in">`rtemp`</span> and <span class="in">`vmax`</span>. To tell the model to consider <span class="in">`rtemp`</span> as a second-order variable, we use the <span class="in">`I()`</span> function. So here, including <span class="in">`I(rtemp^2)`</span> in the formula will inform the model to regress <span class="in">`vmax`</span> against <span class="in">`rtemp^2`</span>. You might be tempted to ask, why not just use <span class="in">`rtemp^2`</span> in the model formula? If we use <span class="in">`vmax ~ rtemp^2`</span> as the model formula, then notation wise it is equivalent to using <span class="in">`vmax ~ rtemp * rtemp`</span>. If we run the model using this formula, the model will omit one of the <span class="in">`rtemp`</span> variables as it is redundant to regress against a variable interacting with itself.</span>
<span id="cb89-534"><a href="#cb89-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-535"><a href="#cb89-535" aria-hidden="true" tabindex="-1"></a>On a more technical note, in R, the symbols <span class="in">`"+", "-", "*" and "^"`</span> are interpreted as formula operators. Therefore if <span class="in">`rtemp^2`</span> is used inside the formula, it will consider it as <span class="in">`rtemp * rtemp`</span>. Thus to make things right, we use the <span class="in">`I()`</span> function, so that R will interpret <span class="in">`rtemp^2`</span> as a new predictor with squared values.</span>
<span id="cb89-536"><a href="#cb89-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-537"><a href="#cb89-537" aria-hidden="true" tabindex="-1"></a>Let us plot a polynomial model for the same question as above.</span>
<span id="cb89-538"><a href="#cb89-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-541"><a href="#cb89-541" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-542"><a href="#cb89-542" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicModel)</span>
<span id="cb89-543"><a href="#cb89-543" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-544"><a href="#cb89-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-545"><a href="#cb89-545" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Tadpoles)</span>
<span id="cb89-546"><a href="#cb89-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-547"><a href="#cb89-547" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model with rtemp in second order using I()</span></span>
<span id="cb89-548"><a href="#cb89-548" aria-hidden="true" tabindex="-1"></a>model_lm_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vmax <span class="sc">~</span> rtemp <span class="sc">+</span> <span class="fu">I</span>(rtemp<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> Tadpoles)</span>
<span id="cb89-549"><a href="#cb89-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-550"><a href="#cb89-550" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb89-551"><a href="#cb89-551" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm_2) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> Tadpoles) <span class="sc">+</span></span>
<span id="cb89-552"><a href="#cb89-552" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span>
<span id="cb89-553"><a href="#cb89-553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-554"><a href="#cb89-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-555"><a href="#cb89-555" aria-hidden="true" tabindex="-1"></a>Much better plot than the earlier one. The same can also be achieved by using the <span class="in">`poly()`</span> function. The syntax for it is; <span class="in">`poly(variable, the order)`</span></span>
<span id="cb89-556"><a href="#cb89-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-559"><a href="#cb89-559" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-560"><a href="#cb89-560" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicModel)</span>
<span id="cb89-561"><a href="#cb89-561" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-562"><a href="#cb89-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-563"><a href="#cb89-563" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Tadpoles)</span>
<span id="cb89-564"><a href="#cb89-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-565"><a href="#cb89-565" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model with rtemp in second order using poly()</span></span>
<span id="cb89-566"><a href="#cb89-566" aria-hidden="true" tabindex="-1"></a>model_lm_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vmax <span class="sc">~</span> <span class="fu">poly</span>(rtemp, <span class="dv">2</span>), <span class="at">data =</span> Tadpoles)</span>
<span id="cb89-567"><a href="#cb89-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-568"><a href="#cb89-568" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb89-569"><a href="#cb89-569" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm_2) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> Tadpoles) <span class="sc">+</span></span>
<span id="cb89-570"><a href="#cb89-570" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span>
<span id="cb89-571"><a href="#cb89-571" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-572"><a href="#cb89-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-573"><a href="#cb89-573" aria-hidden="true" tabindex="-1"></a><span class="fu">## Total and partial change</span></span>
<span id="cb89-574"><a href="#cb89-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-575"><a href="#cb89-575" aria-hidden="true" tabindex="-1"></a>From the previous tutorial and current tutorial, we built our notion of effect size bit by bit. In a gist, the flowchart below shows our efforts till now;</span>
<span id="cb89-576"><a href="#cb89-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-579"><a href="#cb89-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb89-580"><a href="#cb89-580" aria-hidden="true" tabindex="-1"></a>%<span class="dt">%</span>{init: {<span class="ot">'</span><span class="ss">securityLevel</span><span class="ot">'</span>: <span class="ot">'</span><span class="ss">loose</span><span class="ot">'</span>, <span class="ot">'</span><span class="ss">theme</span><span class="ot">'</span>:<span class="ot">'</span><span class="ss">base</span><span class="ot">'</span>}}%%</span>
<span id="cb89-581"><a href="#cb89-581" aria-hidden="true" tabindex="-1"></a>graph TB</span>
<span id="cb89-582"><a href="#cb89-582" aria-hidden="true" tabindex="-1"></a>  A[Understanding effect sizes] -<span class="ot">-o</span> B(In the context of numerical explanatory variable)</span>
<span id="cb89-583"><a href="#cb89-583" aria-hidden="true" tabindex="-1"></a>  B --&gt; C(In the context of categorical explanatory variable)</span>
<span id="cb89-584"><a href="#cb89-584" aria-hidden="true" tabindex="-1"></a>  C --&gt; D(Magnitude <span class="ot">and</span> the sign of effect size value)</span>
<span id="cb89-585"><a href="#cb89-585" aria-hidden="true" tabindex="-1"></a>  D --&gt; E(Units of effect size)</span>
<span id="cb89-586"><a href="#cb89-586" aria-hidden="true" tabindex="-1"></a>  E --&gt; F(In the context of categorical response variable)</span>
<span id="cb89-587"><a href="#cb89-587" aria-hidden="true" tabindex="-1"></a>  F --&gt; G(How interaction terms affect effect sizes:&lt;br&gt;Understanding it from graphs)</span>
<span id="cb89-588"><a href="#cb89-588" aria-hidden="true" tabindex="-1"></a>  G -.-&gt; H(How interaction terms affect effect sizes:&lt;br&gt;Understanding it from calculations)</span>
<span id="cb89-589"><a href="#cb89-589" aria-hidden="true" tabindex="-1"></a>  style H fill:<span class="co">#f96</span></span>
<span id="cb89-590"><a href="#cb89-590" aria-hidden="true" tabindex="-1"></a>  subgraph Flowchart on current understanding of effect size</span>
<span id="cb89-591"><a href="#cb89-591" aria-hidden="true" tabindex="-1"></a>  A</span>
<span id="cb89-592"><a href="#cb89-592" aria-hidden="true" tabindex="-1"></a>  B</span>
<span id="cb89-593"><a href="#cb89-593" aria-hidden="true" tabindex="-1"></a>  C</span>
<span id="cb89-594"><a href="#cb89-594" aria-hidden="true" tabindex="-1"></a>  D</span>
<span id="cb89-595"><a href="#cb89-595" aria-hidden="true" tabindex="-1"></a>  E</span>
<span id="cb89-596"><a href="#cb89-596" aria-hidden="true" tabindex="-1"></a>  F</span>
<span id="cb89-597"><a href="#cb89-597" aria-hidden="true" tabindex="-1"></a>  G</span>
<span id="cb89-598"><a href="#cb89-598" aria-hidden="true" tabindex="-1"></a>  H</span>
<span id="cb89-599"><a href="#cb89-599" aria-hidden="true" tabindex="-1"></a>  end</span>
<span id="cb89-600"><a href="#cb89-600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-601"><a href="#cb89-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-602"><a href="#cb89-602" aria-hidden="true" tabindex="-1"></a>From the flowchart, we can appreciate the growing complexity in the understanding of effect size. We have already begun to understand effect sizes in the context of interaction terms as seen from previous graphs. Now let us try to calculate effect sizes with interaction terms.</span>
<span id="cb89-603"><a href="#cb89-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-604"><a href="#cb89-604" aria-hidden="true" tabindex="-1"></a>We will use the <span class="in">`HorsePrices`</span> dataset from the <span class="in">`{Stat2Data}`</span> package in R. The dataset contains the price and related characteristics of horses listed for sale on the internet. The variables in the dataset include; <span class="in">`Price`</span> = Price of the horse ($), <span class="in">`HorseID`</span> = ID of the horse, <span class="in">`Age`</span> = Age of the horse, <span class="in">`Height`</span> = Height of the horse and <span class="in">`Sex`</span> = Sex of the horse.</span>
<span id="cb89-605"><a href="#cb89-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-606"><a href="#cb89-606" aria-hidden="true" tabindex="-1"></a>Suppose we are interested in the following questions</span>
<span id="cb89-607"><a href="#cb89-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-608"><a href="#cb89-608" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>How does the price of the horse change between sexes?</span>
<span id="cb89-609"><a href="#cb89-609" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>How does the price of the horse change between sexes for the same height and age?</span>
<span id="cb89-610"><a href="#cb89-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-611"><a href="#cb89-611" aria-hidden="true" tabindex="-1"></a>In the first question, we are checking for the price difference between the sexes. Here, when sex changes, the covariate variables; height and age of the horse will also change with sex. Therefore, here we are measuring the change in price by allowing all other variables in the model to change along with the exploratory variable sex. This is termed the 'total change in price as sex changes'.</span>
<span id="cb89-612"><a href="#cb89-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-613"><a href="#cb89-613" aria-hidden="true" tabindex="-1"></a>In the second question, unlike the first, we want to specifically see what is the price difference between sexes. To see this change, we keep height and age constant. Therefore, the only change seen in this case would be coming from the sex change. This is termed the 'partial change of price as sex changes'.</span>
<span id="cb89-614"><a href="#cb89-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-615"><a href="#cb89-615" aria-hidden="true" tabindex="-1"></a>For the first question, we will calculate the effect size of sex on price using the following lines of code. Since our question focuses on the total change in price with sex, we make a model by excluding all the other covariates that we want to change as sex changes.</span>
<span id="cb89-616"><a href="#cb89-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-619"><a href="#cb89-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-620"><a href="#cb89-620" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-621"><a href="#cb89-621" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(Stat2Data)) <span class="fu">install.packages</span>(<span class="st">'Stat2Data'</span>)</span>
<span id="cb89-622"><a href="#cb89-622" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb89-623"><a href="#cb89-623" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-624"><a href="#cb89-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-625"><a href="#cb89-625" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb89-626"><a href="#cb89-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-627"><a href="#cb89-627" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb89-628"><a href="#cb89-628" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Sex, <span class="at">data =</span> HorsePrices)</span>
<span id="cb89-629"><a href="#cb89-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-630"><a href="#cb89-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-631"><a href="#cb89-631" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb89-632"><a href="#cb89-632" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_lm, <span class="sc">~</span> Sex)</span>
<span id="cb89-633"><a href="#cb89-633" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-634"><a href="#cb89-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-635"><a href="#cb89-635" aria-hidden="true" tabindex="-1"></a>The effect size value tells us that, changing from a male horse to a female, the price depreciates by 17225 dollars. Now to answer the second question, to calculate the partial change in price because of a change in sex, we build a model by including all the other covariates that we want to keep constant when we change sex.</span>
<span id="cb89-636"><a href="#cb89-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-639"><a href="#cb89-639" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-640"><a href="#cb89-640" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-641"><a href="#cb89-641" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(Stat2Data)) <span class="fu">install.packages</span>(<span class="st">'Stat2Data'</span>)</span>
<span id="cb89-642"><a href="#cb89-642" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb89-643"><a href="#cb89-643" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-644"><a href="#cb89-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-645"><a href="#cb89-645" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb89-646"><a href="#cb89-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-647"><a href="#cb89-647" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb89-648"><a href="#cb89-648" aria-hidden="true" tabindex="-1"></a>model_lm_partial <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Sex <span class="sc">+</span> Height <span class="sc">+</span> Age, <span class="at">data =</span> HorsePrices)</span>
<span id="cb89-649"><a href="#cb89-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-650"><a href="#cb89-650" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb89-651"><a href="#cb89-651" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_lm_partial, <span class="sc">~</span> Sex)</span>
<span id="cb89-652"><a href="#cb89-652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-653"><a href="#cb89-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-654"><a href="#cb89-654" aria-hidden="true" tabindex="-1"></a>The effect size value, in this case, tells us that, a male horse of age 6 and 16.5m in height will be 9928 dollars more costly than a female horse of the same physical attributes. Here it's clear that for the given height and age, there is a price difference between male and female horses, something which we were trying to answer.</span>
<span id="cb89-655"><a href="#cb89-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-656"><a href="#cb89-656" aria-hidden="true" tabindex="-1"></a><span class="fu">## R-squared in terms of model output</span></span>
<span id="cb89-657"><a href="#cb89-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-658"><a href="#cb89-658" aria-hidden="true" tabindex="-1"></a>So far we have seen metrics like the mean of the square of prediction error and likelihood values to evaluate a model's predictive abilities. In terms of variables used in the model formula, we know how to interpret them using effect sizes. There is also another metric called R-squared ($R^2$).</span>
<span id="cb89-659"><a href="#cb89-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-660"><a href="#cb89-660" aria-hidden="true" tabindex="-1"></a>One of the implications of a model is to account for variations seen within the response variable to the model output values. The R-squared value tells us how well this has been done. By definition;</span>
<span id="cb89-661"><a href="#cb89-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-662"><a href="#cb89-662" aria-hidden="true" tabindex="-1"></a>$$R^2 = \frac{variance\,of\,model\,output\,values}{variance\,of\,response\,variable\,values}$$</span>
<span id="cb89-663"><a href="#cb89-663" aria-hidden="true" tabindex="-1"></a>The R-squared value is always positive and is between 0 and 1. R-squared value of 1 means that the model accounted for all the variance seen within the actual dataset values of the response variable. R-squared value of 0 means that the model does not account for any variance seen in the response variable. </span>
<span id="cb89-664"><a href="#cb89-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-665"><a href="#cb89-665" aria-hidden="true" tabindex="-1"></a>But the R-squared value has its flaws which we will see soon.</span>
<span id="cb89-666"><a href="#cb89-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-667"><a href="#cb89-667" aria-hidden="true" tabindex="-1"></a>Let us calculate the R-squared value for some models. We will again use the <span class="in">`HorsePrices`</span> dataset from the <span class="in">`{Stat2Data}`</span> package in R. Let us build the earlier model again and calculate the R-squared value for the model. We will use the <span class="in">`evaluate_model()`</span> function from the <span class="in">`statisticalModeling`</span> package to get the predicted values. For now, we will use the training dataset itself as the testing dataset. We will use the <span class="in">`var()`</span> formula to calculate the variance.</span>
<span id="cb89-668"><a href="#cb89-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-671"><a href="#cb89-671" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-672"><a href="#cb89-672" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-673"><a href="#cb89-673" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb89-674"><a href="#cb89-674" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-675"><a href="#cb89-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-676"><a href="#cb89-676" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb89-677"><a href="#cb89-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-678"><a href="#cb89-678" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb89-679"><a href="#cb89-679" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Sex, <span class="at">data =</span> HorsePrices)</span>
<span id="cb89-680"><a href="#cb89-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-681"><a href="#cb89-681" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the predicted values</span></span>
<span id="cb89-682"><a href="#cb89-682" aria-hidden="true" tabindex="-1"></a>model_lm_output <span class="ot">&lt;-</span> <span class="fu">evaluate_model</span>(model_lm, <span class="at">data =</span> HorsePrices)</span>
<span id="cb89-683"><a href="#cb89-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-684"><a href="#cb89-684" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the R-squared value</span></span>
<span id="cb89-685"><a href="#cb89-685" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="at">data =</span> model_lm_output, <span class="fu">var</span>(model_output)<span class="sc">/</span><span class="fu">var</span>(Price))</span>
<span id="cb89-686"><a href="#cb89-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-687"><a href="#cb89-687" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing R-squared value</span></span>
<span id="cb89-688"><a href="#cb89-688" aria-hidden="true" tabindex="-1"></a>r_squared</span>
<span id="cb89-689"><a href="#cb89-689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-690"><a href="#cb89-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-691"><a href="#cb89-691" aria-hidden="true" tabindex="-1"></a>We get an R-squared value of 0.32. What this means is that 32% of the variability seen in the price of the horses is explained by the sex of the horses.</span>
<span id="cb89-692"><a href="#cb89-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-693"><a href="#cb89-693" aria-hidden="true" tabindex="-1"></a>Now let us add in more explanatory variables and calculate the R-squared value. We will also remove any <span class="in">`NA`</span> values in the model variables.</span>
<span id="cb89-694"><a href="#cb89-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-697"><a href="#cb89-697" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-698"><a href="#cb89-698" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-699"><a href="#cb89-699" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb89-700"><a href="#cb89-700" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-701"><a href="#cb89-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-702"><a href="#cb89-702" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb89-703"><a href="#cb89-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-704"><a href="#cb89-704" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing NA values</span></span>
<span id="cb89-705"><a href="#cb89-705" aria-hidden="true" tabindex="-1"></a>HorsePrices_new <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(HorsePrices)</span>
<span id="cb89-706"><a href="#cb89-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-707"><a href="#cb89-707" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb89-708"><a href="#cb89-708" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Sex <span class="sc">+</span> Height <span class="sc">+</span> Age, <span class="at">data =</span> HorsePrices_new)</span>
<span id="cb89-709"><a href="#cb89-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-710"><a href="#cb89-710" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the predicted values</span></span>
<span id="cb89-711"><a href="#cb89-711" aria-hidden="true" tabindex="-1"></a>model_lm_output <span class="ot">&lt;-</span> <span class="fu">evaluate_model</span>(model_lm, <span class="at">data =</span> HorsePrices_new)</span>
<span id="cb89-712"><a href="#cb89-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-713"><a href="#cb89-713" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the R-squared value</span></span>
<span id="cb89-714"><a href="#cb89-714" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="at">data =</span> model_lm_output, <span class="fu">var</span>(model_output)<span class="sc">/</span><span class="fu">var</span>(Price))</span>
<span id="cb89-715"><a href="#cb89-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-716"><a href="#cb89-716" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing R-squared value</span></span>
<span id="cb89-717"><a href="#cb89-717" aria-hidden="true" tabindex="-1"></a>r_squared</span>
<span id="cb89-718"><a href="#cb89-718" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-719"><a href="#cb89-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-720"><a href="#cb89-720" aria-hidden="true" tabindex="-1"></a>We got a higher R-squared value than before. Instead of 32%, we now can account for 43% of variability seen in price by all the other variables.</span>
<span id="cb89-721"><a href="#cb89-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-722"><a href="#cb89-722" aria-hidden="true" tabindex="-1"></a>Does this mean that this model is better than the previous one? Before we jump in, let us do a fun little experiment. Let us see what happens if we add in random variables with no predicted power whatsoever to the model and run a model using them.</span>
<span id="cb89-723"><a href="#cb89-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-726"><a href="#cb89-726" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-727"><a href="#cb89-727" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-728"><a href="#cb89-728" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb89-729"><a href="#cb89-729" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-730"><a href="#cb89-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-731"><a href="#cb89-731" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb89-732"><a href="#cb89-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-733"><a href="#cb89-733" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing NA values</span></span>
<span id="cb89-734"><a href="#cb89-734" aria-hidden="true" tabindex="-1"></a>HorsePrices_new <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(HorsePrices)</span>
<span id="cb89-735"><a href="#cb89-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-736"><a href="#cb89-736" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding random variable</span></span>
<span id="cb89-737"><a href="#cb89-737" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">56</span>)</span>
<span id="cb89-738"><a href="#cb89-738" aria-hidden="true" tabindex="-1"></a>HorsePrices_new<span class="sc">$</span>Random <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(HorsePrices_new)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb89-739"><a href="#cb89-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-740"><a href="#cb89-740" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb89-741"><a href="#cb89-741" aria-hidden="true" tabindex="-1"></a>model_lm_random <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Sex <span class="sc">+</span> Height <span class="sc">+</span> Age <span class="sc">+</span> Random, <span class="at">data =</span> HorsePrices_new)</span>
<span id="cb89-742"><a href="#cb89-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-743"><a href="#cb89-743" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the predicted values</span></span>
<span id="cb89-744"><a href="#cb89-744" aria-hidden="true" tabindex="-1"></a>model_lm_random_output <span class="ot">&lt;-</span> <span class="fu">evaluate_model</span>(model_lm_random, <span class="at">data =</span> HorsePrices_new)</span>
<span id="cb89-745"><a href="#cb89-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-746"><a href="#cb89-746" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the R-squared value</span></span>
<span id="cb89-747"><a href="#cb89-747" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="at">data =</span> model_lm_random_output, <span class="fu">var</span>(model_output)<span class="sc">/</span><span class="fu">var</span>(Price))</span>
<span id="cb89-748"><a href="#cb89-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-749"><a href="#cb89-749" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing R-squared value</span></span>
<span id="cb89-750"><a href="#cb89-750" aria-hidden="true" tabindex="-1"></a>r_squared</span>
<span id="cb89-751"><a href="#cb89-751" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-752"><a href="#cb89-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-753"><a href="#cb89-753" aria-hidden="true" tabindex="-1"></a>We got an R-squared value of 0.44. The random variable should throw off the model output, then why did we get a higher R-squared value?</span>
<span id="cb89-754"><a href="#cb89-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-755"><a href="#cb89-755" aria-hidden="true" tabindex="-1"></a>The R-squared value of a model will increase with increasing explanatory variables. To remind you again, the R-squared value comes partly from the model output and our model output comes from the design of the model. The model design includes selecting the appropriate explanatory variables which are up to the user. Therefore, stupidly adding variables which have no relationship whatsoever with the response variable can lead us to the wrong conclusion. Let us calculate the mean square of the prediction error for our last two models and compare them.</span>
<span id="cb89-756"><a href="#cb89-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-759"><a href="#cb89-759" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-760"><a href="#cb89-760" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-761"><a href="#cb89-761" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb89-762"><a href="#cb89-762" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-763"><a href="#cb89-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-764"><a href="#cb89-764" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb89-765"><a href="#cb89-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-766"><a href="#cb89-766" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing NA values</span></span>
<span id="cb89-767"><a href="#cb89-767" aria-hidden="true" tabindex="-1"></a>HorsePrices_new <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(HorsePrices)</span>
<span id="cb89-768"><a href="#cb89-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-769"><a href="#cb89-769" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding random variable</span></span>
<span id="cb89-770"><a href="#cb89-770" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">56</span>)</span>
<span id="cb89-771"><a href="#cb89-771" aria-hidden="true" tabindex="-1"></a>HorsePrices_new<span class="sc">$</span>Random <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(HorsePrices_new)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb89-772"><a href="#cb89-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-773"><a href="#cb89-773" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb89-774"><a href="#cb89-774" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Sex, <span class="at">data =</span> HorsePrices_new)</span>
<span id="cb89-775"><a href="#cb89-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-776"><a href="#cb89-776" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model with random variable</span></span>
<span id="cb89-777"><a href="#cb89-777" aria-hidden="true" tabindex="-1"></a>model_lm_random <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Sex <span class="sc">+</span> Random, <span class="at">data =</span> HorsePrices_new)</span>
<span id="cb89-778"><a href="#cb89-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-779"><a href="#cb89-779" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the mean of square of prediction errors for trials</span></span>
<span id="cb89-780"><a href="#cb89-780" aria-hidden="true" tabindex="-1"></a>model_errors <span class="ot">&lt;-</span> <span class="fu">cv_pred_error</span>(model_lm, model_lm_random)</span>
<span id="cb89-781"><a href="#cb89-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-782"><a href="#cb89-782" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the mean of square of prediction errors</span></span>
<span id="cb89-783"><a href="#cb89-783" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(mse <span class="sc">~</span> model, model_errors)</span>
<span id="cb89-784"><a href="#cb89-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-785"><a href="#cb89-785" aria-hidden="true" tabindex="-1"></a><span class="co"># Conducting t-test</span></span>
<span id="cb89-786"><a href="#cb89-786" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(mse <span class="sc">~</span> model, model_errors)</span>
<span id="cb89-787"><a href="#cb89-787" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-788"><a href="#cb89-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-789"><a href="#cb89-789" aria-hidden="true" tabindex="-1"></a>The plot and the t.test results can be used to check if the model with the random variable is indeed a poor one compared to the model without any random variable, something the R-squared value failed to report. Therefore R-squared value has its flaw, but it is widely used by people. Therefore, we should be very careful in interpreting the R-squared values of different models. Different models made from the same data can have different R-squared values.</span>
<span id="cb89-790"><a href="#cb89-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-791"><a href="#cb89-791" aria-hidden="true" tabindex="-1"></a><span class="fu">## R-squared in terms of residuals</span></span>
<span id="cb89-792"><a href="#cb89-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-793"><a href="#cb89-793" aria-hidden="true" tabindex="-1"></a>From the above example, I mentioned that the R-squared value tells us how much percentage of the variability seen within the response variable is captured by the predicted model output values. Another way of seeing the same thing is through residuals. The residual is the distance between the regression line and the response variable value, or in other words, the difference between the fitted value and the corresponding response variable value. We can find R-squared using the following formula also;</span>
<span id="cb89-794"><a href="#cb89-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-795"><a href="#cb89-795" aria-hidden="true" tabindex="-1"></a>$$R^2 = \frac{variance\,of\,response\,variable\,values - variance\,of\,residuals}{variance\,of\,response\,variable\,values}$$</span>
<span id="cb89-796"><a href="#cb89-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-797"><a href="#cb89-797" aria-hidden="true" tabindex="-1"></a>We can use the following code to calculate the R-squared value via the above formula.</span>
<span id="cb89-798"><a href="#cb89-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-801"><a href="#cb89-801" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-802"><a href="#cb89-802" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-803"><a href="#cb89-803" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb89-804"><a href="#cb89-804" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-805"><a href="#cb89-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-806"><a href="#cb89-806" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb89-807"><a href="#cb89-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-808"><a href="#cb89-808" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing NA values</span></span>
<span id="cb89-809"><a href="#cb89-809" aria-hidden="true" tabindex="-1"></a>HorsePrices_new <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(HorsePrices)</span>
<span id="cb89-810"><a href="#cb89-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-811"><a href="#cb89-811" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb89-812"><a href="#cb89-812" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Sex <span class="sc">+</span> Height <span class="sc">+</span> Age, <span class="at">data =</span> HorsePrices_new)</span>
<span id="cb89-813"><a href="#cb89-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-814"><a href="#cb89-814" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the predicted values</span></span>
<span id="cb89-815"><a href="#cb89-815" aria-hidden="true" tabindex="-1"></a>model_lm_output <span class="ot">&lt;-</span> <span class="fu">evaluate_model</span>(model_lm, <span class="at">data =</span> HorsePrices_new)</span>
<span id="cb89-816"><a href="#cb89-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-817"><a href="#cb89-817" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the R-squared value using model output values</span></span>
<span id="cb89-818"><a href="#cb89-818" aria-hidden="true" tabindex="-1"></a>r_squared_mo <span class="ot">&lt;-</span> <span class="fu">with</span>(<span class="at">data =</span> model_lm_output, <span class="fu">var</span>(model_output)<span class="sc">/</span><span class="fu">var</span>(Price))</span>
<span id="cb89-819"><a href="#cb89-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-820"><a href="#cb89-820" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the R-squared value using residuals</span></span>
<span id="cb89-821"><a href="#cb89-821" aria-hidden="true" tabindex="-1"></a>r_squared_res <span class="ot">&lt;-</span> (<span class="fu">var</span>(HorsePrices_new<span class="sc">$</span>Price) <span class="sc">-</span> <span class="fu">var</span>(model_lm<span class="sc">$</span>residuals)) <span class="sc">/</span> <span class="fu">var</span>(HorsePrices_new<span class="sc">$</span>Price)</span>
<span id="cb89-822"><a href="#cb89-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-823"><a href="#cb89-823" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking if both R-squared values are the same</span></span>
<span id="cb89-824"><a href="#cb89-824" aria-hidden="true" tabindex="-1"></a>r_squared_mo</span>
<span id="cb89-825"><a href="#cb89-825" aria-hidden="true" tabindex="-1"></a>r_squared_res</span>
<span id="cb89-826"><a href="#cb89-826" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(r_squared_mo) <span class="sc">==</span> <span class="fu">round</span>(r_squared_res)</span>
<span id="cb89-827"><a href="#cb89-827" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-828"><a href="#cb89-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-829"><a href="#cb89-829" aria-hidden="true" tabindex="-1"></a>As you can see, they are both the same. Therefore, the R-squared value of 1 means that the model has zero residuals, which means that the model is a perfect fit; all data points lie on the regression line. R-squared value of 0 means that the variance of residuals is the same as that of the variance of the response variable. This means the explanatory variables we chose do not account for the variation seen within the response variable.</span>
<span id="cb89-830"><a href="#cb89-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-831"><a href="#cb89-831" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bootstrapping and precision</span></span>
<span id="cb89-832"><a href="#cb89-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-833"><a href="#cb89-833" aria-hidden="true" tabindex="-1"></a>All the datasets that we have worked on till now have been collected from a large population. Therefore, from these samples, we calculated different test statistics like the mean prediction error and effect sizes. Suppose we sample data again from the same population and calculate these test statistics, if they are close to earlier calculated values, then we can say that our test statistics are precise. But re-sampling the data is often costly and tedious to do. Then how can we check for precision? We can do that using a technique called bootstrapping. Similar to resampling, instead of collecting new samples from the population, we resample the data from the already collected data itself. Essentially, we are treating our existing dataset as a population dataset from which resampling occurs. Needless to say, this would only work effectively with large datasets.</span>
<span id="cb89-834"><a href="#cb89-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-837"><a href="#cb89-837" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb89-838"><a href="#cb89-838" aria-hidden="true" tabindex="-1"></a>%<span class="dt">%</span>{init: {<span class="ot">'</span><span class="ss">securityLevel</span><span class="ot">'</span>: <span class="ot">'</span><span class="ss">loose</span><span class="ot">'</span>, <span class="ot">'</span><span class="ss">theme</span><span class="ot">'</span>:<span class="ot">'</span><span class="ss">base</span><span class="ot">'</span>}}%%</span>
<span id="cb89-839"><a href="#cb89-839" aria-hidden="true" tabindex="-1"></a>graph LR</span>
<span id="cb89-840"><a href="#cb89-840" aria-hidden="true" tabindex="-1"></a>  A[Population] --&gt; B(Random sample)</span>
<span id="cb89-841"><a href="#cb89-841" aria-hidden="true" tabindex="-1"></a>  B --&gt; C(Calculating sample statistics)</span>
<span id="cb89-842"><a href="#cb89-842" aria-hidden="true" tabindex="-1"></a>  A --&gt; D(Random sample)</span>
<span id="cb89-843"><a href="#cb89-843" aria-hidden="true" tabindex="-1"></a>  D --&gt; E(Calculating sample statistics)</span>
<span id="cb89-844"><a href="#cb89-844" aria-hidden="true" tabindex="-1"></a>  A --&gt; F(<span class="ot">"</span><span class="st">---</span><span class="ot">"</span>)</span>
<span id="cb89-845"><a href="#cb89-845" aria-hidden="true" tabindex="-1"></a>  F --&gt; G(<span class="ot">"</span><span class="st">---</span><span class="ot">"</span>)</span>
<span id="cb89-846"><a href="#cb89-846" aria-hidden="true" tabindex="-1"></a>  A --&gt; H(Random sample)</span>
<span id="cb89-847"><a href="#cb89-847" aria-hidden="true" tabindex="-1"></a>  H --&gt; I(Calculating sample statistics)</span>
<span id="cb89-848"><a href="#cb89-848" aria-hidden="true" tabindex="-1"></a>  J[Population] --&gt; K(Random sample)</span>
<span id="cb89-849"><a href="#cb89-849" aria-hidden="true" tabindex="-1"></a>  J --&gt; L(Random sample)</span>
<span id="cb89-850"><a href="#cb89-850" aria-hidden="true" tabindex="-1"></a>  J --&gt; M(Collected random sample)</span>
<span id="cb89-851"><a href="#cb89-851" aria-hidden="true" tabindex="-1"></a>  M --&gt; N(Resample <span class="dv">1</span>)</span>
<span id="cb89-852"><a href="#cb89-852" aria-hidden="true" tabindex="-1"></a>  M --&gt; O(Resample <span class="dv">2</span>)</span>
<span id="cb89-853"><a href="#cb89-853" aria-hidden="true" tabindex="-1"></a>  M --&gt; P(Resample <span class="dv">3</span>)</span>
<span id="cb89-854"><a href="#cb89-854" aria-hidden="true" tabindex="-1"></a>  J --&gt; Q(Random sample)</span>
<span id="cb89-855"><a href="#cb89-855" aria-hidden="true" tabindex="-1"></a>  subgraph Bootstrapping</span>
<span id="cb89-856"><a href="#cb89-856" aria-hidden="true" tabindex="-1"></a>  J</span>
<span id="cb89-857"><a href="#cb89-857" aria-hidden="true" tabindex="-1"></a>  K</span>
<span id="cb89-858"><a href="#cb89-858" aria-hidden="true" tabindex="-1"></a>  L</span>
<span id="cb89-859"><a href="#cb89-859" aria-hidden="true" tabindex="-1"></a>  M</span>
<span id="cb89-860"><a href="#cb89-860" aria-hidden="true" tabindex="-1"></a>  N</span>
<span id="cb89-861"><a href="#cb89-861" aria-hidden="true" tabindex="-1"></a>  O</span>
<span id="cb89-862"><a href="#cb89-862" aria-hidden="true" tabindex="-1"></a>  P</span>
<span id="cb89-863"><a href="#cb89-863" aria-hidden="true" tabindex="-1"></a>  Q</span>
<span id="cb89-864"><a href="#cb89-864" aria-hidden="true" tabindex="-1"></a>  end</span>
<span id="cb89-865"><a href="#cb89-865" aria-hidden="true" tabindex="-1"></a>  subgraph Resampling from the population</span>
<span id="cb89-866"><a href="#cb89-866" aria-hidden="true" tabindex="-1"></a>  A</span>
<span id="cb89-867"><a href="#cb89-867" aria-hidden="true" tabindex="-1"></a>  B</span>
<span id="cb89-868"><a href="#cb89-868" aria-hidden="true" tabindex="-1"></a>  C</span>
<span id="cb89-869"><a href="#cb89-869" aria-hidden="true" tabindex="-1"></a>  D</span>
<span id="cb89-870"><a href="#cb89-870" aria-hidden="true" tabindex="-1"></a>  E</span>
<span id="cb89-871"><a href="#cb89-871" aria-hidden="true" tabindex="-1"></a>  F</span>
<span id="cb89-872"><a href="#cb89-872" aria-hidden="true" tabindex="-1"></a>  G</span>
<span id="cb89-873"><a href="#cb89-873" aria-hidden="true" tabindex="-1"></a>  H</span>
<span id="cb89-874"><a href="#cb89-874" aria-hidden="true" tabindex="-1"></a>  I</span>
<span id="cb89-875"><a href="#cb89-875" aria-hidden="true" tabindex="-1"></a>  end</span>
<span id="cb89-876"><a href="#cb89-876" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-877"><a href="#cb89-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-878"><a href="#cb89-878" aria-hidden="true" tabindex="-1"></a>Let us perform a bootstrap trial code by code. We will be using the <span class="in">`run17`</span> dataset from the <span class="in">`{cherryblossom}`</span> package in R. It's a relatively large dataset that we can use to study how to do a bootstrap.</span>
<span id="cb89-879"><a href="#cb89-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-880"><a href="#cb89-880" aria-hidden="true" tabindex="-1"></a>We will first build a model and then calculate a sample statistic, which in this case would be the effect size.</span>
<span id="cb89-881"><a href="#cb89-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-884"><a href="#cb89-884" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-885"><a href="#cb89-885" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-886"><a href="#cb89-886" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(cherryblossom)) <span class="fu">install.packages</span>(<span class="st">'cherryblossom'</span>)</span>
<span id="cb89-887"><a href="#cb89-887" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb89-888"><a href="#cb89-888" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-889"><a href="#cb89-889" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb89-890"><a href="#cb89-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-891"><a href="#cb89-891" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb89-892"><a href="#cb89-892" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb89-893"><a href="#cb89-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-894"><a href="#cb89-894" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb89-895"><a href="#cb89-895" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(net_sec <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> run17_marathon)</span>
<span id="cb89-896"><a href="#cb89-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-897"><a href="#cb89-897" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb89-898"><a href="#cb89-898" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_lm, <span class="sc">~</span> age)</span>
<span id="cb89-899"><a href="#cb89-899" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-900"><a href="#cb89-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-901"><a href="#cb89-901" aria-hidden="true" tabindex="-1"></a>Using the <span class="in">`sample()`</span> function in R, we will sample the row indices in the original dataset. Then using these row indices, we build a resampled dataset. Then using this resampled dataset, we will build a new model and then calculate the effect size.</span>
<span id="cb89-902"><a href="#cb89-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-905"><a href="#cb89-905" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-906"><a href="#cb89-906" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-907"><a href="#cb89-907" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb89-908"><a href="#cb89-908" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-909"><a href="#cb89-909" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb89-910"><a href="#cb89-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-911"><a href="#cb89-911" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb89-912"><a href="#cb89-912" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb89-913"><a href="#cb89-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-914"><a href="#cb89-914" aria-hidden="true" tabindex="-1"></a><span class="co"># Collecting the row indices </span></span>
<span id="cb89-915"><a href="#cb89-915" aria-hidden="true" tabindex="-1"></a>row_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(run17_marathon), <span class="at">replace =</span> T)</span>
<span id="cb89-916"><a href="#cb89-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-917"><a href="#cb89-917" aria-hidden="true" tabindex="-1"></a><span class="co"># Resampling data using the rwo indices</span></span>
<span id="cb89-918"><a href="#cb89-918" aria-hidden="true" tabindex="-1"></a>resample_data <span class="ot">&lt;-</span> run17_marathon[row_indices, ]</span>
<span id="cb89-919"><a href="#cb89-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-920"><a href="#cb89-920" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb89-921"><a href="#cb89-921" aria-hidden="true" tabindex="-1"></a>model_lm_resample <span class="ot">&lt;-</span> <span class="fu">lm</span>(net_sec <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> resample_data)</span>
<span id="cb89-922"><a href="#cb89-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-923"><a href="#cb89-923" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb89-924"><a href="#cb89-924" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_lm_resample, <span class="sc">~</span> age)</span>
<span id="cb89-925"><a href="#cb89-925" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-926"><a href="#cb89-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-927"><a href="#cb89-927" aria-hidden="true" tabindex="-1"></a>We get a slightly different effect size value in each case. If we repeat this process, we can get multiple effect size values that we can plot to get the sampling distribution of the effect size. doing this code by code is tedious and therefore we will automate this process using the <span class="in">`ensemble()`</span> function in the <span class="in">`statisticalModeling`</span> package in R. Using <span class="in">`nreps`</span> inside the <span class="in">`ensemble()`</span> function, we can specify how many times we want to resample the data. Normally, 100 resampling trials are performed.</span>
<span id="cb89-928"><a href="#cb89-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-931"><a href="#cb89-931" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-932"><a href="#cb89-932" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb89-933"><a href="#cb89-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-934"><a href="#cb89-934" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb89-935"><a href="#cb89-935" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb89-936"><a href="#cb89-936" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-937"><a href="#cb89-937" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb89-938"><a href="#cb89-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-939"><a href="#cb89-939" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data for 10 Mile marathon participants</span></span>
<span id="cb89-940"><a href="#cb89-940" aria-hidden="true" tabindex="-1"></a>run17_marathon <span class="ot">&lt;-</span> run17 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(event <span class="sc">==</span> <span class="st">"10 Mile"</span>)</span>
<span id="cb89-941"><a href="#cb89-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-942"><a href="#cb89-942" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb89-943"><a href="#cb89-943" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(net_sec <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> run17_marathon)</span>
<span id="cb89-944"><a href="#cb89-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-945"><a href="#cb89-945" aria-hidden="true" tabindex="-1"></a><span class="co"># Resampling 100 times</span></span>
<span id="cb89-946"><a href="#cb89-946" aria-hidden="true" tabindex="-1"></a>model_trials <span class="ot">&lt;-</span> <span class="fu">ensemble</span>(model_lm, <span class="at">nreps =</span> <span class="dv">100</span>)</span>
<span id="cb89-947"><a href="#cb89-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-948"><a href="#cb89-948" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size for each resampled data</span></span>
<span id="cb89-949"><a href="#cb89-949" aria-hidden="true" tabindex="-1"></a>resampled_effect_sizes <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(model_trials, <span class="sc">~</span> age)</span>
<span id="cb89-950"><a href="#cb89-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-951"><a href="#cb89-951" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing effect sizes</span></span>
<span id="cb89-952"><a href="#cb89-952" aria-hidden="true" tabindex="-1"></a>resampled_effect_sizes</span>
<span id="cb89-953"><a href="#cb89-953" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-954"><a href="#cb89-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-955"><a href="#cb89-955" aria-hidden="true" tabindex="-1"></a>Now to estimate the precision in the effect size, we can calculate its standard deviation. This is the bootstrapped estimate of the standard error of the effect size, a measure of the precision of the quantity calculated on the original model. We can also plot a histogram of the effect size values we got from each of the trails to get the sampling distribution of the effect size.</span>
<span id="cb89-956"><a href="#cb89-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-959"><a href="#cb89-959" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-960"><a href="#cb89-960" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the standard error of effect size of age</span></span>
<span id="cb89-961"><a href="#cb89-961" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(resampled_effect_sizes<span class="sc">$</span>slope)</span>
<span id="cb89-962"><a href="#cb89-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-963"><a href="#cb89-963" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting a histogram</span></span>
<span id="cb89-964"><a href="#cb89-964" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(resampled_effect_sizes<span class="sc">$</span>slope)</span>
<span id="cb89-965"><a href="#cb89-965" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-966"><a href="#cb89-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-967"><a href="#cb89-967" aria-hidden="true" tabindex="-1"></a><span class="fu">## Scales and transformations</span></span>
<span id="cb89-968"><a href="#cb89-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-969"><a href="#cb89-969" aria-hidden="true" tabindex="-1"></a>Depending on the class of the response variables, we can apply relevant transformations to change the scale of the variables to make the model better. We have seen how to use appropriate model architecture depending on the response variable, now we will see how to use relevant transformations.</span>
<span id="cb89-970"><a href="#cb89-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-971"><a href="#cb89-971" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logarithmic transformation</span></span>
<span id="cb89-972"><a href="#cb89-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-973"><a href="#cb89-973" aria-hidden="true" tabindex="-1"></a>In this exercise, we will see log-transformation which is mainly used when the response variable varies in proportion to its current size. For example, variables denoting population growth, exponential growth, prices or other money-related variables.</span>
<span id="cb89-974"><a href="#cb89-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-975"><a href="#cb89-975" aria-hidden="true" tabindex="-1"></a>We will be using the <span class="in">`Oil_history`</span> dataset from the <span class="in">`statisticalModeling`</span> package in R. It denotes the historical production of crude oil, worldwide from 1880-2014. Let us first plot the data points and see how they are distributed. Here I am filtering the data till the year 1980 to get a nice looking exponential growth curve for the exercise.</span>
<span id="cb89-976"><a href="#cb89-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-979"><a href="#cb89-979" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-980"><a href="#cb89-980" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-981"><a href="#cb89-981" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb89-982"><a href="#cb89-982" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb89-983"><a href="#cb89-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-984"><a href="#cb89-984" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Oil_history"</span>)</span>
<span id="cb89-985"><a href="#cb89-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-986"><a href="#cb89-986" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the data points</span></span>
<span id="cb89-987"><a href="#cb89-987" aria-hidden="true" tabindex="-1"></a>Oil_history <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">1980</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-988"><a href="#cb89-988" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, mbbl)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb89-989"><a href="#cb89-989" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"mbbl (oil production in millions of barrels)"</span>) <span class="sc">+</span></span>
<span id="cb89-990"><a href="#cb89-990" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb89-991"><a href="#cb89-991" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-992"><a href="#cb89-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-993"><a href="#cb89-993" aria-hidden="true" tabindex="-1"></a>You can see exponential growth in oil barrel production with increasing years. First, we will build a linear model looking at how years influenced change in barrel production. Here, <span class="in">`mbbl`</span> would be our response variable and <span class="in">`year`</span> our explanatory variable. Secondly, we will build another linear model but here our response variable; <span class="in">`mbbl`</span> will be log-transformed. You can compare the plots using the slider.</span>
<span id="cb89-994"><a href="#cb89-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-997"><a href="#cb89-997" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-998"><a href="#cb89-998" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb89-999"><a href="#cb89-999" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb89-1000"><a href="#cb89-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1001"><a href="#cb89-1001" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-1002"><a href="#cb89-1002" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb89-1003"><a href="#cb89-1003" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb89-1004"><a href="#cb89-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1005"><a href="#cb89-1005" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Oil_history"</span>)</span>
<span id="cb89-1006"><a href="#cb89-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1007"><a href="#cb89-1007" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering values till 1980</span></span>
<span id="cb89-1008"><a href="#cb89-1008" aria-hidden="true" tabindex="-1"></a>Oil_1980 <span class="ot">&lt;-</span> Oil_history <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">1980</span>)</span>
<span id="cb89-1009"><a href="#cb89-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1010"><a href="#cb89-1010" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb89-1011"><a href="#cb89-1011" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb89-1012"><a href="#cb89-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1013"><a href="#cb89-1013" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the linear model</span></span>
<span id="cb89-1014"><a href="#cb89-1014" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> Oil_1980) <span class="sc">+</span></span>
<span id="cb89-1015"><a href="#cb89-1015" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"mbbl (oil production in millions of barrels)"</span>,</span>
<span id="cb89-1016"><a href="#cb89-1016" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">"Oil production in millions of barrels ~ Year"</span>) <span class="sc">+</span></span>
<span id="cb89-1017"><a href="#cb89-1017" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb89-1018"><a href="#cb89-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1019"><a href="#cb89-1019" aria-hidden="true" tabindex="-1"></a><span class="co"># Transforming mbbl values to logarithmic scale</span></span>
<span id="cb89-1020"><a href="#cb89-1020" aria-hidden="true" tabindex="-1"></a>Oil_1980<span class="sc">$</span>log_mbbl <span class="ot">&lt;-</span> <span class="fu">log</span>(Oil_1980<span class="sc">$</span>mbbl)</span>
<span id="cb89-1021"><a href="#cb89-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1022"><a href="#cb89-1022" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with log transformed response variable</span></span>
<span id="cb89-1023"><a href="#cb89-1023" aria-hidden="true" tabindex="-1"></a>model_lm_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb89-1024"><a href="#cb89-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1025"><a href="#cb89-1025" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the linear model with log transformed response variable</span></span>
<span id="cb89-1026"><a href="#cb89-1026" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm_log) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> Oil_1980) <span class="sc">+</span></span>
<span id="cb89-1027"><a href="#cb89-1027" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"log(mbbl) [oil production in millions of barrels]"</span>,</span>
<span id="cb89-1028"><a href="#cb89-1028" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">"log(Oil production in millions of barrels) ~ Year"</span>) <span class="sc">+</span></span>
<span id="cb89-1029"><a href="#cb89-1029" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb89-1030"><a href="#cb89-1030" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1031"><a href="#cb89-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1032"><a href="#cb89-1032" aria-hidden="true" tabindex="-1"></a>::: {.juxtapose data-startingposition="50%"}</span>
<span id="cb89-1033"><a href="#cb89-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1036"><a href="#cb89-1036" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1037"><a href="#cb89-1037" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-1038"><a href="#cb89-1038" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb89-1039"><a href="#cb89-1039" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb89-1040"><a href="#cb89-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1041"><a href="#cb89-1041" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Oil_history"</span>)</span>
<span id="cb89-1042"><a href="#cb89-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1043"><a href="#cb89-1043" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering values till 1980</span></span>
<span id="cb89-1044"><a href="#cb89-1044" aria-hidden="true" tabindex="-1"></a>Oil_1980 <span class="ot">&lt;-</span> Oil_history <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">1980</span>)</span>
<span id="cb89-1045"><a href="#cb89-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1046"><a href="#cb89-1046" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb89-1047"><a href="#cb89-1047" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb89-1048"><a href="#cb89-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1049"><a href="#cb89-1049" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the linear model</span></span>
<span id="cb89-1050"><a href="#cb89-1050" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> Oil_1980) <span class="sc">+</span></span>
<span id="cb89-1051"><a href="#cb89-1051" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"mbbl (oil production in millions of barrels)"</span>,</span>
<span id="cb89-1052"><a href="#cb89-1052" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">"Oil production in millions of barrels ~ Year"</span>) <span class="sc">+</span></span>
<span id="cb89-1053"><a href="#cb89-1053" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb89-1054"><a href="#cb89-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1055"><a href="#cb89-1055" aria-hidden="true" tabindex="-1"></a><span class="co"># Transforming mbbl values to logarithmic scale</span></span>
<span id="cb89-1056"><a href="#cb89-1056" aria-hidden="true" tabindex="-1"></a>Oil_1980<span class="sc">$</span>log_mbbl <span class="ot">&lt;-</span> <span class="fu">log</span>(Oil_1980<span class="sc">$</span>mbbl)</span>
<span id="cb89-1057"><a href="#cb89-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1058"><a href="#cb89-1058" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with log transformed response variable</span></span>
<span id="cb89-1059"><a href="#cb89-1059" aria-hidden="true" tabindex="-1"></a>model_lm_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb89-1060"><a href="#cb89-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1061"><a href="#cb89-1061" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the linear model with log transformed response variable</span></span>
<span id="cb89-1062"><a href="#cb89-1062" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm_log) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> Oil_1980) <span class="sc">+</span></span>
<span id="cb89-1063"><a href="#cb89-1063" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"log(mbbl) [oil production in millions of barrels]"</span>,</span>
<span id="cb89-1064"><a href="#cb89-1064" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">"log(Oil production in millions of barrels) ~ Year"</span>) <span class="sc">+</span></span>
<span id="cb89-1065"><a href="#cb89-1065" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb89-1066"><a href="#cb89-1066" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1067"><a href="#cb89-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1068"><a href="#cb89-1068" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb89-1069"><a href="#cb89-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1070"><a href="#cb89-1070" aria-hidden="true" tabindex="-1"></a>In the first graph, our linear model does not fit the values perfectly as opposed to the model which used the log transformation of the response variable. Why the second model fits better because initially <span class="in">`mbbl`</span> and <span class="in">`Year`</span> had an exponential relationship. But after log transformation, the relationship became a linear one and thus the model performs better. We can calculate the mean predictive error between these two models and see which one does a better job at predicting.</span>
<span id="cb89-1071"><a href="#cb89-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1074"><a href="#cb89-1074" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1075"><a href="#cb89-1075" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-1076"><a href="#cb89-1076" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb89-1077"><a href="#cb89-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1078"><a href="#cb89-1078" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Oil_history"</span>)</span>
<span id="cb89-1079"><a href="#cb89-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1080"><a href="#cb89-1080" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering values till 1980</span></span>
<span id="cb89-1081"><a href="#cb89-1081" aria-hidden="true" tabindex="-1"></a>Oil_1980 <span class="ot">&lt;-</span> Oil_history <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">1980</span>)</span>
<span id="cb89-1082"><a href="#cb89-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1083"><a href="#cb89-1083" aria-hidden="true" tabindex="-1"></a><span class="co"># Transforming mbbl values to logarithmic scale</span></span>
<span id="cb89-1084"><a href="#cb89-1084" aria-hidden="true" tabindex="-1"></a>Oil_1980<span class="sc">$</span>log_mbbl <span class="ot">&lt;-</span> <span class="fu">log</span>(Oil_1980<span class="sc">$</span>mbbl)</span>
<span id="cb89-1085"><a href="#cb89-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1086"><a href="#cb89-1086" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb89-1087"><a href="#cb89-1087" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb89-1088"><a href="#cb89-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1089"><a href="#cb89-1089" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with log transformed response variable</span></span>
<span id="cb89-1090"><a href="#cb89-1090" aria-hidden="true" tabindex="-1"></a>model_lm_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb89-1091"><a href="#cb89-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1092"><a href="#cb89-1092" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluating the model</span></span>
<span id="cb89-1093"><a href="#cb89-1093" aria-hidden="true" tabindex="-1"></a>predict_lm <span class="ot">&lt;-</span> <span class="fu">evaluate_model</span>(model_lm, <span class="at">data =</span> Oil_1980)</span>
<span id="cb89-1094"><a href="#cb89-1094" aria-hidden="true" tabindex="-1"></a>predict_lm_log <span class="ot">&lt;-</span> <span class="fu">evaluate_model</span>(model_lm_log, <span class="at">data =</span> Oil_1980)</span>
<span id="cb89-1095"><a href="#cb89-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1096"><a href="#cb89-1096" aria-hidden="true" tabindex="-1"></a><span class="co"># Transforming the model output values back to normal</span></span>
<span id="cb89-1097"><a href="#cb89-1097" aria-hidden="true" tabindex="-1"></a>predict_lm_log<span class="sc">$</span>model_output_nonlog <span class="ot">&lt;-</span> <span class="fu">exp</span>(predict_lm_log<span class="sc">$</span>model_output)</span>
<span id="cb89-1098"><a href="#cb89-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1099"><a href="#cb89-1099" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the mean square errors</span></span>
<span id="cb89-1100"><a href="#cb89-1100" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((predict_lm<span class="sc">$</span>mbbl <span class="sc">-</span> predict_lm<span class="sc">$</span>model_output)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb89-1101"><a href="#cb89-1101" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((predict_lm_log<span class="sc">$</span>mbbl <span class="sc">-</span> predict_lm_log<span class="sc">$</span>model_output_nonlog)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb89-1102"><a href="#cb89-1102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1103"><a href="#cb89-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1104"><a href="#cb89-1104" aria-hidden="true" tabindex="-1"></a>We get a much smaller mean predictive error for the model with log transformation as compared to the model which does not have log transformation.</span>
<span id="cb89-1105"><a href="#cb89-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1106"><a href="#cb89-1106" aria-hidden="true" tabindex="-1"></a>Let us calculate the effect size for these two models</span>
<span id="cb89-1107"><a href="#cb89-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1110"><a href="#cb89-1110" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1111"><a href="#cb89-1111" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-1112"><a href="#cb89-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1113"><a href="#cb89-1113" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Oil_history"</span>)</span>
<span id="cb89-1114"><a href="#cb89-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1115"><a href="#cb89-1115" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb89-1116"><a href="#cb89-1116" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb89-1117"><a href="#cb89-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1118"><a href="#cb89-1118" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with log transformed response variable</span></span>
<span id="cb89-1119"><a href="#cb89-1119" aria-hidden="true" tabindex="-1"></a>model_lm_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb89-1120"><a href="#cb89-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1121"><a href="#cb89-1121" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect sizes</span></span>
<span id="cb89-1122"><a href="#cb89-1122" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_lm, <span class="sc">~</span> year)</span>
<span id="cb89-1123"><a href="#cb89-1123" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_lm_log, <span class="sc">~</span> year)</span>
<span id="cb89-1124"><a href="#cb89-1124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1125"><a href="#cb89-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1126"><a href="#cb89-1126" aria-hidden="true" tabindex="-1"></a>For the model without a log-transformed response variable, we have slope = 254. This means, that from the year 1958 to 1988, the oil barrels production increased by 254 million barrels per year. What about the effect size of the model with a log-transformed response variable?</span>
<span id="cb89-1127"><a href="#cb89-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1128"><a href="#cb89-1128" aria-hidden="true" tabindex="-1"></a>The effect size for a log-transformed value is in terms of the change of logarithm per unit of the explanatory variable. It's generally easier to interpret this as a percentage change per unit of the explanatory variable, which also involves an exponential transformation: <span class="in">`100 * (exp(__effect_size__) - 1)`</span></span>
<span id="cb89-1129"><a href="#cb89-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1132"><a href="#cb89-1132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1133"><a href="#cb89-1133" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-1134"><a href="#cb89-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1135"><a href="#cb89-1135" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Oil_history"</span>)</span>
<span id="cb89-1136"><a href="#cb89-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1137"><a href="#cb89-1137" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with log transformed response variable</span></span>
<span id="cb89-1138"><a href="#cb89-1138" aria-hidden="true" tabindex="-1"></a>model_lm_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb89-1139"><a href="#cb89-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1140"><a href="#cb89-1140" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb89-1141"><a href="#cb89-1141" aria-hidden="true" tabindex="-1"></a>effect_lm_log <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(model_lm_log, <span class="sc">~</span> year)</span>
<span id="cb89-1142"><a href="#cb89-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1143"><a href="#cb89-1143" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting effect size to percentage change</span></span>
<span id="cb89-1144"><a href="#cb89-1144" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span> <span class="sc">*</span> (<span class="fu">exp</span>(effect_lm_log<span class="sc">$</span>slope) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb89-1145"><a href="#cb89-1145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1146"><a href="#cb89-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1147"><a href="#cb89-1147" aria-hidden="true" tabindex="-1"></a>We get a value of 6.75. This means that barrel production increased by 6.75% each year from 1958 to 1988.</span>
<span id="cb89-1148"><a href="#cb89-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1149"><a href="#cb89-1149" aria-hidden="true" tabindex="-1"></a>We can take this one step further by using the bootstrapping method and thereby calculate the effect size. Then, after converting effect size to percentage change, we can calculate the 95% confidence interval on the percentage change in oil barrel production per year.</span>
<span id="cb89-1150"><a href="#cb89-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1153"><a href="#cb89-1153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1154"><a href="#cb89-1154" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-1155"><a href="#cb89-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1156"><a href="#cb89-1156" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Oil_history"</span>)</span>
<span id="cb89-1157"><a href="#cb89-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1158"><a href="#cb89-1158" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with log transformed response variable</span></span>
<span id="cb89-1159"><a href="#cb89-1159" aria-hidden="true" tabindex="-1"></a>model_lm_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_mbbl <span class="sc">~</span> year, <span class="at">data =</span> Oil_1980)</span>
<span id="cb89-1160"><a href="#cb89-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1161"><a href="#cb89-1161" aria-hidden="true" tabindex="-1"></a><span class="co"># Bootstrap replications: 100 trials</span></span>
<span id="cb89-1162"><a href="#cb89-1162" aria-hidden="true" tabindex="-1"></a>bootstrap_trials <span class="ot">&lt;-</span> <span class="fu">ensemble</span>(model_lm_log, <span class="at">nreps =</span> <span class="dv">100</span>, <span class="at">data =</span> Oil_1980)</span>
<span id="cb89-1163"><a href="#cb89-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1164"><a href="#cb89-1164" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect size</span></span>
<span id="cb89-1165"><a href="#cb89-1165" aria-hidden="true" tabindex="-1"></a>bootstrap_effect_sizes <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(bootstrap_trials, <span class="sc">~</span> year)</span>
<span id="cb89-1166"><a href="#cb89-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1167"><a href="#cb89-1167" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting effect size to percentage change</span></span>
<span id="cb89-1168"><a href="#cb89-1168" aria-hidden="true" tabindex="-1"></a>bootstrap_effect_sizes<span class="sc">$</span>precentage_change <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> (<span class="fu">exp</span>(bootstrap_effect_sizes<span class="sc">$</span>slope) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb89-1169"><a href="#cb89-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1170"><a href="#cb89-1170" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating 95% confidence interval</span></span>
<span id="cb89-1171"><a href="#cb89-1171" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(bootstrap_effect_sizes, <span class="fu">mean</span>(precentage_change) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">sd</span>(precentage_change))</span>
<span id="cb89-1172"><a href="#cb89-1172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1173"><a href="#cb89-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1174"><a href="#cb89-1174" aria-hidden="true" tabindex="-1"></a>Nice! We got a narrow 95% confidence interval of <span class="co">[</span><span class="ot">6.50, 7.00</span><span class="co">]</span>.</span>
<span id="cb89-1175"><a href="#cb89-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1176"><a href="#cb89-1176" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rank transformation</span></span>
<span id="cb89-1177"><a href="#cb89-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1178"><a href="#cb89-1178" aria-hidden="true" tabindex="-1"></a>We found that log transformation worked best for datasets showcasing exponential growth or where depicting percentage change of response variables makes more sense. Likewise, there is another transformation called rank transformation which works best with a dataset that deviates from normality and has outliers.</span>
<span id="cb89-1179"><a href="#cb89-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1180"><a href="#cb89-1180" aria-hidden="true" tabindex="-1"></a>Consider the dataset <span class="in">`HorsePrices`</span> from the <span class="in">`Stat2Data`</span> package in R. We will plot the prices for female horses with their age.</span>
<span id="cb89-1181"><a href="#cb89-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1184"><a href="#cb89-1184" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1185"><a href="#cb89-1185" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb89-1186"><a href="#cb89-1186" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb89-1187"><a href="#cb89-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1188"><a href="#cb89-1188" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the graph</span></span>
<span id="cb89-1189"><a href="#cb89-1189" aria-hidden="true" tabindex="-1"></a>HorsePrices <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex <span class="sc">==</span> <span class="st">"f"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-1190"><a href="#cb89-1190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Age, Price)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb89-1191"><a href="#cb89-1191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1192"><a href="#cb89-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1193"><a href="#cb89-1193" aria-hidden="true" tabindex="-1"></a>You can see that there are two outliers in the plot for y &gt; 30000, let us label them. </span>
<span id="cb89-1194"><a href="#cb89-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1197"><a href="#cb89-1197" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1198"><a href="#cb89-1198" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb89-1199"><a href="#cb89-1199" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb89-1200"><a href="#cb89-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1201"><a href="#cb89-1201" aria-hidden="true" tabindex="-1"></a><span class="co"># Making a function to identify outliers</span></span>
<span id="cb89-1202"><a href="#cb89-1202" aria-hidden="true" tabindex="-1"></a>is_outlier <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb89-1203"><a href="#cb89-1203" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">&gt;</span> <span class="dv">30000</span></span>
<span id="cb89-1204"><a href="#cb89-1204" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-1205"><a href="#cb89-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1206"><a href="#cb89-1206" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering female horses and labelling the outliers</span></span>
<span id="cb89-1207"><a href="#cb89-1207" aria-hidden="true" tabindex="-1"></a>female_horses <span class="ot">&lt;-</span> HorsePrices <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex <span class="sc">==</span> <span class="st">"f"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-1208"><a href="#cb89-1208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outliers =</span> <span class="fu">if_else</span>(<span class="fu">is_outlier</span>(Price), Price, rlang<span class="sc">::</span>na_int))</span>
<span id="cb89-1209"><a href="#cb89-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1210"><a href="#cb89-1210" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the graph</span></span>
<span id="cb89-1211"><a href="#cb89-1211" aria-hidden="true" tabindex="-1"></a>female_horses <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex <span class="sc">==</span> <span class="st">"f"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-1212"><a href="#cb89-1212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Age, Price)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb89-1213"><a href="#cb89-1213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> outliers), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb89-1214"><a href="#cb89-1214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb89-1215"><a href="#cb89-1215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1216"><a href="#cb89-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1217"><a href="#cb89-1217" aria-hidden="true" tabindex="-1"></a>Now let us build a linear model with <span class="in">`Price`</span> as the response variable and <span class="in">`Age`</span> as the explanatory variable and then plot the model.</span>
<span id="cb89-1218"><a href="#cb89-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1221"><a href="#cb89-1221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1222"><a href="#cb89-1222" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb89-1223"><a href="#cb89-1223" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb89-1224"><a href="#cb89-1224" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-1225"><a href="#cb89-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1226"><a href="#cb89-1226" aria-hidden="true" tabindex="-1"></a><span class="co"># Making a function to identify outliers</span></span>
<span id="cb89-1227"><a href="#cb89-1227" aria-hidden="true" tabindex="-1"></a>is_outlier <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb89-1228"><a href="#cb89-1228" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">&gt;</span> <span class="dv">30000</span></span>
<span id="cb89-1229"><a href="#cb89-1229" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-1230"><a href="#cb89-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1231"><a href="#cb89-1231" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering female horses and labelling the outliers</span></span>
<span id="cb89-1232"><a href="#cb89-1232" aria-hidden="true" tabindex="-1"></a>female_horses <span class="ot">&lt;-</span> HorsePrices <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex <span class="sc">==</span> <span class="st">"f"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-1233"><a href="#cb89-1233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outliers =</span> <span class="fu">if_else</span>(<span class="fu">is_outlier</span>(Price), Price, rlang<span class="sc">::</span>na_int))</span>
<span id="cb89-1234"><a href="#cb89-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1235"><a href="#cb89-1235" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb89-1236"><a href="#cb89-1236" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Price <span class="sc">~</span> Age, <span class="at">data =</span> female_horses)</span>
<span id="cb89-1237"><a href="#cb89-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1238"><a href="#cb89-1238" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb89-1239"><a href="#cb89-1239" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> female_horses) <span class="sc">+</span></span>
<span id="cb89-1240"><a href="#cb89-1240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> outliers), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">vjust =</span> <span class="dv">1</span>,</span>
<span id="cb89-1241"><a href="#cb89-1241" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">data =</span> female_horses) <span class="sc">+</span></span>
<span id="cb89-1242"><a href="#cb89-1242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">50000</span>,<span class="dv">10000</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50000</span>)) <span class="sc">+</span></span>
<span id="cb89-1243"><a href="#cb89-1243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Linear model"</span>) <span class="sc">+</span></span>
<span id="cb89-1244"><a href="#cb89-1244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb89-1245"><a href="#cb89-1245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1246"><a href="#cb89-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1247"><a href="#cb89-1247" aria-hidden="true" tabindex="-1"></a>The outliers might be causing an effect on the slope of the regression line. This is where rank transformation comes into place. Using the <span class="in">`rank()`</span> in R, we replace the actual value with the rank which that value occupies when arranged from ascending to descending order. Let us see how the plot will be after rank transformation.</span>
<span id="cb89-1248"><a href="#cb89-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1251"><a href="#cb89-1251" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1252"><a href="#cb89-1252" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb89-1253"><a href="#cb89-1253" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb89-1254"><a href="#cb89-1254" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-1255"><a href="#cb89-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1256"><a href="#cb89-1256" aria-hidden="true" tabindex="-1"></a><span class="co"># Making a function to identify outliers via ranks</span></span>
<span id="cb89-1257"><a href="#cb89-1257" aria-hidden="true" tabindex="-1"></a>is_outlier <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb89-1258"><a href="#cb89-1258" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">&gt;</span> <span class="dv">18</span></span>
<span id="cb89-1259"><a href="#cb89-1259" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-1260"><a href="#cb89-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1261"><a href="#cb89-1261" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering female horses</span></span>
<span id="cb89-1262"><a href="#cb89-1262" aria-hidden="true" tabindex="-1"></a>female_horses <span class="ot">&lt;-</span> HorsePrices <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex <span class="sc">==</span> <span class="st">"f"</span>)</span>
<span id="cb89-1263"><a href="#cb89-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1264"><a href="#cb89-1264" aria-hidden="true" tabindex="-1"></a><span class="co"># Assigning ranks</span></span>
<span id="cb89-1265"><a href="#cb89-1265" aria-hidden="true" tabindex="-1"></a>female_horses<span class="sc">$</span>price_rank <span class="ot">&lt;-</span> <span class="fu">rank</span>(female_horses<span class="sc">$</span>Price)</span>
<span id="cb89-1266"><a href="#cb89-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1267"><a href="#cb89-1267" aria-hidden="true" tabindex="-1"></a><span class="co"># Labelling outliers via ranks</span></span>
<span id="cb89-1268"><a href="#cb89-1268" aria-hidden="true" tabindex="-1"></a>female_horses<span class="ot">&lt;-</span> female_horses <span class="sc">%&gt;%</span></span>
<span id="cb89-1269"><a href="#cb89-1269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outliers =</span> <span class="fu">if_else</span>(<span class="fu">is_outlier</span>(price_rank), Price, rlang<span class="sc">::</span>na_int))</span>
<span id="cb89-1270"><a href="#cb89-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1271"><a href="#cb89-1271" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the linear model</span></span>
<span id="cb89-1272"><a href="#cb89-1272" aria-hidden="true" tabindex="-1"></a>model_lm_rank <span class="ot">&lt;-</span> <span class="fu">lm</span>(price_rank <span class="sc">~</span> Age, <span class="at">data =</span> female_horses)</span>
<span id="cb89-1273"><a href="#cb89-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1274"><a href="#cb89-1274" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb89-1275"><a href="#cb89-1275" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm_rank) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> female_horses) <span class="sc">+</span></span>
<span id="cb89-1276"><a href="#cb89-1276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> outliers), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">vjust =</span> <span class="dv">1</span>,</span>
<span id="cb89-1277"><a href="#cb89-1277" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">data =</span> female_horses) <span class="sc">+</span></span>
<span id="cb89-1278"><a href="#cb89-1278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Ranked Price"</span>, <span class="at">title =</span> <span class="st">"Linear model with ranked price"</span>) <span class="sc">+</span></span>
<span id="cb89-1279"><a href="#cb89-1279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb89-1280"><a href="#cb89-1280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1281"><a href="#cb89-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1282"><a href="#cb89-1282" aria-hidden="true" tabindex="-1"></a>A quick comparison of both the graphs shows that the slope of the regression line has changed. For now, let us not worry if this made the model better. We will see in greater detail rank transformation in the coming tutorials. For now, keep in mind that rank transformation works best for data with outliers.</span>
<span id="cb89-1283"><a href="#cb89-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1284"><a href="#cb89-1284" aria-hidden="true" tabindex="-1"></a><span class="fu">## Collinearity (also called Multicollinearity)</span></span>
<span id="cb89-1285"><a href="#cb89-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1286"><a href="#cb89-1286" aria-hidden="true" tabindex="-1"></a>Collinearity is a phenomenon that occurs when two or more explanatory variables used in the model are in a linear relationship with each other. Consider a dataset with 'poverty' as a variable, let's say we are looking at the association between 'poverty' and other variables such as 'education' and 'income'. Now common sense tells us that, most often, education and income have a linear relationship with each other. Highly educated people often will have a high income. Therefore, changes seen in poverty status explained by education might often be a result of income rather than education itself and vice versa. In this case, we say that the variables 'education' and 'income' are colinear.</span>
<span id="cb89-1287"><a href="#cb89-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1288"><a href="#cb89-1288" aria-hidden="true" tabindex="-1"></a>Let us look at a real-life example. Let us use the <span class="in">`SAT`</span> dataset from the <span class="in">`{mosaicData}`</span> package in R. The SAT data looks at the link between SAT scores and measures of educational expenditures. </span>
<span id="cb89-1289"><a href="#cb89-1289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1290"><a href="#cb89-1290" aria-hidden="true" tabindex="-1"></a>We will build a linear model using <span class="in">`sat`</span> as the response variable. The <span class="in">`sat`</span> variable denotes the average total SAT score. We will also use <span class="in">`expend`</span> as the explanatory variable. The <span class="in">`expend`</span> variable denotes expenditure per pupil in average daily attendance in public elementary and secondary schools, 1994-95 (in thousands of US dollars). We will also do bootstrapping and find the 95% confidence interval.</span>
<span id="cb89-1291"><a href="#cb89-1291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1294"><a href="#cb89-1294" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1295"><a href="#cb89-1295" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb89-1296"><a href="#cb89-1296" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-1297"><a href="#cb89-1297" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb89-1298"><a href="#cb89-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1299"><a href="#cb89-1299" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb89-1300"><a href="#cb89-1300" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend, <span class="at">data =</span> SAT)</span>
<span id="cb89-1301"><a href="#cb89-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1302"><a href="#cb89-1302" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb89-1303"><a href="#cb89-1303" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb89-1304"><a href="#cb89-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1305"><a href="#cb89-1305" aria-hidden="true" tabindex="-1"></a><span class="co"># Bootstrap replications: 100 trials</span></span>
<span id="cb89-1306"><a href="#cb89-1306" aria-hidden="true" tabindex="-1"></a>bootstrap_trials <span class="ot">&lt;-</span> <span class="fu">ensemble</span>(model_lm, <span class="at">nreps =</span> <span class="dv">100</span>)</span>
<span id="cb89-1307"><a href="#cb89-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1308"><a href="#cb89-1308" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect sizes of salary from the bootstrap samples</span></span>
<span id="cb89-1309"><a href="#cb89-1309" aria-hidden="true" tabindex="-1"></a>bootstrap_effect_sizes <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(bootstrap_trials, <span class="sc">~</span> expend)</span>
<span id="cb89-1310"><a href="#cb89-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1311"><a href="#cb89-1311" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the 95% confidence interval</span></span>
<span id="cb89-1312"><a href="#cb89-1312" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(bootstrap_effect_sizes, <span class="fu">mean</span>(slope) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">sd</span>(slope))</span>
<span id="cb89-1313"><a href="#cb89-1313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1314"><a href="#cb89-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1315"><a href="#cb89-1315" aria-hidden="true" tabindex="-1"></a>We get a rather surprising plot and a 95% confidence interval value. The plot suggests that with increasing college expenditure, sat scores reduce. The confidence interval is adding evidence to it by showing that the mean of the effect size lies within a negative interval. So what's happening? Should we believe our model? </span>
<span id="cb89-1316"><a href="#cb89-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1317"><a href="#cb89-1317" aria-hidden="true" tabindex="-1"></a>Before we decide on anything, let us add a covariate to the model. We will add the variable <span class="in">`frac`</span> to the model which denotes the percentage of all eligible students taking the SAT. Let us build the model.</span>
<span id="cb89-1318"><a href="#cb89-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1321"><a href="#cb89-1321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1322"><a href="#cb89-1322" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb89-1323"><a href="#cb89-1323" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-1324"><a href="#cb89-1324" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb89-1325"><a href="#cb89-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1326"><a href="#cb89-1326" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb89-1327"><a href="#cb89-1327" aria-hidden="true" tabindex="-1"></a>model_lm_cov <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend <span class="sc">+</span> frac, <span class="at">data =</span> SAT)</span>
<span id="cb89-1328"><a href="#cb89-1328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1329"><a href="#cb89-1329" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the model</span></span>
<span id="cb89-1330"><a href="#cb89-1330" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm_cov) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb89-1331"><a href="#cb89-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1332"><a href="#cb89-1332" aria-hidden="true" tabindex="-1"></a><span class="co"># Bootstrap replications: 100 trials</span></span>
<span id="cb89-1333"><a href="#cb89-1333" aria-hidden="true" tabindex="-1"></a>bootstrap_trials_cov <span class="ot">&lt;-</span> <span class="fu">ensemble</span>(model_lm_cov, <span class="at">nreps =</span> <span class="dv">100</span>)</span>
<span id="cb89-1334"><a href="#cb89-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1335"><a href="#cb89-1335" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the effect sizes of salary from the bootstrap samples</span></span>
<span id="cb89-1336"><a href="#cb89-1336" aria-hidden="true" tabindex="-1"></a>bootstrap_effect_sizes_cov <span class="ot">&lt;-</span> <span class="fu">effect_size</span>(bootstrap_trials, <span class="sc">~</span> expend)</span>
<span id="cb89-1337"><a href="#cb89-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1338"><a href="#cb89-1338" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the 95% confidence interval</span></span>
<span id="cb89-1339"><a href="#cb89-1339" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(bootstrap_effect_sizes_cov, <span class="fu">mean</span>(slope) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">sd</span>(slope))</span>
<span id="cb89-1340"><a href="#cb89-1340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1341"><a href="#cb89-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1342"><a href="#cb89-1342" aria-hidden="true" tabindex="-1"></a>Guess we got quite the opposite result now. Let us calculate the mean prediction error using the cross-validation technique and see which of these models is better.</span>
<span id="cb89-1343"><a href="#cb89-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1346"><a href="#cb89-1346" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1347"><a href="#cb89-1347" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb89-1348"><a href="#cb89-1348" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-1349"><a href="#cb89-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1350"><a href="#cb89-1350" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb89-1351"><a href="#cb89-1351" aria-hidden="true" tabindex="-1"></a>model_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend, <span class="at">data =</span> SAT)</span>
<span id="cb89-1352"><a href="#cb89-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1353"><a href="#cb89-1353" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model with covariate</span></span>
<span id="cb89-1354"><a href="#cb89-1354" aria-hidden="true" tabindex="-1"></a>model_lm_cov <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend <span class="sc">+</span> frac, <span class="at">data =</span> SAT)</span>
<span id="cb89-1355"><a href="#cb89-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1356"><a href="#cb89-1356" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the m.s.e values</span></span>
<span id="cb89-1357"><a href="#cb89-1357" aria-hidden="true" tabindex="-1"></a>trials_mse <span class="ot">&lt;-</span> <span class="fu">cv_pred_error</span>(model_lm, model_lm_cov)</span>
<span id="cb89-1358"><a href="#cb89-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1359"><a href="#cb89-1359" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing mse</span></span>
<span id="cb89-1360"><a href="#cb89-1360" aria-hidden="true" tabindex="-1"></a>trials_mse</span>
<span id="cb89-1361"><a href="#cb89-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1362"><a href="#cb89-1362" aria-hidden="true" tabindex="-1"></a><span class="co"># Doing a t.test</span></span>
<span id="cb89-1363"><a href="#cb89-1363" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(mse <span class="sc">~</span> model, trials_mse)</span>
<span id="cb89-1364"><a href="#cb89-1364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1365"><a href="#cb89-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1366"><a href="#cb89-1366" aria-hidden="true" tabindex="-1"></a>From the t.test results, the model with the covariate has a lower mean prediction error value as compared to the model without the covariate. Adding <span class="in">`frac`</span> as the covariate seems to significantly improve our model.</span>
<span id="cb89-1367"><a href="#cb89-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1368"><a href="#cb89-1368" aria-hidden="true" tabindex="-1"></a>The reason why I emphasized covariates is because collinearity is introduced to the model as a result of our choice of covariates. To check for collinearity, we build a linear model with our group of explanatory variables that we want to check. Then we will find the R-squared value from the model, the greater the R-squared value, the greater the collinearity between these variables. Let us find the collinearity between <span class="in">`expend`</span> and <span class="in">`frac`</span>. We can either use the <span class="in">`summary()`</span> function to get the model summary and then get the R-squared value from the summary or use the <span class="in">`rsquared()`</span> function from the <span class="in">`{mosaic}`</span> package in R.</span>
<span id="cb89-1369"><a href="#cb89-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1372"><a href="#cb89-1372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1373"><a href="#cb89-1373" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(mosaic)) <span class="fu">install.packages</span>(<span class="st">'mosaic'</span>)</span>
<span id="cb89-1374"><a href="#cb89-1374" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb89-1375"><a href="#cb89-1375" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaic)</span>
<span id="cb89-1376"><a href="#cb89-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1377"><a href="#cb89-1377" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model</span></span>
<span id="cb89-1378"><a href="#cb89-1378" aria-hidden="true" tabindex="-1"></a>model_cov <span class="ot">&lt;-</span> <span class="fu">lm</span>(expend <span class="sc">~</span> frac, <span class="at">data =</span> SAT)</span>
<span id="cb89-1379"><a href="#cb89-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1380"><a href="#cb89-1380" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the summary of the model to get Rsquared value</span></span>
<span id="cb89-1381"><a href="#cb89-1381" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_cov)</span>
<span id="cb89-1382"><a href="#cb89-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1383"><a href="#cb89-1383" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the Rsquared value</span></span>
<span id="cb89-1384"><a href="#cb89-1384" aria-hidden="true" tabindex="-1"></a><span class="fu">rsquared</span>(model_cov)</span>
<span id="cb89-1385"><a href="#cb89-1385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1386"><a href="#cb89-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1387"><a href="#cb89-1387" aria-hidden="true" tabindex="-1"></a>From the model summary, the value that we are interested in is given in the 'Multiple R-squared' section, which is 0.35, which is the same as the output given by the <span class="in">`rsquared()`</span> function. The value of 0.35 means that 35% of the variation seen in the <span class="in">`expend`</span> variable is explained by <span class="in">`frac`</span>. This suggests that there is some level of redundancy between the <span class="in">`expend`</span> and <span class="in">`frac`</span>. Greater the R-squared value, the greater the redundancy between the variables.</span>
<span id="cb89-1388"><a href="#cb89-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1389"><a href="#cb89-1389" aria-hidden="true" tabindex="-1"></a>R-squared is also represented in a different way called 'variance inflation factor (VIF)' which measures the factor by which the correlations amongst the predictor variables inflate the variance of the standard error of the effect size. Okay, that was a handful, let us see what this means. First, let us see the formula for VIF;</span>
<span id="cb89-1390"><a href="#cb89-1390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1391"><a href="#cb89-1391" aria-hidden="true" tabindex="-1"></a>$$VIF = \frac{1}{1-R^2}$$</span>
<span id="cb89-1392"><a href="#cb89-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1393"><a href="#cb89-1393" aria-hidden="true" tabindex="-1"></a>Here, if we have an R-squared value of 0, which means there is no collinearity between the variables, then VIF would be 1. Let us assume we get a VIF value of 2. In the current context, this means that the variance of the effect sizes calculated from bootstrap trials is increased by a factor of 2. If variance increases, then the standard error associated with the effect sizes increases and thereby it will lead to reduced precision. A result of collinearity is often getting a wider confidence interval thereby giving us an unprecise estimation of; for example effect sizes in this case.</span>
<span id="cb89-1394"><a href="#cb89-1394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1395"><a href="#cb89-1395" aria-hidden="true" tabindex="-1"></a>If we take the square root of VIF, then we get the 'standard error inflation factor' which tells us by how much factor the standard error of the effect sizes calculated from bootstrap trails inflate.</span>
<span id="cb89-1396"><a href="#cb89-1396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1397"><a href="#cb89-1397" aria-hidden="true" tabindex="-1"></a>Let us see all this in action from the codes below;</span>
<span id="cb89-1398"><a href="#cb89-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1399"><a href="#cb89-1399" aria-hidden="true" tabindex="-1"></a>We will add another covariate to our earlier model; <span class="in">`salary`</span>. The variable <span class="in">`salary`</span> denotes the estimated average annual salary of teachers in public elementary and secondary schools.</span>
<span id="cb89-1400"><a href="#cb89-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1401"><a href="#cb89-1401" aria-hidden="true" tabindex="-1"></a>Let us first check for collinearity between the <span class="in">`salary`</span> and <span class="in">`expend`</span>.</span>
<span id="cb89-1402"><a href="#cb89-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1405"><a href="#cb89-1405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1406"><a href="#cb89-1406" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaic)</span>
<span id="cb89-1407"><a href="#cb89-1407" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb89-1408"><a href="#cb89-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1409"><a href="#cb89-1409" aria-hidden="true" tabindex="-1"></a><span class="co"># Building a linear model to check collinearity</span></span>
<span id="cb89-1410"><a href="#cb89-1410" aria-hidden="true" tabindex="-1"></a>model_collinear_salary <span class="ot">&lt;-</span> <span class="fu">lm</span>(expend <span class="sc">~</span> salary, <span class="at">data =</span> SAT)</span>
<span id="cb89-1411"><a href="#cb89-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1412"><a href="#cb89-1412" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the Rsquared value</span></span>
<span id="cb89-1413"><a href="#cb89-1413" aria-hidden="true" tabindex="-1"></a><span class="fu">rsquared</span>(model_collinear_salary)</span>
<span id="cb89-1414"><a href="#cb89-1414" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1415"><a href="#cb89-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1416"><a href="#cb89-1416" aria-hidden="true" tabindex="-1"></a>Looks like we opened Pandora's box. Now let us build two models, one without salary and one with salary and, see how the prediction error of the effect sizes changes. The two models will have the SAT scores as the response variable. We will calculate the standard error of effect sizes within the <span class="in">`effect_size()`</span> formula by assigning <span class="in">`bootstrap = TRUE`</span>.</span>
<span id="cb89-1417"><a href="#cb89-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1420"><a href="#cb89-1420" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1421"><a href="#cb89-1421" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-1422"><a href="#cb89-1422" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb89-1423"><a href="#cb89-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1424"><a href="#cb89-1424" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1 without salary</span></span>
<span id="cb89-1425"><a href="#cb89-1425" aria-hidden="true" tabindex="-1"></a>model_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend, <span class="at">data =</span> SAT)</span>
<span id="cb89-1426"><a href="#cb89-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1427"><a href="#cb89-1427" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2 with salary</span></span>
<span id="cb89-1428"><a href="#cb89-1428" aria-hidden="true" tabindex="-1"></a>model_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend <span class="sc">+</span> salary, <span class="at">data =</span> SAT)</span>
<span id="cb89-1429"><a href="#cb89-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1430"><a href="#cb89-1430" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating effect sizes and standard error via bootstrapping</span></span>
<span id="cb89-1431"><a href="#cb89-1431" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">effect_size</span>(model_1, <span class="sc">~</span> expend, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>), <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb89-1432"><a href="#cb89-1432" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">effect_size</span>(model_2, <span class="sc">~</span> expend, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>), <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb89-1433"><a href="#cb89-1433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1434"><a href="#cb89-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1435"><a href="#cb89-1435" aria-hidden="true" tabindex="-1"></a>You can see that the standard error has increased which is due to the effect of collinearity between <span class="in">`expend`</span> and <span class="in">`salary`</span>.</span>
<span id="cb89-1436"><a href="#cb89-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1437"><a href="#cb89-1437" aria-hidden="true" tabindex="-1"></a>The <span class="in">`statisticalModeling`</span> package comes with the <span class="in">`collinearity()`</span> function which can be used to calculate how much the effect size might (at a maximum) be influenced by collinearity with the other explanatory variables. Essentially, the <span class="in">`collinearity()`</span> function calculates the square root of VIF which denotes the inflation of standard errors. Let us check the collinearity between <span class="in">`expend`</span> and <span class="in">`salary`</span> variables.</span>
<span id="cb89-1438"><a href="#cb89-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1441"><a href="#cb89-1441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1442"><a href="#cb89-1442" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-1443"><a href="#cb89-1443" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb89-1444"><a href="#cb89-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1445"><a href="#cb89-1445" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the collinearity</span></span>
<span id="cb89-1446"><a href="#cb89-1446" aria-hidden="true" tabindex="-1"></a><span class="fu">collinearity</span>(<span class="sc">~</span> expend <span class="sc">+</span> salary, <span class="at">data =</span> SAT)</span>
<span id="cb89-1447"><a href="#cb89-1447" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1448"><a href="#cb89-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1449"><a href="#cb89-1449" aria-hidden="true" tabindex="-1"></a>Interaction between collinear variables can also increase the standard error of effect size.</span>
<span id="cb89-1450"><a href="#cb89-1450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1453"><a href="#cb89-1453" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1454"><a href="#cb89-1454" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-1455"><a href="#cb89-1455" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb89-1456"><a href="#cb89-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1457"><a href="#cb89-1457" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3 with salary interaction</span></span>
<span id="cb89-1458"><a href="#cb89-1458" aria-hidden="true" tabindex="-1"></a>model_3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend <span class="sc">*</span> salary, <span class="at">data =</span> SAT)</span>
<span id="cb89-1459"><a href="#cb89-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1460"><a href="#cb89-1460" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating effect sizes and standard error via bootstrapping</span></span>
<span id="cb89-1461"><a href="#cb89-1461" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">effect_size</span>(model_3, <span class="sc">~</span> expend, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>), <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb89-1462"><a href="#cb89-1462" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1463"><a href="#cb89-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1464"><a href="#cb89-1464" aria-hidden="true" tabindex="-1"></a>As you can see, we got a higher standard error value as compared to model_1. Let us also calculate the mean prediction error for the three models we created.</span>
<span id="cb89-1465"><a href="#cb89-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1468"><a href="#cb89-1468" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb89-1469"><a href="#cb89-1469" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb89-1470"><a href="#cb89-1470" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb89-1471"><a href="#cb89-1471" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb89-1472"><a href="#cb89-1472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1473"><a href="#cb89-1473" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the models</span></span>
<span id="cb89-1474"><a href="#cb89-1474" aria-hidden="true" tabindex="-1"></a>model_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend, <span class="at">data =</span> SAT)</span>
<span id="cb89-1475"><a href="#cb89-1475" aria-hidden="true" tabindex="-1"></a>model_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend <span class="sc">+</span> salary, <span class="at">data =</span> SAT)</span>
<span id="cb89-1476"><a href="#cb89-1476" aria-hidden="true" tabindex="-1"></a>model_3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sat <span class="sc">~</span> expend <span class="sc">*</span> salary, <span class="at">data =</span> SAT)</span>
<span id="cb89-1477"><a href="#cb89-1477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1478"><a href="#cb89-1478" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the mean prediction error for 100 trials</span></span>
<span id="cb89-1479"><a href="#cb89-1479" aria-hidden="true" tabindex="-1"></a>model_mse <span class="ot">&lt;-</span> <span class="fu">cv_pred_error</span>(model_1, model_2, model_3, <span class="at">ntrials =</span> <span class="dv">100</span>)</span>
<span id="cb89-1480"><a href="#cb89-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1481"><a href="#cb89-1481" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the mean and sd of mse</span></span>
<span id="cb89-1482"><a href="#cb89-1482" aria-hidden="true" tabindex="-1"></a>model_mse_mean <span class="ot">&lt;-</span> model_mse <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb89-1483"><a href="#cb89-1483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(mse),</span>
<span id="cb89-1484"><a href="#cb89-1484" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd =</span> <span class="fu">sd</span>(mse))</span>
<span id="cb89-1485"><a href="#cb89-1485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1486"><a href="#cb89-1486" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the mean and sd of mse</span></span>
<span id="cb89-1487"><a href="#cb89-1487" aria-hidden="true" tabindex="-1"></a>model_mse_mean</span>
<span id="cb89-1488"><a href="#cb89-1488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1489"><a href="#cb89-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1490"><a href="#cb89-1490" aria-hidden="true" tabindex="-1"></a>Since I did not set seed, you might not get the same results as I got. But essentially we can use the mean prediction error values to also choose the better model out of the three.</span>
<span id="cb89-1491"><a href="#cb89-1491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1492"><a href="#cb89-1492" aria-hidden="true" tabindex="-1"></a>In the end, from these two tutorials, we can sum up our criteria for model comparison. We should check for the following while doing the comparison;</span>
<span id="cb89-1493"><a href="#cb89-1493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1494"><a href="#cb89-1494" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Cross-validated prediction error</span>
<span id="cb89-1495"><a href="#cb89-1495" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Inflation due to collinearity</span>
<span id="cb89-1496"><a href="#cb89-1496" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The standard error of effect size</span>
<span id="cb89-1497"><a href="#cb89-1497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1498"><a href="#cb89-1498" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion</span></span>
<span id="cb89-1499"><a href="#cb89-1499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1500"><a href="#cb89-1500" aria-hidden="true" tabindex="-1"></a>First of all, congratulations on completing the intermediate statistical modelling tutorial (bonus points if you completed the introduction tutorial also). In a nutshell, this is what we have learned from this tutorial;</span>
<span id="cb89-1501"><a href="#cb89-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1502"><a href="#cb89-1502" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Interpreting effect size when the response variable is categorical</span>
<span id="cb89-1503"><a href="#cb89-1503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1504"><a href="#cb89-1504" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Plotting model output using the <span class="in">`fmodel()`</span> function from the <span class="in">`{statisticalModeling}`</span> package</span>
<span id="cb89-1505"><a href="#cb89-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1506"><a href="#cb89-1506" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Interaction terms</span>
<span id="cb89-1507"><a href="#cb89-1507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1508"><a href="#cb89-1508" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Polynomial regression</span>
<span id="cb89-1509"><a href="#cb89-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1510"><a href="#cb89-1510" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Total and partial change</span>
<span id="cb89-1511"><a href="#cb89-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1512"><a href="#cb89-1512" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Interpreting the R-squared value in terms of model output and residuals</span>
<span id="cb89-1513"><a href="#cb89-1513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1514"><a href="#cb89-1514" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Bootstrapping technique to measure the precision of model statistics</span>
<span id="cb89-1515"><a href="#cb89-1515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1516"><a href="#cb89-1516" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>Scales and transformation</span>
<span id="cb89-1517"><a href="#cb89-1517" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Log transformation</span>
<span id="cb89-1518"><a href="#cb89-1518" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>Rank transformation</span>
<span id="cb89-1519"><a href="#cb89-1519" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-1520"><a href="#cb89-1520" aria-hidden="true" tabindex="-1"></a><span class="ss">9. </span>Collinearity</span>
<span id="cb89-1521"><a href="#cb89-1521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1522"><a href="#cb89-1522" aria-hidden="true" tabindex="-1"></a>You have mastered almost everything that is there in linear modelling. Congratulations! But, the journey is not over. The next stop is 'Generalized Linear Models in R`. This is a realm where we deal with complex datasets that cannot be analysed by our trusty linear regression models. Anyway, that's a problem for tomorrow. Practice the concepts you gained from both the tutorials and come ready for the next tutorial ✌️</span>
<span id="cb89-1523"><a href="#cb89-1523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1524"><a href="#cb89-1524" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;a</span> <span class="er">hidden</span> <span class="er">href</span><span class="ot">=</span><span class="st">"https://info.flagcounter.com/ynrK"</span><span class="kw">&gt;&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://s11.flagcounter.com/count2/ynrK/bg_000000/txt_FFFFFF/border_F0F0F0/columns_5/maxflags_25/viewers_0/labels_1/pageviews_1/flags_0/percent_0/"</span> <span class="er">alt</span><span class="ot">=</span><span class="st">"Flag Counter"</span> <span class="er">border</span><span class="ot">=</span><span class="st">"0"</span><span class="kw">/&gt;&lt;/a&gt;</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Blog made using <a href="https://quarto.org/">Quarto®</a> with ❤️, by Jewel Johnson.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jeweljohnsonj">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/jeweljohnsonj">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:jewel.johnson@bsu.edu">
      <i class="bi bi-briefcase" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:jeweljohnsonj@gmail.com">
      <i class="bi bi-house" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<div class="page-columns page-rows-contents page-layout-article"><div class="social-share"><a href="https://twitter.com/share?url=https://sciquest.netlify.app/tutorials/stat_model/inter_stat_model.html&amp;text=Intermediate statistical modelling in R" target="_blank" class="twitter"><i class="fab fa-twitter fa-fw fa-lg"></i></a><a href="https://www.linkedin.com/shareArticle?url=https://sciquest.netlify.app/tutorials/stat_model/inter_stat_model.html&amp;title=Intermediate statistical modelling in R" target="_blank" class="linkedin"><i class="fa-brands fa-linkedin-in fa-fw fa-lg"></i></a>  <a href="mailto:?subject=Intermediate statistical modelling in R&amp;body=Check out this link:https://sciquest.netlify.app/tutorials/stat_model/inter_stat_model.html" target="_blank" class="email"><i class="fa-solid fa-envelope fa-fw fa-lg"></i></a><a href="https://www.facebook.com/sharer.php?u=https://sciquest.netlify.app/tutorials/stat_model/inter_stat_model.html" target="_blank" class="facebook"><i class="fab fa-facebook-f fa-fw fa-lg"></i></a><a href="https://reddit.com/submit?url=https://sciquest.netlify.app/tutorials/stat_model/inter_stat_model.html&amp;title=Intermediate statistical modelling in R" target="_blank" class="reddit">   <i class="fa-brands fa-reddit-alien fa-fw fa-lg"></i></a><a href="https://www.stumbleupon.com/submit?url=https://sciquest.netlify.app/tutorials/stat_model/inter_stat_model.html&amp;title=Intermediate statistical modelling in R" target="_blank" class="stumbleupon"><i class="fa-brands fa-stumbleupon fa-fw fa-lg"></i></a><a href="https://www.tumblr.com/share/link?url=https://sciquest.netlify.app/tutorials/stat_model/inter_stat_model.html&amp;name=Intermediate statistical modelling in R" target="_blank" class="tumblr"><i class="fa-brands fa-tumblr fa-fw fa-lg"></i></a></div></div>



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>