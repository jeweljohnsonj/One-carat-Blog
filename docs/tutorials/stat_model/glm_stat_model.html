<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.242">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Jewel Johnson">
<meta name="dcterms.date" content="2022-08-23">
<meta name="description" content="Go beyond linear models and extend them to analyse non-normal datasets">
<title>one carat blog - Generalized linear models in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/quarto-contrib/social-share-0.1.0/social-share.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/social-share-0.1.0/all.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EVCS615JQR"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EVCS615JQR', { 'anonymize_ip': true});
</script><style>html{ scroll-behavior: smooth; }</style>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script><link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<link href="../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../site_libs/pagedtable-1.1/js/pagedtable.js"></script><script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script><script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script><script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
<link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="https://cdn.knightlab.com/libs/juxtapose/latest/css/juxtapose.css">
<meta property="og:title" content="one carat blog - Generalized linear models in R">
<meta property="og:description" content="Go beyond linear models and extend them to analyse non-normal datasets">
<meta property="og:image" content="https://one-carat-blog.netlify.app/tutorials\stat_model\images\stat_model_3.png">
<meta property="og:site-name" content="one carat blog">
<meta property="og:image:height" content="1080">
<meta property="og:image:width" content="1920">
<meta name="twitter:title" content="one carat blog - Generalized linear models in R">
<meta name="twitter:description" content="Go beyond linear models and extend them to analyse non-normal datasets">
<meta name="twitter:image" content="https://one-carat-blog.netlify.app/tutorials\stat_model\images\stat_model_3.png">
<meta name="twitter:image-height" content="1080">
<meta name="twitter:image-width" content="1920">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../favicon.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">one carat blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../blog.html">Blog</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials.html">Tutorials</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://jeweljohnsonj.github.io/jewel_resume/">About me</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jeweljohnsonj/one-carat-blog"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/jeweljohnsonj"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
</ul>
<div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Generalized linear models in R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          Go beyond linear models and extend them to analyse non-normal datasets
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">statistical modelling</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Jewel Johnson </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 23, 2022</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#prologue" id="toc-prologue" class="nav-link active" data-scroll-target="#prologue"><span class="toc-section-number">1</span>  Prologue</a></li>
  <li><a href="#making-life-easier" id="toc-making-life-easier" class="nav-link" data-scroll-target="#making-life-easier"><span class="toc-section-number">2</span>  Making life easier</a></li>
  <li><a href="#understanding-the-coeffecients-in-a-linear-model" id="toc-understanding-the-coeffecients-in-a-linear-model" class="nav-link" data-scroll-target="#understanding-the-coeffecients-in-a-linear-model"><span class="toc-section-number">3</span>  Understanding the coeffecients in a linear model</a></li>
  <li><a href="#limitations-of-linear-models" id="toc-limitations-of-linear-models" class="nav-link" data-scroll-target="#limitations-of-linear-models"><span class="toc-section-number">4</span>  Limitations of linear models</a></li>
  <li><a href="#poisson-regression-model" id="toc-poisson-regression-model" class="nav-link" data-scroll-target="#poisson-regression-model"><span class="toc-section-number">5</span>  Poisson regression model</a></li>
  <li>
<a href="#logistic-regression-model" id="toc-logistic-regression-model" class="nav-link" data-scroll-target="#logistic-regression-model"><span class="toc-section-number">6</span>  Logistic regression model</a>
  <ul class="collapse">
<li><a href="#bernouli-and-binomial-distributions" id="toc-bernouli-and-binomial-distributions" class="nav-link" data-scroll-target="#bernouli-and-binomial-distributions"><span class="toc-section-number">6.1</span>  Bernouli and binomial distributions</a></li>
  </ul>
</li>
  <li><a href="#link-functions" id="toc-link-functions" class="nav-link" data-scroll-target="#link-functions"><span class="toc-section-number">7</span>  Link functions</a></li>
  <li><a href="#simulating-logit-and-probit" id="toc-simulating-logit-and-probit" class="nav-link" data-scroll-target="#simulating-logit-and-probit"><span class="toc-section-number">8</span>  Simulating logit and probit</a></li>
  <li><a href="#understanding-the-coefficients-in-a-poisson-model" id="toc-understanding-the-coefficients-in-a-poisson-model" class="nav-link" data-scroll-target="#understanding-the-coefficients-in-a-poisson-model"><span class="toc-section-number">9</span>  Understanding the coefficients in a Poisson model</a></li>
  <li><a href="#plotting-a-poisson-model" id="toc-plotting-a-poisson-model" class="nav-link" data-scroll-target="#plotting-a-poisson-model"><span class="toc-section-number">10</span>  Plotting a Poisson model</a></li>
  <li><a href="#understanding-the-coefficients-in-a-logistic-model" id="toc-understanding-the-coefficients-in-a-logistic-model" class="nav-link" data-scroll-target="#understanding-the-coefficients-in-a-logistic-model"><span class="toc-section-number">11</span>  Understanding the coefficients in a logistic model</a></li>
  <li><a href="#plotting-a-logistic-model" id="toc-plotting-a-logistic-model" class="nav-link" data-scroll-target="#plotting-a-logistic-model"><span class="toc-section-number">12</span>  Plotting a logistic model</a></li>
  <li><a href="#multiple-regression-with-glms" id="toc-multiple-regression-with-glms" class="nav-link" data-scroll-target="#multiple-regression-with-glms"><span class="toc-section-number">13</span>  Multiple regression with GLMs</a></li>
  <li><a href="#assumptions-of-glms" id="toc-assumptions-of-glms" class="nav-link" data-scroll-target="#assumptions-of-glms"><span class="toc-section-number">14</span>  Assumptions of GLMs</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="toc-section-number">15</span>  Conclusion</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jeweljohnsonj/one-carat-blog/edit/main/tutorials/stat_model/glm_stat_model.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/jeweljohnsonj/one-carat-blog/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><div class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="27" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 26;"><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="pp">require</span>(<span class="st">"https://cdn.jsdelivr.net/npm/juxtaposejs@1.1.6/build/js/juxtapose.min.js"</span>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">catch</span>(() <span class="kw">=&gt;</span> <span class="kw">null</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-1" data-nodetype="expression">

</div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
TL;DR
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this article you will learn;</p>
<ol type="1">
<li><p>Understanding the coefficients in a linear model</p></li>
<li><p>Why do linear models fail for some datasets and what are the limitations of a linear model</p></li>
<li><p>Two types of GLMs: Poisson and Logistic</p></li>
<li><p>Link functions</p></li>
<li><p>Understanding the coefficients in a Poisson and logistic models</p></li>
<li><p>Plotting Poisson and logistic models</p></li>
<li><p>Brief introduction to multiple regression using GLMs</p></li>
<li><p>Assumptions of GLMs: When to use GLMs</p></li>
</ol>
</div>
</div>
<section id="prologue" class="level2" data-number="1"><h2 data-number="1" class="anchored" data-anchor-id="prologue">
<span class="header-section-number">1</span> Prologue</h2>
<p>This is the third tutorial in the series: Statistical modelling using R. In this tutorial we will work with datasets that fail the assumptions of linear models. We will first see what these assumptions are and then we will learn about generalised linear models which is an extension of the linear model architecture. So let’s go!</p>
</section><section id="making-life-easier" class="level2" data-number="2"><h2 data-number="2" class="anchored" data-anchor-id="making-life-easier">
<span class="header-section-number">2</span> Making life easier</h2>
<p>Please install and load the necessary packages and datasets which are listed below for a seamless tutorial session. (Not required but can be very helpful if you are following this tutorial code by code)</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Run the following lines of code</span></span>
<span></span>
<span><span class="co"># Packages used in this tutorial</span></span>
<span><span class="va">tutorial_packages</span> <span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html">quos</a></span><span class="op">(</span><span class="va">Stat2Data</span>, <span class="va">modelsummary</span>, <span class="va">devtools</span>, <span class="va">COUNT</span>, <span class="va">broom</span>,</span>
<span>                                 <span class="va">cherryblossom</span>, <span class="va">datasets</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install required packages</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">tutorial_packages</span>, <span class="fu">rlang</span><span class="fu">::</span><span class="va"><a href="https://rlang.r-lib.org/reference/quo_label.html">quo_name</a></span><span class="op">)</span>,</span>
<span>  <span class="va">install.packages</span>,</span>
<span>  character.only <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"dtkaplan/statisticalModeling"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loading the libraries</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">tutorial_packages</span>, <span class="fu">rlang</span><span class="fu">::</span><span class="va"><a href="https://rlang.r-lib.org/reference/quo_label.html">quo_name</a></span><span class="op">)</span>,</span>
<span>  <span class="va">library</span>,</span>
<span>  character.only <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Datasets used in this tutorial</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"HorsePrices"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"rwm1984"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"run17"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="understanding-the-coeffecients-in-a-linear-model" class="level2" data-number="3"><h2 data-number="3" class="anchored" data-anchor-id="understanding-the-coeffecients-in-a-linear-model">
<span class="header-section-number">3</span> Understanding the coeffecients in a linear model</h2>
<p>To quickly recap, a linear model tries to explain the variability seen in the response variable by estimating the coefficients for explanatory variables. These coefficients are nothing but your effect size or the slope of the explanatory variable calculated from the model. Consider the following example.</p>
<p>We will use the <code>HorsePrices</code> dataset from the <a href="https://github.com/statmanrobin/Stat2Data">Stat2Data</a> package in R. We will model the price of the horses in this dataset to their height and age. We will use the <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function to output the summary of the linear model.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statmanrobin/Stat2Data">Stat2Data</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'Stat2Data'</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">statisticalModeling</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'statisticalModeling'</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statmanrobin/Stat2Data">Stat2Data</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">statisticalModeling</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"HorsePrices"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a linear model</span></span>
<span><span class="va">model_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Price</span> <span class="op">~</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">Sex</span>, data <span class="op">=</span> <span class="va">HorsePrices</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the model</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/statisticalModeling/man/fmodel.html">fmodel</a></span><span class="op">(</span><span class="va">model_lm</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Price ~ Age + Height"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="glm_stat_model_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Getting the summary of the linear model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_lm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Price ~ Age + Sex, data = HorsePrices)

Residuals:
   Min     1Q Median     3Q    Max 
-24988 -10296  -1494   8286  27653 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  18199.7     4129.3   4.407 6.03e-05 ***
Age           -220.1      393.8  -0.559    0.579    
Sexm         17008.6     3639.6   4.673 2.52e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 12540 on 47 degrees of freedom
Multiple R-squared:  0.3283,    Adjusted R-squared:  0.2997 
F-statistic: 11.48 on 2 and 47 DF,  p-value: 8.695e-05</code></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calculating the effect sizes</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/statisticalModeling/man/effect_size.html">effect_size</a></span><span class="op">(</span><span class="va">model_lm</span>, <span class="op">~</span> <span class="va">Age</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["slope"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Age"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["to:Age"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Sex"],"name":[4],"type":["fct"],"align":["left"]}],"data":[{"1":"-220.0847","2":"6","3":"10.57398","4":"m","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>In the summary of the model, in the coefficients section, the estimate column is nothing but effect sizes. Compare the estimate for ‘age’ in the model summary and the effect size of ‘age’ calculated from the <code><a href="https://rdrr.io/pkg/statisticalModeling/man/effect_size.html">effect_size()</a></code> function, both are the same.</p>
<p>Recall that the equation for a straight line is;</p>
<p><span class="math display"> y = mx+c </span> Where <span class="math inline">m</span> is the slope of the line and <span class="math inline">c</span> is the y-intercept.</p>
<p>We can see from the graph that there are two straight lines, therefore there will be two equations for the straight lines. Imagine <span class="math inline">y_1</span> to be the equation of the straight line for females (the red line) and similarly, <span class="math inline">y_2</span> is for males (the blue line). The equations for the straight lines are;</p>
<p><span class="math display"> y_1 = m_1x_1 + c_1 \\
y_2 = m_2x_2 + c_2</span></p>
<p>From the graph, you can see that the slopes for both lines are the same. This means that the effect size of age is the same across both the sex. Also, the slope should be a negative value because as age increases, the price is decreasing for both sexes. From the model summary, the slope value for age is -220.10. Thus we have;</p>
<p><span class="math display">m_1 = m_2 = -220.1</span></p>
<p>Now recall how I explained that the effect size for a categorical exploratory variable is expressed in terms of <a href="https://one-carat-blog.netlify.app/tutorials/stat_model/intro_stat_model.html#effect-sizes">change</a> and that change is in terms of their <a href="https://one-carat-blog.netlify.app/tutorials/stat_model/inter_stat_model.html#interactions-among-explanatory-variables">y-intercepts</a>.</p>
<p>Now R calculates intercepts in two ways. The default way or the first way is what is shown in the model summary. In the (Intercept) row, the estimated value is 18199.7 and this value is the y-intercept value for the straight line for ‘female’. You can easily verify this from the red line in the graph. Notice how the y-intercepts are the same as shown in the model summary and the plot. Now in the row ‘Sexm’, the estimated value shows how much difference is there from the estimated value shown in the (Intercept) row or otherwise how much difference in y-intercept is there between females and males. Since the difference is positive this means the y-intercept for males is 17008.6 higher than the y-intercept for females. Thus we have;</p>
<p><span class="math display">c_1 = 18199.7\\c_2 - c_1 = 17008.6</span></p>
<p>The intercept value by default is shown for the first level in the exploratory variable which here is female.</p>
<p>The second way is to individually show the corresponding y-intercept values for males and females. For that, we can use the expression <code>-1</code> in the model formula.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statmanrobin/Stat2Data">Stat2Data</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">statisticalModeling</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"HorsePrices"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a linear model showing mean for each level of the response variable</span></span>
<span><span class="va">model_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Price</span> <span class="op">~</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">Sex</span> <span class="op">-</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">HorsePrices</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Getting the summary of the linear model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_lm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Price ~ Age + Sex - 1, data = HorsePrices)

Residuals:
   Min     1Q Median     3Q    Max 
-24988 -10296  -1494   8286  27653 

Coefficients:
     Estimate Std. Error t value Pr(&gt;|t|)    
Age    -220.1      393.8  -0.559    0.579    
Sexf  18199.7     4129.3   4.407 6.03e-05 ***
Sexm  35208.2     3497.7  10.066 2.59e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 12540 on 47 degrees of freedom
Multiple R-squared:  0.8429,    Adjusted R-squared:  0.8329 
F-statistic: 84.05 on 3 and 47 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Now you get individual y-intercept values for all the levels in the data. There will be slight decimal differences while adding up the values but the concept is the same.</p>
<p><span class="math display">c_1 = 18199.7\\c_2 = 35208.2 = 17008.6 + 18199.7</span></p>
<p>In algebraic form, the default model formula for a linear model used in <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> is;</p>
<p><span class="math display">y \sim \beta_0 + \beta_2x_2 + \beta_3x_3 + .. + \epsilon</span> And when <code>-1</code> is used in the model formula, then it becomes;</p>
<p><span class="math display">y \sim \beta_1x_1 + \beta_2x_2 + \beta_3x_3 + .. + \epsilon</span></p>
<p>So the first way compares differences between groups by taking the first group as the reference and giving a global intercept (<span class="math inline">\beta_0</span>) and in a second way, we can see the actual change in the respective groups as their respective coefficients (<span class="math inline">\beta_1</span>, <span class="math inline">\beta_2</span> etc.).</p>
</section><section id="limitations-of-linear-models" class="level2" data-number="4"><h2 data-number="4" class="anchored" data-anchor-id="limitations-of-linear-models">
<span class="header-section-number">4</span> Limitations of linear models</h2>
<p>Four assumptions are required to be satisfied to be able to do linear modelling;</p>
<ol type="1">
<li>The values in the datasets are normally distributed</li>
<li>The residuals are normally distributed</li>
<li>The values in the datasets are continuous</li>
<li>Variables form a linear relationship with each other</li>
</ol>
<p>Many datasets fail these assumptions. Survival data with binary responses or data with count values are both non-normal and discontinuous. Linear modelling won’t do any good in analysing these datasets. So what is the solution? The solution is to extend linear models and generalize them so that they can accept non-normal distributions. In R, the process is simple and we have seen it being used in logistic regression in tutorial 1 using the <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> function. Therefore <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> function calls for the generalized model in R and the type of model is specified by the distribution of the data. If the data is count type then we can use the <code>Poisson</code> family distribution and if the data is binomial then use the <code>binomial</code> family distribution. We will see both of these in detail further in the tutorial. The process of generalizing a linear model is through ‘non-linear link functions’ which link the regression coefficients to the distribution and allow the linear model to be generalised. We will learn more about this in the later sections.</p>
<p>The syntax for the <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> function is as follows;</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, family <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the Poisson regression model we can specify <code>family = "poisson"</code> and for the binomial regression model we can specify <code>family = "binomial"</code>.</p>
<p>Since the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function is only applicable for normal or Gaussian distributions;</p>
<p><code>glm(formula, data, family = "gaussian")</code> = <code>lm(formula, data)</code></p>
<p>Therefore a linear model is a generalized linear model with the Gaussian family.</p>
</section><section id="poisson-regression-model" class="level2" data-number="5"><h2 data-number="5" class="anchored" data-anchor-id="poisson-regression-model">
<span class="header-section-number">5</span> Poisson regression model</h2>
<p>As mentioned earlier, the Poisson model is used if the dataset contains count data. Count data can be no of things sold in a shop, no people with cancer in a city or no of visitors in a shop. Intuitively, we can say that count data ranges from 0 to infinity. There is no negative or decimal count data. Thus your dataset should only contain 0 or positive integer values for the Poisson model to work. Also, the values in the dataset should have been obtained in the same manner. For example: let’s say your dataset contains count data for the no. of people coming to the shop per day, then the same dataset should not contain values for no. of people coming to the shop per week, as they are sampled differently in terms of time. Lastly, if your dataset has a variance greater than the mean or if you have lots of zeros in your data then some modifications have to be done to be able to use the Poisson regression model.</p>
<p>In short, you should not use the Poisson regression model if you have the following conditions;</p>
<ol type="1">
<li>Dataset contains negative and/or non-integer values</li>
<li>Dataset is sampled across in a different manner (no. of people per day vs.&nbsp;no. of people per week)</li>
<li>Dataset has a variance greater than its mean (Over-dispersed data)</li>
<li>Dataset has lots of zero values (Zero-inflated data)</li>
</ol>
<p>Let us build a Poisson model. We will use the <code>rwm1984</code> dataset from the <code>{COUNT}</code> package in R. The dataset is a German health registry for the year 1984. We are interested in seeing whether the number of visits to the doctor during a year (<code>docvis</code>) is associated with age (<code>age</code>). Since we have count data we will build a Poisson model to see this association.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">COUNT</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'COUNT'</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">COUNT</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"rwm1984"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a poisson model</span></span>
<span><span class="va">model_poisson</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">docvis</span> <span class="op">~</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">rwm1984</span>, family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Printing model output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_poisson</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = docvis ~ age, family = "poisson", data = rwm1984)

Deviance Residuals: 
   Min      1Q  Median      3Q     Max  
-3.229  -2.263  -1.271   0.326  26.383  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -0.0983153  0.0399295  -2.462   0.0138 *  
age          0.0273395  0.0008204  33.325   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 25791  on 3873  degrees of freedom
Residual deviance: 24655  on 3872  degrees of freedom
AIC: 31742

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>Apart from the <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function, we also use the <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> function from the <a href="https://broom.tidymodels.org/">broom</a> package in R to print the outputs of the model as a data frame.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'broom'</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">COUNT</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"rwm1984"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a poisson model</span></span>
<span><span class="va">model_poisson</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">docvis</span> <span class="op">~</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">rwm1984</span>, family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Printing model output using tidy()</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_poisson</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"-0.09831529","3":"0.0399294797","4":"-2.462223","5":"1.380787e-02"},{"1":"age","2":"0.02733953","3":"0.0008203971","4":"33.324750","5":"1.691649e-243"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Sometimes we are interested in extracting the coefficients or finding out the confidence intervals from the model.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">COUNT</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"rwm1984"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a poisson model</span></span>
<span><span class="va">model_poisson</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">docvis</span> <span class="op">~</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">rwm1984</span>, family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extracting the coefficients</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">model_poisson</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         age 
-0.09831529  0.02733953 </code></pre>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Estimating the confidence interval</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">model_poisson</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %      97.5 %
(Intercept) -0.1767936 -0.02027057
age          0.0257330  0.02894895</code></pre>
</div>
</div>
</section><section id="logistic-regression-model" class="level2" data-number="6"><h2 data-number="6" class="anchored" data-anchor-id="logistic-regression-model">
<span class="header-section-number">6</span> Logistic regression model</h2>
<p>In <a href="https://one-carat-blog.netlify.app/tutorials/stat_model/intro_stat_model.html#logistic-model">tutorial 1</a>, we briefly saw what logistic regression was. We use the logistic model when;</p>
<ol type="1">
<li>Data is binary (0/1)</li>
<li>Data has only two mutually exclusive values (Alive/Dead or Yes/No or Win/Lose or Pass/Fail)</li>
<li>Data has only two values choices or behaviour (Non-veg/Veg, Wet/Dry)</li>
</ol>
<p>In short, for a logistic regression model, the model outputs probabilities (<span class="math inline">p</span>) for binary outcomes in the response variable (<span class="math inline">y</span>).</p>
<p><span class="math display">y = Binomial(p)</span></p>
<p>Let us build a logistic model using <code>run17</code> dataset from the <a href="https://github.com/OpenIntroStat/cherryblossom">cherryblossom</a> package in R. We have seen this dataset in the first tutorial. The dataset contains details for all 19,961 runners in the 2017 Cherry Blossom Run, which is an annual road race that takes place in Washington, DC, USA. The Cherry Blossom Run has two events; a 10 Mile marathon and a 5 Km run. We will be building a logistic model to whether event choice is predicted by the participant’s age.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/OpenIntroStat/cherryblossom">cherryblossom</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'cherryblossom'</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/OpenIntroStat/cherryblossom">cherryblossom</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"run17"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tidying the data</span></span>
<span><span class="va">run17_tidy</span> <span class="op">&lt;-</span> <span class="va">run17</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span>, <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span>, <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span><span class="op">)</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a logistic model</span></span>
<span><span class="va">model_binomial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">event</span> <span class="op">~</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">run17_tidy</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Printing model output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_binomial</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = event ~ age, family = "binomial", data = run17_tidy)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1471   0.4963   0.5102   0.5285   0.6241  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.250155   0.074991  30.006  &lt; 2e-16 ***
age         -0.008390   0.001897  -4.423 9.74e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 15130  on 19959  degrees of freedom
Residual deviance: 15111  on 19958  degrees of freedom
  (1 observation deleted due to missingness)
AIC: 15115

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<section id="bernouli-and-binomial-distributions" class="level3" data-number="6.1"><h3 data-number="6.1" class="anchored" data-anchor-id="bernouli-and-binomial-distributions">
<span class="header-section-number">6.1</span> Bernouli and binomial distributions</h3>
<p>Both Bernoulli and binomial distributions form the basis for logistic regression. The main difference between these two distributions is that Bernoulli is associated with probabilities of a result in a single event whereas binomial is associated with probabilities of a result in multiple events. For example; the chance of getting a head in a single coin toss follows a Bernoulli distribution and the chance of getting a head in 10 coin tosses follows a binomial distribution.</p>
<p>In R we have the option to either use binomial or Bernoulli. So how do we know when to use which? The short answer is that it depends on the data structure. For wide format data, the binomial distribution is used and for long format data, the Bernoulli distribution is used. You can learn more about long format and wide format data <a href="https://one-carat-blog.netlify.app/tutorials/data_man/project5.html#reshaping-dataset">here</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/OpenIntroStat/cherryblossom">cherryblossom</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"run17"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tidying the data</span></span>
<span><span class="va">run17_tidy</span> <span class="op">&lt;-</span> <span class="va">run17</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">event</span>, <span class="va">age</span><span class="op">)</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span>, <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span>, <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span><span class="op">)</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Long format</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["event"],"name":[1],"type":["fct"],"align":["left"]},{"label":["age"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"Ten_Mile","2":"21"},{"1":"Ten_Mile","2":"22"},{"1":"Ten_Mile","2":"31"},{"1":"Ten_Mile","2":"33"},{"1":"Ten_Mile","2":"35"},{"1":"Ten_Mile","2":"33"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Converting the dataset to wide format</span></span>
<span><span class="va">run17_wide</span> <span class="op">&lt;-</span> <span class="va">run17_tidy</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">event</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">run17_wide</span> <span class="op">&lt;-</span> <span class="va">run17_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"event"</span>, values_from <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span></span>
<span><span class="va">run17_wide</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">run17_wide</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Wide format</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">run17_wide</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["age"],"name":[1],"type":["int"],"align":["right"]},{"label":["Five_Km"],"name":[2],"type":["int"],"align":["right"]},{"label":["Ten_Mile"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"6","2":"4","3":"0"},{"1":"7","2":"2","3":"0"},{"1":"8","2":"5","3":"0"},{"1":"9","2":"8","3":"0"},{"1":"10","2":"9","3":"0"},{"1":"11","2":"14","3":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>In the above case, for long format data, we have a single entry in each row corresponding to individual data but in the wide format, we have each row entry corresponding to a single age group. Another way of expressing the data in a wide format is to calculate the percentage of choices, which is by dividing the total number of choices for the first category by the total number of choices for both categories.</p>
<p>So for wide format data; If our data structure has the absolute value of the no. of choices made then we use <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code> in the model formula (also called as the Wilkinson-Rogers format). If we have percentages, then we use <code>weights = ()</code> in the <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> function.</p>
<p>So in summary we choose between Bernoulli and binomial by checking the following questions;</p>
<ol type="1">
<li>Is the data in long or wide format?</li>
<li>Do we have individual or group data?</li>
<li>Are we interested in individuals or groups?</li>
</ol>
<p>Let us build logistic models for both long format and wide format data.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/OpenIntroStat/cherryblossom">cherryblossom</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"run17"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tidying the data</span></span>
<span><span class="va">run17_tidy</span> <span class="op">&lt;-</span> <span class="va">run17</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">event</span>, <span class="va">age</span><span class="op">)</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span>, <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span>, <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span><span class="op">)</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a logistic model with long format</span></span>
<span><span class="va">model_logistic_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">event</span> <span class="op">~</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">run17_tidy</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Converting the dataset to wide format</span></span>
<span><span class="va">run17_tidy_1</span> <span class="op">&lt;-</span> <span class="va">run17_tidy</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>event_choice <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">event</span> <span class="op">==</span> <span class="st">"Ten_Mile"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">run17_wide</span> <span class="op">&lt;-</span> <span class="va">run17_tidy_1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">event</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">run17_wide</span> <span class="op">&lt;-</span> <span class="va">run17_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"event"</span>, values_from <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span></span>
<span><span class="va">run17_wide</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">run17_wide</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Building a logistic model with wide format</span></span>
<span><span class="co"># We use cbind() to bind the two choices</span></span>
<span><span class="va">model_logistic_wide_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Five_Km</span>, <span class="va">Ten_Mile</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span>,</span>
<span>                             data <span class="op">=</span> <span class="va">run17_wide</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a logistic model with wide format</span></span>
<span><span class="co"># We use percentage of choice and the weight or number of observations per group</span></span>
<span><span class="va">run17_wide</span><span class="op">$</span><span class="va">prect_ten_mile</span> <span class="op">&lt;-</span> <span class="va">run17_wide</span><span class="op">$</span><span class="va">Ten_Mile</span> <span class="op">/</span> <span class="op">(</span><span class="va">run17_wide</span><span class="op">$</span><span class="va">Ten_Mile</span> <span class="op">+</span> <span class="va">run17_wide</span><span class="op">$</span><span class="va">Five_Km</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_logistic_wide_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">prect_ten_mile</span> <span class="op">~</span> <span class="va">age</span>, </span>
<span>                             data <span class="op">=</span> <span class="va">run17_wide</span>, family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                             weights <span class="op">=</span> <span class="op">(</span><span class="va">run17_wide</span><span class="op">$</span><span class="va">Ten_Mile</span> <span class="op">+</span> <span class="va">run17_wide</span><span class="op">$</span><span class="va">Five_Km</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Printing model outputs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_logistic_long</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = event ~ age, family = "binomial", data = run17_tidy)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1471   0.4963   0.5102   0.5285   0.6241  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.250155   0.074991  30.006  &lt; 2e-16 ***
age         -0.008390   0.001897  -4.423 9.74e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 15130  on 19959  degrees of freedom
Residual deviance: 15111  on 19958  degrees of freedom
  (1 observation deleted due to missingness)
AIC: 15115

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_logistic_wide_1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = cbind(Five_Km, Ten_Mile) ~ age, family = "binomial", 
    data = run17_wide)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.9381  -0.6116   0.4472   1.7556   7.5007  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -2.245070   0.074961 -29.950  &lt; 2e-16 ***
age          0.008267   0.001897   4.358 1.31e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 411.90  on 79  degrees of freedom
Residual deviance: 393.17  on 78  degrees of freedom
AIC: 711.65

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_logistic_wide_2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = prect_ten_mile ~ age, family = "binomial", data = run17_wide, 
    weights = (run17_wide$Ten_Mile + run17_wide$Five_Km))

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-7.5007  -1.7556  -0.4472   0.6116   2.9381  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.245070   0.074961  29.950  &lt; 2e-16 ***
age         -0.008267   0.001897  -4.358 1.31e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 411.90  on 79  degrees of freedom
Residual deviance: 393.17  on 78  degrees of freedom
AIC: 711.65

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>In summary we have three data formats for logistic regression</p>
<ol type="1">
<li>Binary format</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Binary: y = 0 or 1</span></span>
<span><span class="va">model_logistic_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">event</span> <span class="op">~</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">run17_tidy</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Wilkinson-Rogers format (the ‘cbind’ format)</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Wilkinson-Rogers: cbind(success, failure)</span></span>
<span><span class="va">model_logistic_wide_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Five_Km</span>, <span class="va">Ten_Mile</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span>,</span>
<span>                             data <span class="op">=</span> <span class="va">run17_wide</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Weighted format</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Weighted format: y = 'proportions', weights = 'totals'</span></span>
<span><span class="va">model_logistic_wide_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">prect_ten_mile</span> <span class="op">~</span> <span class="va">age</span>, </span>
<span>                             data <span class="op">=</span> <span class="va">run17_wide</span>, family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                             weights <span class="op">=</span> <span class="op">(</span><span class="va">run17_wide</span><span class="op">$</span><span class="va">Ten_Mile</span> <span class="op">+</span> <span class="va">run17_wide</span><span class="op">$</span><span class="va">Five_Km</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Please note that all three models give the same coefficients but the model with the long format structure has higher degrees of freedom as compared to the other two models with the wide format.</p>
</section></section><section id="link-functions" class="level2" data-number="7"><h2 data-number="7" class="anchored" data-anchor-id="link-functions">
<span class="header-section-number">7</span> Link functions</h2>
<p>The ‘link function’ is what enables us to generalize a linear model so that we can use it in datasets which do not meet the assumptions of a linear model. In a way, it is a function which transforms the coefficients of the explanatory variables to form a linear combination with each other like in the case of a linear regression model.</p>
<ul>
<li>For <code>poisson</code> family models, the link function is <code>log</code> and thus the coefficients of the model are in log-scale.</li>
<li>For ‘binomial’ family models, there are two link functions; <code>logit</code> and <code>probit</code>
</li>
</ul>
<p>The logit link function transforms the probabilities to ‘log-odds values’ which are real numbers ranging from <span class="math inline">-\infty</span> to <span class="math inline">+\infty</span> and gives rise to a linear equation similar to what is seen in a linear regression model. In logistic regression, by default, the <code>logit</code> link function is used.</p>
<p><span class="math display">logit(p) = m_1x_1 + c_1 = log(\frac{p}{1-p})</span> The probit link function is also similar to the logit link but is based on the cumulative standard normal distribution function. By default, the logistic regression in the <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> function uses the logit link function.</p>
<p>To use another link function, we should specify the link function in the family;</p>
<p><code>family = "binomial"</code> = <code>family = binomial(link = "probit")</code>: By default, logit link function is used</p>
<p><code>family = binomial(link = "probit")</code>: Using the probit link function</p>
<p>Look at the graphs given below. Use the slider to compare them. You can see that the model with the logit link function has a slightly longer or fatter tail, as both the tail ends reaches the limit slower as compared to the model with the probit link function. Therefore, in general, the logit link function is better at modelling outliers or rare events as compared to probit.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">datasets</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">statisticalModeling</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a logistic model with logit link which is the default</span></span>
<span><span class="va">mtcars_logit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="va">mpg</span>, data<span class="op">=</span><span class="va">mtcars</span>, family<span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a logistic model with probit link which is the default</span></span>
<span><span class="va">mtcars_probit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="va">mpg</span>, data<span class="op">=</span><span class="va">mtcars</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"probit"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting logistic model with logit link</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/statisticalModeling/man/fmodel.html">fmodel</a></span><span class="op">(</span><span class="va">mtcars_logit</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"VS ~ mpg (logistic model with logit link)"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting logistic model with probit link</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/statisticalModeling/man/fmodel.html">fmodel</a></span><span class="op">(</span><span class="va">mtcars_probit</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"VS ~ mpg (logistic model with probit link)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="juxtapose" data-startingposition="50%">
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">datasets</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">statisticalModeling</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a logistic model with logit link which is the default</span></span>
<span><span class="va">mtcars_logit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="va">mpg</span>, data<span class="op">=</span><span class="va">mtcars</span>, family<span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a logistic model with probit link which is the default</span></span>
<span><span class="va">mtcars_probit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="va">mpg</span>, data<span class="op">=</span><span class="va">mtcars</span>, family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"probit"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting logistic model with logit link</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/statisticalModeling/man/fmodel.html">fmodel</a></span><span class="op">(</span><span class="va">mtcars_logit</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"VS ~ mpg (logistic model with logit link)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="glm_stat_model_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Plotting logistic model with probit link</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/statisticalModeling/man/fmodel.html">fmodel</a></span><span class="op">(</span><span class="va">mtcars_probit</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"VS ~ mpg (logistic model with probit link)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="glm_stat_model_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</section><section id="simulating-logit-and-probit" class="level2" data-number="8"><h2 data-number="8" class="anchored" data-anchor-id="simulating-logit-and-probit">
<span class="header-section-number">8</span> Simulating logit and probit</h2>
<p>We can simulate a logit distribution using the <code><a href="https://rdrr.io/r/stats/Logistic.html">plogis()</a></code> and the <code><a href="https://rdrr.io/r/stats/Binomial.html">rbinom()</a></code> functions together. The <code><a href="https://rdrr.io/r/stats/Binomial.html">rbinom()</a></code> is a random number generator function which has additional input parameters;</p>
<p><code>n</code> = Number of random numbers to generate <code>size</code> = Number of trails <code>p</code> = Probability of success</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Converting a logit scale value to probability value</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulating a logit distribution</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 1 1 0 1 1 1 1</code></pre>
</div>
</div>
<p>A probit distribution can be made using the <code>pnrom()</code> and the <code><a href="https://rdrr.io/r/stats/Binomial.html">rbinom()</a></code> functions together.</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Converting a probit scale value to probability value</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulating a probit distribution</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 1 1 1 1 1 1 1</code></pre>
</div>
</div>
</section><section id="understanding-the-coefficients-in-a-poisson-model" class="level2" data-number="9"><h2 data-number="9" class="anchored" data-anchor-id="understanding-the-coefficients-in-a-poisson-model">
<span class="header-section-number">9</span> Understanding the coefficients in a Poisson model</h2>
<p>The link function for the Poisson regression model is the log function. Now we will see how to interpret the coefficients/effect sizes of a Poisson regression model. Let us quickly recall how we interpreted the coefficients/effect sizes of a linear regression model. We will use our earlier example but with only ‘Sex’ as the exploratory variable.</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statmanrobin/Stat2Data">Stat2Data</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"HorsePrices"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a linear model</span></span>
<span><span class="va">model_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Price</span> <span class="op">~</span> <span class="va">Sex</span>, data <span class="op">=</span> <span class="va">HorsePrices</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Getting the summary of the linear model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_lm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Price ~ Sex, data = HorsePrices)

Residuals:
   Min     1Q Median     3Q    Max 
-23730 -10061  -1255   8495  28495 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    16505       2783   5.931 3.20e-07 ***
Sexm           17225       3593   4.794 1.62e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 12450 on 48 degrees of freedom
Multiple R-squared:  0.3238,    Adjusted R-squared:  0.3097 
F-statistic: 22.98 on 1 and 48 DF,  p-value: 1.619e-05</code></pre>
</div>
</div>
<p>In algebraic form, the model formula for a linear model is;</p>
<p><span class="math display">y \sim \beta_0 + \beta_1x_1 + \beta_2x_2 + .. + \epsilon</span> From the model summary, we have;</p>
<p><span class="math display">y = Price\\ \beta_0 = 16505 = Reference\,intercept\,(female)\\ \beta_1 = 17225 = Difference\,from\,the\,reference\,intercept\,(for\,male)\\ \epsilon = Error\,value\,of\,the\,model</span></p>
<p>We also have;</p>
<p><span class="math display">\beta_0 + \beta_1 = Average\,price\,of\,male\,horses</span> This shows that the coefficient in a linear model is additive. But when we come to the Poisson model, the link function is a log function which takes in the parameter <span class="math inline">\lambda</span> of the Poisson distribution. We have;</p>
<p><span class="math display">Parameter\,of\,poisson\,distribution:\lambda = e^{\beta_0 + \beta_1x_1 + \beta_2x_2 + .. + \epsilon}\\ Link\,function: ln(\lambda) = \beta_0 + \beta_1x_1 + \beta_2x_2 + .. + \epsilon</span></p>
<p>Here the coefficients are no longer additive as they are in log scale. Therefore the coefficients are multiplicative. Let us look at the Poisson regression model we created earlier;</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">COUNT</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"rwm1984"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a poisson model</span></span>
<span><span class="va">model_poisson</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">docvis</span> <span class="op">~</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">rwm1984</span>, family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Printing model outputs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_poisson</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = docvis ~ age, family = "poisson", data = rwm1984)

Deviance Residuals: 
   Min      1Q  Median      3Q     Max  
-3.229  -2.263  -1.271   0.326  26.383  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -0.0983153  0.0399295  -2.462   0.0138 *  
age          0.0273395  0.0008204  33.325   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 25791  on 3873  degrees of freedom
Residual deviance: 24655  on 3872  degrees of freedom
AIC: 31742

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>Here we have;</p>
<p><span class="math display">y = No.\,of\,days\,of\,doctor\,visits\\ \beta_0 = -0.0983153 = Reference\,intercept\\ \beta_1 = 0.0273395 = Difference\,from\,the\,reference\,intercept\\ \epsilon = Error\,value\,of\,the\,model</span></p>
<p>Now to find the average effect of age on the no. of days of doctor visits, we have to multiply <span class="math inline">\beta_0</span> and <span class="math inline">\beta_1</span> instead adding the values like in the case of a linear model.</p>
<p><span class="math display">\beta_0 * \beta_1 = ln(average\,effect\,of\,age\,on\,the\,no.\,of\,days\,of\,doctor\,visits)\\ e^{\beta_0 + \beta_1} = average\,effect\,of\,age\,on\,the\,no.\,of\,days\,of\,doctor\,visits</span></p>
<p>But if we exponentiate the coefficients, then we get the raw value, which we can add like in the case of a linear model.</p>
</section><section id="plotting-a-poisson-model" class="level2" data-number="10"><h2 data-number="10" class="anchored" data-anchor-id="plotting-a-poisson-model">
<span class="header-section-number">10</span> Plotting a Poisson model</h2>
<p>You can either use the <code><a href="https://rdrr.io/pkg/statisticalModeling/man/fmodel.html">fmodel()</a></code> function from the <code>{statisticalModeling}</code> package or use the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function from the <a href="https://ggplot2.tidyverse.org">ggplot2</a> package.</p>
<p>For the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function, we specify ‘poisson’ model in the <code>method.args = list(family = " ")</code> parameter inside <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> argument.</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">COUNT</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">statisticalModeling</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"rwm1984"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a poisson model</span></span>
<span><span class="va">model_poisson</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">docvis</span> <span class="op">~</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">rwm1984</span>, family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting using the fmodel() function</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/statisticalModeling/man/fmodel.html">fmodel</a></span><span class="op">(</span><span class="va">model_poisson</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rwm1984</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"docvis ~ age (poisson model)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="glm_stat_model_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Plotting using the ggplot() function</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rwm1984</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">docvis</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.05</span>, height <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'glm'</span>, method.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">'poisson'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"docvis ~ age (poisson model)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="glm_stat_model_files/figure-html/unnamed-chunk-21-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="understanding-the-coefficients-in-a-logistic-model" class="level2" data-number="11"><h2 data-number="11" class="anchored" data-anchor-id="understanding-the-coefficients-in-a-logistic-model">
<span class="header-section-number">11</span> Understanding the coefficients in a logistic model</h2>
<p>In a linear model, the coefficients were straight forward and in the Poisson model, after exponentiating the coefficients, the values were similar to that of the linear model. But for a logistic model transformation won’t help and it’s not as straightforward as compared to the other models. So instead, the coefficient values are converted to odds ratio. The odds ratio calculates the relative odds of two events occurring. For example, let us imagine a football team that is expected to win 10 games for every game they lose. Then the odds of winning the odds of losing would be 10 to 1. And the odds ratio would be 10/1 which is 10.</p>
<p>As mentioned earlier, the default link function for a logistic model is logit, so our coefficients start as ‘log-odds’ which when exponentiated will give us the odds ratio.</p>
<p>In general, odds-ratio values are interpreted in the following way;</p>
<ul>
<li>OR = 1: Coefficient has no effect</li>
<li>OR &lt; 1: Coefficient decreased the odds</li>
<li>OR &gt; 1: Coefficient increases the odds</li>
</ul>
<p>Imagine a football team is singing two players; A and B. Odds-ratio of winning is 3 if player A joins the team, which means, in that season, if player A joins, the team is bound to win 3 games for every game they lose. Likewise, if player B joins let’s say the odds ratio is 0.5, which means they will win 1 game for every 2 games they lose. The odds ratio is often reported along the 95% confidence intervals.</p>
<p>Let us calculate the odds ratio and the confidence interval of the model we previously created. We will use the <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> function from <a href="https://broom.tidymodels.org/">broom</a> package in R.</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/OpenIntroStat/cherryblossom">cherryblossom</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"run17"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tidying the data</span></span>
<span><span class="va">run17_tidy</span> <span class="op">&lt;-</span> <span class="va">run17</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span>, <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span>, <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span><span class="op">)</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a logistic model</span></span>
<span><span class="va">model_binomial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">event</span> <span class="op">~</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">run17_tidy</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Finding the odds ratio and confidence interval</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_binomial</span>, exponentiate <span class="op">=</span> <span class="cn">T</span>, conf.int <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"9.489204","3":"0.074990636","4":"30.005809","5":"8.242298e-198","6":"8.1938689","7":"10.9941637"},{"1":"age","2":"0.991645","3":"0.001897033","4":"-4.422763","5":"9.744683e-06","6":"0.9879755","7":"0.9953503"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The odds ratio of age to the event is ~ 0.9916 which is almost 1. This suggests that when age increases by 1 year, there 50% chance that the participant chooses 5Km over 10 Mile event run (the odds are 1 to 1). So basically age does not seem to have an association with event choice. Also note that for the 95% confidence interval, the upper bound almost includes 1 which further reinforces the notion that age is not associated with the event choice.</p>
</section><section id="plotting-a-logistic-model" class="level2" data-number="12"><h2 data-number="12" class="anchored" data-anchor-id="plotting-a-logistic-model">
<span class="header-section-number">12</span> Plotting a logistic model</h2>
<p>Like earlier, we can either use <code><a href="https://rdrr.io/pkg/statisticalModeling/man/fmodel.html">fmodel()</a></code> function from the <code>{statisticalModeling}</code> package or use the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function from the <a href="https://ggplot2.tidyverse.org">ggplot2</a> package.</p>
<p>For the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function, we specify the ‘binomial’ model in the <code>method.args = list(family = " ")</code> parameter inside <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> argument. Converting the event to numeric form and subtracting 1 from it will make the choice values stay between zero and one. In the ggplot2 graph, the value 1 corresponds to the 10 Mile run and the value 0 corresponds to the 5 Km run.</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/OpenIntroStat/cherryblossom">cherryblossom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">statisticalModeling</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"run17"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tidying the data</span></span>
<span><span class="va">run17_tidy</span> <span class="op">&lt;-</span> <span class="va">run17</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">event</span>, <span class="va">age</span><span class="op">)</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span>, <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span>, <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span><span class="op">)</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a logistic model with logit link</span></span>
<span><span class="va">model_logistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">event</span> <span class="op">~</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">run17_tidy</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the logistic model with link function using fmodel()</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/statisticalModeling/man/fmodel.html">fmodel</a></span><span class="op">(</span><span class="va">model_logistic</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"event ~ age (logistic model)"</span>,</span>
<span>                    y <span class="op">=</span> <span class="st">"Probability to choose the 10 Mile marathon over the 5 Km run"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="glm_stat_model_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Plotting the logistic model with link function using ggplot()</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">run17_tidy</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">age</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">event</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0</span>, height <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'glm'</span>, method.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"event ~ age (logistic model)"</span>,</span>
<span>                    y <span class="op">=</span> <span class="st">"Probability to choose the 10 Mile marathon over the 5 Km run"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="glm_stat_model_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can also plot for different link functions in the logistic model.</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/OpenIntroStat/cherryblossom">cherryblossom</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"run17"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tidying the data</span></span>
<span><span class="va">run17_tidy</span> <span class="op">&lt;-</span> <span class="va">run17</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">event</span>, <span class="va">age</span><span class="op">)</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span>, <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span>, <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span><span class="op">)</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a logistic model with logit link</span></span>
<span><span class="va">model_logistic_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">event</span> <span class="op">~</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">run17_tidy</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the logistic model with logit and probit link function using ggplot()</span></span>
<span><span class="co"># Same graph as the earlier one</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">run17_tidy</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">age</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">event</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0</span>, height <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'glm'</span>, method.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">'logit'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'glm'</span>, method.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">'probit'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              colour <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"event ~ age (logistic model; red: logit, green: probit)"</span>,</span>
<span>                    y <span class="op">=</span> <span class="st">"Probability to choose the 10 Mile marathon over the 5 Km run"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="glm_stat_model_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As you can see the lines corresponding to logit and probit link functions are very similar.</p>
</section><section id="multiple-regression-with-glms" class="level2" data-number="13"><h2 data-number="13" class="anchored" data-anchor-id="multiple-regression-with-glms">
<span class="header-section-number">13</span> Multiple regression with GLMs</h2>
<p>As seen with linear models, GLMs are also affected by collinearity. Therefore, the order of the explanatory variables in the model formula matters for GLMs, if there exists a correlation between the explanatory variables used. To check the correlation between two variables we can use the <code><a href="https://rdrr.io/r/stats/cor.html">cor()</a></code> function.</p>
<p>Let us look at this in action using the logistic model we created earlier, but this time we will also add the <code>pace_sec</code> variable which tells the average time (in seconds) to complete a mile.</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/OpenIntroStat/cherryblossom">cherryblossom</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"run17"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tidying the data</span></span>
<span><span class="va">run17_tidy</span> <span class="op">&lt;-</span> <span class="va">run17</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span>, <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span>, <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span><span class="op">)</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Finding the correlation between pace_sec and age</span></span>
<span><span class="co"># Remove any NAs prior to finding the correlation</span></span>
<span><span class="va">run17_tidy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">pace_sec</span>, <span class="va">run17_tidy</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1620674</code></pre>
</div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Building a logistic model wiht pace_sec + age</span></span>
<span><span class="va">model_logistic_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">event</span> <span class="op">~</span> <span class="va">pace_sec</span> <span class="op">+</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">run17_tidy</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a logistic model wiht age + pace_sec</span></span>
<span><span class="va">model_logistic_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">event</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">pace_sec</span>, data <span class="op">=</span> <span class="va">run17_tidy</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Printing the results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_logistic_1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = event ~ pace_sec + age, family = "binomial", data = run17_tidy)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.2235   0.1997   0.3203   0.4770   1.2549  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  8.4756604  0.1606570  52.756  &lt; 2e-16 ***
pace_sec    -0.0107900  0.0002218 -48.650  &lt; 2e-16 ***
age          0.0154362  0.0022611   6.827 8.69e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 15118  on 19956  degrees of freedom
Residual deviance: 11404  on 19954  degrees of freedom
AIC: 11410

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_logistic_2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = event ~ age + pace_sec, family = "binomial", data = run17_tidy)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.2235   0.1997   0.3203   0.4770   1.2549  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  8.4756604  0.1606570  52.756  &lt; 2e-16 ***
age          0.0154362  0.0022611   6.827 8.69e-12 ***
pace_sec    -0.0107900  0.0002218 -48.650  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 15118  on 19956  degrees of freedom
Residual deviance: 11404  on 19954  degrees of freedom
AIC: 11410

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>You can see that the model summary is identical, even with different ordering of the exploratory variables. This is because the correlation coefficient is ~ 0.17 which means there is a weak correlation between the used exploratory variables. So before building a model it’s a good practice to check if the exploratory variables exhibit collinearity.</p>
</section><section id="assumptions-of-glms" class="level2" data-number="14"><h2 data-number="14" class="anchored" data-anchor-id="assumptions-of-glms">
<span class="header-section-number">14</span> Assumptions of GLMs</h2>
<p>GLMs extend the linear model via link function which transforms the coefficient into a linear combination which can be interpreted in a similar way to that seen in linear models. Nevertheless, there are important assumptions which are to be met by the data to apply any GLM.</p>
<ol type="1">
<li><strong>Simpson’s paradox does not occur</strong></li>
</ol>
<p>Simpson’s paradox occurs when we fail to include an exploratory variable which significantly changes the model output after its addition. Consider the graphs given below. Please use the slider to compare them.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/OpenIntroStat/cherryblossom">cherryblossom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">statisticalModeling</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"run17"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tidying the data</span></span>
<span><span class="va">run17_tidy</span> <span class="op">&lt;-</span> <span class="va">run17</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span>, <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span>, <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span><span class="op">)</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a logistic model with age</span></span>
<span><span class="va">model_logistic_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">event</span> <span class="op">~</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">run17_tidy</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the model</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/statisticalModeling/man/fmodel.html">fmodel</a></span><span class="op">(</span><span class="va">model_logistic_1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"event ~ age (logistic model)"</span>,</span>
<span>                    y <span class="op">=</span> <span class="st">"Probability to choose the 10 Mile marathon over the 5 Km run"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a logistic model with age + pace_sec</span></span>
<span><span class="va">model_logistic_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">event</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">pace_sec</span>, data <span class="op">=</span> <span class="va">run17_tidy</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the model</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/statisticalModeling/man/fmodel.html">fmodel</a></span><span class="op">(</span><span class="va">model_logistic_2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"event ~ age + pace_sec (logistic model)"</span>,</span>
<span>                    y <span class="op">=</span> <span class="st">"Probability to choose the 10 Mile marathon over the 5 Km run"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="juxtapose" data-startingposition="50%">
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/OpenIntroStat/cherryblossom">cherryblossom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">statisticalModeling</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"run17"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tidying the data</span></span>
<span><span class="va">run17_tidy</span> <span class="op">&lt;-</span> <span class="va">run17</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span>, <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span>, <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span><span class="op">)</span></span>
<span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">run17_tidy</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Building a logistic model with age</span></span>
<span><span class="va">model_logistic_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">event</span> <span class="op">~</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">run17_tidy</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the model</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/statisticalModeling/man/fmodel.html">fmodel</a></span><span class="op">(</span><span class="va">model_logistic_1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"event ~ age (logistic model)"</span>,</span>
<span>                    y <span class="op">=</span> <span class="st">"Probability to choose the 10 Mile marathon over the 5 Km run"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="glm_stat_model_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Building a logistic model with age + pace_sec</span></span>
<span><span class="va">model_logistic_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">event</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">pace_sec</span>, data <span class="op">=</span> <span class="va">run17_tidy</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the model</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/statisticalModeling/man/fmodel.html">fmodel</a></span><span class="op">(</span><span class="va">model_logistic_2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"event ~ age + pace_sec (logistic model)"</span>,</span>
<span>                    y <span class="op">=</span> <span class="st">"Probability to choose the 10 Mile marathon over the 5 Km run"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="glm_stat_model_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<p>In the first model, predicting event choice with just age suggests that with increasing age, there is less chance that people will participate in the 10 Mile marathon. But when you also add the pace of participants into the model formula then you get completely different results (and absurd too!). The second model indicates that participants with a high pace (shorter y-axis values in the graph) irrespective of age will almost always choose the 10 Mile marathon. So our interpretation is completely changed and this is an example of Simpson’s paradox.</p>
<ol start="2" type="1">
<li><strong>Variables follow linear relationship and are monotonic</strong></li>
</ol>
<p>Like in the case of linear models, GLMs also require that the variables follow a linear change. Monotonic means that the change is either always increasing or decreasing.</p>
<ol start="3" type="1">
<li><strong>Variables should independent</strong></li>
</ol>
<p>The effect sizes of one variable should not influence the effect size of another variable. We have seen this in detail for linear models. If they are independent, then we have to represent them as interaction terms. In this case, the order also matters while inputting them into the model formula.</p>
<ol start="4" type="1">
<li><strong>Over dispersion</strong></li>
</ol>
<p>Overdispersion occurs when the datasets have a lot of zeros or ones in the case of the binomial distribution and a lot of zeros in the case of the Poisson distribution. Also if the variance is greater than the mean of the data, then again the model is over-dispersed.</p>
</section><section id="conclusion" class="level2" data-number="15"><h2 data-number="15" class="anchored" data-anchor-id="conclusion">
<span class="header-section-number">15</span> Conclusion</h2>
<p>This marks the end of the introduction to generalised linear models. In summary, we learned;</p>
<ol type="1">
<li><p>Understanding the coefficients in a linear model</p></li>
<li><p>Why do linear models fail for some datasets and what are the limitations of a linear model</p></li>
<li><p>Two types of GLMs: Poisson and Logistic</p></li>
<li><p>Link functions</p></li>
<li><p>Understanding the coefficients in a Poisson and logistic models</p></li>
<li><p>Plotting Poisson and logistic models</p></li>
<li><p>Brief introduction to multiple regression using GLMs</p></li>
<li><p>Assumptions of GLMs: When to use GLMs</p></li>
</ol>
<p>In the next tutorial, we will take our understanding of GLMs to the next level and learn about ‘Hierarchical and Mixed Effects Models in R’. See you then!</p>
</section><div id="quarto-appendix" class="default"><section id="last-updated-on" class="level4 unnumbered unlisted appendix"><h2 class="quarto-appendix-heading">Last updated on</h2><div class="quarto-appendix-contents">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-08-28 11:16:50 IST"</code></pre>
</div>
</div>
<!-- Do not forget to put flag counter -->
<p><a hidden="" href="https://info.flagcounter.com/ynrK"><img src="https://s11.flagcounter.com/count2/ynrK/bg_000000/txt_FFFFFF/border_F0F0F0/columns_5/maxflags_25/viewers_0/labels_1/pageviews_1/flags_0/percent_0/" alt="Flag Counter" border="0"></a></p>


<!-- -->

</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{johnson2022,
  author = {Jewel Johnson},
  editor = {},
  title = {Generalized Linear Models in {R}},
  date = {2022-08-23},
  url = {https://one-carat-blog.netlify.app//tutorials/stat_model/glm_stat_model.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-johnson2022" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Jewel Johnson. 2022. <span>“Generalized Linear Models in R.”</span>
August 23, 2022. <a href="https://one-carat-blog.netlify.app//tutorials/stat_model/glm_stat_model.html">https://one-carat-blog.netlify.app//tutorials/stat_model/glm_stat_model.html</a>.
</div></div></section></div></main><!-- /main --><script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"require(\"https://cdn.jsdelivr.net/npm/juxtaposejs@1.1.6/build/js/juxtapose.min.js\")\n  .catch(() => null)\n"}]}
</script><script type="module">
window._ojs.paths.runtimeToDoc = "../../tutorials/stat_model";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><script src="https://giscus.app/client.js" data-repo="jeweljohnsonj/one-carat-blog" data-repo-id="R_kgDOHW124A" data-category="General" data-category-id="DIC_kwDOHW124M4CPNVL" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb57" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Generalized linear models in R"</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Go beyond linear models and extend them to analyse non-normal datasets"</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "08/23/2022"</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co">    css:</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co">      - https://cdn.knightlab.com/libs/juxtapose/latest/css/juxtapose.css</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> images/stat_model_3.png</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [statistical modelling]</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co">   - social-share</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="an">share:</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co">  permalink: "https://one-carat-blog.netlify.app/tutorials/stat_model/glm_stat_model.html"</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co">  description: "Generalized linear models in R"</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="co">  twitter: true</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="co">  facebook: true</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="co">  reddit: true</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="co">  stumble: true</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a><span class="co">  tumblr: true</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="co">  linkedin: true</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="co">  email: true</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a><span class="co">//| output: false</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a><span class="pp">require</span>(<span class="st">"https://cdn.jsdelivr.net/npm/juxtaposejs@1.1.6/build/js/juxtapose.min.js"</span>)</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">catch</span>(() <span class="kw">=&gt;</span> <span class="kw">null</span>)</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a><span class="vs">:::{.callout-note}</span></span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a><span class="vs">## TL;DR</span></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a><span class="vs">In this article you will learn;</span></span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a><span class="vs">1.    Understanding the coefficients in a linear model</span></span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a><span class="vs">2.    Why do linear models fail for some datasets and what are the limitations of a linear model</span></span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a><span class="vs">3.    Two types of GLMs: Poisson and Logistic</span></span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a><span class="vs">4.    Link functions</span></span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a><span class="vs">5.    Understanding the coefficients in a Poisson and logistic models</span></span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a><span class="vs">6.    Plotting Poisson and logistic models</span></span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a><span class="vs">7.    Brief introduction to multiple regression using GLMs</span></span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a><span class="vs">8.    Assumptions of GLMs: When to use GLMs</span></span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a><span class="vs">:::</span></span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a><span class="vs">## Prologue</span></span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a><span class="vs">This is the third tutorial in the series: Statistical modelling using R. In this tutorial we will work with datasets that fail the assumptions of linear models. We will first see what these assumptions are and then we will learn about generalised linear models which is an extension of the linear model architecture. So let's go!</span></span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a><span class="vs">## Making life easier</span></span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a><span class="vs">Please install and load the necessary packages and datasets which are listed below for a seamless tutorial session. (Not required but can be very helpful if you are following this tutorial code by code)</span></span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> eval<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a># Run the following lines <span class="kw">of</span> code</span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a># Packages used <span class="kw">in</span> <span class="kw">this</span> tutorial</span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a>tutorial_packages <span class="op">&lt;-</span> rlang<span class="op">::</span><span class="fu">quos</span>(Stat2Data<span class="op">,</span> modelsummary<span class="op">,</span> devtools<span class="op">,</span> COUNT<span class="op">,</span> broom<span class="op">,</span></span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a>                                 cherryblossom<span class="op">,</span> datasets)</span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a># Install required packages</span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">lapply</span>(tutorial_packages<span class="op">,</span> rlang<span class="op">::</span>quo_name)<span class="op">,</span></span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>  install<span class="op">.</span><span class="at">packages</span><span class="op">,</span></span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a>  character<span class="op">.</span><span class="at">only</span> <span class="op">=</span> TRUE</span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a>devtools<span class="op">::</span><span class="fu">install_github</span>(<span class="st">"dtkaplan/statisticalModeling"</span>)</span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a># Loading the libraries</span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">lapply</span>(tutorial_packages<span class="op">,</span> rlang<span class="op">::</span>quo_name)<span class="op">,</span></span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a>  library<span class="op">,</span></span>
<span id="cb57-87"><a href="#cb57-87" aria-hidden="true" tabindex="-1"></a>  character<span class="op">.</span><span class="at">only</span> <span class="op">=</span> TRUE</span>
<span id="cb57-88"><a href="#cb57-88" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-89"><a href="#cb57-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-90"><a href="#cb57-90" aria-hidden="true" tabindex="-1"></a># Datasets used <span class="kw">in</span> <span class="kw">this</span> tutorial</span>
<span id="cb57-91"><a href="#cb57-91" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb57-92"><a href="#cb57-92" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"rwm1984"</span>)</span>
<span id="cb57-93"><a href="#cb57-93" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"run17"</span>)</span>
<span id="cb57-94"><a href="#cb57-94" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb57-95"><a href="#cb57-95" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-96"><a href="#cb57-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-97"><a href="#cb57-97" aria-hidden="true" tabindex="-1"></a><span class="vs">## Understanding the coeffecients in a linear model</span></span>
<span id="cb57-98"><a href="#cb57-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-99"><a href="#cb57-99" aria-hidden="true" tabindex="-1"></a><span class="vs">To quickly recap, a linear model tries to explain the variability seen in the response variable by estimating the coefficients for explanatory variables. These coefficients are nothing but your effect size or the slope of the explanatory variable calculated from the model. Consider the following example.</span></span>
<span id="cb57-100"><a href="#cb57-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-101"><a href="#cb57-101" aria-hidden="true" tabindex="-1"></a><span class="vs">We will use the `</span><span class="fu">HorsePrices</span><span class="vs">` dataset from the `</span>{Stat2Data}<span class="vs">` package in R. We will model the price of the horses in this dataset to their height and age. We will use the `</span><span class="fu">summary</span>()<span class="vs">` function to output the summary of the linear model.</span></span>
<span id="cb57-102"><a href="#cb57-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-105"><a href="#cb57-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-106"><a href="#cb57-106" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="pp">require</span>(Stat2Data)) install<span class="op">.</span><span class="fu">packages</span>(<span class="st">'Stat2Data'</span>)</span>
<span id="cb57-107"><a href="#cb57-107" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="pp">require</span>(statisticalModeling)) install<span class="op">.</span><span class="fu">packages</span>(<span class="st">'statisticalModeling'</span>)</span>
<span id="cb57-108"><a href="#cb57-108" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb57-109"><a href="#cb57-109" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb57-110"><a href="#cb57-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-111"><a href="#cb57-111" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb57-112"><a href="#cb57-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-113"><a href="#cb57-113" aria-hidden="true" tabindex="-1"></a># Building a linear model</span>
<span id="cb57-114"><a href="#cb57-114" aria-hidden="true" tabindex="-1"></a>model_lm <span class="op">&lt;-</span> <span class="fu">lm</span>(Price <span class="op">~</span> Age <span class="op">+</span> Sex<span class="op">,</span> data <span class="op">=</span> HorsePrices)</span>
<span id="cb57-115"><a href="#cb57-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-116"><a href="#cb57-116" aria-hidden="true" tabindex="-1"></a># Plotting the model</span>
<span id="cb57-117"><a href="#cb57-117" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_lm) <span class="op">+</span> ggplot2<span class="op">::</span><span class="fu">theme_bw</span>() <span class="op">+</span></span>
<span id="cb57-118"><a href="#cb57-118" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="op">::</span><span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"Price ~ Age + Height"</span>)</span>
<span id="cb57-119"><a href="#cb57-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-120"><a href="#cb57-120" aria-hidden="true" tabindex="-1"></a># Getting the summary <span class="kw">of</span> the linear model</span>
<span id="cb57-121"><a href="#cb57-121" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_lm)</span>
<span id="cb57-122"><a href="#cb57-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-123"><a href="#cb57-123" aria-hidden="true" tabindex="-1"></a># Calculating the effect sizes</span>
<span id="cb57-124"><a href="#cb57-124" aria-hidden="true" tabindex="-1"></a><span class="fu">effect_size</span>(model_lm<span class="op">,</span> <span class="op">~</span> Age)</span>
<span id="cb57-125"><a href="#cb57-125" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-126"><a href="#cb57-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-127"><a href="#cb57-127" aria-hidden="true" tabindex="-1"></a><span class="vs">In the summary of the model, in the coefficients section, the estimate column is nothing but effect sizes. Compare the estimate for 'age' in the model summary and the effect size of 'age' calculated from the `</span><span class="fu">effect_size</span>()<span class="vs">` function, both are the same.</span></span>
<span id="cb57-128"><a href="#cb57-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-129"><a href="#cb57-129" aria-hidden="true" tabindex="-1"></a><span class="vs">Recall that the equation for a straight line is;</span></span>
<span id="cb57-130"><a href="#cb57-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-131"><a href="#cb57-131" aria-hidden="true" tabindex="-1"></a><span class="vs">$$ y = mx+c $$</span></span>
<span id="cb57-132"><a href="#cb57-132" aria-hidden="true" tabindex="-1"></a><span class="vs">Where $m$ is the slope of the line and $c$ is the y-intercept.</span></span>
<span id="cb57-133"><a href="#cb57-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-134"><a href="#cb57-134" aria-hidden="true" tabindex="-1"></a><span class="vs">We can see from the graph that there are two straight lines, therefore there will be two equations for the straight lines. Imagine $y_1$ to be the equation of the straight line for females (the red line) and similarly, $y_2$ is for males (the blue line). The equations for the straight lines are;</span></span>
<span id="cb57-135"><a href="#cb57-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-136"><a href="#cb57-136" aria-hidden="true" tabindex="-1"></a><span class="vs">$$ y_1 = m_1x_1 + c_1 </span><span class="sc">\\</span></span>
<span id="cb57-137"><a href="#cb57-137" aria-hidden="true" tabindex="-1"></a><span class="vs"> y_2 = m_2x_2 + c_2$$</span></span>
<span id="cb57-138"><a href="#cb57-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-139"><a href="#cb57-139" aria-hidden="true" tabindex="-1"></a><span class="vs">From the graph, you can see that the slopes for both lines are the same. This means that the effect size of age is the same across both the sex. Also, the slope should be a negative value because as age increases, the price is decreasing for both sexes. From the model summary, the slope value for age is -220.10. Thus we have;</span></span>
<span id="cb57-140"><a href="#cb57-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-141"><a href="#cb57-141" aria-hidden="true" tabindex="-1"></a><span class="vs">$$m_1 = m_2 = -220.1$$</span></span>
<span id="cb57-142"><a href="#cb57-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-143"><a href="#cb57-143" aria-hidden="true" tabindex="-1"></a><span class="vs">Now recall how I explained that the effect size for a categorical exploratory variable is expressed in terms of [change](https://one-carat-blog.netlify.app/tutorials/stat_model/intro_stat_model.html#effect-sizes) and that change is in terms of their [y-intercepts](https://one-carat-blog.netlify.app/tutorials/stat_model/inter_stat_model.html#interactions-among-explanatory-variables).</span></span>
<span id="cb57-144"><a href="#cb57-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-145"><a href="#cb57-145" aria-hidden="true" tabindex="-1"></a><span class="vs">Now R calculates intercepts in two ways. The default way or the first way is what is shown in the model summary. In the (Intercept) row, the estimated value is 18199.7 and this value is the y-intercept value for the straight line for 'female'. You can easily verify this from the red line in the graph. Notice how the y-intercepts are the same as shown in the model summary and the plot. Now in the row 'Sexm', the estimated value shows how much difference is there from the estimated value shown in the (Intercept) row or otherwise how much difference in y-intercept is there between females and males. Since the difference is positive this means the y-intercept for males is 17008.6 higher than the y-intercept for females. Thus we have;</span></span>
<span id="cb57-146"><a href="#cb57-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-147"><a href="#cb57-147" aria-hidden="true" tabindex="-1"></a><span class="vs">$$c_1 = 18199.7</span><span class="sc">\\</span><span class="vs">c_2 - c_1 = 17008.6$$</span></span>
<span id="cb57-148"><a href="#cb57-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-149"><a href="#cb57-149" aria-hidden="true" tabindex="-1"></a><span class="vs">The intercept value by default is shown for the first level in the exploratory variable which here is female. </span></span>
<span id="cb57-150"><a href="#cb57-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-151"><a href="#cb57-151" aria-hidden="true" tabindex="-1"></a><span class="vs">The second way is to individually show the corresponding y-intercept values for males and females. For that, we can use the expression `</span><span class="op">-</span><span class="dv">1</span><span class="vs">` in the model formula.</span></span>
<span id="cb57-152"><a href="#cb57-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-155"><a href="#cb57-155" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-156"><a href="#cb57-156" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb57-157"><a href="#cb57-157" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb57-158"><a href="#cb57-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-159"><a href="#cb57-159" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb57-160"><a href="#cb57-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-161"><a href="#cb57-161" aria-hidden="true" tabindex="-1"></a># Building a linear model showing mean <span class="cf">for</span> each level <span class="kw">of</span> the response variable</span>
<span id="cb57-162"><a href="#cb57-162" aria-hidden="true" tabindex="-1"></a>model_lm <span class="op">&lt;-</span> <span class="fu">lm</span>(Price <span class="op">~</span> Age <span class="op">+</span> Sex <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> data <span class="op">=</span> HorsePrices)</span>
<span id="cb57-163"><a href="#cb57-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-164"><a href="#cb57-164" aria-hidden="true" tabindex="-1"></a># Getting the summary <span class="kw">of</span> the linear model</span>
<span id="cb57-165"><a href="#cb57-165" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_lm)</span>
<span id="cb57-166"><a href="#cb57-166" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-167"><a href="#cb57-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-168"><a href="#cb57-168" aria-hidden="true" tabindex="-1"></a><span class="vs">Now you get individual y-intercept values for all the levels in the data. There will be slight decimal differences while adding up the values but the concept is the same.</span></span>
<span id="cb57-169"><a href="#cb57-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-170"><a href="#cb57-170" aria-hidden="true" tabindex="-1"></a><span class="vs">$$c_1 = 18199.7</span><span class="sc">\\</span><span class="vs">c_2 = 35208.2 = 17008.6 + 18199.7$$</span></span>
<span id="cb57-171"><a href="#cb57-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-172"><a href="#cb57-172" aria-hidden="true" tabindex="-1"></a><span class="vs">In algebraic form, the default model formula for a linear model used in `</span><span class="fu">lm</span>()<span class="vs">` is;</span></span>
<span id="cb57-173"><a href="#cb57-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-174"><a href="#cb57-174" aria-hidden="true" tabindex="-1"></a><span class="vs">$$y </span><span class="sc">\s</span><span class="vs">im </span><span class="sc">\b</span><span class="vs">eta_0 + </span><span class="sc">\b</span><span class="vs">eta_2x_2 + </span><span class="sc">\b</span><span class="vs">eta_3x_3 + .. + </span><span class="sc">\e</span><span class="vs">psilon$$</span></span>
<span id="cb57-175"><a href="#cb57-175" aria-hidden="true" tabindex="-1"></a><span class="vs">And when `</span><span class="op">-</span><span class="dv">1</span><span class="vs">` is used in the model formula, then it becomes;</span></span>
<span id="cb57-176"><a href="#cb57-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-177"><a href="#cb57-177" aria-hidden="true" tabindex="-1"></a><span class="vs">$$y </span><span class="sc">\s</span><span class="vs">im </span><span class="sc">\b</span><span class="vs">eta_1x_1 + </span><span class="sc">\b</span><span class="vs">eta_2x_2 + </span><span class="sc">\b</span><span class="vs">eta_3x_3 + .. + </span><span class="sc">\e</span><span class="vs">psilon$$</span></span>
<span id="cb57-178"><a href="#cb57-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-179"><a href="#cb57-179" aria-hidden="true" tabindex="-1"></a><span class="vs">So the first way compares differences between groups by taking the first group as the reference and giving a global intercept ($</span><span class="sc">\b</span><span class="vs">eta_0$) and in a second way, we can see the actual change in the respective groups as their respective coefficients ($</span><span class="sc">\b</span><span class="vs">eta_1$, $</span><span class="sc">\b</span><span class="vs">eta_2$ etc.).</span></span>
<span id="cb57-180"><a href="#cb57-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-181"><a href="#cb57-181" aria-hidden="true" tabindex="-1"></a><span class="vs">## Limitations of linear models</span></span>
<span id="cb57-182"><a href="#cb57-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-183"><a href="#cb57-183" aria-hidden="true" tabindex="-1"></a><span class="vs">Four assumptions are required to be satisfied to be able to do linear modelling;</span></span>
<span id="cb57-184"><a href="#cb57-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-185"><a href="#cb57-185" aria-hidden="true" tabindex="-1"></a><span class="vs">1.    The values in the datasets are normally distributed</span></span>
<span id="cb57-186"><a href="#cb57-186" aria-hidden="true" tabindex="-1"></a><span class="vs">2.    The residuals are normally distributed </span></span>
<span id="cb57-187"><a href="#cb57-187" aria-hidden="true" tabindex="-1"></a><span class="vs">3.    The values in the datasets are continuous</span></span>
<span id="cb57-188"><a href="#cb57-188" aria-hidden="true" tabindex="-1"></a><span class="vs">4.    Variables form a linear relationship with each other</span></span>
<span id="cb57-189"><a href="#cb57-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-190"><a href="#cb57-190" aria-hidden="true" tabindex="-1"></a><span class="vs">Many datasets fail these assumptions. Survival data with binary responses or data with count values are both non-normal and discontinuous. Linear modelling won't do any good in analysing these datasets. So what is the solution? The solution is to extend linear models and generalize them so that they can accept non-normal distributions. In R, the process is simple and we have seen it being used in logistic regression in tutorial 1 using the `</span><span class="fu">glm</span>()<span class="vs">` function. Therefore `</span><span class="fu">glm</span>()<span class="vs">` function calls for the generalized model in R and the type of model is specified by the distribution of the data. If the data is count type then we can use the `</span><span class="fu">Poisson</span><span class="vs">` family distribution and if the data is binomial then use the `</span><span class="fu">binomial</span><span class="vs">` family distribution. We will see both of these in detail further in the tutorial. The process of generalizing a linear model is through 'non-linear link functions' which link the regression coefficients to the distribution and allow the linear model to be generalised. We will learn more about this in the later sections.</span></span>
<span id="cb57-191"><a href="#cb57-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-192"><a href="#cb57-192" aria-hidden="true" tabindex="-1"></a><span class="vs">The syntax for the `</span><span class="fu">glm</span>()<span class="vs">` function is as follows;</span></span>
<span id="cb57-193"><a href="#cb57-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-196"><a href="#cb57-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-197"><a href="#cb57-197" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> eval<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb57-198"><a href="#cb57-198" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(formula<span class="op">,</span> data<span class="op">,</span> family <span class="op">=</span> <span class="st">""</span>)</span>
<span id="cb57-199"><a href="#cb57-199" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-200"><a href="#cb57-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-201"><a href="#cb57-201" aria-hidden="true" tabindex="-1"></a><span class="vs">For the Poisson regression model we can specify `</span>family <span class="op">=</span> <span class="st">"poisson"</span><span class="vs">` and for the binomial regression model we can specify `</span>family <span class="op">=</span> <span class="st">"binomial"</span><span class="vs">`. </span></span>
<span id="cb57-202"><a href="#cb57-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-203"><a href="#cb57-203" aria-hidden="true" tabindex="-1"></a><span class="vs">Since the `</span><span class="fu">lm</span>()<span class="vs">` function is only applicable for normal or Gaussian distributions; </span></span>
<span id="cb57-204"><a href="#cb57-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-205"><a href="#cb57-205" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span><span class="fu">glm</span>(formula<span class="op">,</span> data<span class="op">,</span> family <span class="op">=</span> <span class="st">"gaussian"</span>)<span class="vs">` = `</span><span class="fu">lm</span>(formula<span class="op">,</span> data)<span class="vs">` </span></span>
<span id="cb57-206"><a href="#cb57-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-207"><a href="#cb57-207" aria-hidden="true" tabindex="-1"></a><span class="vs">Therefore a linear model is a generalized linear model with the Gaussian family.</span></span>
<span id="cb57-208"><a href="#cb57-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-209"><a href="#cb57-209" aria-hidden="true" tabindex="-1"></a><span class="vs">## Poisson regression model</span></span>
<span id="cb57-210"><a href="#cb57-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-211"><a href="#cb57-211" aria-hidden="true" tabindex="-1"></a><span class="vs">As mentioned earlier, the Poisson model is used if the dataset contains count data. Count data can be no of things sold in a shop, no people with cancer in a city or no of visitors in a shop. Intuitively, we can say that count data ranges from 0 to infinity. There is no negative or decimal count data. Thus your dataset should only contain 0 or positive integer values for the Poisson model to work. Also, the values in the dataset should have been obtained in the same manner. For example: let's say your dataset contains count data for the no. of people coming to the shop per day, then the same dataset should not contain values for no. of people coming to the shop per week, as they are sampled differently in terms of time. Lastly, if your dataset has a variance greater than the mean or if you have lots of zeros in your data then some modifications have to be done to be able to use the Poisson regression model.</span></span>
<span id="cb57-212"><a href="#cb57-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-213"><a href="#cb57-213" aria-hidden="true" tabindex="-1"></a><span class="vs">In short, you should not use the Poisson regression model if you have the following conditions;</span></span>
<span id="cb57-214"><a href="#cb57-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-215"><a href="#cb57-215" aria-hidden="true" tabindex="-1"></a><span class="vs">1.    Dataset contains negative and/or non-integer values</span></span>
<span id="cb57-216"><a href="#cb57-216" aria-hidden="true" tabindex="-1"></a><span class="vs">2.    Dataset is sampled across in a different manner (no. of people per day vs. no. of people per week)</span></span>
<span id="cb57-217"><a href="#cb57-217" aria-hidden="true" tabindex="-1"></a><span class="vs">3.    Dataset has a variance greater than its mean (Over-dispersed data)</span></span>
<span id="cb57-218"><a href="#cb57-218" aria-hidden="true" tabindex="-1"></a><span class="vs">4.    Dataset has lots of zero values (Zero-inflated data)</span></span>
<span id="cb57-219"><a href="#cb57-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-220"><a href="#cb57-220" aria-hidden="true" tabindex="-1"></a><span class="vs">Let us build a Poisson model. We will use the `</span><span class="fu">rwm1984</span><span class="vs">` dataset from the `</span>{COUNT}<span class="vs">` package in R. The dataset is a German health registry for the year 1984. We are interested in seeing whether the number of visits to the doctor during a year (`</span><span class="fu">docvis</span><span class="vs">`) is associated with age (`</span><span class="fu">age</span><span class="vs">`). Since we have count data we will build a Poisson model to see this association.</span></span>
<span id="cb57-221"><a href="#cb57-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-224"><a href="#cb57-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-225"><a href="#cb57-225" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="pp">require</span>(COUNT)) install<span class="op">.</span><span class="fu">packages</span>(<span class="st">'COUNT'</span>)</span>
<span id="cb57-226"><a href="#cb57-226" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(COUNT)</span>
<span id="cb57-227"><a href="#cb57-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-228"><a href="#cb57-228" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"rwm1984"</span>)</span>
<span id="cb57-229"><a href="#cb57-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-230"><a href="#cb57-230" aria-hidden="true" tabindex="-1"></a># Building a poisson model</span>
<span id="cb57-231"><a href="#cb57-231" aria-hidden="true" tabindex="-1"></a>model_poisson <span class="op">&lt;-</span> <span class="fu">glm</span>(docvis <span class="op">~</span> age<span class="op">,</span> data <span class="op">=</span> rwm1984<span class="op">,</span> family <span class="op">=</span> <span class="st">"poisson"</span>)</span>
<span id="cb57-232"><a href="#cb57-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-233"><a href="#cb57-233" aria-hidden="true" tabindex="-1"></a># Printing model output</span>
<span id="cb57-234"><a href="#cb57-234" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_poisson)</span>
<span id="cb57-235"><a href="#cb57-235" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-236"><a href="#cb57-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-237"><a href="#cb57-237" aria-hidden="true" tabindex="-1"></a><span class="vs">Apart from the `</span><span class="fu">summary</span>()<span class="vs">` function, we also use the `</span><span class="fu">tidy</span>()<span class="vs">` function from the `</span>{broom}<span class="vs">` package in R to print the outputs of the model as a data frame.</span></span>
<span id="cb57-238"><a href="#cb57-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-241"><a href="#cb57-241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-242"><a href="#cb57-242" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="pp">require</span>(broom)) install<span class="op">.</span><span class="fu">packages</span>(<span class="st">'broom'</span>)</span>
<span id="cb57-243"><a href="#cb57-243" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(COUNT)</span>
<span id="cb57-244"><a href="#cb57-244" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb57-245"><a href="#cb57-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-246"><a href="#cb57-246" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"rwm1984"</span>)</span>
<span id="cb57-247"><a href="#cb57-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-248"><a href="#cb57-248" aria-hidden="true" tabindex="-1"></a># Building a poisson model</span>
<span id="cb57-249"><a href="#cb57-249" aria-hidden="true" tabindex="-1"></a>model_poisson <span class="op">&lt;-</span> <span class="fu">glm</span>(docvis <span class="op">~</span> age<span class="op">,</span> data <span class="op">=</span> rwm1984<span class="op">,</span> family <span class="op">=</span> <span class="st">"poisson"</span>)</span>
<span id="cb57-250"><a href="#cb57-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-251"><a href="#cb57-251" aria-hidden="true" tabindex="-1"></a># Printing model output using <span class="fu">tidy</span>()</span>
<span id="cb57-252"><a href="#cb57-252" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(model_poisson)</span>
<span id="cb57-253"><a href="#cb57-253" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-254"><a href="#cb57-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-255"><a href="#cb57-255" aria-hidden="true" tabindex="-1"></a><span class="vs">Sometimes we are interested in extracting the coefficients or finding out the confidence intervals from the model.</span></span>
<span id="cb57-256"><a href="#cb57-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-259"><a href="#cb57-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-260"><a href="#cb57-260" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(COUNT)</span>
<span id="cb57-261"><a href="#cb57-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-262"><a href="#cb57-262" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"rwm1984"</span>)</span>
<span id="cb57-263"><a href="#cb57-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-264"><a href="#cb57-264" aria-hidden="true" tabindex="-1"></a># Building a poisson model</span>
<span id="cb57-265"><a href="#cb57-265" aria-hidden="true" tabindex="-1"></a>model_poisson <span class="op">&lt;-</span> <span class="fu">glm</span>(docvis <span class="op">~</span> age<span class="op">,</span> data <span class="op">=</span> rwm1984<span class="op">,</span> family <span class="op">=</span> <span class="st">"poisson"</span>)</span>
<span id="cb57-266"><a href="#cb57-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-267"><a href="#cb57-267" aria-hidden="true" tabindex="-1"></a># Extracting the coefficients</span>
<span id="cb57-268"><a href="#cb57-268" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model_poisson)</span>
<span id="cb57-269"><a href="#cb57-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-270"><a href="#cb57-270" aria-hidden="true" tabindex="-1"></a># Estimating the confidence interval</span>
<span id="cb57-271"><a href="#cb57-271" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(model_poisson)</span>
<span id="cb57-272"><a href="#cb57-272" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-273"><a href="#cb57-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-274"><a href="#cb57-274" aria-hidden="true" tabindex="-1"></a><span class="vs">## Logistic regression model</span></span>
<span id="cb57-275"><a href="#cb57-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-276"><a href="#cb57-276" aria-hidden="true" tabindex="-1"></a><span class="vs">In [tutorial 1](https://one-carat-blog.netlify.app/tutorials/stat_model/intro_stat_model.html#logistic-model), we briefly saw what logistic regression was. We use the logistic model when;</span></span>
<span id="cb57-277"><a href="#cb57-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-278"><a href="#cb57-278" aria-hidden="true" tabindex="-1"></a><span class="vs">1.    Data is binary (0/1)</span></span>
<span id="cb57-279"><a href="#cb57-279" aria-hidden="true" tabindex="-1"></a><span class="vs">2.    Data has only two mutually exclusive values (Alive/Dead or Yes/No or Win/Lose or Pass/Fail)</span></span>
<span id="cb57-280"><a href="#cb57-280" aria-hidden="true" tabindex="-1"></a><span class="vs">3.    Data has only two values choices or behaviour (Non-veg/Veg, Wet/Dry)</span></span>
<span id="cb57-281"><a href="#cb57-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-282"><a href="#cb57-282" aria-hidden="true" tabindex="-1"></a><span class="vs">In short, for a logistic regression model, the model outputs probabilities ($p$) for binary outcomes in the response variable ($y$).</span></span>
<span id="cb57-283"><a href="#cb57-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-284"><a href="#cb57-284" aria-hidden="true" tabindex="-1"></a><span class="vs">$$y = Binomial(p)$$</span></span>
<span id="cb57-285"><a href="#cb57-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-286"><a href="#cb57-286" aria-hidden="true" tabindex="-1"></a><span class="vs">Let us build a logistic model using `</span><span class="fu">run17</span><span class="vs">` dataset from the `</span>{cherryblossom}<span class="vs">` package in R. We have seen this dataset in the first tutorial. The dataset contains details for all 19,961 runners in the 2017 Cherry Blossom Run, which is an annual road race that takes place in Washington, DC, USA. The Cherry Blossom Run has two events; a 10 Mile marathon and a 5 Km run. We will be building a logistic model to whether event choice is predicted by the participant's age.   </span></span>
<span id="cb57-287"><a href="#cb57-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-290"><a href="#cb57-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-291"><a href="#cb57-291" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="pp">require</span>(cherryblossom)) install<span class="op">.</span><span class="fu">packages</span>(<span class="st">'cherryblossom'</span>)</span>
<span id="cb57-292"><a href="#cb57-292" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb57-293"><a href="#cb57-293" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb57-294"><a href="#cb57-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-295"><a href="#cb57-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-296"><a href="#cb57-296" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"run17"</span>)</span>
<span id="cb57-297"><a href="#cb57-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-298"><a href="#cb57-298" aria-hidden="true" tabindex="-1"></a># Tidying the data</span>
<span id="cb57-299"><a href="#cb57-299" aria-hidden="true" tabindex="-1"></a>run17_tidy <span class="op">&lt;-</span> run17</span>
<span id="cb57-300"><a href="#cb57-300" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="fu">recode</span>(run17_tidy$event<span class="op">,</span> <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span><span class="op">,</span> <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span>)</span>
<span id="cb57-301"><a href="#cb57-301" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="im">as</span><span class="op">.</span><span class="fu">factor</span>(run17_tidy$event)</span>
<span id="cb57-302"><a href="#cb57-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-303"><a href="#cb57-303" aria-hidden="true" tabindex="-1"></a># Building a logistic model</span>
<span id="cb57-304"><a href="#cb57-304" aria-hidden="true" tabindex="-1"></a>model_binomial <span class="op">&lt;-</span> <span class="fu">glm</span>(<span class="bu">event</span> <span class="op">~</span> age<span class="op">,</span> data <span class="op">=</span> run17_tidy<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb57-305"><a href="#cb57-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-306"><a href="#cb57-306" aria-hidden="true" tabindex="-1"></a># Printing model output</span>
<span id="cb57-307"><a href="#cb57-307" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_binomial)</span>
<span id="cb57-308"><a href="#cb57-308" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-309"><a href="#cb57-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-310"><a href="#cb57-310" aria-hidden="true" tabindex="-1"></a><span class="vs">### Bernouli and binomial distributions</span></span>
<span id="cb57-311"><a href="#cb57-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-312"><a href="#cb57-312" aria-hidden="true" tabindex="-1"></a><span class="vs">Both Bernoulli and binomial distributions form the basis for logistic regression. The main difference between these two distributions is that Bernoulli is associated with probabilities of a result in a single event whereas binomial is associated with probabilities of a result in multiple events. For example; the chance of getting a head in a single coin toss follows a Bernoulli distribution and the chance of getting a head in 10 coin tosses follows a binomial distribution.</span></span>
<span id="cb57-313"><a href="#cb57-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-314"><a href="#cb57-314" aria-hidden="true" tabindex="-1"></a><span class="vs">In R we have the option to either use binomial or Bernoulli. So how do we know when to use which? The short answer is that it depends on the data structure. For wide format data, the binomial distribution is used and for long format data, the Bernoulli distribution is used. You can learn more about long format and wide format data [here](https://one-carat-blog.netlify.app/tutorials/data_man/project5.html#reshaping-dataset).</span></span>
<span id="cb57-315"><a href="#cb57-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-318"><a href="#cb57-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-319"><a href="#cb57-319" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb57-320"><a href="#cb57-320" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb57-321"><a href="#cb57-321" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb57-322"><a href="#cb57-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-323"><a href="#cb57-323" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"run17"</span>)</span>
<span id="cb57-324"><a href="#cb57-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-325"><a href="#cb57-325" aria-hidden="true" tabindex="-1"></a># Tidying the data</span>
<span id="cb57-326"><a href="#cb57-326" aria-hidden="true" tabindex="-1"></a>run17_tidy <span class="op">&lt;-</span> run17 <span class="op">%&gt;%</span> dplyr<span class="op">::</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">,</span> age)</span>
<span id="cb57-327"><a href="#cb57-327" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="fu">recode</span>(run17_tidy$event<span class="op">,</span> <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span><span class="op">,</span> <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span>)</span>
<span id="cb57-328"><a href="#cb57-328" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="im">as</span><span class="op">.</span><span class="fu">factor</span>(run17_tidy$event)</span>
<span id="cb57-329"><a href="#cb57-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-330"><a href="#cb57-330" aria-hidden="true" tabindex="-1"></a># Long format</span>
<span id="cb57-331"><a href="#cb57-331" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(run17_tidy)</span>
<span id="cb57-332"><a href="#cb57-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-333"><a href="#cb57-333" aria-hidden="true" tabindex="-1"></a># Converting the dataset to wide format</span>
<span id="cb57-334"><a href="#cb57-334" aria-hidden="true" tabindex="-1"></a>run17_wide <span class="op">&lt;-</span> run17_tidy <span class="op">%&gt;%</span> <span class="fu">group_by</span>(age<span class="op">,</span> <span class="bu">event</span>) <span class="op">%&gt;%</span></span>
<span id="cb57-335"><a href="#cb57-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(count <span class="op">=</span> <span class="fu">n</span>())</span>
<span id="cb57-336"><a href="#cb57-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-337"><a href="#cb57-337" aria-hidden="true" tabindex="-1"></a>run17_wide <span class="op">&lt;-</span> run17_wide <span class="op">%&gt;%</span> <span class="fu">pivot_wider</span>(names_from <span class="op">=</span> <span class="st">"event"</span><span class="op">,</span> values_from <span class="op">=</span> <span class="st">"count"</span>)</span>
<span id="cb57-338"><a href="#cb57-338" aria-hidden="true" tabindex="-1"></a>run17_wide[is<span class="op">.</span><span class="fu">na</span>(run17_wide)] <span class="op">&lt;-</span> <span class="dv">0</span></span>
<span id="cb57-339"><a href="#cb57-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-340"><a href="#cb57-340" aria-hidden="true" tabindex="-1"></a># Wide format</span>
<span id="cb57-341"><a href="#cb57-341" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(run17_wide)</span>
<span id="cb57-342"><a href="#cb57-342" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-343"><a href="#cb57-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-344"><a href="#cb57-344" aria-hidden="true" tabindex="-1"></a><span class="vs">In the above case, for long format data, we have a single entry in each row corresponding to individual data but in the wide format, we have each row entry corresponding to a single age group. Another way of expressing the data in a wide format is to calculate the percentage of choices, which is by dividing the total number of choices for the first category by the total number of choices for both categories.</span></span>
<span id="cb57-345"><a href="#cb57-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-346"><a href="#cb57-346" aria-hidden="true" tabindex="-1"></a><span class="vs">So for wide format data; If our data structure has the absolute value of the no. of choices made then we use `</span><span class="fu">cbind</span>()<span class="vs">` in the model formula (also called as the Wilkinson-Rogers format). If we have percentages, then we use `</span>weights <span class="op">=</span> ()<span class="vs">` in the `</span><span class="fu">glm</span>()<span class="vs">` function.</span></span>
<span id="cb57-347"><a href="#cb57-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-348"><a href="#cb57-348" aria-hidden="true" tabindex="-1"></a><span class="vs">So in summary we choose between Bernoulli and binomial by checking the following questions;</span></span>
<span id="cb57-349"><a href="#cb57-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-350"><a href="#cb57-350" aria-hidden="true" tabindex="-1"></a><span class="vs">1.    Is the data in long or wide format?</span></span>
<span id="cb57-351"><a href="#cb57-351" aria-hidden="true" tabindex="-1"></a><span class="vs">2.    Do we have individual or group data?</span></span>
<span id="cb57-352"><a href="#cb57-352" aria-hidden="true" tabindex="-1"></a><span class="vs">3.    Are we interested in individuals or groups?</span></span>
<span id="cb57-353"><a href="#cb57-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-354"><a href="#cb57-354" aria-hidden="true" tabindex="-1"></a><span class="vs">Let us build logistic models for both long format and wide format data.</span></span>
<span id="cb57-355"><a href="#cb57-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-358"><a href="#cb57-358" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-359"><a href="#cb57-359" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb57-360"><a href="#cb57-360" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb57-361"><a href="#cb57-361" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb57-362"><a href="#cb57-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-363"><a href="#cb57-363" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"run17"</span>)</span>
<span id="cb57-364"><a href="#cb57-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-365"><a href="#cb57-365" aria-hidden="true" tabindex="-1"></a># Tidying the data</span>
<span id="cb57-366"><a href="#cb57-366" aria-hidden="true" tabindex="-1"></a>run17_tidy <span class="op">&lt;-</span> run17 <span class="op">%&gt;%</span> dplyr<span class="op">::</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">,</span> age)</span>
<span id="cb57-367"><a href="#cb57-367" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="fu">recode</span>(run17_tidy$event<span class="op">,</span> <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span><span class="op">,</span> <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span>)</span>
<span id="cb57-368"><a href="#cb57-368" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="im">as</span><span class="op">.</span><span class="fu">factor</span>(run17_tidy$event)</span>
<span id="cb57-369"><a href="#cb57-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-370"><a href="#cb57-370" aria-hidden="true" tabindex="-1"></a># Building a logistic model <span class="cf">with</span> long format</span>
<span id="cb57-371"><a href="#cb57-371" aria-hidden="true" tabindex="-1"></a>model_logistic_long <span class="op">&lt;-</span> <span class="fu">glm</span>(<span class="bu">event</span> <span class="op">~</span> age<span class="op">,</span> data <span class="op">=</span> run17_tidy<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb57-372"><a href="#cb57-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-373"><a href="#cb57-373" aria-hidden="true" tabindex="-1"></a># Converting the dataset to wide format</span>
<span id="cb57-374"><a href="#cb57-374" aria-hidden="true" tabindex="-1"></a>run17_tidy_1 <span class="op">&lt;-</span> run17_tidy <span class="op">%&gt;%</span> <span class="fu">mutate</span>(event_choice <span class="op">=</span> <span class="fu">ifelse</span>(<span class="bu">event</span> <span class="op">==</span> <span class="st">"Ten_Mile"</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span>))</span>
<span id="cb57-375"><a href="#cb57-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-376"><a href="#cb57-376" aria-hidden="true" tabindex="-1"></a>run17_wide <span class="op">&lt;-</span> run17_tidy_1 <span class="op">%&gt;%</span> <span class="fu">group_by</span>(age<span class="op">,</span> <span class="bu">event</span>) <span class="op">%&gt;%</span></span>
<span id="cb57-377"><a href="#cb57-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(count <span class="op">=</span> <span class="fu">n</span>())</span>
<span id="cb57-378"><a href="#cb57-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-379"><a href="#cb57-379" aria-hidden="true" tabindex="-1"></a>run17_wide <span class="op">&lt;-</span> run17_wide <span class="op">%&gt;%</span> <span class="fu">pivot_wider</span>(names_from <span class="op">=</span> <span class="st">"event"</span><span class="op">,</span> values_from <span class="op">=</span> <span class="st">"count"</span>)</span>
<span id="cb57-380"><a href="#cb57-380" aria-hidden="true" tabindex="-1"></a>run17_wide[is<span class="op">.</span><span class="fu">na</span>(run17_wide)] <span class="op">&lt;-</span> <span class="dv">0</span></span>
<span id="cb57-381"><a href="#cb57-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-382"><a href="#cb57-382" aria-hidden="true" tabindex="-1"></a># Building a logistic model <span class="cf">with</span> wide format</span>
<span id="cb57-383"><a href="#cb57-383" aria-hidden="true" tabindex="-1"></a># We use <span class="fu">cbind</span>() to bind the two choices</span>
<span id="cb57-384"><a href="#cb57-384" aria-hidden="true" tabindex="-1"></a>model_logistic_wide_1 <span class="op">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(Five_Km<span class="op">,</span> Ten_Mile) <span class="op">~</span> age<span class="op">,</span></span>
<span id="cb57-385"><a href="#cb57-385" aria-hidden="true" tabindex="-1"></a>                             data <span class="op">=</span> run17_wide<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb57-386"><a href="#cb57-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-387"><a href="#cb57-387" aria-hidden="true" tabindex="-1"></a># Building a logistic model <span class="cf">with</span> wide format</span>
<span id="cb57-388"><a href="#cb57-388" aria-hidden="true" tabindex="-1"></a># We use percentage <span class="kw">of</span> choice and the weight or number <span class="kw">of</span> observations per group</span>
<span id="cb57-389"><a href="#cb57-389" aria-hidden="true" tabindex="-1"></a>run17_wide$prect_ten_mile <span class="op">&lt;-</span> run17_wide$Ten_Mile <span class="op">/</span> (run17_wide$Ten_Mile <span class="op">+</span> run17_wide$Five_Km)</span>
<span id="cb57-390"><a href="#cb57-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-391"><a href="#cb57-391" aria-hidden="true" tabindex="-1"></a>model_logistic_wide_2 <span class="op">&lt;-</span> <span class="fu">glm</span>(prect_ten_mile <span class="op">~</span> age<span class="op">,</span> </span>
<span id="cb57-392"><a href="#cb57-392" aria-hidden="true" tabindex="-1"></a>                             data <span class="op">=</span> run17_wide<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">,</span></span>
<span id="cb57-393"><a href="#cb57-393" aria-hidden="true" tabindex="-1"></a>                             weights <span class="op">=</span> (run17_wide$Ten_Mile <span class="op">+</span> run17_wide$Five_Km))</span>
<span id="cb57-394"><a href="#cb57-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-395"><a href="#cb57-395" aria-hidden="true" tabindex="-1"></a># Printing model outputs</span>
<span id="cb57-396"><a href="#cb57-396" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_logistic_long)</span>
<span id="cb57-397"><a href="#cb57-397" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_logistic_wide_1)</span>
<span id="cb57-398"><a href="#cb57-398" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_logistic_wide_2)</span>
<span id="cb57-399"><a href="#cb57-399" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-400"><a href="#cb57-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-401"><a href="#cb57-401" aria-hidden="true" tabindex="-1"></a><span class="vs">In summary we have three data formats for logistic regression</span></span>
<span id="cb57-402"><a href="#cb57-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-403"><a href="#cb57-403" aria-hidden="true" tabindex="-1"></a><span class="vs">1.    Binary format</span></span>
<span id="cb57-404"><a href="#cb57-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-407"><a href="#cb57-407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-408"><a href="#cb57-408" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> eval<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb57-409"><a href="#cb57-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-410"><a href="#cb57-410" aria-hidden="true" tabindex="-1"></a># Binary<span class="op">:</span> y <span class="op">=</span> <span class="dv">0</span> or <span class="dv">1</span></span>
<span id="cb57-411"><a href="#cb57-411" aria-hidden="true" tabindex="-1"></a>model_logistic_long <span class="op">&lt;-</span> <span class="fu">glm</span>(<span class="bu">event</span> <span class="op">~</span> age<span class="op">,</span> data <span class="op">=</span> run17_tidy<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb57-412"><a href="#cb57-412" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-413"><a href="#cb57-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-414"><a href="#cb57-414" aria-hidden="true" tabindex="-1"></a><span class="vs">2.    Wilkinson-Rogers format (the 'cbind' format)</span></span>
<span id="cb57-415"><a href="#cb57-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-418"><a href="#cb57-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-419"><a href="#cb57-419" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> eval<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb57-420"><a href="#cb57-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-421"><a href="#cb57-421" aria-hidden="true" tabindex="-1"></a># Wilkinson<span class="op">-</span>Rogers<span class="op">:</span> <span class="fu">cbind</span>(success<span class="op">,</span> failure)</span>
<span id="cb57-422"><a href="#cb57-422" aria-hidden="true" tabindex="-1"></a>model_logistic_wide_1 <span class="op">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(Five_Km<span class="op">,</span> Ten_Mile) <span class="op">~</span> age<span class="op">,</span></span>
<span id="cb57-423"><a href="#cb57-423" aria-hidden="true" tabindex="-1"></a>                             data <span class="op">=</span> run17_wide<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb57-424"><a href="#cb57-424" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-425"><a href="#cb57-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-426"><a href="#cb57-426" aria-hidden="true" tabindex="-1"></a><span class="vs">3.    Weighted format </span></span>
<span id="cb57-427"><a href="#cb57-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-430"><a href="#cb57-430" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-431"><a href="#cb57-431" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> eval<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb57-432"><a href="#cb57-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-433"><a href="#cb57-433" aria-hidden="true" tabindex="-1"></a># Weighted format<span class="op">:</span> y <span class="op">=</span> <span class="st">'proportions'</span><span class="op">,</span> weights <span class="op">=</span> <span class="st">'totals'</span></span>
<span id="cb57-434"><a href="#cb57-434" aria-hidden="true" tabindex="-1"></a>model_logistic_wide_2 <span class="op">&lt;-</span> <span class="fu">glm</span>(prect_ten_mile <span class="op">~</span> age<span class="op">,</span> </span>
<span id="cb57-435"><a href="#cb57-435" aria-hidden="true" tabindex="-1"></a>                             data <span class="op">=</span> run17_wide<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">,</span></span>
<span id="cb57-436"><a href="#cb57-436" aria-hidden="true" tabindex="-1"></a>                             weights <span class="op">=</span> (run17_wide$Ten_Mile <span class="op">+</span> run17_wide$Five_Km))</span>
<span id="cb57-437"><a href="#cb57-437" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-438"><a href="#cb57-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-439"><a href="#cb57-439" aria-hidden="true" tabindex="-1"></a><span class="vs">Please note that all three models give the same coefficients but the model with the long format structure has higher degrees of freedom as compared to the other two models with the wide format.</span></span>
<span id="cb57-440"><a href="#cb57-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-441"><a href="#cb57-441" aria-hidden="true" tabindex="-1"></a><span class="vs">## Link functions</span></span>
<span id="cb57-442"><a href="#cb57-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-443"><a href="#cb57-443" aria-hidden="true" tabindex="-1"></a><span class="vs">The 'link function' is what enables us to generalize a linear model so that we can use it in datasets which do not meet the assumptions of a linear model. In a way, it is a function which transforms the coefficients of the explanatory variables to form a linear combination with each other like in the case of a linear regression model.</span></span>
<span id="cb57-444"><a href="#cb57-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-445"><a href="#cb57-445" aria-hidden="true" tabindex="-1"></a><span class="vs">*   For `</span><span class="fu">poisson</span><span class="vs">` family models, the link function is `</span><span class="fu">log</span><span class="vs">` and thus the coefficients of the model are in log-scale.</span></span>
<span id="cb57-446"><a href="#cb57-446" aria-hidden="true" tabindex="-1"></a><span class="vs">*   For 'binomial' family models, there are two link functions; `</span><span class="fu">logit</span><span class="vs">` and `</span><span class="fu">probit</span><span class="vs">`</span></span>
<span id="cb57-447"><a href="#cb57-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-448"><a href="#cb57-448" aria-hidden="true" tabindex="-1"></a><span class="vs">The logit link function transforms the probabilities to 'log-odds values' which are real numbers ranging from $-</span><span class="sc">\i</span><span class="vs">nfty$ to $+</span><span class="sc">\i</span><span class="vs">nfty$ and gives rise to a linear equation similar to what is seen in a linear regression model. In logistic regression, by default, the `</span><span class="fu">logit</span><span class="vs">` link function is used.</span></span>
<span id="cb57-449"><a href="#cb57-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-450"><a href="#cb57-450" aria-hidden="true" tabindex="-1"></a><span class="vs">$$logit(p) = m_1x_1 + c_1 = log(</span><span class="sc">\f</span><span class="vs">rac{p}{1-p})$$</span></span>
<span id="cb57-451"><a href="#cb57-451" aria-hidden="true" tabindex="-1"></a><span class="vs">The probit link function is also similar to the logit link but is based on the cumulative standard normal distribution function. By default, the logistic regression in the `</span><span class="fu">glm</span>()<span class="vs">` function uses the logit link function. </span></span>
<span id="cb57-452"><a href="#cb57-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-453"><a href="#cb57-453" aria-hidden="true" tabindex="-1"></a><span class="vs">To use another link function, we should specify the link function in the family; </span></span>
<span id="cb57-454"><a href="#cb57-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-455"><a href="#cb57-455" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>family <span class="op">=</span> <span class="st">"binomial"</span><span class="vs">` = `</span>family <span class="op">=</span> <span class="fu">binomial</span>(link <span class="op">=</span> <span class="st">"probit"</span>)<span class="vs">`: By default, logit link function is used</span></span>
<span id="cb57-456"><a href="#cb57-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-457"><a href="#cb57-457" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>family <span class="op">=</span> <span class="fu">binomial</span>(link <span class="op">=</span> <span class="st">"probit"</span>)<span class="vs">`: Using the probit link function</span></span>
<span id="cb57-458"><a href="#cb57-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-459"><a href="#cb57-459" aria-hidden="true" tabindex="-1"></a><span class="vs">Look at the graphs given below. Use the slider to compare them. You can see that the model with the logit link function has a slightly longer or fatter tail, as both the tail ends reaches the limit slower as compared to the model with the probit link function. Therefore, in general, the logit link function is better at modelling outliers or rare events as compared to probit.</span></span>
<span id="cb57-460"><a href="#cb57-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-463"><a href="#cb57-463" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-464"><a href="#cb57-464" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> eval<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb57-465"><a href="#cb57-465" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>fold<span class="op">:</span> <span class="kw">true</span></span>
<span id="cb57-466"><a href="#cb57-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-467"><a href="#cb57-467" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb57-468"><a href="#cb57-468" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb57-469"><a href="#cb57-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-470"><a href="#cb57-470" aria-hidden="true" tabindex="-1"></a># Building a logistic model <span class="cf">with</span> logit link which is the <span class="im">default</span></span>
<span id="cb57-471"><a href="#cb57-471" aria-hidden="true" tabindex="-1"></a>mtcars_logit <span class="op">&lt;-</span> <span class="fu">glm</span>(vs <span class="op">~</span> mpg<span class="op">,</span> data<span class="op">=</span>mtcars<span class="op">,</span> family<span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb57-472"><a href="#cb57-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-473"><a href="#cb57-473" aria-hidden="true" tabindex="-1"></a># Building a logistic model <span class="cf">with</span> probit link which is the <span class="im">default</span></span>
<span id="cb57-474"><a href="#cb57-474" aria-hidden="true" tabindex="-1"></a>mtcars_probit <span class="op">&lt;-</span> <span class="fu">glm</span>(vs <span class="op">~</span> mpg<span class="op">,</span> data<span class="op">=</span>mtcars<span class="op">,</span> family<span class="op">=</span><span class="fu">binomial</span>(link<span class="op">=</span><span class="st">"probit"</span>))</span>
<span id="cb57-475"><a href="#cb57-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-476"><a href="#cb57-476" aria-hidden="true" tabindex="-1"></a># Plotting logistic model <span class="cf">with</span> logit link</span>
<span id="cb57-477"><a href="#cb57-477" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(mtcars_logit) <span class="op">+</span> ggplot2<span class="op">::</span><span class="fu">theme_bw</span>() <span class="op">+</span></span>
<span id="cb57-478"><a href="#cb57-478" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="op">::</span><span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"VS ~ mpg (logistic model with logit link)"</span>)</span>
<span id="cb57-479"><a href="#cb57-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-480"><a href="#cb57-480" aria-hidden="true" tabindex="-1"></a># Plotting logistic model <span class="cf">with</span> probit link</span>
<span id="cb57-481"><a href="#cb57-481" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(mtcars_probit) <span class="op">+</span> ggplot2<span class="op">::</span><span class="fu">theme_bw</span>() <span class="op">+</span></span>
<span id="cb57-482"><a href="#cb57-482" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="op">::</span><span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"VS ~ mpg (logistic model with probit link)"</span>)</span>
<span id="cb57-483"><a href="#cb57-483" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-484"><a href="#cb57-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-485"><a href="#cb57-485" aria-hidden="true" tabindex="-1"></a><span class="vs">::: {.juxtapose data-startingposition="50%"}</span></span>
<span id="cb57-486"><a href="#cb57-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-489"><a href="#cb57-489" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-490"><a href="#cb57-490" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb57-491"><a href="#cb57-491" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb57-492"><a href="#cb57-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-493"><a href="#cb57-493" aria-hidden="true" tabindex="-1"></a># Building a logistic model <span class="cf">with</span> logit link which is the <span class="im">default</span></span>
<span id="cb57-494"><a href="#cb57-494" aria-hidden="true" tabindex="-1"></a>mtcars_logit <span class="op">&lt;-</span> <span class="fu">glm</span>(vs <span class="op">~</span> mpg<span class="op">,</span> data<span class="op">=</span>mtcars<span class="op">,</span> family<span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb57-495"><a href="#cb57-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-496"><a href="#cb57-496" aria-hidden="true" tabindex="-1"></a># Building a logistic model <span class="cf">with</span> probit link which is the <span class="im">default</span></span>
<span id="cb57-497"><a href="#cb57-497" aria-hidden="true" tabindex="-1"></a>mtcars_probit <span class="op">&lt;-</span> <span class="fu">glm</span>(vs <span class="op">~</span> mpg<span class="op">,</span> data<span class="op">=</span>mtcars<span class="op">,</span> family<span class="op">=</span><span class="fu">binomial</span>(link<span class="op">=</span><span class="st">"probit"</span>))</span>
<span id="cb57-498"><a href="#cb57-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-499"><a href="#cb57-499" aria-hidden="true" tabindex="-1"></a># Plotting logistic model <span class="cf">with</span> logit link</span>
<span id="cb57-500"><a href="#cb57-500" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(mtcars_logit) <span class="op">+</span> ggplot2<span class="op">::</span><span class="fu">theme_bw</span>() <span class="op">+</span></span>
<span id="cb57-501"><a href="#cb57-501" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="op">::</span><span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"VS ~ mpg (logistic model with logit link)"</span>)</span>
<span id="cb57-502"><a href="#cb57-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-503"><a href="#cb57-503" aria-hidden="true" tabindex="-1"></a># Plotting logistic model <span class="cf">with</span> probit link</span>
<span id="cb57-504"><a href="#cb57-504" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(mtcars_probit) <span class="op">+</span> ggplot2<span class="op">::</span><span class="fu">theme_bw</span>() <span class="op">+</span></span>
<span id="cb57-505"><a href="#cb57-505" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="op">::</span><span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"VS ~ mpg (logistic model with probit link)"</span>)</span>
<span id="cb57-506"><a href="#cb57-506" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-507"><a href="#cb57-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-508"><a href="#cb57-508" aria-hidden="true" tabindex="-1"></a><span class="vs">:::</span></span>
<span id="cb57-509"><a href="#cb57-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-510"><a href="#cb57-510" aria-hidden="true" tabindex="-1"></a><span class="vs">## Simulating logit and probit</span></span>
<span id="cb57-511"><a href="#cb57-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-512"><a href="#cb57-512" aria-hidden="true" tabindex="-1"></a><span class="vs">We can simulate a logit distribution using the `</span><span class="fu">plogis</span>()<span class="vs">` and the `</span><span class="fu">rbinom</span>()<span class="vs">` functions together. The `</span><span class="fu">rbinom</span>()<span class="vs">` is a random number generator function which has additional input parameters; </span></span>
<span id="cb57-513"><a href="#cb57-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-514"><a href="#cb57-514" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span><span class="fu">n</span><span class="vs">` = Number of random numbers to generate</span></span>
<span id="cb57-515"><a href="#cb57-515" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span><span class="fu">size</span><span class="vs">` = Number of trails</span></span>
<span id="cb57-516"><a href="#cb57-516" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span><span class="fu">p</span><span class="vs">` = Probability of success</span></span>
<span id="cb57-517"><a href="#cb57-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-520"><a href="#cb57-520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-521"><a href="#cb57-521" aria-hidden="true" tabindex="-1"></a># Converting a logit scale value to probability value</span>
<span id="cb57-522"><a href="#cb57-522" aria-hidden="true" tabindex="-1"></a>p <span class="op">&lt;-</span> <span class="fu">plogis</span>(<span class="dv">2</span>)</span>
<span id="cb57-523"><a href="#cb57-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-524"><a href="#cb57-524" aria-hidden="true" tabindex="-1"></a># Simulating a logit distribution</span>
<span id="cb57-525"><a href="#cb57-525" aria-hidden="true" tabindex="-1"></a><span class="fu">rbinom</span>(n <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> size <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> prob <span class="op">=</span> p)</span>
<span id="cb57-526"><a href="#cb57-526" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-527"><a href="#cb57-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-528"><a href="#cb57-528" aria-hidden="true" tabindex="-1"></a><span class="vs">A probit distribution can be made using the `</span><span class="fu">pnrom</span>()<span class="vs">` and the `</span><span class="fu">rbinom</span>()<span class="vs">` functions together.</span></span>
<span id="cb57-529"><a href="#cb57-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-532"><a href="#cb57-532" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-533"><a href="#cb57-533" aria-hidden="true" tabindex="-1"></a># Converting a probit scale value to probability value</span>
<span id="cb57-534"><a href="#cb57-534" aria-hidden="true" tabindex="-1"></a>p <span class="op">&lt;-</span> <span class="fu">pnorm</span>(<span class="dv">2</span>)</span>
<span id="cb57-535"><a href="#cb57-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-536"><a href="#cb57-536" aria-hidden="true" tabindex="-1"></a># Simulating a probit distribution</span>
<span id="cb57-537"><a href="#cb57-537" aria-hidden="true" tabindex="-1"></a><span class="fu">rbinom</span>(n <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> size <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> prob <span class="op">=</span> p)</span>
<span id="cb57-538"><a href="#cb57-538" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-539"><a href="#cb57-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-540"><a href="#cb57-540" aria-hidden="true" tabindex="-1"></a><span class="vs">## Understanding the coefficients in a Poisson model</span></span>
<span id="cb57-541"><a href="#cb57-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-542"><a href="#cb57-542" aria-hidden="true" tabindex="-1"></a><span class="vs">The link function for the Poisson regression model is the log function. Now we will see how to interpret the coefficients/effect sizes of a Poisson regression model. Let us quickly recall how we interpreted the coefficients/effect sizes of a linear regression model. We will use our earlier example but with only 'Sex' as the exploratory variable.</span></span>
<span id="cb57-543"><a href="#cb57-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-546"><a href="#cb57-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-547"><a href="#cb57-547" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Stat2Data)</span>
<span id="cb57-548"><a href="#cb57-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-549"><a href="#cb57-549" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"HorsePrices"</span>)</span>
<span id="cb57-550"><a href="#cb57-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-551"><a href="#cb57-551" aria-hidden="true" tabindex="-1"></a># Building a linear model</span>
<span id="cb57-552"><a href="#cb57-552" aria-hidden="true" tabindex="-1"></a>model_lm <span class="op">&lt;-</span> <span class="fu">lm</span>(Price <span class="op">~</span> Sex<span class="op">,</span> data <span class="op">=</span> HorsePrices)</span>
<span id="cb57-553"><a href="#cb57-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-554"><a href="#cb57-554" aria-hidden="true" tabindex="-1"></a># Getting the summary <span class="kw">of</span> the linear model</span>
<span id="cb57-555"><a href="#cb57-555" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_lm)</span>
<span id="cb57-556"><a href="#cb57-556" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-557"><a href="#cb57-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-558"><a href="#cb57-558" aria-hidden="true" tabindex="-1"></a><span class="vs">In algebraic form, the model formula for a linear model is;</span></span>
<span id="cb57-559"><a href="#cb57-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-560"><a href="#cb57-560" aria-hidden="true" tabindex="-1"></a><span class="vs">$$y </span><span class="sc">\s</span><span class="vs">im </span><span class="sc">\b</span><span class="vs">eta_0 + </span><span class="sc">\b</span><span class="vs">eta_1x_1 + </span><span class="sc">\b</span><span class="vs">eta_2x_2 + .. + </span><span class="sc">\e</span><span class="vs">psilon$$</span></span>
<span id="cb57-561"><a href="#cb57-561" aria-hidden="true" tabindex="-1"></a><span class="vs">From the model summary, we have;</span></span>
<span id="cb57-562"><a href="#cb57-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-563"><a href="#cb57-563" aria-hidden="true" tabindex="-1"></a><span class="vs">$$y = Price</span><span class="sc">\\</span><span class="vs"> </span><span class="sc">\b</span><span class="vs">eta_0 = 16505 = Reference</span><span class="sc">\,</span><span class="vs">intercept</span><span class="sc">\,</span><span class="vs">(female)</span><span class="sc">\\</span><span class="vs"> </span><span class="sc">\b</span><span class="vs">eta_1 = 17225 = Difference</span><span class="sc">\,</span><span class="vs">from</span><span class="sc">\,</span><span class="vs">the</span><span class="sc">\,</span><span class="vs">reference</span><span class="sc">\,</span><span class="vs">intercept</span><span class="sc">\,</span><span class="vs">(for</span><span class="sc">\,</span><span class="vs">male)</span><span class="sc">\\</span><span class="vs"> </span><span class="sc">\e</span><span class="vs">psilon = Error</span><span class="sc">\,</span><span class="vs">value</span><span class="sc">\,</span><span class="vs">of</span><span class="sc">\,</span><span class="vs">the</span><span class="sc">\,</span><span class="vs">model$$</span></span>
<span id="cb57-564"><a href="#cb57-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-565"><a href="#cb57-565" aria-hidden="true" tabindex="-1"></a><span class="vs">We also have;</span></span>
<span id="cb57-566"><a href="#cb57-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-567"><a href="#cb57-567" aria-hidden="true" tabindex="-1"></a><span class="vs">$$</span><span class="sc">\b</span><span class="vs">eta_0 + </span><span class="sc">\b</span><span class="vs">eta_1 = Average</span><span class="sc">\,</span><span class="vs">price</span><span class="sc">\,</span><span class="vs">of</span><span class="sc">\,</span><span class="vs">male</span><span class="sc">\,</span><span class="vs">horses$$</span></span>
<span id="cb57-568"><a href="#cb57-568" aria-hidden="true" tabindex="-1"></a><span class="vs">This shows that the coefficient in a linear model is additive. But when we come to the Poisson model, the link function is a log function which takes in the parameter $</span><span class="sc">\l</span><span class="vs">ambda$ of the Poisson distribution. We have;</span></span>
<span id="cb57-569"><a href="#cb57-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-570"><a href="#cb57-570" aria-hidden="true" tabindex="-1"></a><span class="vs">$$Parameter</span><span class="sc">\,</span><span class="vs">of</span><span class="sc">\,</span><span class="vs">poisson</span><span class="sc">\,</span><span class="vs">distribution:</span><span class="sc">\l</span><span class="vs">ambda = e^{</span><span class="sc">\b</span><span class="vs">eta_0 + </span><span class="sc">\b</span><span class="vs">eta_1x_1 + </span><span class="sc">\b</span><span class="vs">eta_2x_2 + .. + </span><span class="sc">\e</span><span class="vs">psilon}</span><span class="sc">\\</span><span class="vs"> Link</span><span class="sc">\,</span><span class="vs">function: ln(</span><span class="sc">\l</span><span class="vs">ambda) = </span><span class="sc">\b</span><span class="vs">eta_0 + </span><span class="sc">\b</span><span class="vs">eta_1x_1 + </span><span class="sc">\b</span><span class="vs">eta_2x_2 + .. + </span><span class="sc">\e</span><span class="vs">psilon$$</span></span>
<span id="cb57-571"><a href="#cb57-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-572"><a href="#cb57-572" aria-hidden="true" tabindex="-1"></a><span class="vs">Here the coefficients are no longer additive as they are in log scale. Therefore the coefficients are multiplicative. Let us look at the Poisson regression model we created earlier;  </span></span>
<span id="cb57-573"><a href="#cb57-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-576"><a href="#cb57-576" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-577"><a href="#cb57-577" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(COUNT)</span>
<span id="cb57-578"><a href="#cb57-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-579"><a href="#cb57-579" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"rwm1984"</span>)</span>
<span id="cb57-580"><a href="#cb57-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-581"><a href="#cb57-581" aria-hidden="true" tabindex="-1"></a># Building a poisson model</span>
<span id="cb57-582"><a href="#cb57-582" aria-hidden="true" tabindex="-1"></a>model_poisson <span class="op">&lt;-</span> <span class="fu">glm</span>(docvis <span class="op">~</span> age<span class="op">,</span> data <span class="op">=</span> rwm1984<span class="op">,</span> family <span class="op">=</span> <span class="st">"poisson"</span>)</span>
<span id="cb57-583"><a href="#cb57-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-584"><a href="#cb57-584" aria-hidden="true" tabindex="-1"></a># Printing model outputs</span>
<span id="cb57-585"><a href="#cb57-585" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_poisson)</span>
<span id="cb57-586"><a href="#cb57-586" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-587"><a href="#cb57-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-588"><a href="#cb57-588" aria-hidden="true" tabindex="-1"></a><span class="vs">Here we have;</span></span>
<span id="cb57-589"><a href="#cb57-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-590"><a href="#cb57-590" aria-hidden="true" tabindex="-1"></a><span class="vs">$$y = No.</span><span class="sc">\,</span><span class="vs">of</span><span class="sc">\,</span><span class="vs">days</span><span class="sc">\,</span><span class="vs">of</span><span class="sc">\,</span><span class="vs">doctor</span><span class="sc">\,</span><span class="vs">visits</span><span class="sc">\\</span><span class="vs"> </span><span class="sc">\b</span><span class="vs">eta_0 = -0.0983153 = Reference</span><span class="sc">\,</span><span class="vs">intercept</span><span class="sc">\\</span><span class="vs"> </span><span class="sc">\b</span><span class="vs">eta_1 = 0.0273395 = Difference</span><span class="sc">\,</span><span class="vs">from</span><span class="sc">\,</span><span class="vs">the</span><span class="sc">\,</span><span class="vs">reference</span><span class="sc">\,</span><span class="vs">intercept</span><span class="sc">\\</span><span class="vs"> </span><span class="sc">\e</span><span class="vs">psilon = Error</span><span class="sc">\,</span><span class="vs">value</span><span class="sc">\,</span><span class="vs">of</span><span class="sc">\,</span><span class="vs">the</span><span class="sc">\,</span><span class="vs">model$$</span></span>
<span id="cb57-591"><a href="#cb57-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-592"><a href="#cb57-592" aria-hidden="true" tabindex="-1"></a><span class="vs">Now to find the average effect of age on the no. of days of doctor visits, we have to multiply $</span><span class="sc">\b</span><span class="vs">eta_0$ and $</span><span class="sc">\b</span><span class="vs">eta_1$ instead adding the values like in the case of a linear model.</span></span>
<span id="cb57-593"><a href="#cb57-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-594"><a href="#cb57-594" aria-hidden="true" tabindex="-1"></a><span class="vs">$$</span><span class="sc">\b</span><span class="vs">eta_0 * </span><span class="sc">\b</span><span class="vs">eta_1 = ln(average</span><span class="sc">\,</span><span class="vs">effect</span><span class="sc">\,</span><span class="vs">of</span><span class="sc">\,</span><span class="vs">age</span><span class="sc">\,</span><span class="vs">on</span><span class="sc">\,</span><span class="vs">the</span><span class="sc">\,</span><span class="vs">no.</span><span class="sc">\,</span><span class="vs">of</span><span class="sc">\,</span><span class="vs">days</span><span class="sc">\,</span><span class="vs">of</span><span class="sc">\,</span><span class="vs">doctor</span><span class="sc">\,</span><span class="vs">visits)</span><span class="sc">\\</span><span class="vs"> e^{</span><span class="sc">\b</span><span class="vs">eta_0 + </span><span class="sc">\b</span><span class="vs">eta_1} = average</span><span class="sc">\,</span><span class="vs">effect</span><span class="sc">\,</span><span class="vs">of</span><span class="sc">\,</span><span class="vs">age</span><span class="sc">\,</span><span class="vs">on</span><span class="sc">\,</span><span class="vs">the</span><span class="sc">\,</span><span class="vs">no.</span><span class="sc">\,</span><span class="vs">of</span><span class="sc">\,</span><span class="vs">days</span><span class="sc">\,</span><span class="vs">of</span><span class="sc">\,</span><span class="vs">doctor</span><span class="sc">\,</span><span class="vs">visits$$</span></span>
<span id="cb57-595"><a href="#cb57-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-596"><a href="#cb57-596" aria-hidden="true" tabindex="-1"></a><span class="vs">But if we exponentiate the coefficients, then we get the raw value, which we can add like in the case of a linear model.</span></span>
<span id="cb57-597"><a href="#cb57-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-598"><a href="#cb57-598" aria-hidden="true" tabindex="-1"></a><span class="vs">## Plotting a Poisson model</span></span>
<span id="cb57-599"><a href="#cb57-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-600"><a href="#cb57-600" aria-hidden="true" tabindex="-1"></a><span class="vs">You can either use the `</span><span class="fu">fmodel</span>()<span class="vs">` function from the `</span>{statisticalModeling}<span class="vs">` package or use the `</span><span class="fu">ggplot</span>()<span class="vs">` function from the `</span>{ggplot2}<span class="vs">` package.</span></span>
<span id="cb57-601"><a href="#cb57-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-602"><a href="#cb57-602" aria-hidden="true" tabindex="-1"></a><span class="vs">For the `</span><span class="fu">ggplot</span>()<span class="vs">` function, we specify 'poisson' model in the `</span>method<span class="op">.</span><span class="at">args</span> <span class="op">=</span> <span class="fu">list</span>(family <span class="op">=</span> <span class="st">" "</span>)<span class="vs">` parameter inside `</span><span class="fu">geom_smooth</span>()<span class="vs">` argument.</span></span>
<span id="cb57-603"><a href="#cb57-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-606"><a href="#cb57-606" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-607"><a href="#cb57-607" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(COUNT)</span>
<span id="cb57-608"><a href="#cb57-608" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb57-609"><a href="#cb57-609" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb57-610"><a href="#cb57-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-611"><a href="#cb57-611" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"rwm1984"</span>)</span>
<span id="cb57-612"><a href="#cb57-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-613"><a href="#cb57-613" aria-hidden="true" tabindex="-1"></a># Building a poisson model</span>
<span id="cb57-614"><a href="#cb57-614" aria-hidden="true" tabindex="-1"></a>model_poisson <span class="op">&lt;-</span> <span class="fu">glm</span>(docvis <span class="op">~</span> age<span class="op">,</span> data <span class="op">=</span> rwm1984<span class="op">,</span> family <span class="op">=</span> <span class="st">"poisson"</span>)</span>
<span id="cb57-615"><a href="#cb57-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-616"><a href="#cb57-616" aria-hidden="true" tabindex="-1"></a># Plotting using the <span class="fu">fmodel</span>() <span class="kw">function</span></span>
<span id="cb57-617"><a href="#cb57-617" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_poisson) <span class="op">+</span> <span class="fu">geom_point</span>(data <span class="op">=</span> rwm1984) <span class="op">+</span></span>
<span id="cb57-618"><a href="#cb57-618" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="op">+</span></span>
<span id="cb57-619"><a href="#cb57-619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"docvis ~ age (poisson model)"</span>)</span>
<span id="cb57-620"><a href="#cb57-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-621"><a href="#cb57-621" aria-hidden="true" tabindex="-1"></a># Plotting using the <span class="fu">ggplot</span>() <span class="kw">function</span></span>
<span id="cb57-622"><a href="#cb57-622" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data <span class="op">=</span> rwm1984<span class="op">,</span> <span class="fu">aes</span>(age<span class="op">,</span> docvis)) <span class="op">+</span></span>
<span id="cb57-623"><a href="#cb57-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(width <span class="op">=</span> <span class="fl">0.05</span><span class="op">,</span> height <span class="op">=</span> <span class="fl">0.05</span>) <span class="op">+</span></span>
<span id="cb57-624"><a href="#cb57-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(method <span class="op">=</span> <span class="st">'glm'</span><span class="op">,</span> method<span class="op">.</span><span class="at">args</span> <span class="op">=</span> <span class="fu">list</span>(family <span class="op">=</span> <span class="st">'poisson'</span>)) <span class="op">+</span></span>
<span id="cb57-625"><a href="#cb57-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="op">+</span></span>
<span id="cb57-626"><a href="#cb57-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"docvis ~ age (poisson model)"</span>)</span>
<span id="cb57-627"><a href="#cb57-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-628"><a href="#cb57-628" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-629"><a href="#cb57-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-630"><a href="#cb57-630" aria-hidden="true" tabindex="-1"></a><span class="vs">## Understanding the coefficients in a logistic model</span></span>
<span id="cb57-631"><a href="#cb57-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-632"><a href="#cb57-632" aria-hidden="true" tabindex="-1"></a><span class="vs">In a linear model, the coefficients were straight forward and in the Poisson model, after exponentiating the coefficients, the values were similar to that of the linear model. But for a logistic model transformation won't help and it's not as straightforward as compared to the other models. So instead, the coefficient values are converted to odds ratio. The odds ratio calculates the relative odds of two events occurring. For example, let us imagine a football team that is expected to win 10 games for every game they lose. Then the odds of winning the odds of losing would be 10 to 1. And the odds ratio would be 10/1 which is 10.</span></span>
<span id="cb57-633"><a href="#cb57-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-634"><a href="#cb57-634" aria-hidden="true" tabindex="-1"></a><span class="vs">As mentioned earlier, the default link function for a logistic model is logit, so our coefficients start as 'log-odds' which when exponentiated will give us the odds ratio.</span></span>
<span id="cb57-635"><a href="#cb57-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-636"><a href="#cb57-636" aria-hidden="true" tabindex="-1"></a><span class="vs">In general, odds-ratio values are interpreted in the following way;</span></span>
<span id="cb57-637"><a href="#cb57-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-638"><a href="#cb57-638" aria-hidden="true" tabindex="-1"></a><span class="vs">*   OR = 1: Coefficient has no effect</span></span>
<span id="cb57-639"><a href="#cb57-639" aria-hidden="true" tabindex="-1"></a><span class="vs">*   OR &lt; 1: Coefficient decreased the odds</span></span>
<span id="cb57-640"><a href="#cb57-640" aria-hidden="true" tabindex="-1"></a><span class="vs">*   OR &gt; 1: Coefficient increases the odds</span></span>
<span id="cb57-641"><a href="#cb57-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-642"><a href="#cb57-642" aria-hidden="true" tabindex="-1"></a><span class="vs">Imagine a football team is singing two players; A and B. Odds-ratio of winning is 3 if player A joins the team, which means, in that season, if player A joins, the team is bound to win 3 games for every game they lose. Likewise, if player B joins let's say the odds ratio is 0.5, which means they will win 1 game for every 2 games they lose. The odds ratio is often reported along the 95% confidence intervals.</span></span>
<span id="cb57-643"><a href="#cb57-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-644"><a href="#cb57-644" aria-hidden="true" tabindex="-1"></a><span class="vs">Let us calculate the odds ratio and the confidence interval of the model we previously created. We will use the `</span><span class="fu">tidy</span>()<span class="vs">` function from `</span>{broom}<span class="vs">` package in R.</span></span>
<span id="cb57-645"><a href="#cb57-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-648"><a href="#cb57-648" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-649"><a href="#cb57-649" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb57-650"><a href="#cb57-650" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb57-651"><a href="#cb57-651" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb57-652"><a href="#cb57-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-653"><a href="#cb57-653" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"run17"</span>)</span>
<span id="cb57-654"><a href="#cb57-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-655"><a href="#cb57-655" aria-hidden="true" tabindex="-1"></a># Tidying the data</span>
<span id="cb57-656"><a href="#cb57-656" aria-hidden="true" tabindex="-1"></a>run17_tidy <span class="op">&lt;-</span> run17</span>
<span id="cb57-657"><a href="#cb57-657" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="fu">recode</span>(run17_tidy$event<span class="op">,</span> <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span><span class="op">,</span> <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span>)</span>
<span id="cb57-658"><a href="#cb57-658" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="im">as</span><span class="op">.</span><span class="fu">factor</span>(run17_tidy$event)</span>
<span id="cb57-659"><a href="#cb57-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-660"><a href="#cb57-660" aria-hidden="true" tabindex="-1"></a># Building a logistic model</span>
<span id="cb57-661"><a href="#cb57-661" aria-hidden="true" tabindex="-1"></a>model_binomial <span class="op">&lt;-</span> <span class="fu">glm</span>(<span class="bu">event</span> <span class="op">~</span> age<span class="op">,</span> data <span class="op">=</span> run17_tidy<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb57-662"><a href="#cb57-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-663"><a href="#cb57-663" aria-hidden="true" tabindex="-1"></a># Finding the odds ratio and confidence interval</span>
<span id="cb57-664"><a href="#cb57-664" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(model_binomial<span class="op">,</span> exponentiate <span class="op">=</span> T<span class="op">,</span> conf<span class="op">.</span><span class="at">int</span> <span class="op">=</span> T)</span>
<span id="cb57-665"><a href="#cb57-665" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-666"><a href="#cb57-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-667"><a href="#cb57-667" aria-hidden="true" tabindex="-1"></a><span class="vs">The odds ratio of age to the event is ~ 0.9916 which is almost 1. This suggests that when age increases by 1 year, there 50% chance that the participant chooses 5Km over 10 Mile event run (the odds are 1 to 1). So basically age does not seem to have an association with event choice. Also note that for the 95% confidence interval, the upper bound almost includes 1 which further reinforces the notion that age is not associated with the event choice.</span></span>
<span id="cb57-668"><a href="#cb57-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-669"><a href="#cb57-669" aria-hidden="true" tabindex="-1"></a><span class="vs">## Plotting a logistic model</span></span>
<span id="cb57-670"><a href="#cb57-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-671"><a href="#cb57-671" aria-hidden="true" tabindex="-1"></a><span class="vs">Like earlier, we can either use `</span><span class="fu">fmodel</span>()<span class="vs">` function from the `</span>{statisticalModeling}<span class="vs">` package or use the `</span><span class="fu">ggplot</span>()<span class="vs">` function from the `</span>{ggplot2}<span class="vs">` package.</span></span>
<span id="cb57-672"><a href="#cb57-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-673"><a href="#cb57-673" aria-hidden="true" tabindex="-1"></a><span class="vs">For the `</span><span class="fu">ggplot</span>()<span class="vs">` function, we specify the 'binomial' model in the `</span>method<span class="op">.</span><span class="at">args</span> <span class="op">=</span> <span class="fu">list</span>(family <span class="op">=</span> <span class="st">" "</span>)<span class="vs">` parameter inside `</span><span class="fu">geom_smooth</span>()<span class="vs">` argument. Converting the event to numeric form and subtracting 1 from it will make the choice values stay between zero and one. In the ggplot2 graph, the value 1 corresponds to the 10 Mile run and the value 0 corresponds to the 5 Km run.</span></span>
<span id="cb57-674"><a href="#cb57-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-677"><a href="#cb57-677" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-678"><a href="#cb57-678" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb57-679"><a href="#cb57-679" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb57-680"><a href="#cb57-680" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb57-681"><a href="#cb57-681" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb57-682"><a href="#cb57-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-683"><a href="#cb57-683" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"run17"</span>)</span>
<span id="cb57-684"><a href="#cb57-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-685"><a href="#cb57-685" aria-hidden="true" tabindex="-1"></a># Tidying the data</span>
<span id="cb57-686"><a href="#cb57-686" aria-hidden="true" tabindex="-1"></a>run17_tidy <span class="op">&lt;-</span> run17 <span class="op">%&gt;%</span> dplyr<span class="op">::</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">,</span> age)</span>
<span id="cb57-687"><a href="#cb57-687" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="fu">recode</span>(run17_tidy$event<span class="op">,</span> <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span><span class="op">,</span> <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span>)</span>
<span id="cb57-688"><a href="#cb57-688" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="im">as</span><span class="op">.</span><span class="fu">factor</span>(run17_tidy$event)</span>
<span id="cb57-689"><a href="#cb57-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-690"><a href="#cb57-690" aria-hidden="true" tabindex="-1"></a># Building a logistic model <span class="cf">with</span> logit link</span>
<span id="cb57-691"><a href="#cb57-691" aria-hidden="true" tabindex="-1"></a>model_logistic <span class="op">&lt;-</span> <span class="fu">glm</span>(<span class="bu">event</span> <span class="op">~</span> age<span class="op">,</span> data <span class="op">=</span> run17_tidy<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb57-692"><a href="#cb57-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-693"><a href="#cb57-693" aria-hidden="true" tabindex="-1"></a># Plotting the logistic model <span class="cf">with</span> link <span class="kw">function</span> using <span class="fu">fmodel</span>()</span>
<span id="cb57-694"><a href="#cb57-694" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic) <span class="op">+</span> <span class="fu">theme_bw</span>() <span class="op">+</span></span>
<span id="cb57-695"><a href="#cb57-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"event ~ age (logistic model)"</span><span class="op">,</span></span>
<span id="cb57-696"><a href="#cb57-696" aria-hidden="true" tabindex="-1"></a>                    y <span class="op">=</span> <span class="st">"Probability to choose the 10 Mile marathon over the 5 Km run"</span>)</span>
<span id="cb57-697"><a href="#cb57-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-698"><a href="#cb57-698" aria-hidden="true" tabindex="-1"></a># Plotting the logistic model <span class="cf">with</span> link <span class="kw">function</span> using <span class="fu">ggplot</span>()</span>
<span id="cb57-699"><a href="#cb57-699" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(run17_tidy<span class="op">,</span> <span class="fu">aes</span>(age<span class="op">,</span> <span class="im">as</span><span class="op">.</span><span class="fu">numeric</span>(<span class="bu">event</span>) <span class="op">-</span> <span class="dv">1</span>)) <span class="op">+</span> <span class="fu">geom_jitter</span>(width <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> height <span class="op">=</span> <span class="fl">0.05</span>) <span class="op">+</span></span>
<span id="cb57-700"><a href="#cb57-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(method <span class="op">=</span> <span class="st">'glm'</span><span class="op">,</span> method<span class="op">.</span><span class="at">args</span> <span class="op">=</span> <span class="fu">list</span>(family <span class="op">=</span> <span class="st">"binomial"</span>)) <span class="op">+</span></span>
<span id="cb57-701"><a href="#cb57-701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="op">+</span> <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"event ~ age (logistic model)"</span><span class="op">,</span></span>
<span id="cb57-702"><a href="#cb57-702" aria-hidden="true" tabindex="-1"></a>                    y <span class="op">=</span> <span class="st">"Probability to choose the 10 Mile marathon over the 5 Km run"</span>)</span>
<span id="cb57-703"><a href="#cb57-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-704"><a href="#cb57-704" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-705"><a href="#cb57-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-706"><a href="#cb57-706" aria-hidden="true" tabindex="-1"></a><span class="vs">We can also plot for different link functions in the logistic model.</span></span>
<span id="cb57-707"><a href="#cb57-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-710"><a href="#cb57-710" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-711"><a href="#cb57-711" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb57-712"><a href="#cb57-712" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb57-713"><a href="#cb57-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-714"><a href="#cb57-714" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"run17"</span>)</span>
<span id="cb57-715"><a href="#cb57-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-716"><a href="#cb57-716" aria-hidden="true" tabindex="-1"></a># Tidying the data</span>
<span id="cb57-717"><a href="#cb57-717" aria-hidden="true" tabindex="-1"></a>run17_tidy <span class="op">&lt;-</span> run17 <span class="op">%&gt;%</span> dplyr<span class="op">::</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">,</span> age)</span>
<span id="cb57-718"><a href="#cb57-718" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="fu">recode</span>(run17_tidy$event<span class="op">,</span> <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span><span class="op">,</span> <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span>)</span>
<span id="cb57-719"><a href="#cb57-719" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="im">as</span><span class="op">.</span><span class="fu">factor</span>(run17_tidy$event)</span>
<span id="cb57-720"><a href="#cb57-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-721"><a href="#cb57-721" aria-hidden="true" tabindex="-1"></a># Building a logistic model <span class="cf">with</span> logit link</span>
<span id="cb57-722"><a href="#cb57-722" aria-hidden="true" tabindex="-1"></a>model_logistic_long <span class="op">&lt;-</span> <span class="fu">glm</span>(<span class="bu">event</span> <span class="op">~</span> age<span class="op">,</span> data <span class="op">=</span> run17_tidy<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb57-723"><a href="#cb57-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-724"><a href="#cb57-724" aria-hidden="true" tabindex="-1"></a># Plotting the logistic model <span class="cf">with</span> logit and probit link <span class="kw">function</span> using <span class="fu">ggplot</span>()</span>
<span id="cb57-725"><a href="#cb57-725" aria-hidden="true" tabindex="-1"></a># Same graph <span class="im">as</span> the earlier one</span>
<span id="cb57-726"><a href="#cb57-726" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(run17_tidy<span class="op">,</span> <span class="fu">aes</span>(age<span class="op">,</span> <span class="im">as</span><span class="op">.</span><span class="fu">numeric</span>(<span class="bu">event</span>) <span class="op">-</span> <span class="dv">1</span>)) <span class="op">+</span> <span class="fu">geom_jitter</span>(width <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> height <span class="op">=</span> <span class="fl">0.05</span>) <span class="op">+</span></span>
<span id="cb57-727"><a href="#cb57-727" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(method <span class="op">=</span> <span class="st">'glm'</span><span class="op">,</span> method<span class="op">.</span><span class="at">args</span> <span class="op">=</span> <span class="fu">list</span>(family <span class="op">=</span> <span class="fu">binomial</span>(link <span class="op">=</span> <span class="st">'logit'</span>))<span class="op">,</span></span>
<span id="cb57-728"><a href="#cb57-728" aria-hidden="true" tabindex="-1"></a>              colour <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb57-729"><a href="#cb57-729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(method <span class="op">=</span> <span class="st">'glm'</span><span class="op">,</span> method<span class="op">.</span><span class="at">args</span> <span class="op">=</span> <span class="fu">list</span>(family <span class="op">=</span> <span class="fu">binomial</span>(link <span class="op">=</span> <span class="st">'probit'</span>))<span class="op">,</span></span>
<span id="cb57-730"><a href="#cb57-730" aria-hidden="true" tabindex="-1"></a>              colour <span class="op">=</span> <span class="st">"green"</span>) <span class="op">+</span> </span>
<span id="cb57-731"><a href="#cb57-731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="op">+</span> <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"event ~ age (logistic model; red: logit, green: probit)"</span><span class="op">,</span></span>
<span id="cb57-732"><a href="#cb57-732" aria-hidden="true" tabindex="-1"></a>                    y <span class="op">=</span> <span class="st">"Probability to choose the 10 Mile marathon over the 5 Km run"</span>)</span>
<span id="cb57-733"><a href="#cb57-733" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-734"><a href="#cb57-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-735"><a href="#cb57-735" aria-hidden="true" tabindex="-1"></a><span class="vs">As you can see the lines corresponding to logit and probit link functions are very similar.</span></span>
<span id="cb57-736"><a href="#cb57-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-737"><a href="#cb57-737" aria-hidden="true" tabindex="-1"></a><span class="vs">## Multiple regression with GLMs</span></span>
<span id="cb57-738"><a href="#cb57-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-739"><a href="#cb57-739" aria-hidden="true" tabindex="-1"></a><span class="vs">As seen with linear models, GLMs are also affected by collinearity. Therefore, the order of the explanatory variables in the model formula matters for GLMs, if there exists a correlation between the explanatory variables used. To check the correlation between two variables we can use the `</span><span class="fu">cor</span>()<span class="vs">` function.</span></span>
<span id="cb57-740"><a href="#cb57-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-741"><a href="#cb57-741" aria-hidden="true" tabindex="-1"></a><span class="vs">Let us look at this in action using the logistic model we created earlier, but this time we will also add the `</span><span class="fu">pace_sec</span><span class="vs">` variable which tells the average time (in seconds) to complete a mile. </span></span>
<span id="cb57-742"><a href="#cb57-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-745"><a href="#cb57-745" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-746"><a href="#cb57-746" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb57-747"><a href="#cb57-747" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb57-748"><a href="#cb57-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-749"><a href="#cb57-749" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"run17"</span>)</span>
<span id="cb57-750"><a href="#cb57-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-751"><a href="#cb57-751" aria-hidden="true" tabindex="-1"></a># Tidying the data</span>
<span id="cb57-752"><a href="#cb57-752" aria-hidden="true" tabindex="-1"></a>run17_tidy <span class="op">&lt;-</span> run17</span>
<span id="cb57-753"><a href="#cb57-753" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="fu">recode</span>(run17_tidy$event<span class="op">,</span> <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span><span class="op">,</span> <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span>)</span>
<span id="cb57-754"><a href="#cb57-754" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="im">as</span><span class="op">.</span><span class="fu">factor</span>(run17_tidy$event)</span>
<span id="cb57-755"><a href="#cb57-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-756"><a href="#cb57-756" aria-hidden="true" tabindex="-1"></a># Finding the correlation between pace_sec and age</span>
<span id="cb57-757"><a href="#cb57-757" aria-hidden="true" tabindex="-1"></a># Remove any NAs prior to finding the correlation</span>
<span id="cb57-758"><a href="#cb57-758" aria-hidden="true" tabindex="-1"></a>run17_tidy <span class="op">&lt;-</span> <span class="fu">drop_na</span>(run17_tidy)</span>
<span id="cb57-759"><a href="#cb57-759" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(run17_tidy$pace_sec<span class="op">,</span> run17_tidy$age)</span>
<span id="cb57-760"><a href="#cb57-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-761"><a href="#cb57-761" aria-hidden="true" tabindex="-1"></a># Building a logistic model wiht pace_sec <span class="op">+</span> age</span>
<span id="cb57-762"><a href="#cb57-762" aria-hidden="true" tabindex="-1"></a>model_logistic_1 <span class="op">&lt;-</span> <span class="fu">glm</span>(<span class="bu">event</span> <span class="op">~</span> pace_sec <span class="op">+</span> age<span class="op">,</span> data <span class="op">=</span> run17_tidy<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb57-763"><a href="#cb57-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-764"><a href="#cb57-764" aria-hidden="true" tabindex="-1"></a># Building a logistic model wiht age <span class="op">+</span> pace_sec</span>
<span id="cb57-765"><a href="#cb57-765" aria-hidden="true" tabindex="-1"></a>model_logistic_2 <span class="op">&lt;-</span> <span class="fu">glm</span>(<span class="bu">event</span> <span class="op">~</span> age <span class="op">+</span> pace_sec<span class="op">,</span> data <span class="op">=</span> run17_tidy<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb57-766"><a href="#cb57-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-767"><a href="#cb57-767" aria-hidden="true" tabindex="-1"></a># Printing the results</span>
<span id="cb57-768"><a href="#cb57-768" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_logistic_1)</span>
<span id="cb57-769"><a href="#cb57-769" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_logistic_2)</span>
<span id="cb57-770"><a href="#cb57-770" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-771"><a href="#cb57-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-772"><a href="#cb57-772" aria-hidden="true" tabindex="-1"></a><span class="vs">You can see that the model summary is identical, even with different ordering of the exploratory variables. This is because the correlation coefficient is ~ 0.17 which means there is a weak correlation between the used exploratory variables. So before building a model it's a good practice to check if the exploratory variables exhibit collinearity.</span></span>
<span id="cb57-773"><a href="#cb57-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-774"><a href="#cb57-774" aria-hidden="true" tabindex="-1"></a><span class="vs">## Assumptions of GLMs</span></span>
<span id="cb57-775"><a href="#cb57-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-776"><a href="#cb57-776" aria-hidden="true" tabindex="-1"></a><span class="vs">GLMs extend the linear model via link function which transforms the coefficient into a linear combination which can be interpreted in a similar way to that seen in linear models. Nevertheless, there are important assumptions which are to be met by the data to apply any GLM.</span></span>
<span id="cb57-777"><a href="#cb57-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-778"><a href="#cb57-778" aria-hidden="true" tabindex="-1"></a><span class="vs">1.    **Simpson's paradox does not occur**</span></span>
<span id="cb57-779"><a href="#cb57-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-780"><a href="#cb57-780" aria-hidden="true" tabindex="-1"></a><span class="vs">Simpson's paradox occurs when we fail to include an exploratory variable which significantly changes the model output after its addition. Consider the graphs given below. Please use the slider to compare them.</span></span>
<span id="cb57-781"><a href="#cb57-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-784"><a href="#cb57-784" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-785"><a href="#cb57-785" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> eval<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb57-786"><a href="#cb57-786" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> code<span class="op">-</span>fold<span class="op">:</span> <span class="kw">true</span></span>
<span id="cb57-787"><a href="#cb57-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-788"><a href="#cb57-788" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb57-789"><a href="#cb57-789" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb57-790"><a href="#cb57-790" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb57-791"><a href="#cb57-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-792"><a href="#cb57-792" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"run17"</span>)</span>
<span id="cb57-793"><a href="#cb57-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-794"><a href="#cb57-794" aria-hidden="true" tabindex="-1"></a># Tidying the data</span>
<span id="cb57-795"><a href="#cb57-795" aria-hidden="true" tabindex="-1"></a>run17_tidy <span class="op">&lt;-</span> run17</span>
<span id="cb57-796"><a href="#cb57-796" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="fu">recode</span>(run17_tidy$event<span class="op">,</span> <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span><span class="op">,</span> <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span>)</span>
<span id="cb57-797"><a href="#cb57-797" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="im">as</span><span class="op">.</span><span class="fu">factor</span>(run17_tidy$event)</span>
<span id="cb57-798"><a href="#cb57-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-799"><a href="#cb57-799" aria-hidden="true" tabindex="-1"></a># Building a logistic model <span class="cf">with</span> age</span>
<span id="cb57-800"><a href="#cb57-800" aria-hidden="true" tabindex="-1"></a>model_logistic_1 <span class="op">&lt;-</span> <span class="fu">glm</span>(<span class="bu">event</span> <span class="op">~</span> age<span class="op">,</span> data <span class="op">=</span> run17_tidy<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb57-801"><a href="#cb57-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-802"><a href="#cb57-802" aria-hidden="true" tabindex="-1"></a># Plotting the model</span>
<span id="cb57-803"><a href="#cb57-803" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic_1) <span class="op">+</span> <span class="fu">theme_bw</span>() <span class="op">+</span></span>
<span id="cb57-804"><a href="#cb57-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"event ~ age (logistic model)"</span><span class="op">,</span></span>
<span id="cb57-805"><a href="#cb57-805" aria-hidden="true" tabindex="-1"></a>                    y <span class="op">=</span> <span class="st">"Probability to choose the 10 Mile marathon over the 5 Km run"</span>)</span>
<span id="cb57-806"><a href="#cb57-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-807"><a href="#cb57-807" aria-hidden="true" tabindex="-1"></a># Building a logistic model <span class="cf">with</span> age <span class="op">+</span> pace_sec</span>
<span id="cb57-808"><a href="#cb57-808" aria-hidden="true" tabindex="-1"></a>model_logistic_2 <span class="op">&lt;-</span> <span class="fu">glm</span>(<span class="bu">event</span> <span class="op">~</span> age <span class="op">+</span> pace_sec<span class="op">,</span> data <span class="op">=</span> run17_tidy<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb57-809"><a href="#cb57-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-810"><a href="#cb57-810" aria-hidden="true" tabindex="-1"></a># Plotting the model</span>
<span id="cb57-811"><a href="#cb57-811" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic_2) <span class="op">+</span> <span class="fu">theme_bw</span>() <span class="op">+</span></span>
<span id="cb57-812"><a href="#cb57-812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"event ~ age + pace_sec (logistic model)"</span><span class="op">,</span></span>
<span id="cb57-813"><a href="#cb57-813" aria-hidden="true" tabindex="-1"></a>                    y <span class="op">=</span> <span class="st">"Probability to choose the 10 Mile marathon over the 5 Km run"</span>)</span>
<span id="cb57-814"><a href="#cb57-814" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-815"><a href="#cb57-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-816"><a href="#cb57-816" aria-hidden="true" tabindex="-1"></a><span class="vs">::: {.juxtapose data-startingposition="50%"}</span></span>
<span id="cb57-817"><a href="#cb57-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-820"><a href="#cb57-820" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-821"><a href="#cb57-821" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb57-822"><a href="#cb57-822" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cherryblossom)</span>
<span id="cb57-823"><a href="#cb57-823" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statisticalModeling)</span>
<span id="cb57-824"><a href="#cb57-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-825"><a href="#cb57-825" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"run17"</span>)</span>
<span id="cb57-826"><a href="#cb57-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-827"><a href="#cb57-827" aria-hidden="true" tabindex="-1"></a># Tidying the data</span>
<span id="cb57-828"><a href="#cb57-828" aria-hidden="true" tabindex="-1"></a>run17_tidy <span class="op">&lt;-</span> run17</span>
<span id="cb57-829"><a href="#cb57-829" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="fu">recode</span>(run17_tidy$event<span class="op">,</span> <span class="st">"10 Mile"</span> <span class="op">=</span> <span class="st">"Ten_Mile"</span><span class="op">,</span> <span class="st">"5K"</span> <span class="op">=</span> <span class="st">"Five_Km"</span>)</span>
<span id="cb57-830"><a href="#cb57-830" aria-hidden="true" tabindex="-1"></a>run17_tidy$event <span class="op">&lt;-</span> <span class="im">as</span><span class="op">.</span><span class="fu">factor</span>(run17_tidy$event)</span>
<span id="cb57-831"><a href="#cb57-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-832"><a href="#cb57-832" aria-hidden="true" tabindex="-1"></a># Building a logistic model <span class="cf">with</span> age</span>
<span id="cb57-833"><a href="#cb57-833" aria-hidden="true" tabindex="-1"></a>model_logistic_1 <span class="op">&lt;-</span> <span class="fu">glm</span>(<span class="bu">event</span> <span class="op">~</span> age<span class="op">,</span> data <span class="op">=</span> run17_tidy<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb57-834"><a href="#cb57-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-835"><a href="#cb57-835" aria-hidden="true" tabindex="-1"></a># Plotting the model</span>
<span id="cb57-836"><a href="#cb57-836" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic_1) <span class="op">+</span> <span class="fu">theme_bw</span>() <span class="op">+</span></span>
<span id="cb57-837"><a href="#cb57-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"event ~ age (logistic model)"</span><span class="op">,</span></span>
<span id="cb57-838"><a href="#cb57-838" aria-hidden="true" tabindex="-1"></a>                    y <span class="op">=</span> <span class="st">"Probability to choose the 10 Mile marathon over the 5 Km run"</span>)</span>
<span id="cb57-839"><a href="#cb57-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-840"><a href="#cb57-840" aria-hidden="true" tabindex="-1"></a># Building a logistic model <span class="cf">with</span> age <span class="op">+</span> pace_sec</span>
<span id="cb57-841"><a href="#cb57-841" aria-hidden="true" tabindex="-1"></a>model_logistic_2 <span class="op">&lt;-</span> <span class="fu">glm</span>(<span class="bu">event</span> <span class="op">~</span> age <span class="op">+</span> pace_sec<span class="op">,</span> data <span class="op">=</span> run17_tidy<span class="op">,</span> family <span class="op">=</span> <span class="st">"binomial"</span>)</span>
<span id="cb57-842"><a href="#cb57-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-843"><a href="#cb57-843" aria-hidden="true" tabindex="-1"></a># Plotting the model</span>
<span id="cb57-844"><a href="#cb57-844" aria-hidden="true" tabindex="-1"></a><span class="fu">fmodel</span>(model_logistic_2) <span class="op">+</span> <span class="fu">theme_bw</span>() <span class="op">+</span></span>
<span id="cb57-845"><a href="#cb57-845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(title <span class="op">=</span> <span class="st">"event ~ age + pace_sec (logistic model)"</span><span class="op">,</span></span>
<span id="cb57-846"><a href="#cb57-846" aria-hidden="true" tabindex="-1"></a>                    y <span class="op">=</span> <span class="st">"Probability to choose the 10 Mile marathon over the 5 Km run"</span>)</span>
<span id="cb57-847"><a href="#cb57-847" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-848"><a href="#cb57-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-849"><a href="#cb57-849" aria-hidden="true" tabindex="-1"></a><span class="vs">:::</span></span>
<span id="cb57-850"><a href="#cb57-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-851"><a href="#cb57-851" aria-hidden="true" tabindex="-1"></a><span class="vs">In the first model, predicting event choice with just age suggests that with increasing age, there is less chance that people will participate in the 10 Mile marathon. But when you also add the pace of participants into the model formula then you get completely different results (and absurd too!). The second model indicates that participants with a high pace (shorter y-axis values in the graph) irrespective of age will almost always choose the 10 Mile marathon. So our interpretation is completely changed and this is an example of Simpson's paradox.</span></span>
<span id="cb57-852"><a href="#cb57-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-853"><a href="#cb57-853" aria-hidden="true" tabindex="-1"></a><span class="vs">2.    **Variables follow linear relationship and are monotonic**</span></span>
<span id="cb57-854"><a href="#cb57-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-855"><a href="#cb57-855" aria-hidden="true" tabindex="-1"></a><span class="vs">Like in the case of linear models, GLMs also require that the variables follow a linear change. Monotonic means that the change is either always increasing or decreasing.</span></span>
<span id="cb57-856"><a href="#cb57-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-857"><a href="#cb57-857" aria-hidden="true" tabindex="-1"></a><span class="vs">3.    **Variables should independent**</span></span>
<span id="cb57-858"><a href="#cb57-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-859"><a href="#cb57-859" aria-hidden="true" tabindex="-1"></a><span class="vs">The effect sizes of one variable should not influence the effect size of another variable. We have seen this in detail for linear models. If they are independent, then we have to represent them as interaction terms. In this case, the order also matters while inputting them into the model formula.</span></span>
<span id="cb57-860"><a href="#cb57-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-861"><a href="#cb57-861" aria-hidden="true" tabindex="-1"></a><span class="vs">4.    **Over dispersion**</span></span>
<span id="cb57-862"><a href="#cb57-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-863"><a href="#cb57-863" aria-hidden="true" tabindex="-1"></a><span class="vs">Overdispersion occurs when the datasets have a lot of zeros or ones in the case of the binomial distribution and a lot of zeros in the case of the Poisson distribution. Also if the variance is greater than the mean of the data, then again the model is over-dispersed.</span></span>
<span id="cb57-864"><a href="#cb57-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-865"><a href="#cb57-865" aria-hidden="true" tabindex="-1"></a><span class="vs">## Conclusion</span></span>
<span id="cb57-866"><a href="#cb57-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-867"><a href="#cb57-867" aria-hidden="true" tabindex="-1"></a><span class="vs">This marks the end of the introduction to generalised linear models. In summary, we learned;</span></span>
<span id="cb57-868"><a href="#cb57-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-869"><a href="#cb57-869" aria-hidden="true" tabindex="-1"></a><span class="vs">1.    Understanding the coefficients in a linear model</span></span>
<span id="cb57-870"><a href="#cb57-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-871"><a href="#cb57-871" aria-hidden="true" tabindex="-1"></a><span class="vs">2.    Why do linear models fail for some datasets and what are the limitations of a linear model</span></span>
<span id="cb57-872"><a href="#cb57-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-873"><a href="#cb57-873" aria-hidden="true" tabindex="-1"></a><span class="vs">3.    Two types of GLMs: Poisson and Logistic</span></span>
<span id="cb57-874"><a href="#cb57-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-875"><a href="#cb57-875" aria-hidden="true" tabindex="-1"></a><span class="vs">4.    Link functions</span></span>
<span id="cb57-876"><a href="#cb57-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-877"><a href="#cb57-877" aria-hidden="true" tabindex="-1"></a><span class="vs">5.    Understanding the coefficients in a Poisson and logistic models</span></span>
<span id="cb57-878"><a href="#cb57-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-879"><a href="#cb57-879" aria-hidden="true" tabindex="-1"></a><span class="vs">6.    Plotting Poisson and logistic models</span></span>
<span id="cb57-880"><a href="#cb57-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-881"><a href="#cb57-881" aria-hidden="true" tabindex="-1"></a><span class="vs">7.    Brief introduction to multiple regression using GLMs</span></span>
<span id="cb57-882"><a href="#cb57-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-883"><a href="#cb57-883" aria-hidden="true" tabindex="-1"></a><span class="vs">8.    Assumptions of GLMs: When to use GLMs</span></span>
<span id="cb57-884"><a href="#cb57-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-885"><a href="#cb57-885" aria-hidden="true" tabindex="-1"></a><span class="vs">In the next tutorial, we will take our understanding of GLMs to the next level and learn about 'Hierarchical and Mixed Effects Models in R'. See you then!</span></span>
<span id="cb57-886"><a href="#cb57-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-887"><a href="#cb57-887" aria-hidden="true" tabindex="-1"></a><span class="vs">#### Last updated on {.unnumbered .unlisted .appendix}</span></span>
<span id="cb57-888"><a href="#cb57-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-891"><a href="#cb57-891" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-892"><a href="#cb57-892" aria-hidden="true" tabindex="-1"></a>#<span class="op">|</span> echo<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb57-893"><a href="#cb57-893" aria-hidden="true" tabindex="-1"></a>Sys<span class="op">.</span><span class="fu">time</span>()</span>
<span id="cb57-894"><a href="#cb57-894" aria-hidden="true" tabindex="-1"></a><span class="vs">```</span></span>
<span id="cb57-895"><a href="#cb57-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-896"><a href="#cb57-896" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;!-- Do not forget to put flag counter --&gt;</span></span>
<span id="cb57-897"><a href="#cb57-897" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;a hidden href="https://info.flagcounter.com/ynrK"&gt;&lt;img src="https://s11.flagcounter.com/count2/ynrK/bg_000000/txt_FFFFFF/border_F0F0F0/columns_5/maxflags_25/viewers_0/labels_1/pageviews_1/flags_0/percent_0/" alt="Flag Counter" border="0"/&gt;&lt;/a&gt;</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Blog made using <a href="https://quarto.org/">Quarto®</a> with ❤️, by Jewel Johnson.</div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jeweljohnsonj">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/jeweljohnsonj">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:jewel15@alumni.iisertvm.ac.in">
      <i class="bi bi-briefcase" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:jeweljohnsonj@gmail.com">
      <i class="bi bi-house" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer><div class="page-columns page-rows-contents page-layout-article"><div class="social-share">
<a href="https://twitter.com/share?url=https://one-carat-blog.netlify.app/tutorials/stat_model/glm_stat_model.html&amp;text=Generalized%20linear%20models%20in%20R" target="_blank" class="twitter"><i class="fab fa-twitter fa-fw fa-lg"></i></a><a href="https://www.linkedin.com/shareArticle?url=https://one-carat-blog.netlify.app/tutorials/stat_model/glm_stat_model.html&amp;title=Generalized%20linear%20models%20in%20R" target="_blank" class="linkedin"><i class="fa-brands fa-linkedin-in fa-fw fa-lg"></i></a>  <a href="mailto:?subject=Generalized%20linear%20models%20in%20R&amp;body=Check%20out%20this%20link:https://one-carat-blog.netlify.app/tutorials/stat_model/glm_stat_model.html" target="_blank" class="email"><i class="fa-solid fa-envelope fa-fw fa-lg"></i></a><a href="https://www.facebook.com/sharer.php?u=https://one-carat-blog.netlify.app/tutorials/stat_model/glm_stat_model.html" target="_blank" class="facebook"><i class="fab fa-facebook-f fa-fw fa-lg"></i></a><a href="https://reddit.com/submit?url=https://one-carat-blog.netlify.app/tutorials/stat_model/glm_stat_model.html&amp;title=Generalized%20linear%20models%20in%20R" target="_blank" class="reddit">   <i class="fa-brands fa-reddit-alien fa-fw fa-lg"></i></a><a href="https://www.stumbleupon.com/submit?url=https://one-carat-blog.netlify.app/tutorials/stat_model/glm_stat_model.html&amp;title=Generalized%20linear%20models%20in%20R" target="_blank" class="stumbleupon"><i class="fa-brands fa-stumbleupon fa-fw fa-lg"></i></a><a href="https://www.tumblr.com/share/link?url=https://one-carat-blog.netlify.app/tutorials/stat_model/glm_stat_model.html&amp;name=Generalized%20linear%20models%20in%20R" target="_blank" class="tumblr"><i class="fa-brands fa-tumblr fa-fw fa-lg"></i></a>
</div></div>



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>