{
  "hash": "6be57beceee7986f1eb12ad5958d1aea",
  "result": {
    "markdown": "---\ntitle: \"Chapter 2: Data manipulation using dplyr (part 1)\"\nsubtitle: |\n  Learn how to manipulate your data with the dplyr package.\nauthor: \"Jewel Johnson\"\ndate: \"12/13/2021\"\nformat:\n  html:\n    toc: true\n    toc-title: On this page\n    html-math-method: katex\n    css: styles.css\n    number-sections: true\n    smooth-scroll: true\n    highlight-style: github\n    code-link: true\ncitation: true\ncomments:\n  hypothesis: true\nexecute: \n  warning: false\n  freeze: auto\nimage: /images/dplyr.png\n---\n\n\n## Introduction to dplyr package\n\nThe `{dplyr}` package is a grammar of data manipulation just like how `{ggplot2}` is the grammar of data visualization. It helps us to apply a wide variety of functions such as;\n\n1.  Summarising the dataset\n2.  Applying selections and orderings as a function of a variable\n3.  Creating new variables as a function of existing variables\n\nWe will see in-depth how to manipulate our data like a boss!\n\n## The pipe operator %\\>%\n\nPerhaps the most amazing thing in making codes short and efficient is the pipe operator which is originally from the `{magrittr}` package which is made available for the `{dplyr}` package. The pipe operator helps you skip the intermediate steps of saving an object before you can use them in command. It does so by 'piping' together results from the first object to the function ahead of the pipe operator. The command `x %>% y %>% z` can be read as 'take the result of x and use it with function y and take that result and use it with function z'. This is the gist of what the pipe operator does. Allow me to demonstrate.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\n# dummy data\na <- c(sample(1:100, size = 50))\nb <- c(sample(1:100, size = 50))\ndata <- as.data.frame(cbind(a,b))\n\n# without %>%\ndata <- mutate(data, ab = a*b, twice_a = 2*a)\ndata_new <- filter(data, ab < 300, twice_a < 200)\nggplot(data_new, aes(ab, twice_a)) + geom_point()\n\n# with %>%\ndata %>% mutate(ab = a*b, twice_a = 2*a) %>% \n  filter(ab < 300, twice_a < 200) %>%\n  ggplot(aes(ab, twice_a)) + geom_point()\n```\n:::\n\n\nAs you can see, with pipe operator `%>%`, we did not have to save any objects in the intermediate steps and also it improved the overall clarity of the code. I have used a few commands from the `{dplyr}` package in the example given above. So without further ado let us delve into the `{dplyr}` package. For this chapter, I will be using the penguin dataset from the popular `{palmerpenguin}` package as an example.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install palmerpenguins package\ninstall.packages(\"palmerpenguins\")\nlibrary(dplyr)\nlibrary(palmerpenguins)\n```\n:::\n\n\n## Grouping the data\n\n### group_by()\n\nThe command `group_by()` allows us to group the data via existing variables. It allows for a 'split-apply-combine' way of getting output. First, it will split the data or group the data with the levels in the variable, then apply the function of our choice and then finally combine the results to give us a tabular output. On its own the command doesn't do anything, we use it in conjunction with other commands to get results based on the grouping we specify. The command `ungroup()` is used to ungroup the data.\n\n## Summarising the data\n\n### summarise()\n\nThe `summarise()` command allows you to get the summary statistics of a variable or a column in the dataset. The result is given as tabular data. Many types of summary statistics can be obtained using the `summarise()` function. Some of them are given below. To calculate average values it is necessary to drop `NA` values from the dataset. Use `drop_na()` command from the `{tidyr}` package. The comments denote what each summary statistic is.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyr)\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\nsummary_data <- penguins %>% drop_na() %>%\n  group_by(species) %>% # we are grouping/splitting the data according to species\n  summarise(avg_mass = mean(body_mass_g), # mean mass\n            median_mass = median(body_mass_g), # median mass\n            max_mass = max(body_mass_g), # max value of mass, can also use min()\n            standard_deviation_bill_length = sd(bill_length_mm), # standard deviation of bill_length\n            sum_mass = sum(flipper_length_mm), # sum\n            distinct_years = n_distinct(year), # distinct values in column year\n            no_of_non_NAs = sum(!is.na(year)), # gives no of non NAs, \n            length_rows = n(), # length of the rows\n            iqr_mass = IQR(body_mass_g), # inter quartile range of mass\n            median_absolute_deviation_mass = mad(body_mass_g), # median absolute deviation of mass\n            variance_mass = var(body_mass_g)) # variance\n# viewing summary as a table\nsummary_data\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 12\n  species avg_mass median_mass max_mass standard_deviat… sum_mass distinct_years\n  <fct>      <dbl>       <dbl>    <int>            <dbl>    <int>          <int>\n1 Adelie     3706.        3700     4775             2.66    27755              3\n2 Chinst…    3733.        3700     4800             3.34    13316              3\n3 Gentoo     5092.        5050     6300             3.11    25851              3\n# … with 5 more variables: no_of_non_NAs <int>, length_rows <int>,\n#   iqr_mass <dbl>, median_absolute_deviation_mass <dbl>, variance_mass <dbl>\n```\n:::\n:::\n\n\nThe number of non `NA` values will be the same as that of `n()` result as we have used `drop_na()`command in the beginning.\n\nThe base function `summary()` in R also gives the whole summary statistics of a dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(palmerpenguins)\n\nsummary(penguins)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      species          island    bill_length_mm  bill_depth_mm  \n Adelie   :152   Biscoe   :168   Min.   :32.10   Min.   :13.10  \n Chinstrap: 68   Dream    :124   1st Qu.:39.23   1st Qu.:15.60  \n Gentoo   :124   Torgersen: 52   Median :44.45   Median :17.30  \n                                 Mean   :43.92   Mean   :17.15  \n                                 3rd Qu.:48.50   3rd Qu.:18.70  \n                                 Max.   :59.60   Max.   :21.50  \n                                 NA's   :2       NA's   :2      \n flipper_length_mm  body_mass_g       sex           year     \n Min.   :172.0     Min.   :2700   female:165   Min.   :2007  \n 1st Qu.:190.0     1st Qu.:3550   male  :168   1st Qu.:2007  \n Median :197.0     Median :4050   NA's  : 11   Median :2008  \n Mean   :200.9     Mean   :4202                Mean   :2008  \n 3rd Qu.:213.0     3rd Qu.:4750                3rd Qu.:2009  \n Max.   :231.0     Max.   :6300                Max.   :2009  \n NA's   :2         NA's   :2                                 \n```\n:::\n:::\n\n\n### when to use group_by()\n\nIt can be confusing to decide when to use the `group_by()` function. In short, you should use it whenever you want any function to act separately on different groups present in the dataset. Here is a graphical representation of how the `summarise()` function is used to calculate the mean values of a dataset. When used with `group_by()` it calculates mean values for the respective groups in the data, but when `group_by()` is not used, it will calculate the mean value of the entire dataset irrespective of the different groups present and outputs a single column.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](images/group_by.png){width=792}\n:::\n:::\n\n\n### count()\n\nThe `count()` command is used to count the number of rows of a variable. Has the same function as that of `n()`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\ncount <- penguins %>% group_by(species) %>%\n  count(island)\n\n# viewing count as a table\ncount\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 3\n# Groups:   species [3]\n  species   island        n\n  <fct>     <fct>     <int>\n1 Adelie    Biscoe       44\n2 Adelie    Dream        56\n3 Adelie    Torgersen    52\n4 Chinstrap Dream        68\n5 Gentoo    Biscoe      124\n```\n:::\n:::\n\n\n## Manipulating cases or observations\n\nThe following functions affect rows to give a subset of rows in a new table as output.\n\n### filter()\n\nUse `filter()` to filter rows corresponding to a given logical criteria\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\npenguins %>% filter(body_mass_g < 3000)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 9 × 8\n  species island bill_length_mm bill_depth_mm flipper_length_… body_mass_g sex  \n  <fct>   <fct>           <dbl>         <dbl>            <int>       <int> <fct>\n1 Adelie  Dream            37.5          18.9              179        2975 <NA> \n2 Adelie  Biscoe           34.5          18.1              187        2900 fema…\n3 Adelie  Biscoe           36.5          16.6              181        2850 fema…\n4 Adelie  Biscoe           36.4          17.1              184        2850 fema…\n5 Adelie  Dream            33.1          16.1              178        2900 fema…\n6 Adelie  Biscoe           37.9          18.6              193        2925 fema…\n7 Adelie  Torge…           38.6          17                188        2900 fema…\n8 Chinst… Dream            43.2          16.6              187        2900 fema…\n9 Chinst… Dream            46.9          16.6              192        2700 fema…\n# … with 1 more variable: year <int>\n```\n:::\n:::\n\n\n### distinct()\n\nUse `distinct()` to remove rows with duplicate or same values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\npenguins %>% group_by(species) %>% distinct(body_mass_g)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 138 × 2\n# Groups:   species [3]\n   species body_mass_g\n   <fct>         <int>\n 1 Adelie         3750\n 2 Adelie         3800\n 3 Adelie         3250\n 4 Adelie           NA\n 5 Adelie         3450\n 6 Adelie         3650\n 7 Adelie         3625\n 8 Adelie         4675\n 9 Adelie         3475\n10 Adelie         4250\n# … with 128 more rows\n```\n:::\n:::\n\n\n### slice()\n\nUse `slice()` to select rows by position.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\n# slice from first row to fifth row\npenguins %>% slice(1:5) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 8\n  species island bill_length_mm bill_depth_mm flipper_length_… body_mass_g sex  \n  <fct>   <fct>           <dbl>         <dbl>            <int>       <int> <fct>\n1 Adelie  Torge…           39.1          18.7              181        3750 male \n2 Adelie  Torge…           39.5          17.4              186        3800 fema…\n3 Adelie  Torge…           40.3          18                195        3250 fema…\n4 Adelie  Torge…           NA            NA                 NA          NA <NA> \n5 Adelie  Torge…           36.7          19.3              193        3450 fema…\n# … with 1 more variable: year <int>\n```\n:::\n:::\n\n\n### slice_sample()\n\nUse `slice_sample()` to randomly select rows from the dataset. Instead of `(n = )` you can also provide the proportion value (between 0 and 1) using `(prop = )`. For e.g. for a dataset with 10 rows, giving `(prop = 0.5)` will randomly sample 5 rows. Other related functions include;\n\n-   `preserve` : Values include `TRUE` to preserve grouping in a grouped dataset and `FALSE` to not preserve grouping while sampling.\n-   `weight_by` : Gives priority to a particular variable during sampling. An example is given below.\n-   `replace` : Values include `TRUE` if you want sampling with replacement which can result in duplicate values, `FALSE` if you want sampling without replacement.\n\n::: panel-tabset\n## (n = 4)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\n# samples 4 rows randomly\npenguins %>% slice_sample(n = 4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 8\n  species island bill_length_mm bill_depth_mm flipper_length_… body_mass_g sex  \n  <fct>   <fct>           <dbl>         <dbl>            <int>       <int> <fct>\n1 Adelie  Dream            36            17.1              187        3700 fema…\n2 Gentoo  Biscoe           47.3          15.3              222        5250 male \n3 Adelie  Biscoe           40.1          18.9              188        4300 male \n4 Gentoo  Biscoe           48.2          14.3              210        4600 fema…\n# … with 1 more variable: year <int>\n```\n:::\n:::\n\n\n## weight_by\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\n# sampling will favour rows with higher values of 'body_mass_g'\npenguins %>% drop_na() %>% slice_sample(n = 4, weight_by = body_mass_g)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 8\n  species island bill_length_mm bill_depth_mm flipper_length_… body_mass_g sex  \n  <fct>   <fct>           <dbl>         <dbl>            <int>       <int> <fct>\n1 Chinst… Dream            49.8          17.3              198        3675 fema…\n2 Adelie  Dream            40.2          20.1              200        3975 male \n3 Adelie  Biscoe           40.6          18.6              183        3550 male \n4 Chinst… Dream            50.3          20                197        3300 male \n# … with 1 more variable: year <int>\n```\n:::\n:::\n\n:::\n\n### slice_min() and slice_max()\n\nUse `slice_min()` to extract rows containing least values and use `slice_max()` to extract rows with greatest values. The function `with_ties = FALSE` is included to avoid tie values.\n\n::: panel-tabset\n## slice_min()\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\npenguins %>% slice_min(body_mass_g, n = 4, with_ties = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 8\n  species island bill_length_mm bill_depth_mm flipper_length_… body_mass_g sex  \n  <fct>   <fct>           <dbl>         <dbl>            <int>       <int> <fct>\n1 Chinst… Dream            46.9          16.6              192        2700 fema…\n2 Adelie  Biscoe           36.5          16.6              181        2850 fema…\n3 Adelie  Biscoe           36.4          17.1              184        2850 fema…\n4 Adelie  Biscoe           34.5          18.1              187        2900 fema…\n# … with 1 more variable: year <int>\n```\n:::\n:::\n\n\n## slice_max()\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\npenguins %>% slice_max(body_mass_g, n = 4,with_ties = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 8\n  species island bill_length_mm bill_depth_mm flipper_length_… body_mass_g sex  \n  <fct>   <fct>           <dbl>         <dbl>            <int>       <int> <fct>\n1 Gentoo  Biscoe           49.2          15.2              221        6300 male \n2 Gentoo  Biscoe           59.6          17                230        6050 male \n3 Gentoo  Biscoe           51.1          16.3              220        6000 male \n4 Gentoo  Biscoe           48.8          16.2              222        6000 male \n# … with 1 more variable: year <int>\n```\n:::\n:::\n\n:::\n\n### slice_head() and slice_tail()\n\nUse `slice_head()` to extract first set of rows and use `slice_tail()` to extract last set of rows.\n\n::: panel-tabset\n## slice_head()\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\npenguins %>% slice_head(n = 4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 8\n  species island bill_length_mm bill_depth_mm flipper_length_… body_mass_g sex  \n  <fct>   <fct>           <dbl>         <dbl>            <int>       <int> <fct>\n1 Adelie  Torge…           39.1          18.7              181        3750 male \n2 Adelie  Torge…           39.5          17.4              186        3800 fema…\n3 Adelie  Torge…           40.3          18                195        3250 fema…\n4 Adelie  Torge…           NA            NA                 NA          NA <NA> \n# … with 1 more variable: year <int>\n```\n:::\n:::\n\n\n## slice_tail()\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\npenguins %>% slice_tail(n = 4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 8\n  species island bill_length_mm bill_depth_mm flipper_length_… body_mass_g sex  \n  <fct>   <fct>           <dbl>         <dbl>            <int>       <int> <fct>\n1 Chinst… Dream            43.5          18.1              202        3400 fema…\n2 Chinst… Dream            49.6          18.2              193        3775 male \n3 Chinst… Dream            50.8          19                210        4100 male \n4 Chinst… Dream            50.2          18.7              198        3775 fema…\n# … with 1 more variable: year <int>\n```\n:::\n:::\n\n:::\n\n### arrange()\n\nUse `arrange()` to arrange rows in a particular order.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\n# arranging rows in descending order of bill length\n# by default it arranges data by ascending order when no specifications are given\npenguins %>% arrange(desc(bill_length_mm))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 344 × 8\n   species   island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   <fct>     <fct>           <dbl>         <dbl>             <int>       <int>\n 1 Gentoo    Biscoe           59.6          17                 230        6050\n 2 Chinstrap Dream            58            17.8               181        3700\n 3 Gentoo    Biscoe           55.9          17                 228        5600\n 4 Chinstrap Dream            55.8          19.8               207        4000\n 5 Gentoo    Biscoe           55.1          16                 230        5850\n 6 Gentoo    Biscoe           54.3          15.7               231        5650\n 7 Chinstrap Dream            54.2          20.8               201        4300\n 8 Chinstrap Dream            53.5          19.9               205        4500\n 9 Gentoo    Biscoe           53.4          15.8               219        5500\n10 Chinstrap Dream            52.8          20                 205        4550\n# … with 334 more rows, and 2 more variables: sex <fct>, year <int>\n```\n:::\n:::\n\n\n### add_row()\n\nUse `add_row()` to add rows to the dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n\nName <- c(\"a\", \"b\")\nAge <- c(12,13)\ndata.frame(Name, Age) %>% add_row(Name = \"c\", Age = 15)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Name Age\n1    a  12\n2    b  13\n3    c  15\n```\n:::\n:::\n\n\n## Manipulating variables or columns\n\nThe following functions affect columns to give a subset of columns in a new table as output.\n\n### pull()\n\nUse `pull()` to extract columns as a vector, by name or index. Only the first 10 results are shown for easy viewing.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\npenguins %>% pull(body_mass_g)\n```\n:::\n\n\n### select()\n\nUse `select()` to extract columns as tables, by name or index.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\npenguins %>% select(species, body_mass_g)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 344 × 2\n   species body_mass_g\n   <fct>         <int>\n 1 Adelie         3750\n 2 Adelie         3800\n 3 Adelie         3250\n 4 Adelie           NA\n 5 Adelie         3450\n 6 Adelie         3650\n 7 Adelie         3625\n 8 Adelie         4675\n 9 Adelie         3475\n10 Adelie         4250\n# … with 334 more rows\n```\n:::\n:::\n\n\n### relocate()\n\nUse `relocate()` to move columns to new position. Results are not shown as these are trivial results.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\n# relocates 'species' column to last position\npenguins %>% relocate(species, .after = last_col())\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\n# relocates 'species' column before column 'year' and renames the column as 'penguins'\npenguins %>% relocate(penguins = species, .before = year)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\n# you can also relocate columns based on their class\n# relocates all columns with 'character' class to last position\npenguins %>% relocate(where(is.character), .after = last_col())\n```\n:::\n\n\n### rename()\n\nUse `rename()` function to rename column names in the dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\n# renames the column sex to gender\npenguins %>% rename(gender = sex)\n```\n:::\n\n\n### mutate()\n\nUse `mutate()` function to create new columns or variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\npenguins %>% drop_na() %>% \n  group_by(species) %>%\n  mutate(mean_mass = mean(body_mass_g))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 333 × 9\n# Groups:   species [3]\n   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   <fct>   <fct>              <dbl>         <dbl>             <int>       <int>\n 1 Adelie  Torgersen           39.1          18.7               181        3750\n 2 Adelie  Torgersen           39.5          17.4               186        3800\n 3 Adelie  Torgersen           40.3          18                 195        3250\n 4 Adelie  Torgersen           36.7          19.3               193        3450\n 5 Adelie  Torgersen           39.3          20.6               190        3650\n 6 Adelie  Torgersen           38.9          17.8               181        3625\n 7 Adelie  Torgersen           39.2          19.6               195        4675\n 8 Adelie  Torgersen           41.1          17.6               182        3200\n 9 Adelie  Torgersen           38.6          21.2               191        3800\n10 Adelie  Torgersen           34.6          21.1               198        4400\n# … with 323 more rows, and 3 more variables: sex <fct>, year <int>,\n#   mean_mass <dbl>\n```\n:::\n:::\n\n\n### transmute()\n\nDoes the same function as `mutate()` but in the process will drop any other columns and give you a table with only the newly created columns.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\npenguins %>% drop_na() %>% \n  group_by(species) %>%\n  transmute(mean_mass = mean(body_mass_g))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 333 × 2\n# Groups:   species [3]\n   species mean_mass\n   <fct>       <dbl>\n 1 Adelie      3706.\n 2 Adelie      3706.\n 3 Adelie      3706.\n 4 Adelie      3706.\n 5 Adelie      3706.\n 6 Adelie      3706.\n 7 Adelie      3706.\n 8 Adelie      3706.\n 9 Adelie      3706.\n10 Adelie      3706.\n# … with 323 more rows\n```\n:::\n:::\n\n\n### across()\n\nUse `across()` to summarise or mutate columns in the same way. First example shows `across()` used with `summarise()` function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\n# summarise across columns body mass, bill length and bill depth\n# and calculate the mean values\n# since we are calculating mean values,\n# NAs are dropped using 'drop_na() function from 'tidyr' package\n\npenguins %>% drop_na() %>%\n  group_by(species) %>%\n  summarise(across(c(body_mass_g, bill_length_mm, bill_depth_mm), mean))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 4\n  species   body_mass_g bill_length_mm bill_depth_mm\n  <fct>           <dbl>          <dbl>         <dbl>\n1 Adelie          3706.           38.8          18.3\n2 Chinstrap       3733.           48.8          18.4\n3 Gentoo          5092.           47.6          15.0\n```\n:::\n:::\n\n\nSecond example showing `across()` used with `mutate()` function. We can efficiently create new columns using `mutate()` and `across()` together. Suppose we want to multiply all numerical values in a dataset with 2 and create new columns of those values. This can be done using the code below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\n# define the function\ntwo_times <- function(x) {\n  2*x\n} \n\n# .name will rename the new columns with 'twice` prefix combined with existing col names\npenguins %>% group_by(species) %>%\n  mutate(across(where(is.numeric), two_times, .names = \"two_times_{col}\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 344 × 13\n# Groups:   species [3]\n   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   <fct>   <fct>              <dbl>         <dbl>             <int>       <int>\n 1 Adelie  Torgersen           39.1          18.7               181        3750\n 2 Adelie  Torgersen           39.5          17.4               186        3800\n 3 Adelie  Torgersen           40.3          18                 195        3250\n 4 Adelie  Torgersen           NA            NA                  NA          NA\n 5 Adelie  Torgersen           36.7          19.3               193        3450\n 6 Adelie  Torgersen           39.3          20.6               190        3650\n 7 Adelie  Torgersen           38.9          17.8               181        3625\n 8 Adelie  Torgersen           39.2          19.6               195        4675\n 9 Adelie  Torgersen           34.1          18.1               193        3475\n10 Adelie  Torgersen           42            20.2               190        4250\n# … with 334 more rows, and 7 more variables: sex <fct>, year <int>,\n#   two_times_bill_length_mm <dbl>, two_times_bill_depth_mm <dbl>,\n#   two_times_flipper_length_mm <dbl>, two_times_body_mass_g <dbl>,\n#   two_times_year <dbl>\n```\n:::\n:::\n\n\nThe same code when used just with `mutate()` function will look like this\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\n# define the function\ntwo_times <- function(x) {\n  2*x\n}\n\n# using only 'mutate()' function\npenguins %>% group_by(species) %>%\n  mutate(twice_bill_lenght = two_times(bill_length_mm),\n         twice_body_mass = two_times(body_mass_g),\n         .....)\n```\n:::\n\n\nSo in this code, I will have to manually type all the col names and apply the operation individually which is too much of a hassle. Now we can better appreciate how efficient it is in using `mutate()` and `across()` functions together.\n\n### c_across()\n\nThe function `c_across()` is similar to the earlier mentioned `across()` function. But instead of doing a column-wise function, it applies function across columns in a row-wise manner. Now, most functions in R by default computes across columns, so to specify row-wise computation, we have to explicitly use the function `rowwise()` in conjunction with other functions. In the example below we will sum both bill and flipper lengths of the penguins in the `penguins` dataset and create a new column called 'sum_of_lengths'.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(palmerpenguins)\n\npenguins %>% drop_na() %>%\n  group_by(species) %>%\n  rowwise() %>%\n  transmute(sum_of_length = sum(c_across(c(bill_length_mm,flipper_length_mm))))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 333 × 2\n# Rowwise:  species\n   species sum_of_length\n   <fct>           <dbl>\n 1 Adelie           220.\n 2 Adelie           226.\n 3 Adelie           235.\n 4 Adelie           230.\n 5 Adelie           229.\n 6 Adelie           220.\n 7 Adelie           234.\n 8 Adelie           223.\n 9 Adelie           230.\n10 Adelie           233.\n# … with 323 more rows\n```\n:::\n:::\n\n\n## Summary\n\nThe `{dplyr}` package is the grammar of the data manipulation in R. It features well-made functions to help us summarise the data, group data by variables and manipulate columns and rows in the dataset. In this chapter, we learned in detail the different functions that help us manipulate data efficiently and have seen case examples also. In the next chapter, we will see the remaining set of functions in the `{dplyr}` package.\n\n## References\n\n1.  Hadley Wickham, Romain François, Lionel Henry and Kirill Müller (2021). dplyr: A Grammar of Data Manipulation. R package version 1.0.7. https://CRAN.R-project.org/package=dplyr Here is the [link](https://github.com/rstudio/cheatsheets/blob/main/data-transformation.pdf) to the cheat sheet explaining each function in `{dplyr}`.\n\n2.  Horst AM, Hill AP, Gorman KB (2020). palmerpenguins: Palmer Archipelago (Antarctica) penguin data. R package version 0.1.0. https://allisonhorst.github.io/palmerpenguins/\n\n3.  Hadley Wickham (2021). tidyr: Tidy Messy Data. R package version 1.1.4. https://CRAN.R-project.org/package=tidyr\n\n#### Last updated on {.unnumbered .unlisted}\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2022-07-18 13:00:59 IST\"\n```\n:::\n:::\n\n\n<a hidden href=\"https://info.flagcounter.com/ynrK\"><img src=\"https://s11.flagcounter.com/count2/ynrK/bg_000000/txt_FFFFFF/border_F0F0F0/columns_5/maxflags_25/viewers_0/labels_1/pageviews_1/flags_0/percent_0/\" alt=\"Flag Counter\" border=\"0\"/></a>\n",
    "supporting": [
      "project6_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}