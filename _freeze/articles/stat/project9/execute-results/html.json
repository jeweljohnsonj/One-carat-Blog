{
  "hash": "e96aacda8c0f75fa482dc9c9fccf5e3a",
  "result": {
    "markdown": "---\ntitle: \"Chapter 9: Tests for multiple groups of data\"\nsubtitle: |\n  Learn about ANOVA and its non-paramteric derivatives\nauthor: \"Jewel Johnson\"\ndate: \"05/21/2022\"\nformat:\n  html:\n    toc: true\n    toc-title: On this page\n    html-math-method: katex\n    css: styles.css\n    number-sections: true\n    smooth-scroll: true\n    highlight-style: github\n    code-link: true\n    code-tools: true\ncitation: true\ncomments:\n  hypothesis: true\nexecute: \n  warning: false\n  freeze: auto\nimage: \"images/stat.jpg\"\ndraft: true\n---\n\n\n\n\n## Multiple pairwise comparisons problem\n\nImagine you are rolling dice. Then the probability to get 6 as an outcome is;\n\n\n```{=tex}\n\\begin{align*}\nP(probability\\ to\\ get\\ 6) &= 1/6 \\\\\n&= 1- P(probability\\ to\\ not\\ get\\ 6) \\\\\n&= 1- 5/6 \\\\\nTherefore;\\ P(probability\\ to\\ not\\ get\\ 6) &= 1- 1/6\n\\end{align*}\n```\n\nLet's roll the dice for the second time, the what is the probability to get at least one 6 in these two attempts.\n\n\n```{=tex}\n\\begin{align*}\nP(probability\\ to\\ get\\ at\\ least\\ one\\ 6\\ in\\ two\\ rolls) &= 1/6 + 1/6\\\\\n&= 1- P(probability\\ to\\ not\\ get\\ 6\\ in\\ two\\ rolls) \\\\\n&= 1 - (1 - 1/6)^2\n\\end{align*}\n```\n\nTherefore for $n$ rolls, we have the probability to get at least one 6 as;\n\n\n```{=tex}\n\\begin{align*}\nP(probability\\ to\\ get\\ at\\ least\\ one\\ 6\\ in\\ n\\ rolls) &= 1/6 + 1/6 + \\dots \\\\\n&= 1- P(probability\\ to\\ not\\ get\\ 6\\ in\\ n\\ rolls) \\\\\n&= 1 - (1 - 1/6)^n\n\\end{align*}\n```\n\nTherefore as we keep increasing the rolls, we are bound to get a 6 in one of these rolls. This means the probability to get 6 increases as the number of rolls increases.\n\nNow with the same notion as earlier, imagine the following situation.\n\nImagine you have set $\\alpha$ = 0.05, then the probability to have a type I error will be 0.05, and the probability of not having a type I error will be 0.95.\n\n\n```{=tex}\n\\begin{align*}\nP(Probability\\ to\\ have\\ type\\ I\\ error)&= 1 - P(Probability\\ to\\ not\\ have\\ type\\ I\\ error) \\\\\n&= 1- 0.95 \\\\\nTherefore;\\ P(Probability\\ to\\ not\\ have\\ type\\ I\\ error) &= 1 - 0.05\n\\end{align*}\n```\n\nNow if we do the same test again, the probability to get at least a single type I error is;\n\n\n```{=tex}\n\\begin{align*}\nP(Probability\\ to\\ have\\ at\\ least\\ one\\ type\\ I\\ error\\ in\\ 2\\ tests)&= 1 - P(Probability\\ to\\ have\\ no\\ type\\ I\\ error\\ in\\ 2\\ tests) \\\\\n&= 1- (1-0.05)^2\n\\end{align*}\n```\n\nTherefore if we perform $n$ pairwise comparisons, then the probability to have at least one type I error in n tests is;\n\n\n```{=tex}\n\\begin{align*}\nP(Probability\\ to\\ have\\ at\\ least\\ one\\ type\\ I\\ error\\ in\\ n\\ tests)&= 1 - P(Probability\\ to\\ have\\ no\\ type\\ I\\ error\\ in\\ n\\ tests) \\\\\n&= 1- (1-0.05)^n\n\\end{align*}\n```\n\nLike for the coin toss problem we get an increased probability to get a type I error, even when we had set the initial $\\alpha$ to be 0.05. As an example, if we do multiple t-tests for different groups in our data, considering multiple hypotheses, we have a high chance of getting a type I error. This is known as a multiple pairwise comparison problem. This is avoided by implementing countermeasures called multiple comparison corrections such as Tukey Honest Significant Differences and the Bonferroni method.\n\n## Parametric multiple comparison test\n\nIf the data follows the assumptions for parametric tests, then for comparing multiple independent groups of data, we can ANOVA. A significant p-value from ANOVA indicates some of the group differences are significantly different from each other, but it does not tell which of these groups are different from each other. To know which groups are different from each other, we perform a post hoc test like a t-test, Tukey's test etc.\n\n## ANOVA\n\n### one way ANOVA\n\nNow let us try doing ANOVA in R. Like before, we will be using the `penguins` dataset from the `{palmerpenguins}` package in R. We will compare the body masses of all three species of penguins in the dataset and see if any two of them are significantly different from each other. In this case, we will be doing a one-way ANOVA, where species is our independent variable and body mass is the independent variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"palmerpenguins\")\n#install.packages(\"tidyverse\")\nlibrary(palmerpenguins)\nlibrary(tidyverse)\n\n# selecting species and mass columns\npen_mass <- penguins[,c(1,6)]\n# one way ANOVA test\nanova1 <- aov(body_mass_g ~ species, data = pen_mass)\n# summarising test result\nsummary(anova1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n             Df    Sum Sq  Mean Sq F value Pr(>F)    \nspecies       2 146864214 73432107   343.6 <2e-16 ***\nResiduals   339  72443483   213698                   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n2 observations deleted due to missingness\n```\n:::\n:::\n\n\nThe column Pr(\\>F) corresponds to the p-value of the test and from the result we find that the test returned a statistically significant p-value. Now to see which species have different body masses from each other, we run a post-hoc test which in this case, we will run a Tukey HSD test.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"palmerpenguins\")\n#install.packages(\"tidyverse\")\nlibrary(palmerpenguins)\nlibrary(tidyverse)\n\n# selecting species and mass columns\npen_mass <- penguins[,c(1,6)]\n# one way ANOVA test\nanova1 <- aov(body_mass_g ~ species, data = pen_mass)\n# tukey HSD test\nTukeyHSD(anova1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n\nFit: aov(formula = body_mass_g ~ species, data = pen_mass)\n\n$species\n                       diff       lwr       upr     p adj\nChinstrap-Adelie   32.42598 -126.5002  191.3522 0.8806666\nGentoo-Adelie    1375.35401 1243.1786 1507.5294 0.0000000\nGentoo-Chinstrap 1342.92802 1178.4810 1507.3750 0.0000000\n```\n:::\n:::\n\n\nFrom the post-hoc test, we can see that body masses between Gentoo-Adelie and Gentoo-Chinstrap are significantly different from each other.\n\n### two way ANOVA\n\nNow if we have more than one independent variable, then we can do a `two-way ANOVA`. In the test below we have both `species` and `island` as the independent variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"palmerpenguins\")\n#install.packages(\"tidyverse\")\nlibrary(palmerpenguins)\nlibrary(tidyverse)\n\n# selecting species and mass columns\npen_mass_land <- penguins[,c(1,2,6)]\n# two way ANOVA test\nanova2 <- aov(body_mass_g ~ species + island, data = pen_mass_land)\n# summarising test result\nsummary(anova2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n             Df    Sum Sq  Mean Sq F value Pr(>F)    \nspecies       2 146864214 73432107 341.663 <2e-16 ***\nisland        2     13655     6827   0.032  0.969    \nResiduals   337  72429829   214925                   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n2 observations deleted due to missingness\n```\n:::\n:::\n\n\nHere the results suggests that, body masses are different between species but there is no significant difference in body mass across the different islands. The follow up post-hoc test would look like this.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"palmerpenguins\")\n#install.packages(\"tidyverse\")\nlibrary(palmerpenguins)\nlibrary(tidyverse)\n\n# selecting species and mass columns\npen_mass_land <- penguins[,c(1,2,6)]\n# two way ANOVA test\nanova2 <- aov(body_mass_g ~ species + island, data = pen_mass_land)\n# tukey HSD test\nTukeyHSD(anova2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n\nFit: aov(formula = body_mass_g ~ species + island, data = pen_mass_land)\n\n$species\n                       diff       lwr       upr     p adj\nChinstrap-Adelie   32.42598 -126.9602  191.8122 0.8813058\nGentoo-Adelie    1375.35401 1242.7960 1507.9120 0.0000000\nGentoo-Chinstrap 1342.92802 1178.0050 1507.8511 0.0000000\n\n$island\n                      diff       lwr      upr     p adj\nDream-Biscoe     -7.911442 -137.2861 121.4632 0.9886403\nTorgersen-Biscoe  3.339873 -171.2651 177.9448 0.9988827\nTorgersen-Dream  11.251314 -170.2981 192.8007 0.9883345\n```\n:::\n:::\n\n\nWe got tot the same inference as last time.\n\n### two way ANOVA with dependent variable\n\nNow suppose that there is a synergistic effect between `species` and `sex` variable. Then in that case they are not independent with each other, nevertheless we can incorporate this factor by changing the addition sign `+` between the variables to an asterisk sign `*`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"palmerpenguins\")\n#install.packages(\"tidyverse\")\nlibrary(palmerpenguins)\nlibrary(tidyverse)\n\n# selecting species and mass columns\npen_mass_land <- penguins[,c(1,6,7)]\n# two way ANOVA test with dependent variables\n# species and sex variables are dependent in nature\nanova_2 <- aov(body_mass_g ~ species * sex, data = pen_mass_land)\n# summarising test result\nsummary(anova_2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n             Df    Sum Sq  Mean Sq F value   Pr(>F)    \nspecies       2 145190219 72595110 758.358  < 2e-16 ***\nsex           1  37090262 37090262 387.460  < 2e-16 ***\nspecies:sex   2   1676557   838278   8.757 0.000197 ***\nResiduals   327  31302628    95727                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n11 observations deleted due to missingness\n```\n:::\n:::\n\n\nFrom the result we can see that both species and sex have a significant effect on body mass and also the interaction between species and sex is also a significant effect.\n\nThe follow up post hoc test result will be;\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"palmerpenguins\")\n#install.packages(\"tidyverse\")\nlibrary(palmerpenguins)\nlibrary(tidyverse)\n\n# selecting species and mass columns\npen_mass_land <- penguins[,c(1,6,7)]\n# two way ANOVA test with dependent variables\n# species and sex variables are dependent in nature\nanova_2 <- aov(body_mass_g ~ species * sex, data = pen_mass_land)\n# tukey HSD test\nTukeyHSD(anova_2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n\nFit: aov(formula = body_mass_g ~ species * sex, data = pen_mass_land)\n\n$species\n                       diff       lwr       upr     p adj\nChinstrap-Adelie   26.92385  -80.0258  133.8735 0.8241288\nGentoo-Adelie    1386.27259 1296.3070 1476.2382 0.0000000\nGentoo-Chinstrap 1359.34874 1248.6108 1470.0866 0.0000000\n\n$sex\n                diff      lwr      upr p adj\nmale-female 667.4577 600.7462 734.1692     0\n\n$`species:sex`\n                                     diff       lwr       upr     p adj\nChinstrap:female-Adelie:female   158.3703  -25.7874  342.5279 0.1376213\nGentoo:female-Adelie:female     1310.9058 1154.8934 1466.9181 0.0000000\nAdelie:male-Adelie:female        674.6575  527.8486  821.4664 0.0000000\nChinstrap:male-Adelie:female     570.1350  385.9773  754.2926 0.0000000\nGentoo:male-Adelie:female       2116.0004 1962.1408 2269.8601 0.0000000\nGentoo:female-Chinstrap:female  1152.5355  960.9603 1344.1107 0.0000000\nAdelie:male-Chinstrap:female     516.2873  332.1296  700.4449 0.0000000\nChinstrap:male-Chinstrap:female  411.7647  196.6479  626.8815 0.0000012\nGentoo:male-Chinstrap:female    1957.6302 1767.8040 2147.4564 0.0000000\nAdelie:male-Gentoo:female       -636.2482 -792.2606 -480.2359 0.0000000\nChinstrap:male-Gentoo:female    -740.7708 -932.3460 -549.1956 0.0000000\nGentoo:male-Gentoo:female        805.0947  642.4300  967.7594 0.0000000\nChinstrap:male-Adelie:male      -104.5226 -288.6802   79.6351 0.5812048\nGentoo:male-Adelie:male         1441.3429 1287.4832 1595.2026 0.0000000\nGentoo:male-Chinstrap:male      1545.8655 1356.0392 1735.6917 0.0000000\n```\n:::\n:::\n\n\nFrom the pairwise comparisons we can see that male and female penguins have significantly different body masses and also the Chinstrap penguins with respect to sex, have similar body mass to Adelie penguins.\n\n### ANOVA test for unbalanced designs\n\nNow if the dataset has unequal sample sizes for each groups, then we can use the `ANOVA test for unbalanced designs`. To use the test we would require the `{car}` package in R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"palmerpenguins\")\n#install.packages(\"tidyverse\")\n#install.packages(“car”)\nlibrary(palmerpenguins)\nlibrary(tidyverse)\nlibrary(car)\n\n# selecting species and mass columns\npen_mass_land <- penguins[,c(1,6,7)]\n# two way ANOVA test with dependent variables\n# species and sex variables are dependent in nature\nanova_2 <- aov(body_mass_g ~ species * sex, data = pen_mass_land)\nAnova(anova_2, type = \"III\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"Sum Sq\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Df\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"F value\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Pr(>F)\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"828480899\",\"2\":\"1\",\"3\":\"8654.648789\",\"4\":\"2.553747e-237\",\"_rn_\":\"(Intercept)\"},{\"1\":\"60350016\",\"2\":\"2\",\"3\":\"315.220419\",\"4\":\"5.208996e-77\",\"_rn_\":\"species\"},{\"1\":\"16613442\",\"2\":\"1\",\"3\":\"173.550777\",\"4\":\"4.371987e-32\",\"_rn_\":\"sex\"},{\"1\":\"1676557\",\"2\":\"2\",\"3\":\"8.756997\",\"4\":\"1.973489e-04\",\"_rn_\":\"species:sex\"},{\"1\":\"31302628\",\"2\":\"327\",\"3\":\"NA\",\"4\":\"NA\",\"_rn_\":\"Residuals\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### MANOVA\n\nIf you have multiple dependent variables, then you can use `MANOVA`. Here our dependent variables are body mass and bill depth and independent variable is species. We want to see if body mass and bill depth is associated with different species of penguins.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"palmerpenguins\")\n#install.packages(\"tidyverse\")\n#install.packages(“car”)\nlibrary(palmerpenguins)\nlibrary(tidyverse)\nlibrary(car)\n\n# selecting species and mass columns\npen_mass_bill <- penguins[,c(1,4,6)]\nmass_bill <- cbind(penguins$bill_depth_mm, penguins$body_mass_g)\n# two way ANOVA test with dependent variables\n# species and sex variables are dependent in nature\nanova_3<- manova(mass_bill ~ species, data = pen_mass_bill)\nsummary(anova_3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           Df  Pillai approx F num Df den Df    Pr(>F)    \nspecies     2 0.91732   143.61      4    678 < 2.2e-16 ***\nResiduals 339                                             \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nFrom the result, we can see that, species statistically significant association with both combined body mass and bill depth variables.\n\n## Kruskal-Wallis Test\n\nThe Kruskal-Wallis test is the non-parametric equivalent of ANOVA.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"palmerpenguins\")\n#install.packages(\"tidyverse\")\nlibrary(palmerpenguins)\nlibrary(tidyverse)\n\n# selecting species and mass columns\npen_mass <- penguins[,c(1,6)]\n# Kruskal-Wallis Test\nkruskal.test(body_mass_g ~ species, data = pen_mass)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tKruskal-Wallis rank sum test\n\ndata:  body_mass_g by species\nKruskal-Wallis chi-squared = 217.6, df = 2, p-value < 2.2e-16\n```\n:::\n:::\n\n\nFor post-hoc test, we can use the non-parametric version of pairwise comparisons tests coupled with p-value correction. Here we will be using the Wilcoxon rank sum test.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"palmerpenguins\")\n#install.packages(\"tidyverse\")\nlibrary(palmerpenguins)\nlibrary(tidyverse)\n\n# selecting species and mass columns\npen_mass <- penguins[,c(1,6)]\n# wilcoxon rank sum test\npairwise.wilcox.test(pen_mass$body_mass_g, pen_mass$species, p.adjust.method = \"BH\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPairwise comparisons using Wilcoxon rank sum test with continuity correction \n\ndata:  pen_mass$body_mass_g and pen_mass$species \n\n          Adelie Chinstrap\nChinstrap 0.49   -        \nGentoo    <2e-16 <2e-16   \n\nP value adjustment method: BH \n```\n:::\n:::\n\n\nHere we can see that, Gentoo penguins have significantly different body masses compared to both Adelie and Chinstrap species.\n\n## References\n\n1.  Cardinal, R.N., & Aitken, M.R.F. (2005). ANOVA for the Behavioral Sciences Researcher (1st ed.). Psychology Press. https://doi.org/10.4324/9780203763933 [Link](https://www.taylorfrancis.com/books/mono/10.4324/9780203763933/anova-behavioral-sciences-researcher-rudolf-cardinal-michael-aitken)\n\n2.  Keselman HJ, Huberty CJ, Lix LM, et al. Statistical Practices of Educational Researchers: An Analysis of their ANOVA, MANOVA, and ANCOVA Analyses. Review of Educational Research. 1998;68(3):350-386. doi:10.3102/00346543068003350 [Link](https://journals.sagepub.com/doi/abs/10.3102/00346543068003350)\n\n#### Last updated on {.unnumbered .unlisted}\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2022-05-26 21:05:13 IST\"\n```\n:::\n:::\n\n\n<a hidden href=\"https://info.flagcounter.com/ynrK\"><img src=\"https://s11.flagcounter.com/count2/ynrK/bg_000000/txt_FFFFFF/border_F0F0F0/columns_5/maxflags_25/viewers_0/labels_1/pageviews_1/flags_0/percent_0/\" alt=\"Flag Counter\" border=\"0\"/></a>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}