{
  "hash": "8b89c7ea60b5d594e673dcbba080d8a7",
  "result": {
    "markdown": "---\ntitle: \"The World Happiness Report 2021\"\ndescription: \"Plotting an interactive map and more\"\nauthor: \"Jewel Johnson\"\ndate: \"05-20-2022\"\nformat:\n  html:\n    toc: false\n    toc-title: On this page\n    html-math-method: katex\n    number-sections: false\n    smooth-scroll: true\n    highlight-style: github\n    code-link: true\n    code-tools: true\ncitation: true\nexecute: \n  warning: false\ncategories: [leaflet, ggstatsplot]\nimage: \"world.jpg\"\n---\n\n\n## Getting the data\n\nIn this post we will do some exploratory data visualizations using data from [The World Happiness Report 2022](https://worldhappiness.report/ed/2022/). You can download the `.csv` file from [here](https://www.kaggle.com/datasets/mathurinache/world-happiness-report?select=2022.csv).\n\n**World Happiness Report 2022** shows which are the happiest countries for the year 2022. By statistically analyzing six key parameters, each country is given a score (which is called `ladder score` within the dataset). The higher the score, the happier the country is and vice versa. The six key parameters which are taken into analysis for determining the score are;\n\n1. Gross domestic product per capita\n2. Social support\n3. Healthy life expectancy\n4. Freedom to make your own life choices\n5. Generosity of the general population\n6. Perceptions of internal and external corruption levels.\n\nFinland is ranked first among 149 countries with an overall score of 7.82. Despite COVID 19 wrecking havoc around the world, citizens of Finland have persevered through it and they have been maintaining first rank since 2016. Afghanistan is at the lowest rank with a score of 2.40. With complications from COVID 19 pandemic and the Taliban take over, Afghanistan is going through one of the worst humanitarian crisis in human history and the ranking reflects it.\n\n## Plotting a world map\n\nWe will plot a world map with a scalable colour palette based on the ladder score where greater scores indicated happier countries and vice versa.\n\nIn short what we we will be doing is, we are going to join the World Happiness Report 2021 dataset with the map data and plot it using the `{ggplot2}` package. The `map_data()` function helps us easily turn data from the `{maps}` package in to a data frame suitable for plotting with ggplot2.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# required packages\nlibrary(readr)\nlibrary(tidyverse)\nlibrary(maps)\nlibrary(viridis)\n\n# load the dataset which you have downloaded\n# please change the location to where your downloaded file is kept\nhap_pre <- read.csv(\"datasets/2022.csv\")\n\n# renaming column names of ease of use\ncolnames(hap_pre)[2] <- \"country\"\ncolnames(hap_pre)[3] <- \"score\"\nhap_pre <- hap_pre[-147,]\n\n# the score values are separated by commas\n# let us change that to dots\nhap_pre$score <- scan(text=hap_pre$score, dec=\",\", sep=\".\")\n\n# selecting country and score columns\nhap <- hap_pre %>% select(country,score)\n\n# removing special characters in df\nhap$country <- gsub(\"[[:punct:]]\",\"\",as.character(hap$country))\n\n# loading map\nmap_world <- map_data('world')\n# remove Antarctica\nmap_world <- map_world[!map_world$region ==\"Antarctica\",]\n\n# checking which country names are a mismatch between map data and the downloaded dataset\nanti_join(hap, map_world,  by = c(\"country\" = \"region\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                   country score\n1            United States 6.977\n2           United Kingdom 6.943\n3                  Czechia 6.920\n4 Taiwan Province of China 6.512\n5             North Cyprus 5.467\n6   Hong Kong SAR of China 5.425\n7                    Congo 5.075\n8  Palestinian Territories 4.483\n9      Eswatini Kingdom of 4.396\n```\n:::\n:::\n\n\nYou can see that some country names are a mismatch with the map data. So we will attempt to fix it.\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\n# display all country names in the dataset\n# useful to locate correct country names\n#map_world %>% group_by(region) %>% summarise() %>% print(n = Inf)\n\n# correcting country names\n# here we are matching the country names of downloaded dataset with the map data\ncorrect_names <- c(\"United States\" = \"USA\",\n                   \"United Kingdom\" = \"UK\",\n                   \"Czechia\" = \"Czech Republic\",\n                   \"Taiwan Province of China\"  = \"Taiwan\",\n                   \"North Cyprus\"= \"Cyprus\",\n                   \"Congo\"= \"Republic of Congo\",\n                   \"Palestinian Territories\" = \"Palestine\",\n                   \"Eswatini Kingdom of\" = \"Swaziland\")\n\n# recoding country names \nhap2 <- hap %>% mutate(country = recode(country, !!!correct_names))\n\n# joining map and the data\nworld_hap <- left_join(map_world, hap2, by = c(\"region\" = \"country\"))\n\n# creating a function to add line in text, for the caption\naddline_format <- function(x,...){\n  gsub(',','\\n',x)}\n\n# plotting the world map\nggplot(world_hap, aes(long, lat)) + geom_polygon(aes(fill = score, group = group)) +\n  scale_fill_viridis(option = \"viridis\") + theme_void() +\n  theme(plot.background = element_rect(fill = \"aliceblue\"),\n        legend.position=\"bottom\") + \n  labs(title = \"Happiness scores of countries in 2022\",\n       subtitle = addline_format(\"Higher scores indicate happier countries and vice versa,Grey colour represents countries with no data\"),\n       fill = \"Score\",\n       caption = addline_format(\"Source: World Happiness Report 2022,Visualization by Jewel Johnson\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}